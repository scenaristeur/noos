(self["webpackChunknoos"]=self["webpackChunknoos"]||[]).push([[450],{3450:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return X_}});var i={};n.r(i),n.d(i,{AsyncCompress:function(){return av},AsyncDecompress:function(){return Mv},AsyncDeflate:function(){return Qg},AsyncGunzip:function(){return uv},AsyncGzip:function(){return av},AsyncInflate:function(){return iv},AsyncUnzipInflate:function(){return Jv},AsyncUnzlib:function(){return xv},AsyncZipDeflate:function(){return Gv},AsyncZlib:function(){return fv},Compress:function(){return ov},DecodeUTF8:function(){return Rv},Decompress:function(){return wv},Deflate:function(){return $g},EncodeUTF8:function(){return Iv},Gunzip:function(){return hv},Gzip:function(){return ov},Inflate:function(){return nv},Unzip:function(){return Kv},UnzipInflate:function(){return Zv},UnzipPassThrough:function(){return Yv},Unzlib:function(){return yv},Zip:function(){return jv},ZipDeflate:function(){return Wv},ZipPassThrough:function(){return Hv},Zlib:function(){return mv},compress:function(){return lv},compressSync:function(){return cv},decompress:function(){return Sv},decompressSync:function(){return Tv},deflate:function(){return tv},deflateSync:function(){return ev},gunzip:function(){return dv},gunzipSync:function(){return pv},gzip:function(){return lv},gzipSync:function(){return cv},inflate:function(){return rv},inflateSync:function(){return sv},strFromU8:function(){return Ov},strToU8:function(){return Dv},unzip:function(){return $v},unzipSync:function(){return Qv},unzlib:function(){return bv},unzlibSync:function(){return _v},zip:function(){return qv},zipSync:function(){return Xv},zlib:function(){return gv},zlibSync:function(){return vv}});var r=function(){var t=this;t._self._c;return t._m(0)},s=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"main-content"},[t._v(" Main "),e("div",{staticClass:"home",attrs:{id:"myCanvas"}})])}];n(7658),n(3408),n(4590),n(541);
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const o="144",a={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},l={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},c=0,h=1,u=2,d=1,p=2,m=3,f=0,g=1,v=2,y=0,x=1,b=2,_=3,w=4,M=5,S=100,T=101,A=102,E=103,C=104,P=200,L=201,R=202,I=203,D=204,O=205,N=206,k=207,z=208,B=209,F=210,U=0,V=1,H=2,W=3,G=4,j=5,q=6,X=7,Y=0,Z=1,J=2,K=0,$=1,Q=2,tt=3,et=4,nt=5,it=300,rt=301,st=302,ot=303,at=304,lt=306,ct=1e3,ht=1001,ut=1002,dt=1003,pt=1004,mt=1005,ft=1006,gt=1007,vt=1008,yt=1009,xt=1010,bt=1011,_t=1012,wt=1013,Mt=1014,St=1015,Tt=1016,At=1017,Et=1018,Ct=1020,Pt=1021,Lt=1022,Rt=1023,It=1024,Dt=1025,Ot=1026,Nt=1027,kt=1028,zt=1029,Bt=1030,Ft=1031,Ut=1033,Vt=33776,Ht=33777,Wt=33778,Gt=33779,jt=35840,qt=35841,Xt=35842,Yt=35843,Zt=36196,Jt=37492,Kt=37496,$t=37808,Qt=37809,te=37810,ee=37811,ne=37812,ie=37813,re=37814,se=37815,oe=37816,ae=37817,le=37818,ce=37819,he=37820,ue=37821,de=36492,pe=2200,me=2201,fe=2202,ge=2300,ve=2301,ye=2302,xe=2400,be=2401,_e=2402,we=2500,Me=2501,Se=1,Te=2,Ae=3e3,Ee=3001,Ce=3200,Pe=3201,Le=0,Re=1,Ie="srgb",De="srgb-linear",Oe=7680,Ne=519,ke=35044,ze="300 es",Be=1035;class Fe{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners,i=n[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners,n=e[t.type];if(void 0!==n){t.target=this;const e=n.slice(0);for(let n=0,i=e.length;n<i;n++)e[n].call(this,t);t.target=null}}}const Ue=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Ve=1234567;const He=Math.PI/180,We=180/Math.PI;function Ge(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=Ue[255&t]+Ue[t>>8&255]+Ue[t>>16&255]+Ue[t>>24&255]+"-"+Ue[255&e]+Ue[e>>8&255]+"-"+Ue[e>>16&15|64]+Ue[e>>24&255]+"-"+Ue[63&n|128]+Ue[n>>8&255]+"-"+Ue[n>>16&255]+Ue[n>>24&255]+Ue[255&i]+Ue[i>>8&255]+Ue[i>>16&255]+Ue[i>>24&255];return r.toLowerCase()}function je(t,e,n){return Math.max(e,Math.min(n,t))}function qe(t,e){return(t%e+e)%e}function Xe(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)}function Ye(t,e,n){return t!==e?(n-t)/(e-t):0}function Ze(t,e,n){return(1-n)*t+n*e}function Je(t,e,n,i){return Ze(t,e,1-Math.exp(-n*i))}function Ke(t,e=1){return e-Math.abs(qe(t,2*e)-e)}function $e(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function Qe(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(6*t-15)+10))}function tn(t,e){return t+Math.floor(Math.random()*(e-t+1))}function en(t,e){return t+Math.random()*(e-t)}function nn(t){return t*(.5-Math.random())}function rn(t){void 0!==t&&(Ve=t);let e=Ve+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}function sn(t){return t*He}function on(t){return t*We}function an(t){return 0===(t&t-1)&&0!==t}function ln(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function cn(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function hn(t,e,n,i,r){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+i)/2),h=o((e+i)/2),u=s((e-i)/2),d=o((e-i)/2),p=s((i-e)/2),m=o((i-e)/2);switch(r){case"XYX":t.set(a*h,l*u,l*d,a*c);break;case"YZY":t.set(l*d,a*h,l*u,a*c);break;case"ZXZ":t.set(l*u,l*d,a*h,a*c);break;case"XZX":t.set(a*h,l*m,l*p,a*c);break;case"YXY":t.set(l*p,a*h,l*m,a*c);break;case"ZYZ":t.set(l*m,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function un(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function dn(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}var pn=Object.freeze({__proto__:null,DEG2RAD:He,RAD2DEG:We,generateUUID:Ge,clamp:je,euclideanModulo:qe,mapLinear:Xe,inverseLerp:Ye,lerp:Ze,damp:Je,pingpong:Ke,smoothstep:$e,smootherstep:Qe,randInt:tn,randFloat:en,randFloatSpread:nn,seededRandom:rn,degToRad:sn,radToDeg:on,isPowerOfTwo:an,ceilPowerOfTwo:ln,floorPowerOfTwo:cn,setQuaternionFromProperEuler:hn,normalize:dn,denormalize:un});class mn{constructor(t=0,e=0){mn.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){const t=Math.atan2(-this.y,-this.x)+Math.PI;return t}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class fn{constructor(){fn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,n,i,r,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=o,c[3]=e,c[4]=r,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],m=i[0],f=i[3],g=i[6],v=i[1],y=i[4],x=i[7],b=i[2],_=i[5],w=i[8];return r[0]=s*m+o*v+a*b,r[3]=s*f+o*y+a*_,r[6]=s*g+o*x+a*w,r[1]=l*m+c*v+h*b,r[4]=l*f+c*y+h*_,r[7]=l*g+c*x+h*w,r[2]=u*m+d*v+p*b,r[5]=u*f+d*y+p*_,r[8]=u*g+d*x+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*r*c+n*o*a+i*r*l-i*s*a}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=c*s-o*l,u=o*a-c*r,d=l*r-s*a,p=e*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*l-c*n)*m,t[2]=(o*n-i*s)*m,t[3]=u*m,t[4]=(c*e-i*a)*m,t[5]=(i*r-o*e)*m,t[6]=d*m,t[7]=(n*a-l*e)*m,t[8]=(s*e-n*r)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-i*l,i*a,-i*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],s=i[3],o=i[6],a=i[1],l=i[4],c=i[7];return i[0]=e*r+n*a,i[3]=e*s+n*l,i[6]=e*o+n*c,i[1]=-n*r+e*a,i[4]=-n*s+e*l,i[7]=-n*o+e*c,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function gn(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const vn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function yn(t,e){return new vn[t](e)}function xn(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function bn(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function _n(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const wn={[Ie]:{[De]:bn},[De]:{[Ie]:_n}},Mn={legacyMode:!0,get workingColorSpace(){return De},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,n){if(this.legacyMode||e===n||!e||!n)return t;if(wn[e]&&void 0!==wn[e][n]){const i=wn[e][n];return t.r=i(t.r),t.g=i(t.g),t.b=i(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},Sn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Tn={r:0,g:0,b:0},An={h:0,s:0,l:0},En={h:0,s:0,l:0};function Cn(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function Pn(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class Ln{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Ie){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Mn.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=De){return this.r=t,this.g=e,this.b=n,Mn.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=De){if(t=qe(t,1),e=je(e,0,1),n=je(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Cn(r,i,t+1/3),this.g=Cn(r,i,t),this.b=Cn(r,i,t-1/3)}return Mn.toWorkingColorSpace(this,i),this}setStyle(t,e=Ie){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,Mn.toWorkingColorSpace(this,e),n(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,Mn.toWorkingColorSpace(this,e),n(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(t[1])/360,r=parseFloat(t[2])/100,s=parseFloat(t[3])/100;return n(t[4]),this.setHSL(i,r,s,e)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],n=t.length;if(3===n)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,Mn.toWorkingColorSpace(this,e),this;if(6===n)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,Mn.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=Ie){const n=Sn[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=bn(t.r),this.g=bn(t.g),this.b=bn(t.b),this}copyLinearToSRGB(t){return this.r=_n(t.r),this.g=_n(t.g),this.b=_n(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Ie){return Mn.fromWorkingColorSpace(Pn(this,Tn),t),je(255*Tn.r,0,255)<<16^je(255*Tn.g,0,255)<<8^je(255*Tn.b,0,255)<<0}getHexString(t=Ie){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=De){Mn.fromWorkingColorSpace(Pn(this,Tn),e);const n=Tn.r,i=Tn.g,r=Tn.b,s=Math.max(n,i,r),o=Math.min(n,i,r);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=c<=.5?t/(s+o):t/(2-s-o),s){case n:a=(i-r)/t+(i<r?6:0);break;case i:a=(r-n)/t+2;break;case r:a=(n-i)/t+4;break}a/=6}return t.h=a,t.s=l,t.l=c,t}getRGB(t,e=De){return Mn.fromWorkingColorSpace(Pn(this,Tn),e),t.r=Tn.r,t.g=Tn.g,t.b=Tn.b,t}getStyle(t=Ie){return Mn.fromWorkingColorSpace(Pn(this,Tn),t),t!==Ie?`color(${t} ${Tn.r} ${Tn.g} ${Tn.b})`:`rgb(${255*Tn.r|0},${255*Tn.g|0},${255*Tn.b|0})`}offsetHSL(t,e,n){return this.getHSL(An),An.h+=t,An.s+=e,An.l+=n,this.setHSL(An.h,An.s,An.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(An),t.getHSL(En);const n=Ze(An.h,En.h,e),i=Ze(An.s,En.s,e),r=Ze(An.l,En.l,e);return this.setHSL(n,i,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Rn;Ln.NAMES=Sn;class In{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Rn&&(Rn=xn("canvas")),Rn.width=t.width,Rn.height=t.height;const n=Rn.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Rn}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap){const e=xn("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*bn(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*bn(e[t]/255)):e[t]=bn(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class Dn{constructor(t=null){this.isSource=!0,this.uuid=Ge(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(On(i[e].image)):t.push(On(i[e]))}else t=On(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function On(t){return"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?In.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Nn=0;class kn extends Fe{constructor(t=kn.DEFAULT_IMAGE,e=kn.DEFAULT_MAPPING,n=ht,i=ht,r=ft,s=vt,o=Rt,a=yt,l=1,c=Ae){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Nn++}),this.uuid=Ge(),this.name="",this.source=new Dn(t),this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new mn(0,0),this.repeat=new mn(1,1),this.center=new mn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new fn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==it)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ct:t.x=t.x-Math.floor(t.x);break;case ht:t.x=t.x<0?0:1;break;case ut:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case ct:t.y=t.y-Math.floor(t.y);break;case ht:t.y=t.y<0?0:1;break;case ut:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}kn.DEFAULT_IMAGE=null,kn.DEFAULT_MAPPING=it;class zn{constructor(t=0,e=0,n=0,i=1){zn.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],p=a[9],m=a[2],f=a[6],g=a[10];if(Math.abs(c-u)<s&&Math.abs(h-m)<s&&Math.abs(p-f)<s){if(Math.abs(c+u)<o&&Math.abs(h+m)<o&&Math.abs(p+f)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(c+u)/4,x=(h+m)/4,b=(p+f)/4;return t>a&&t>v?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=y/n,r=x/n):a>v?a<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=y/i,r=b/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=x/r,i=b/r),this.set(n,i,r,e),this}let v=Math.sqrt((f-p)*(f-p)+(h-m)*(h-m)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(f-p)/v,this.y=(h-m)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Bn extends Fe{constructor(t,e,n={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new zn(0,0,t,e),this.scissorTest=!1,this.viewport=new zn(0,0,t,e);const i={width:t,height:e,depth:1};this.texture=new kn(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:ft,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Dn(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Fn extends kn{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=dt,this.minFilter=dt,this.wrapR=ht,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Un extends kn{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=dt,this.minFilter=dt,this.wrapR=ht,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Vn{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,s,o){let a=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],m=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=m);if(h!==m||a!==u||l!==d||c!==p){let t=1-o;const e=a*u+l*d+c*p+h*m,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*n;if(a=a*t+u*r,l=l*t+d*r,c=c*t+p*r,h=h*t+m*r,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=t,l*=t,c*=t,h*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,n,i,r,s){const o=n[i],a=n[i+1],l=n[i+2],c=n[i+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=o*p+c*h+a*d-l*u,t[e+1]=a*p+c*u+l*h-o*d,t[e+2]=l*p+c*d+o*u-a*h,t[e+3]=c*p-o*h-a*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const n=t._x,i=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(i/2),h=o(r/2),u=a(n/2),d=a(i/2),p=a(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],h=e[10],u=n+o+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-a)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>o&&n>h){const t=2*Math.sqrt(1+n-o-h);this._w=(c-a)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(o>h){const t=2*Math.sqrt(1+o-n-h);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+h-n-o);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(je(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+i*l-r*a,this._y=i*c+s*a+r*o-n*l,this._z=r*c+s*l+n*a-i*o,this._w=s*c-n*o-i*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let o=s*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Hn{constructor(t=0,e=0,n=0){Hn.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Gn.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Gn.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*i-o*n,c=a*n+o*e-r*i,h=a*i+r*n-s*e,u=-r*e-s*n-o*i;return this.x=l*a+u*-r+c*-o-h*-s,this.y=c*a+u*-s+h*-r-l*-o,this.z=h*a+u*-o+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Wn.copy(this).projectOnVector(t),this.sub(Wn)}reflect(t){return this.sub(Wn.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(je(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Wn=new Hn,Gn=new Vn;class jn{constructor(t=new Hn(1/0,1/0,1/0),e=new Hn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],h=t[a+2];l<e&&(e=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),h=t.getZ(a);l<e&&(e=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>s&&(s=c),h>o&&(o=h)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Xn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n)if(e&&void 0!=n.attributes&&void 0!==n.attributes.position){const e=n.attributes.position;for(let n=0,i=e.count;n<i;n++)Xn.fromBufferAttribute(e,n).applyMatrix4(t.matrixWorld),this.expandByPoint(Xn)}else null===n.boundingBox&&n.computeBoundingBox(),Yn.copy(n.boundingBox),Yn.applyMatrix4(t.matrixWorld),this.union(Yn);const i=t.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Xn),Xn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ei),ni.subVectors(this.max,ei),Zn.subVectors(t.a,ei),Jn.subVectors(t.b,ei),Kn.subVectors(t.c,ei),$n.subVectors(Jn,Zn),Qn.subVectors(Kn,Jn),ti.subVectors(Zn,Kn);let e=[0,-$n.z,$n.y,0,-Qn.z,Qn.y,0,-ti.z,ti.y,$n.z,0,-$n.x,Qn.z,0,-Qn.x,ti.z,0,-ti.x,-$n.y,$n.x,0,-Qn.y,Qn.x,0,-ti.y,ti.x,0];return!!si(e,Zn,Jn,Kn,ni)&&(e=[1,0,0,0,1,0,0,0,1],!!si(e,Zn,Jn,Kn,ni)&&(ii.crossVectors($n,Qn),e=[ii.x,ii.y,ii.z],si(e,Zn,Jn,Kn,ni)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){const e=Xn.copy(t).clamp(this.min,this.max);return e.sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Xn).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(qn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),qn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),qn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),qn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),qn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),qn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),qn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),qn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(qn)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const qn=[new Hn,new Hn,new Hn,new Hn,new Hn,new Hn,new Hn,new Hn],Xn=new Hn,Yn=new jn,Zn=new Hn,Jn=new Hn,Kn=new Hn,$n=new Hn,Qn=new Hn,ti=new Hn,ei=new Hn,ni=new Hn,ii=new Hn,ri=new Hn;function si(t,e,n,i,r){for(let s=0,o=t.length-3;s<=o;s+=3){ri.fromArray(t,s);const o=r.x*Math.abs(ri.x)+r.y*Math.abs(ri.y)+r.z*Math.abs(ri.z),a=e.dot(ri),l=n.dot(ri),c=i.dot(ri);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const oi=new jn,ai=new Hn,li=new Hn,ci=new Hn;class hi{constructor(t=new Hn,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):oi.setFromPoints(t).getCenter(n);let i=0;for(let r=0,s=t.length;r<s;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){ci.subVectors(t,this.center);const e=ci.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(ci.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return!0===this.center.equals(t.center)?li.set(0,0,1).multiplyScalar(t.radius):li.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(ai.copy(t.center).add(li)),this.expandByPoint(ai.copy(t.center).sub(li)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ui=new Hn,di=new Hn,pi=new Hn,mi=new Hn,fi=new Hn,gi=new Hn,vi=new Hn;class yi{constructor(t=new Hn,e=new Hn(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ui)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ui.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ui.copy(this.direction).multiplyScalar(e).add(this.origin),ui.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){di.copy(t).add(e).multiplyScalar(.5),pi.copy(e).sub(t).normalize(),mi.copy(this.origin).sub(di);const r=.5*t.distanceTo(e),s=-this.direction.dot(pi),o=mi.dot(this.direction),a=-mi.dot(pi),l=mi.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*a-o,u=s*o-a,p=r*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+l}else u=r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u=-r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-p?(h=Math.max(0,-(-s*r+o)),u=h>0?-r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(h=Math.max(0,-(s*r+o)),u=h>0?r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),i&&i.copy(pi).multiplyScalar(u).add(di),d}intersectSphere(t,e){ui.subVectors(t.center,this.origin);const n=ui.dot(this.direction),i=ui.dot(ui)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;const n=t.normal.dot(this.direction);return n*e<0}intersectBox(t,e){let n,i,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(t.min.x-u.x)*l,i=(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,i=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),n>s||r>i?null:((r>n||n!==n)&&(n=r),(s<i||i!==i)&&(i=s),h>=0?(o=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(o=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),n>a||o>i?null:((o>n||n!==n)&&(n=o),(a<i||i!==i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,ui)}intersectTriangle(t,e,n,i,r){fi.subVectors(e,t),gi.subVectors(n,t),vi.crossVectors(fi,gi);let s,o=this.direction.dot(vi);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}mi.subVectors(this.origin,t);const a=s*this.direction.dot(gi.crossVectors(mi,gi));if(a<0)return null;const l=s*this.direction.dot(fi.cross(mi));if(l<0)return null;if(a+l>o)return null;const c=-s*mi.dot(vi);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class xi{constructor(){xi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,n,i,r,s,o,a,l,c,h,u,d,p,m,f){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new xi).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/bi.setFromMatrixColumn(t,0).length(),r=1/bi.setFromMatrixColumn(t,1).length(),s=1/bi.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,n=s*h,i=o*c,r=o*h;e[0]=a*c,e[4]=-a*h,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-o*a,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,n=a*h,i=l*c,r=l*h;e[0]=t+r*o,e[4]=i*o-n,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-o,e[2]=n*o-i,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,n=a*h,i=l*c,r=l*h;e[0]=t-r*o,e[4]=-s*h,e[8]=i+n*o,e[1]=n+i*o,e[5]=s*c,e[9]=r-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,n=s*h,i=o*c,r=o*h;e[0]=a*c,e[4]=i*l-n,e[8]=t*l+r,e[1]=a*h,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*c,e[4]=r-t*h,e[8]=i*h+n,e[1]=h,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*h+i,e[10]=t-r*h}else if("XZY"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=n*h-i,e[2]=i*h-n,e[6]=o*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(wi,t,Mi)}lookAt(t,e,n){const i=this.elements;return Ai.subVectors(t,e),0===Ai.lengthSq()&&(Ai.z=1),Ai.normalize(),Si.crossVectors(n,Ai),0===Si.lengthSq()&&(1===Math.abs(n.z)?Ai.x+=1e-4:Ai.z+=1e-4,Ai.normalize(),Si.crossVectors(n,Ai)),Si.normalize(),Ti.crossVectors(Ai,Si),i[0]=Si.x,i[4]=Ti.x,i[8]=Ai.x,i[1]=Si.y,i[5]=Ti.y,i[9]=Ai.y,i[2]=Si.z,i[6]=Ti.z,i[10]=Ai.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],m=n[6],f=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],_=i[0],w=i[4],M=i[8],S=i[12],T=i[1],A=i[5],E=i[9],C=i[13],P=i[2],L=i[6],R=i[10],I=i[14],D=i[3],O=i[7],N=i[11],k=i[15];return r[0]=s*_+o*T+a*P+l*D,r[4]=s*w+o*A+a*L+l*O,r[8]=s*M+o*E+a*R+l*N,r[12]=s*S+o*C+a*I+l*k,r[1]=c*_+h*T+u*P+d*D,r[5]=c*w+h*A+u*L+d*O,r[9]=c*M+h*E+u*R+d*N,r[13]=c*S+h*C+u*I+d*k,r[2]=p*_+m*T+f*P+g*D,r[6]=p*w+m*A+f*L+g*O,r[10]=p*M+m*E+f*R+g*N,r[14]=p*S+m*C+f*I+g*k,r[3]=v*_+y*T+x*P+b*D,r[7]=v*w+y*A+x*L+b*O,r[11]=v*M+y*E+x*R+b*N,r[15]=v*S+y*C+x*I+b*k,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14],p=t[3],m=t[7],f=t[11],g=t[15];return p*(+r*a*h-i*l*h-r*o*u+n*l*u+i*o*d-n*a*d)+m*(+e*a*d-e*l*u+r*s*u-i*s*d+i*l*c-r*a*c)+f*(+e*l*h-e*o*d-r*s*h+n*s*d+r*o*c-n*l*c)+g*(-i*o*c-e*a*h+e*o*u+i*s*h-n*s*u+n*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],g=t[15],v=h*f*l-m*u*l+m*a*d-o*f*d-h*a*g+o*u*g,y=p*u*l-c*f*l-p*a*d+s*f*d+c*a*g-s*u*g,x=c*m*l-p*h*l+p*o*d-s*m*d-c*o*g+s*h*g,b=p*h*a-c*m*a-p*o*u+s*m*u+c*o*f-s*h*f,_=e*v+n*y+i*x+r*b;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return t[0]=v*w,t[1]=(m*u*r-h*f*r-m*i*d+n*f*d+h*i*g-n*u*g)*w,t[2]=(o*f*r-m*a*r+m*i*l-n*f*l-o*i*g+n*a*g)*w,t[3]=(h*a*r-o*u*r-h*i*l+n*u*l+o*i*d-n*a*d)*w,t[4]=y*w,t[5]=(c*f*r-p*u*r+p*i*d-e*f*d-c*i*g+e*u*g)*w,t[6]=(p*a*r-s*f*r-p*i*l+e*f*l+s*i*g-e*a*g)*w,t[7]=(s*u*r-c*a*r+c*i*l-e*u*l-s*i*d+e*a*d)*w,t[8]=x*w,t[9]=(p*h*r-c*m*r-p*n*d+e*m*d+c*n*g-e*h*g)*w,t[10]=(s*m*r-p*o*r+p*n*l-e*m*l-s*n*g+e*o*g)*w,t[11]=(c*o*r-s*h*r-c*n*l+e*h*l+s*n*d-e*o*d)*w,t[12]=b*w,t[13]=(c*m*i-p*h*i+p*n*u-e*m*u-c*n*f+e*h*f)*w,t[14]=(p*o*i-s*m*i-p*n*a+e*m*a+s*n*f-e*o*f)*w,t[15]=(s*h*i-c*o*i+c*n*a-e*h*a-s*n*u+e*o*u)*w,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,o=t.y,a=t.z,l=r*s,c=r*o;return this.set(l*s+n,l*o-i*a,l*a+i*o,0,l*o+i*a,c*o+n,c*a-i*s,0,l*a-i*o,c*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,c=s+s,h=o+o,u=r*l,d=r*c,p=r*h,m=s*c,f=s*h,g=o*h,v=a*l,y=a*c,x=a*h,b=n.x,_=n.y,w=n.z;return i[0]=(1-(m+g))*b,i[1]=(d+x)*b,i[2]=(p-y)*b,i[3]=0,i[4]=(d-x)*_,i[5]=(1-(u+g))*_,i[6]=(f+v)*_,i[7]=0,i[8]=(p+y)*w,i[9]=(f-v)*w,i[10]=(1-(u+m))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=bi.set(i[0],i[1],i[2]).length();const s=bi.set(i[4],i[5],i[6]).length(),o=bi.set(i[8],i[9],i[10]).length(),a=this.determinant();a<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],_i.copy(this);const l=1/r,c=1/s,h=1/o;return _i.elements[0]*=l,_i.elements[1]*=l,_i.elements[2]*=l,_i.elements[4]*=c,_i.elements[5]*=c,_i.elements[6]*=c,_i.elements[8]*=h,_i.elements[9]*=h,_i.elements[10]*=h,e.setFromRotationMatrix(_i),n.x=r,n.y=s,n.z=o,this}makePerspective(t,e,n,i,r,s){const o=this.elements,a=2*r/(e-t),l=2*r/(n-i),c=(e+t)/(e-t),h=(n+i)/(n-i),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s){const o=this.elements,a=1/(e-t),l=1/(n-i),c=1/(s-r),h=(e+t)*a,u=(n+i)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const bi=new Hn,_i=new xi,wi=new Hn(0,0,0),Mi=new Hn(1,1,1),Si=new Hn,Ti=new Hn,Ai=new Hn,Ei=new xi,Ci=new Vn;class Pi{constructor(t=0,e=0,n=0,i=Pi.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],o=i[8],a=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(je(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-je(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(je(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-je(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(je(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-je(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Ei.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ei,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ci.setFromEuler(this),this.setFromQuaternion(Ci,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Pi.DefaultOrder="XYZ",Pi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Li{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return 0!==(this.mask&(1<<t|0))}}let Ri=0;const Ii=new Hn,Di=new Vn,Oi=new xi,Ni=new Hn,ki=new Hn,zi=new Hn,Bi=new Vn,Fi=new Hn(1,0,0),Ui=new Hn(0,1,0),Vi=new Hn(0,0,1),Hi={type:"added"},Wi={type:"removed"};class Gi extends Fe{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ri++}),this.uuid=Ge(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Gi.DefaultUp.clone();const t=new Hn,e=new Pi,n=new Vn,i=new Hn(1,1,1);function r(){n.setFromEuler(e,!1)}function s(){e.setFromQuaternion(n,void 0,!1)}e._onChange(r),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new xi},normalMatrix:{value:new fn}}),this.matrix=new xi,this.matrixWorld=new xi,this.matrixAutoUpdate=Gi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Gi.DefaultMatrixWorldAutoUpdate,this.layers=new Li,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Di.setFromAxisAngle(t,e),this.quaternion.multiply(Di),this}rotateOnWorldAxis(t,e){return Di.setFromAxisAngle(t,e),this.quaternion.premultiply(Di),this}rotateX(t){return this.rotateOnAxis(Fi,t)}rotateY(t){return this.rotateOnAxis(Ui,t)}rotateZ(t){return this.rotateOnAxis(Vi,t)}translateOnAxis(t,e){return Ii.copy(t).applyQuaternion(this.quaternion),this.position.add(Ii.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Fi,t)}translateY(t){return this.translateOnAxis(Ui,t)}translateZ(t){return this.translateOnAxis(Vi,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Oi.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Ni.copy(t):Ni.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),ki.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Oi.lookAt(ki,Ni,this.up):Oi.lookAt(Ni,ki,this.up),this.quaternion.setFromRotationMatrix(Oi),i&&(Oi.extractRotation(i.matrixWorld),Di.setFromRotationMatrix(Oi),this.quaternion.premultiply(Di.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Hi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Wi)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Wi)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Oi.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Oi.multiply(t.parent.matrixWorld)),t.applyMatrix4(Oi),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n],r=i.getObjectByProperty(t,e);if(void 0!==r)return r}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ki,t,zi),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ki,Bi,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){const i=e[n];!0!==i.matrixWorldAutoUpdate&&!0!==t||i.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){const n=t[e];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"===typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations),h=s(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),h.length>0&&(n.nodes=h)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){const e=t.children[n];this.add(e.clone())}return this}}Gi.DefaultUp=new Hn(0,1,0),Gi.DefaultMatrixAutoUpdate=!0,Gi.DefaultMatrixWorldAutoUpdate=!0;const ji=new Hn,qi=new Hn,Xi=new Hn,Yi=new Hn,Zi=new Hn,Ji=new Hn,Ki=new Hn,$i=new Hn,Qi=new Hn,tr=new Hn;class er{constructor(t=new Hn,e=new Hn,n=new Hn){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),ji.subVectors(t,e),i.cross(ji);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){ji.subVectors(i,e),qi.subVectors(n,e),Xi.subVectors(t,e);const s=ji.dot(ji),o=ji.dot(qi),a=ji.dot(Xi),l=qi.dot(qi),c=qi.dot(Xi),h=s*l-o*o;if(0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*a-o*c)*u,p=(s*c-o*a)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,Yi),Yi.x>=0&&Yi.y>=0&&Yi.x+Yi.y<=1}static getUV(t,e,n,i,r,s,o,a){return this.getBarycoord(t,e,n,i,Yi),a.set(0,0),a.addScaledVector(r,Yi.x),a.addScaledVector(s,Yi.y),a.addScaledVector(o,Yi.z),a}static isFrontFacing(t,e,n,i){return ji.subVectors(n,e),qi.subVectors(t,e),ji.cross(qi).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ji.subVectors(this.c,this.b),qi.subVectors(this.a,this.b),.5*ji.cross(qi).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return er.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return er.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return er.getUV(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return er.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return er.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,o;Zi.subVectors(i,n),Ji.subVectors(r,n),$i.subVectors(t,n);const a=Zi.dot($i),l=Ji.dot($i);if(a<=0&&l<=0)return e.copy(n);Qi.subVectors(t,i);const c=Zi.dot(Qi),h=Ji.dot(Qi);if(c>=0&&h<=c)return e.copy(i);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(Zi,s);tr.subVectors(t,r);const d=Zi.dot(tr),p=Ji.dot(tr);if(p>=0&&d<=p)return e.copy(r);const m=d*l-a*p;if(m<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(Ji,o);const f=c*p-d*h;if(f<=0&&h-c>=0&&d-p>=0)return Ki.subVectors(r,i),o=(h-c)/(h-c+(d-p)),e.copy(i).addScaledVector(Ki,o);const g=1/(f+m+u);return s=m*g,o=u*g,e.copy(n).addScaledVector(Zi,s).addScaledVector(Ji,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let nr=0;class ir extends Fe{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:nr++}),this.uuid=Ge(),this.name="",this.type="Material",this.blending=x,this.side=f,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=D,this.blendDst=O,this.blendEquation=S,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=W,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ne,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Oe,this.stencilZFail=Oe,this.stencilZPass=Oe,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!==t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"===typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(n.blending=this.blending),this.side!==f&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class rr extends ir{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ln(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const sr=new Hn,or=new mn;class ar{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=ke,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)or.fromBufferAttribute(this,e),or.applyMatrix3(t),this.setXY(e,or.x,or.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)sr.fromBufferAttribute(this,e),sr.applyMatrix3(t),this.setXYZ(e,sr.x,sr.y,sr.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)sr.fromBufferAttribute(this,e),sr.applyMatrix4(t),this.setXYZ(e,sr.x,sr.y,sr.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)sr.fromBufferAttribute(this,e),sr.applyNormalMatrix(t),this.setXYZ(e,sr.x,sr.y,sr.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)sr.fromBufferAttribute(this,e),sr.transformDirection(t),this.setXYZ(e,sr.x,sr.y,sr.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=un(e,this.array)),e}setX(t,e){return this.normalized&&(e=dn(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=un(e,this.array)),e}setY(t,e){return this.normalized&&(e=dn(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=un(e,this.array)),e}setZ(t,e){return this.normalized&&(e=dn(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=un(e,this.array)),e}setW(t,e){return this.normalized&&(e=dn(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=dn(e,this.array),n=dn(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=dn(e,this.array),n=dn(n,this.array),i=dn(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=dn(e,this.array),n=dn(n,this.array),i=dn(i,this.array),r=dn(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==ke&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class lr extends ar{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class cr extends ar{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class hr extends ar{constructor(t,e,n){super(new Float32Array(t),e,n)}}let ur=0;const dr=new xi,pr=new Gi,mr=new Hn,fr=new jn,gr=new jn,vr=new Hn;class yr extends Fe{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ur++}),this.uuid=Ge(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(gn(t)?cr:lr)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new fn).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return dr.makeRotationFromQuaternion(t),this.applyMatrix4(dr),this}rotateX(t){return dr.makeRotationX(t),this.applyMatrix4(dr),this}rotateY(t){return dr.makeRotationY(t),this.applyMatrix4(dr),this}rotateZ(t){return dr.makeRotationZ(t),this.applyMatrix4(dr),this}translate(t,e,n){return dr.makeTranslation(t,e,n),this.applyMatrix4(dr),this}scale(t,e,n){return dr.makeScale(t,e,n),this.applyMatrix4(dr),this}lookAt(t){return pr.lookAt(t),pr.updateMatrix(),this.applyMatrix4(pr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(mr).negate(),this.translate(mr.x,mr.y,mr.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new hr(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new jn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Hn(-1/0,-1/0,-1/0),new Hn(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){const t=e[n];fr.setFromBufferAttribute(t),this.morphTargetsRelative?(vr.addVectors(this.boundingBox.min,fr.min),this.boundingBox.expandByPoint(vr),vr.addVectors(this.boundingBox.max,fr.max),this.boundingBox.expandByPoint(vr)):(this.boundingBox.expandByPoint(fr.min),this.boundingBox.expandByPoint(fr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new hi);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Hn,1/0);if(t){const n=this.boundingSphere.center;if(fr.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const n=e[t];gr.setFromBufferAttribute(n),this.morphTargetsRelative?(vr.addVectors(fr.min,gr.min),fr.expandByPoint(vr),vr.addVectors(fr.max,gr.max),fr.expandByPoint(vr)):(fr.expandByPoint(gr.min),fr.expandByPoint(gr.max))}fr.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)vr.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(vr));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)vr.fromBufferAttribute(s,e),o&&(mr.fromBufferAttribute(t,e),vr.add(mr)),i=Math.max(i,n.distanceToSquared(vr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,i=e.position.array,r=e.normal.array,s=e.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ar(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let T=0;T<o;T++)l[T]=new Hn,c[T]=new Hn;const h=new Hn,u=new Hn,d=new Hn,p=new mn,m=new mn,f=new mn,g=new Hn,v=new Hn;function y(t,e,n){h.fromArray(i,3*t),u.fromArray(i,3*e),d.fromArray(i,3*n),p.fromArray(s,2*t),m.fromArray(s,2*e),f.fromArray(s,2*n),u.sub(h),d.sub(h),m.sub(p),f.sub(p);const r=1/(m.x*f.y-f.x*m.y);isFinite(r)&&(g.copy(u).multiplyScalar(f.y).addScaledVector(d,-m.y).multiplyScalar(r),v.copy(d).multiplyScalar(m.x).addScaledVector(u,-f.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(v),c[e].add(v),c[n].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let T=0,A=x.length;T<A;++T){const t=x[T],e=t.start,i=t.count;for(let r=e,s=e+i;r<s;r+=3)y(n[r+0],n[r+1],n[r+2])}const b=new Hn,_=new Hn,w=new Hn,M=new Hn;function S(t){w.fromArray(r,3*t),M.copy(w);const e=l[t];b.copy(e),b.sub(w.multiplyScalar(w.dot(e))).normalize(),_.crossVectors(M,e);const n=_.dot(c[t]),i=n<0?-1:1;a[4*t]=b.x,a[4*t+1]=b.y,a[4*t+2]=b.z,a[4*t+3]=i}for(let T=0,A=x.length;T<A;++T){const t=x[T],e=t.start,i=t.count;for(let r=e,s=e+i;r<s;r+=3)S(n[r+0]),S(n[r+1]),S(n[r+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new ar(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Hn,r=new Hn,s=new Hn,o=new Hn,a=new Hn,l=new Hn,c=new Hn,h=new Hn;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),m=t.getX(u+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,m),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,m),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(m,l.x,l.y,l.z)}else for(let t=0,u=e.count;t<u;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)vr.fromBufferAttribute(t,e),vr.normalize(),t.setXYZ(e,vr.x,vr.y,vr.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let o=0,a=0;for(let l=0,c=e.length;l<c;l++){o=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*i;for(let t=0;t<i;t++)s[a++]=n[o++]}return new ar(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new yr,n=this.index.array,i=this.attributes;for(const o in i){const r=i[o],s=t(r,n);e.setAttribute(o,s)}const r=this.morphAttributes;for(const o in r){const i=[],s=r[o];for(let e=0,r=s.length;e<r;e++){const r=s[e],o=t(r,n);i.push(o)}e.morphAttributes[o]=i}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,a=s.length;o<a;o++){const t=s[o];e.addGroup(t.start,t.count,t.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const a in n){const e=n[a];t.data.attributes[a]=e.toJSON(t.data)}const i={};let r=!1;for(const a in this.morphAttributes){const e=this.morphAttributes[a],n=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];n.push(r.toJSON(t.data))}n.length>0&&(i[a]=n,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const l in i){const t=i[l];this.setAttribute(l,t.clone(e))}const r=t.morphAttributes;for(const l in r){const t=[],n=r[l];for(let i=0,r=n.length;i<r;i++)t.push(n[i].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let l=0,c=s.length;l<c;l++){const t=s[l];this.addGroup(t.start,t.count,t.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const xr=new xi,br=new yi,_r=new hi,wr=new Hn,Mr=new Hn,Sr=new Hn,Tr=new Hn,Ar=new Hn,Er=new Hn,Cr=new Hn,Pr=new Hn,Lr=new Hn,Rr=new mn,Ir=new mn,Dr=new mn,Or=new Hn,Nr=new Hn;class kr extends Gi{constructor(t=new yr,e=new rr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry,e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),_r.copy(n.boundingSphere),_r.applyMatrix4(r),!1===t.ray.intersectsSphere(_r))return;if(xr.copy(r).invert(),br.copy(t.ray).applyMatrix4(xr),null!==n.boundingBox&&!1===br.intersectsBox(n.boundingBox))return;let s;const o=n.index,a=n.attributes.position,l=n.morphAttributes.position,c=n.morphTargetsRelative,h=n.attributes.uv,u=n.attributes.uv2,d=n.groups,p=n.drawRange;if(null!==o)if(Array.isArray(i))for(let m=0,f=d.length;m<f;m++){const n=d[m],r=i[n.materialIndex],f=Math.max(n.start,p.start),g=Math.min(o.count,Math.min(n.start+n.count,p.start+p.count));for(let i=f,d=g;i<d;i+=3){const d=o.getX(i),p=o.getX(i+1),m=o.getX(i+2);s=Br(this,r,t,br,a,l,c,h,u,d,p,m),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=n.materialIndex,e.push(s))}}else{const n=Math.max(0,p.start),r=Math.min(o.count,p.start+p.count);for(let d=n,p=r;d<p;d+=3){const n=o.getX(d),r=o.getX(d+1),p=o.getX(d+2);s=Br(this,i,t,br,a,l,c,h,u,n,r,p),s&&(s.faceIndex=Math.floor(d/3),e.push(s))}}else if(void 0!==a)if(Array.isArray(i))for(let m=0,f=d.length;m<f;m++){const n=d[m],r=i[n.materialIndex],o=Math.max(n.start,p.start),f=Math.min(a.count,Math.min(n.start+n.count,p.start+p.count));for(let i=o,d=f;i<d;i+=3){const o=i,d=i+1,p=i+2;s=Br(this,r,t,br,a,l,c,h,u,o,d,p),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=n.materialIndex,e.push(s))}}else{const n=Math.max(0,p.start),r=Math.min(a.count,p.start+p.count);for(let o=n,d=r;o<d;o+=3){const n=o,r=o+1,d=o+2;s=Br(this,i,t,br,a,l,c,h,u,n,r,d),s&&(s.faceIndex=Math.floor(o/3),e.push(s))}}}}function zr(t,e,n,i,r,s,o,a){let l;if(l=e.side===g?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,e.side!==v,a),null===l)return null;Nr.copy(a),Nr.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(Nr);return c<n.near||c>n.far?null:{distance:c,point:Nr.clone(),object:t}}function Br(t,e,n,i,r,s,o,a,l,c,h,u){wr.fromBufferAttribute(r,c),Mr.fromBufferAttribute(r,h),Sr.fromBufferAttribute(r,u);const d=t.morphTargetInfluences;if(s&&d){Cr.set(0,0,0),Pr.set(0,0,0),Lr.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],n=s[t];0!==e&&(Tr.fromBufferAttribute(n,c),Ar.fromBufferAttribute(n,h),Er.fromBufferAttribute(n,u),o?(Cr.addScaledVector(Tr,e),Pr.addScaledVector(Ar,e),Lr.addScaledVector(Er,e)):(Cr.addScaledVector(Tr.sub(wr),e),Pr.addScaledVector(Ar.sub(Mr),e),Lr.addScaledVector(Er.sub(Sr),e)))}wr.add(Cr),Mr.add(Pr),Sr.add(Lr)}t.isSkinnedMesh&&(t.boneTransform(c,wr),t.boneTransform(h,Mr),t.boneTransform(u,Sr));const p=zr(t,e,n,i,wr,Mr,Sr,Or);if(p){a&&(Rr.fromBufferAttribute(a,c),Ir.fromBufferAttribute(a,h),Dr.fromBufferAttribute(a,u),p.uv=er.getUV(Or,wr,Mr,Sr,Rr,Ir,Dr,new mn)),l&&(Rr.fromBufferAttribute(l,c),Ir.fromBufferAttribute(l,h),Dr.fromBufferAttribute(l,u),p.uv2=er.getUV(Or,wr,Mr,Sr,Rr,Ir,Dr,new mn));const t={a:c,b:h,c:u,normal:new Hn,materialIndex:0};er.getNormal(wr,Mr,Sr,t.normal),p.face=t}return p}class Fr extends yr{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,n,i,r,s,p,m,f,g,v){const y=s/f,x=p/g,b=s/2,_=p/2,w=m/2,M=f+1,S=g+1;let T=0,A=0;const E=new Hn;for(let o=0;o<S;o++){const s=o*x-_;for(let a=0;a<M;a++){const u=a*y-b;E[t]=u*i,E[e]=s*r,E[n]=w,l.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[n]=m>0?1:-1,c.push(E.x,E.y,E.z),h.push(a/f),h.push(1-o/g),T+=1}}for(let o=0;o<g;o++)for(let t=0;t<f;t++){const e=u+t+M*o,n=u+t+M*(o+1),i=u+(t+1)+M*(o+1),r=u+(t+1)+M*o;a.push(e,n,r),a.push(n,i,r),A+=6}o.addGroup(d,A,v),d+=A,u+=T}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new hr(l,3)),this.setAttribute("normal",new hr(c,3)),this.setAttribute("uv",new hr(h,2))}static fromJSON(t){return new Fr(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Ur(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Vr(t){const e={};for(let n=0;n<t.length;n++){const i=Ur(t[n]);for(const t in i)e[t]=i[t]}return e}function Hr(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}const Wr={clone:Ur,merge:Vr};var Gr="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",jr="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class qr extends ir{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Gr,this.fragmentShader=jr,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ur(t.uniforms),this.uniformsGroups=Hr(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i],r=n.value;r&&r.isTexture?e.uniforms[i]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[i]={type:"m4",value:r.toArray()}:e.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class Xr extends Gi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new xi,this.projectionMatrix=new xi,this.projectionMatrixInverse=new xi}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Yr extends Xr{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*We*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*He*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*We*Math.atan(Math.tan(.5*He*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*He*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/o,i*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Zr=90,Jr=1;class Kr extends Gi{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n;const i=new Yr(Zr,Jr,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Hn(1,0,0)),this.add(i);const r=new Yr(Zr,Jr,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Hn(-1,0,0)),this.add(r);const s=new Yr(Zr,Jr,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Hn(0,1,0)),this.add(s);const o=new Yr(Zr,Jr,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Hn(0,-1,0)),this.add(o);const a=new Yr(Zr,Jr,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Hn(0,0,1)),this.add(a);const l=new Yr(Zr,Jr,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Hn(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,s,o,a,l]=this.children,c=t.getRenderTarget(),h=t.toneMapping,u=t.xr.enabled;t.toneMapping=K,t.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=d,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(c),t.toneMapping=h,t.xr.enabled=u,n.texture.needsPMREMUpdate=!0}}class $r extends kn{constructor(t,e,n,i,r,s,o,a,l,c){t=void 0!==t?t:[],e=void 0!==e?e:rt,super(t,e,n,i,r,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Qr extends Bn{constructor(t,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new $r(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:ft}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Fr(5,5,5),r=new qr({name:"CubemapFromEquirect",uniforms:Ur(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:g,blending:y});r.uniforms.tEquirect.value=e;const s=new kr(i,r),o=e.minFilter;e.minFilter===vt&&(e.minFilter=ft);const a=new Kr(1,10,this);return a.update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,n,i);t.setRenderTarget(r)}}const ts=new Hn,es=new Hn,ns=new fn;class is{constructor(t=new Hn(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=ts.subVectors(n,e).cross(es.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(ts),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(n).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||ns.getNormalMatrix(t),i=this.coplanarPoint(ts).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const rs=new hi,ss=new Hn;class os{constructor(t=new is,e=new is,n=new is,i=new is,r=new is,s=new is){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],h=n[7],u=n[8],d=n[9],p=n[10],m=n[11],f=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(o-i,h-a,m-u,y-f).normalize(),e[1].setComponents(o+i,h+a,m+u,y+f).normalize(),e[2].setComponents(o+r,h+l,m+d,y+g).normalize(),e[3].setComponents(o-r,h-l,m-d,y-g).normalize(),e[4].setComponents(o-s,h-c,m-p,y-v).normalize(),e[5].setComponents(o+s,h+c,m+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),rs.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(rs)}intersectsSprite(t){return rs.center.set(0,0,0),rs.radius=.7071067811865476,rs.applyMatrix4(t.matrixWorld),this.intersectsSphere(rs)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let r=0;r<6;r++){const t=e[r].distanceToPoint(n);if(t<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(ss.x=i.normal.x>0?t.max.x:t.min.x,ss.y=i.normal.y>0?t.max.y:t.min.y,ss.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(ss)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function as(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function ls(t,e){const n=e.isWebGL2,i=new WeakMap;function r(e,i){const r=e.array,s=e.usage,o=t.createBuffer();let a;if(t.bindBuffer(i,o),t.bufferData(i,r,s),e.onUploadCallback(),r instanceof Float32Array)a=5126;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(r instanceof Int16Array)a=5122;else if(r instanceof Uint32Array)a=5125;else if(r instanceof Int32Array)a=5124;else if(r instanceof Int8Array)a=5120;else if(r instanceof Uint8Array)a=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=5121}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}function s(e,i,r){const s=i.array,o=i.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,s):(n?t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}function o(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)}function a(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))}function l(t,e){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);void 0===n?i.set(t,r(t,e)):n.version<t.version&&(s(n.buffer,t,e),n.version=t.version)}return{get:o,remove:a,update:l}}class cs extends yr{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,o=Math.floor(n),a=Math.floor(i),l=o+1,c=a+1,h=t/o,u=e/a,d=[],p=[],m=[],f=[];for(let g=0;g<c;g++){const t=g*u-s;for(let e=0;e<l;e++){const n=e*h-r;p.push(n,-t,0),m.push(0,0,1),f.push(e/o),f.push(1-g/a)}}for(let g=0;g<a;g++)for(let t=0;t<o;t++){const e=t+l*g,n=t+l*(g+1),i=t+1+l*(g+1),r=t+1+l*g;d.push(e,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new hr(p,3)),this.setAttribute("normal",new hr(m,3)),this.setAttribute("uv",new hr(f,2))}static fromJSON(t){return new cs(t.width,t.height,t.widthSegments,t.heightSegments)}}var hs="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",us="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",ds="#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",ps="#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",ms="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",fs="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",gs="vec3 transformed = vec3( position );",vs="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",ys="vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",xs="#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bs="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",_s="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",ws="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",Ms="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",Ss="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",Ts="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",As="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",Es="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",Cs="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",Ps="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",Ls="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",Rs="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",Is="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",Ds="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",Os="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",Ns="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",ks="gl_FragColor = linearToOutputTexel( gl_FragColor );",zs="vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",Bs="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",Fs="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",Us="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",Vs="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",Hs="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",Ws="#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",Gs="#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",js="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",qs="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",Xs="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",Ys="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",Zs="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",Js="LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",Ks="varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n#define Material_LightProbeLOD( material )\t(0)",$s="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",Qs="#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",to="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",eo="varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",no="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",io="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",ro="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",so="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",oo="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",ao="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lo="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",co="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",ho="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",uo="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",po="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",mo="#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",fo="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",go="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",vo="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",yo="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",xo="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",bo="#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",_o="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",wo="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",Mo="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",So="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",To="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",Ao="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",Eo="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",Co="#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",Po="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",Lo="#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",Ro="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",Io="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",Do="#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",Oo="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",No="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",ko="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",zo="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",Bo="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",Fo="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",Uo="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",Vo="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",Ho="#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",Wo="#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",Go="#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",jo="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",qo="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",Xo="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",Yo="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",Zo="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",Jo="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",Ko="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",$o="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",Qo="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",ta="#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",ea="#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",na="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",ia="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",ra="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",sa="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",oa="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",aa="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",la="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif";const ca="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",ha="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",ua="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",da="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",pa="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",ma="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",fa="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",ga="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",va="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",ya="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",xa="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",ba="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",_a="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",wa="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ma="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Sa="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ta="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",Aa="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ea="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",Ca="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",Pa="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",La="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ra="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",Ia="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Da="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Oa="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Na="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",ka="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",za="#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Ba="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Fa="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Ua="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Va={alphamap_fragment:hs,alphamap_pars_fragment:us,alphatest_fragment:ds,alphatest_pars_fragment:ps,aomap_fragment:ms,aomap_pars_fragment:fs,begin_vertex:gs,beginnormal_vertex:vs,bsdfs:ys,iridescence_fragment:xs,bumpmap_pars_fragment:bs,clipping_planes_fragment:_s,clipping_planes_pars_fragment:ws,clipping_planes_pars_vertex:Ms,clipping_planes_vertex:Ss,color_fragment:Ts,color_pars_fragment:As,color_pars_vertex:Es,color_vertex:Cs,common:Ps,cube_uv_reflection_fragment:Ls,defaultnormal_vertex:Rs,displacementmap_pars_vertex:Is,displacementmap_vertex:Ds,emissivemap_fragment:Os,emissivemap_pars_fragment:Ns,encodings_fragment:ks,encodings_pars_fragment:zs,envmap_fragment:Bs,envmap_common_pars_fragment:Fs,envmap_pars_fragment:Us,envmap_pars_vertex:Vs,envmap_physical_pars_fragment:Qs,envmap_vertex:Hs,fog_vertex:Ws,fog_pars_vertex:Gs,fog_fragment:js,fog_pars_fragment:qs,gradientmap_pars_fragment:Xs,lightmap_fragment:Ys,lightmap_pars_fragment:Zs,lights_lambert_fragment:Js,lights_lambert_pars_fragment:Ks,lights_pars_begin:$s,lights_toon_fragment:to,lights_toon_pars_fragment:eo,lights_phong_fragment:no,lights_phong_pars_fragment:io,lights_physical_fragment:ro,lights_physical_pars_fragment:so,lights_fragment_begin:oo,lights_fragment_maps:ao,lights_fragment_end:lo,logdepthbuf_fragment:co,logdepthbuf_pars_fragment:ho,logdepthbuf_pars_vertex:uo,logdepthbuf_vertex:po,map_fragment:mo,map_pars_fragment:fo,map_particle_fragment:go,map_particle_pars_fragment:vo,metalnessmap_fragment:yo,metalnessmap_pars_fragment:xo,morphcolor_vertex:bo,morphnormal_vertex:_o,morphtarget_pars_vertex:wo,morphtarget_vertex:Mo,normal_fragment_begin:So,normal_fragment_maps:To,normal_pars_fragment:Ao,normal_pars_vertex:Eo,normal_vertex:Co,normalmap_pars_fragment:Po,clearcoat_normal_fragment_begin:Lo,clearcoat_normal_fragment_maps:Ro,clearcoat_pars_fragment:Io,iridescence_pars_fragment:Do,output_fragment:Oo,packing:No,premultiplied_alpha_fragment:ko,project_vertex:zo,dithering_fragment:Bo,dithering_pars_fragment:Fo,roughnessmap_fragment:Uo,roughnessmap_pars_fragment:Vo,shadowmap_pars_fragment:Ho,shadowmap_pars_vertex:Wo,shadowmap_vertex:Go,shadowmask_pars_fragment:jo,skinbase_vertex:qo,skinning_pars_vertex:Xo,skinning_vertex:Yo,skinnormal_vertex:Zo,specularmap_fragment:Jo,specularmap_pars_fragment:Ko,tonemapping_fragment:$o,tonemapping_pars_fragment:Qo,transmission_fragment:ta,transmission_pars_fragment:ea,uv_pars_fragment:na,uv_pars_vertex:ia,uv_vertex:ra,uv2_pars_fragment:sa,uv2_pars_vertex:oa,uv2_vertex:aa,worldpos_vertex:la,background_vert:ca,background_frag:ha,cube_vert:ua,cube_frag:da,depth_vert:pa,depth_frag:ma,distanceRGBA_vert:fa,distanceRGBA_frag:ga,equirect_vert:va,equirect_frag:ya,linedashed_vert:xa,linedashed_frag:ba,meshbasic_vert:_a,meshbasic_frag:wa,meshlambert_vert:Ma,meshlambert_frag:Sa,meshmatcap_vert:Ta,meshmatcap_frag:Aa,meshnormal_vert:Ea,meshnormal_frag:Ca,meshphong_vert:Pa,meshphong_frag:La,meshphysical_vert:Ra,meshphysical_frag:Ia,meshtoon_vert:Da,meshtoon_frag:Oa,points_vert:Na,points_frag:ka,shadow_vert:za,shadow_frag:Ba,sprite_vert:Fa,sprite_frag:Ua},Ha={common:{diffuse:{value:new Ln(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new fn},uv2Transform:{value:new fn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new mn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ln(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ln(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new fn}},sprite:{diffuse:{value:new Ln(16777215)},opacity:{value:1},center:{value:new mn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new fn}}},Wa={basic:{uniforms:Vr([Ha.common,Ha.specularmap,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.fog]),vertexShader:Va.meshbasic_vert,fragmentShader:Va.meshbasic_frag},lambert:{uniforms:Vr([Ha.common,Ha.specularmap,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.fog,Ha.lights,{emissive:{value:new Ln(0)}}]),vertexShader:Va.meshlambert_vert,fragmentShader:Va.meshlambert_frag},phong:{uniforms:Vr([Ha.common,Ha.specularmap,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.fog,Ha.lights,{emissive:{value:new Ln(0)},specular:{value:new Ln(1118481)},shininess:{value:30}}]),vertexShader:Va.meshphong_vert,fragmentShader:Va.meshphong_frag},standard:{uniforms:Vr([Ha.common,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.roughnessmap,Ha.metalnessmap,Ha.fog,Ha.lights,{emissive:{value:new Ln(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Va.meshphysical_vert,fragmentShader:Va.meshphysical_frag},toon:{uniforms:Vr([Ha.common,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.gradientmap,Ha.fog,Ha.lights,{emissive:{value:new Ln(0)}}]),vertexShader:Va.meshtoon_vert,fragmentShader:Va.meshtoon_frag},matcap:{uniforms:Vr([Ha.common,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.fog,{matcap:{value:null}}]),vertexShader:Va.meshmatcap_vert,fragmentShader:Va.meshmatcap_frag},points:{uniforms:Vr([Ha.points,Ha.fog]),vertexShader:Va.points_vert,fragmentShader:Va.points_frag},dashed:{uniforms:Vr([Ha.common,Ha.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Va.linedashed_vert,fragmentShader:Va.linedashed_frag},depth:{uniforms:Vr([Ha.common,Ha.displacementmap]),vertexShader:Va.depth_vert,fragmentShader:Va.depth_frag},normal:{uniforms:Vr([Ha.common,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,{opacity:{value:1}}]),vertexShader:Va.meshnormal_vert,fragmentShader:Va.meshnormal_frag},sprite:{uniforms:Vr([Ha.sprite,Ha.fog]),vertexShader:Va.sprite_vert,fragmentShader:Va.sprite_frag},background:{uniforms:{uvTransform:{value:new fn},t2D:{value:null}},vertexShader:Va.background_vert,fragmentShader:Va.background_frag},cube:{uniforms:Vr([Ha.envmap,{opacity:{value:1}}]),vertexShader:Va.cube_vert,fragmentShader:Va.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Va.equirect_vert,fragmentShader:Va.equirect_frag},distanceRGBA:{uniforms:Vr([Ha.common,Ha.displacementmap,{referencePosition:{value:new Hn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Va.distanceRGBA_vert,fragmentShader:Va.distanceRGBA_frag},shadow:{uniforms:Vr([Ha.lights,Ha.fog,{color:{value:new Ln(0)},opacity:{value:1}}]),vertexShader:Va.shadow_vert,fragmentShader:Va.shadow_frag}};function Ga(t,e,n,i,r,s){const o=new Ln(0);let a,l,c=!0===r?0:1,h=null,u=0,d=null;function p(n,r){let s=!1,p=!0===r.isScene?r.background:null;p&&p.isTexture&&(p=e.get(p));const v=t.xr,y=v.getSession&&v.getSession();y&&"additive"===y.environmentBlendMode&&(p=null),null===p?m(o,c):p&&p.isColor&&(m(p,1),s=!0),(t.autoClear||s)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),p&&(p.isCubeTexture||p.mapping===lt)?(void 0===l&&(l=new kr(new Fr(1,1,1),new qr({name:"BackgroundCubeMaterial",uniforms:Ur(Wa.cube.uniforms),vertexShader:Wa.cube.vertexShader,fragmentShader:Wa.cube.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),l.material.uniforms.envMap.value=p,l.material.uniforms.flipEnvMap.value=p.isCubeTexture&&!1===p.isRenderTargetTexture?-1:1,h===p&&u===p.version&&d===t.toneMapping||(l.material.needsUpdate=!0,h=p,u=p.version,d=t.toneMapping),l.layers.enableAll(),n.unshift(l,l.geometry,l.material,0,0,null)):p&&p.isTexture&&(void 0===a&&(a=new kr(new cs(2,2),new qr({name:"BackgroundMaterial",uniforms:Ur(Wa.background.uniforms),vertexShader:Wa.background.vertexShader,fragmentShader:Wa.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),a.material.uniforms.uvTransform.value.copy(p.matrix),h===p&&u===p.version&&d===t.toneMapping||(a.material.needsUpdate=!0,h=p,u=p.version,d=t.toneMapping),a.layers.enableAll(),n.unshift(a,a.geometry,a.material,0,0,null))}function m(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),c=e,m(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,m(o,c)},render:p}}function ja(t,e,n,i){const r=t.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=g(null);let c=l,h=!1;function u(e,i,r,s,a){let l=!1;if(o){const t=f(s,r,i);c!==t&&(c=t,p(c.object)),l=v(e,s,r,a),l&&y(e,s,r,a)}else{const t=!0===i.wireframe;c.geometry===s.id&&c.program===r.id&&c.wireframe===t||(c.geometry=s.id,c.program=r.id,c.wireframe=t,l=!0)}null!==a&&n.update(a,34963),(l||h)&&(h=!1,S(e,i,r,s),null!==a&&t.bindBuffer(34963,n.get(a).buffer))}function d(){return i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()}function p(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function m(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function f(t,e,n){const i=!0===n.wireframe;let r=a[t.id];void 0===r&&(r={},a[t.id]=r);let s=r[e.id];void 0===s&&(s={},r[e.id]=s);let o=s[i];return void 0===o&&(o=g(d()),s[i]=o),o}function g(t){const e=[],n=[],i=[];for(let s=0;s<r;s++)e[s]=0,n[s]=0,i[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function v(t,e,n,i){const r=c.attributes,s=e.attributes;let o=0;const a=n.getAttributes();for(const l in a){const e=a[l];if(e.location>=0){const e=r[l];let n=s[l];if(void 0===n&&("instanceMatrix"===l&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===l&&t.instanceColor&&(n=t.instanceColor)),void 0===e)return!0;if(e.attribute!==n)return!0;if(n&&e.data!==n.data)return!0;o++}}return c.attributesNum!==o||c.index!==i}function y(t,e,n,i){const r={},s=e.attributes;let o=0;const a=n.getAttributes();for(const l in a){const e=a[l];if(e.location>=0){let e=s[l];void 0===e&&("instanceMatrix"===l&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===l&&t.instanceColor&&(e=t.instanceColor));const n={};n.attribute=e,e&&e.data&&(n.data=e.data),r[l]=n,o++}}c.attributes=r,c.attributesNum=o,c.index=i}function x(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function b(t){_(t,0)}function _(n,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==r){const s=i.isWebGL2?t:e.get("ANGLE_instanced_arrays");s[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r}}function w(){const e=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function M(e,n,r,s,o,a){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,s,o,a):t.vertexAttribIPointer(e,n,r,o,a)}function S(r,s,o,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;x();const l=a.attributes,c=o.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const i=c[e];if(i.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,o=s.itemSize,l=n.get(s);if(void 0===l)continue;const c=l.buffer,h=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,l=n.stride,d=s.offset;if(n.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)_(i.location+t,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<i.locationSize;t++)b(i.location+t);t.bindBuffer(34962,c);for(let t=0;t<i.locationSize;t++)M(i.location+t,o/i.locationSize,h,e,l*u,(d+o/i.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)_(i.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<i.locationSize;t++)b(i.location+t);t.bindBuffer(34962,c);for(let t=0;t<i.locationSize;t++)M(i.location+t,o/i.locationSize,h,e,o*u,o/i.locationSize*t*u)}}else if(void 0!==h){const n=h[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i.location,n);break;case 3:t.vertexAttrib3fv(i.location,n);break;case 4:t.vertexAttrib4fv(i.location,n);break;default:t.vertexAttrib1fv(i.location,n)}}}}w()}function T(){C();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)m(n[t].object),delete n[t];delete e[t]}delete a[t]}}function A(t){if(void 0===a[t.id])return;const e=a[t.id];for(const n in e){const t=e[n];for(const e in t)m(t[e].object),delete t[e];delete e[n]}delete a[t.id]}function E(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)m(i[t].object),delete i[t];delete n[t.id]}}function C(){P(),h=!0,c!==l&&(c=l,p(c.object))}function P(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:C,resetDefaultState:P,dispose:T,releaseStatesOfGeometry:A,releaseStatesOfProgram:E,initAttributes:x,enableAttribute:b,disableUnusedAttributes:w}}function qa(t,e,n,i){const r=i.isWebGL2;let s;function o(t){s=t}function a(e,i){t.drawArrays(s,e,i),n.update(i,s,1)}function l(i,o,a){if(0===a)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,o,a),n.update(o,s,a)}this.setMode=o,this.render=a,this.renderInstances=l}function Xa(t,e,n){let i;function r(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),h=!0===n.logarithmicDepthBuffer,u=t.getParameter(34930),d=t.getParameter(35660),p=t.getParameter(3379),m=t.getParameter(34076),f=t.getParameter(34921),g=t.getParameter(36347),v=t.getParameter(36348),y=t.getParameter(36349),x=d>0,b=o||e.has("OES_texture_float"),_=x&&b,w=o?t.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:m,maxAttributes:f,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:b,floatVertexTextures:_,maxSamples:w}}function Ya(t){const e=this;let n=null,i=0,r=!1,s=!1;const o=new is,a=new fn,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(t,n,i,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=i+4*s,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let n=0,l=i;n!==s;++n,l+=4)o.copy(t[n]).applyMatrix4(r,a),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==i||r;return r=e,n=h(t,s,0),i=t.length,o},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,o,a){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,m=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?h(null):c();else{const t=s?0:i,e=4*t;let r=m.clippingState||null;l.value=r,r=h(u,o,e,a);for(let i=0;i!==e;++i)r[i]=n[i];m.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Za(t){let e=new WeakMap;function n(t,e){return e===ot?t.mapping=rt:e===at&&(t.mapping=st),t}function i(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const s=i.mapping;if(s===ot||s===at){if(e.has(i)){const t=e.get(i).texture;return n(t,i.mapping)}{const s=i.image;if(s&&s.height>0){const o=new Qr(s.height/2);return o.fromEquirectangularTexture(t,i),e.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}Wa.physical={uniforms:Vr([Wa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new mn(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ln(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new mn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ln(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ln(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Va.meshphysical_vert,fragmentShader:Va.meshphysical_frag};class Ja extends Xr{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,o=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Ka=4,$a=[.125,.215,.35,.446,.526,.582],Qa=20,tl=new Ja,el=new Ln;let nl=null;const il=(1+Math.sqrt(5))/2,rl=1/il,sl=[new Hn(1,1,1),new Hn(-1,1,1),new Hn(1,1,-1),new Hn(-1,1,-1),new Hn(0,il,rl),new Hn(0,il,-rl),new Hn(rl,0,il),new Hn(-rl,0,il),new Hn(il,rl,0),new Hn(-il,rl,0)];class ol{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){nl=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=dl(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=ul(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(nl),t.scissorTest=!1,cl(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===rt||t.mapping===st?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),nl=this._renderer.getRenderTarget();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:ft,minFilter:ft,generateMipmaps:!1,type:Tt,format:Rt,encoding:Ae,depthBuffer:!1},i=ll(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ll(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=al(i)),this._blurMaterial=hl(i,t,e)}return i}_compileMaterial(t){const e=new kr(this._lodPlanes[0],t);this._renderer.compile(e,tl)}_sceneToCubeUV(t,e,n,i){const r=90,s=1,o=new Yr(r,s,e,n),a=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear,u=c.toneMapping;c.getClearColor(el),c.toneMapping=K,c.autoClear=!1;const d=new rr({name:"PMREM.Background",side:g,depthWrite:!1,depthTest:!1}),p=new kr(new Fr,d);let m=!1;const f=t.background;f?f.isColor&&(d.color.copy(f),t.background=null,m=!0):(d.color.copy(el),m=!0);for(let g=0;g<6;g++){const e=g%3;0===e?(o.up.set(0,a[g],0),o.lookAt(l[g],0,0)):1===e?(o.up.set(0,0,a[g]),o.lookAt(0,l[g],0)):(o.up.set(0,a[g],0),o.lookAt(0,0,l[g]));const n=this._cubeSize;cl(i,e*n,g>2?n:0,n,n),c.setRenderTarget(i),m&&c.render(p,o),c.render(t,o)}p.geometry.dispose(),p.material.dispose(),c.toneMapping=u,c.autoClear=h,t.background=f}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===rt||t.mapping===st;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=dl()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=ul());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new kr(this._lodPlanes[0],r),o=r.uniforms;o["envMap"].value=t;const a=this._cubeSize;cl(e,0,0,3*a,2*a),n.setRenderTarget(e),n.render(s,tl)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const e=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=sl[(i-1)%sl.length];this._blur(t,i-1,i,e,n)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=new kr(this._lodPlanes[i],l),u=l.uniforms,d=this._sizeLods[n]-1,p=isFinite(r)?Math.PI/(2*d):2*Math.PI/(2*Qa-1),m=r/p,f=isFinite(r)?1+Math.floor(c*m):Qa;f>Qa&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${Qa}`);const g=[];let v=0;for(let w=0;w<Qa;++w){const t=w/m,e=Math.exp(-t*t/2);g.push(e),0===w?v+=e:w<f&&(v+=2*e)}for(let w=0;w<g.length;w++)g[w]=g[w]/v;u["envMap"].value=t.texture,u["samples"].value=f,u["weights"].value=g,u["latitudinal"].value="latitudinal"===s,o&&(u["poleAxis"].value=o);const{_lodMax:y}=this;u["dTheta"].value=p,u["mipInt"].value=y-n;const x=this._sizeLods[i],b=3*x*(i>y-Ka?i-y+Ka:0),_=4*(this._cubeSize-x);cl(e,b,_,3*x,2*x),a.setRenderTarget(e),a.render(h,tl)}}function al(t){const e=[],n=[],i=[];let r=t;const s=t-Ka+1+$a.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);n.push(s);let a=1/s;o>t-Ka?a=$a[o-t+Ka-1]:0===o&&(a=0),i.push(a);const l=1/(s-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,m=3,f=2,g=1,v=new Float32Array(m*p*d),y=new Float32Array(f*p*d),x=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];v.set(i,m*p*t),y.set(u,f*p*t);const r=[t,t,t,t,t,t];x.set(r,g*p*t)}const b=new yr;b.setAttribute("position",new ar(v,m)),b.setAttribute("uv",new ar(y,f)),b.setAttribute("faceIndex",new ar(x,g)),e.push(b),r>Ka&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}function ll(t,e,n){const i=new Bn(t,e,n);return i.texture.mapping=lt,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function cl(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function hl(t,e,n){const i=new Float32Array(Qa),r=new Hn(0,1,0),s=new qr({name:"SphericalGaussianBlur",defines:{n:Qa,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:pl(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:y,depthTest:!1,depthWrite:!1});return s}function ul(){return new qr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:pl(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:y,depthTest:!1,depthWrite:!1})}function dl(){return new qr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:pl(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:y,depthTest:!1,depthWrite:!1})}function pl(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function ml(t){let e=new WeakMap,n=null;function i(i){if(i&&i.isTexture){const o=i.mapping,a=o===ot||o===at,l=o===rt||o===st;if(a||l){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=e.get(i);return null===n&&(n=new ol(t)),r=a?n.fromEquirectangular(i,r):n.fromCubemap(i,r),e.set(i,r),r.texture}if(e.has(i))return e.get(i).texture;{const o=i.image;if(a&&o&&o.height>0||l&&o&&r(o)){null===n&&(n=new ol(t));const r=a?n.fromEquirectangular(i):n.fromCubemap(i);return e.set(i,r),i.addEventListener("dispose",s),r.texture}return null}}}return i}function r(t){let e=0;const n=6;for(let i=0;i<n;i++)void 0!==t[i]&&e++;return e===n}function s(t){const n=t.target;n.removeEventListener("dispose",s);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}function o(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}return{get:i,dispose:o}}function fl(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function gl(t,e,n,i){const r={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const n in a.attributes)e.remove(a.attributes[n]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,n.memory.geometries++),e}function l(t){const n=t.attributes;for(const r in n)e.update(n[r],34962);const i=t.morphAttributes;for(const r in i){const t=i[r];for(let n=0,i=t.length;n<i;n++)e.update(t[n],34962)}}function c(t){const n=[],i=t.index,r=t.attributes.position;let o=0;if(null!==i){const t=i.array;o=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{const t=r.array;o=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}const a=new(gn(n)?cr:lr)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}function h(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&c(t)}else c(t);return s.get(t)}return{get:a,update:l,getWireframeAttribute:h}}function vl(t,e,n,i){const r=i.isWebGL2;let s,o,a;function l(t){s=t}function c(t){o=t.type,a=t.bytesPerElement}function h(e,i){t.drawElements(s,i,o,e*a),n.update(i,s,1)}function u(i,l,c){if(0===c)return;let h,u;if(r)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,o,i*a,c),n.update(l,s,c)}this.setMode=l,this.setIndex=c,this.render=h,this.renderInstances=u}function yl(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function i(t,e,i){switch(n.calls++,e){case 4:n.triangles+=i*(t/3);break;case 1:n.lines+=i*(t/2);break;case 3:n.lines+=i*(t-1);break;case 2:n.lines+=i*t;break;case 0:n.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",e);break}}function r(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:r,update:i}}function xl(t,e){return t[0]-e[0]}function bl(t,e){return Math.abs(e[1])-Math.abs(t[1])}function _l(t,e,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new zn,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(l,c,h,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,m=void 0!==p?p.length:0;let f=s.get(c);if(void 0===f||f.count!==m){void 0!==f&&f.texture.dispose();const y=void 0!==c.morphAttributes.position,x=void 0!==c.morphAttributes.normal,b=void 0!==c.morphAttributes.color,_=c.morphAttributes.position||[],w=c.morphAttributes.normal||[],M=c.morphAttributes.color||[];let S=0;!0===y&&(S=1),!0===x&&(S=2),!0===b&&(S=3);let T=c.attributes.position.count*S,A=1;T>e.maxTextureSize&&(A=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const E=new Float32Array(T*A*4*m),C=new Fn(E,T,A,m);C.type=St,C.needsUpdate=!0;const P=4*S;for(let R=0;R<m;R++){const I=_[R],D=w[R],O=M[R],N=T*A*4*R;for(let k=0;k<I.count;k++){const z=k*P;!0===y&&(o.fromBufferAttribute(I,k),E[N+z+0]=o.x,E[N+z+1]=o.y,E[N+z+2]=o.z,E[N+z+3]=0),!0===x&&(o.fromBufferAttribute(D,k),E[N+z+4]=o.x,E[N+z+5]=o.y,E[N+z+6]=o.z,E[N+z+7]=0),!0===b&&(o.fromBufferAttribute(O,k),E[N+z+8]=o.x,E[N+z+9]=o.y,E[N+z+10]=o.z,E[N+z+11]=4===O.itemSize?o.w:1)}}function L(){C.dispose(),s.delete(c),c.removeEventListener("dispose",L)}f={count:m,texture:C,size:new mn(T,A)},s.set(c,f),c.addEventListener("dispose",L)}let g=0;for(let B=0;B<d.length;B++)g+=d[B];const v=c.morphTargetsRelative?1:1-g;u.getUniforms().setValue(t,"morphTargetBaseInfluence",v),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",f.texture,n),u.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}else{const F=void 0===d?0:d.length;let U=i[c.id];if(void 0===U||U.length!==F){U=[];for(let j=0;j<F;j++)U[j]=[j,0];i[c.id]=U}for(let q=0;q<F;q++){const X=U[q];X[0]=q,X[1]=d[q]}U.sort(bl);for(let Y=0;Y<8;Y++)Y<F&&U[Y][1]?(a[Y][0]=U[Y][0],a[Y][1]=U[Y][1]):(a[Y][0]=Number.MAX_SAFE_INTEGER,a[Y][1]=0);a.sort(xl);const V=c.morphAttributes.position,H=c.morphAttributes.normal;let W=0;for(let Z=0;Z<8;Z++){const J=a[Z],K=J[0],$=J[1];K!==Number.MAX_SAFE_INTEGER&&$?(V&&c.getAttribute("morphTarget"+Z)!==V[K]&&c.setAttribute("morphTarget"+Z,V[K]),H&&c.getAttribute("morphNormal"+Z)!==H[K]&&c.setAttribute("morphNormal"+Z,H[K]),r[Z]=$,W+=$):(V&&!0===c.hasAttribute("morphTarget"+Z)&&c.deleteAttribute("morphTarget"+Z),H&&!0===c.hasAttribute("morphNormal"+Z)&&c.deleteAttribute("morphNormal"+Z),r[Z]=0)}const G=c.morphTargetsRelative?1:1-W;u.getUniforms().setValue(t,"morphTargetBaseInfluence",G),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}return{update:l}}function wl(t,e,n,i){let r=new WeakMap;function s(t){const s=i.render.frame,o=t.geometry,l=e.get(t,o);return r.get(l)!==s&&(e.update(l),r.set(l,s)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",a)&&t.addEventListener("dispose",a),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l}function o(){r=new WeakMap}function a(t){const e=t.target;e.removeEventListener("dispose",a),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:s,dispose:o}}const Ml=new kn,Sl=new Fn,Tl=new Un,Al=new $r,El=[],Cl=[],Pl=new Float32Array(16),Ll=new Float32Array(9),Rl=new Float32Array(4);function Il(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=El[r];if(void 0===s&&(s=new Float32Array(r),El[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function Dl(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Ol(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Nl(t,e){let n=Cl[e];void 0===n&&(n=new Int32Array(e),Cl[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function kl(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function zl(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Dl(n,e))return;t.uniform2fv(this.addr,e),Ol(n,e)}}function Bl(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Dl(n,e))return;t.uniform3fv(this.addr,e),Ol(n,e)}}function Fl(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Dl(n,e))return;t.uniform4fv(this.addr,e),Ol(n,e)}}function Ul(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Dl(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Ol(n,e)}else{if(Dl(n,i))return;Rl.set(i),t.uniformMatrix2fv(this.addr,!1,Rl),Ol(n,i)}}function Vl(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Dl(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Ol(n,e)}else{if(Dl(n,i))return;Ll.set(i),t.uniformMatrix3fv(this.addr,!1,Ll),Ol(n,i)}}function Hl(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Dl(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Ol(n,e)}else{if(Dl(n,i))return;Pl.set(i),t.uniformMatrix4fv(this.addr,!1,Pl),Ol(n,i)}}function Wl(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Gl(t,e){const n=this.cache;Dl(n,e)||(t.uniform2iv(this.addr,e),Ol(n,e))}function jl(t,e){const n=this.cache;Dl(n,e)||(t.uniform3iv(this.addr,e),Ol(n,e))}function ql(t,e){const n=this.cache;Dl(n,e)||(t.uniform4iv(this.addr,e),Ol(n,e))}function Xl(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Yl(t,e){const n=this.cache;Dl(n,e)||(t.uniform2uiv(this.addr,e),Ol(n,e))}function Zl(t,e){const n=this.cache;Dl(n,e)||(t.uniform3uiv(this.addr,e),Ol(n,e))}function Jl(t,e){const n=this.cache;Dl(n,e)||(t.uniform4uiv(this.addr,e),Ol(n,e))}function Kl(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(e||Ml,r)}function $l(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||Tl,r)}function Ql(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||Al,r)}function tc(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||Sl,r)}function ec(t){switch(t){case 5126:return kl;case 35664:return zl;case 35665:return Bl;case 35666:return Fl;case 35674:return Ul;case 35675:return Vl;case 35676:return Hl;case 5124:case 35670:return Wl;case 35667:case 35671:return Gl;case 35668:case 35672:return jl;case 35669:case 35673:return ql;case 5125:return Xl;case 36294:return Yl;case 36295:return Zl;case 36296:return Jl;case 35678:case 36198:case 36298:case 36306:case 35682:return Kl;case 35679:case 36299:case 36307:return $l;case 35680:case 36300:case 36308:case 36293:return Ql;case 36289:case 36303:case 36311:case 36292:return tc}}function nc(t,e){t.uniform1fv(this.addr,e)}function ic(t,e){const n=Il(e,this.size,2);t.uniform2fv(this.addr,n)}function rc(t,e){const n=Il(e,this.size,3);t.uniform3fv(this.addr,n)}function sc(t,e){const n=Il(e,this.size,4);t.uniform4fv(this.addr,n)}function oc(t,e){const n=Il(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function ac(t,e){const n=Il(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function lc(t,e){const n=Il(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function cc(t,e){t.uniform1iv(this.addr,e)}function hc(t,e){t.uniform2iv(this.addr,e)}function uc(t,e){t.uniform3iv(this.addr,e)}function dc(t,e){t.uniform4iv(this.addr,e)}function pc(t,e){t.uniform1uiv(this.addr,e)}function mc(t,e){t.uniform2uiv(this.addr,e)}function fc(t,e){t.uniform3uiv(this.addr,e)}function gc(t,e){t.uniform4uiv(this.addr,e)}function vc(t,e,n){const i=e.length,r=Nl(n,i);t.uniform1iv(this.addr,r);for(let s=0;s!==i;++s)n.setTexture2D(e[s]||Ml,r[s])}function yc(t,e,n){const i=e.length,r=Nl(n,i);t.uniform1iv(this.addr,r);for(let s=0;s!==i;++s)n.setTexture3D(e[s]||Tl,r[s])}function xc(t,e,n){const i=e.length,r=Nl(n,i);t.uniform1iv(this.addr,r);for(let s=0;s!==i;++s)n.setTextureCube(e[s]||Al,r[s])}function bc(t,e,n){const i=e.length,r=Nl(n,i);t.uniform1iv(this.addr,r);for(let s=0;s!==i;++s)n.setTexture2DArray(e[s]||Sl,r[s])}function _c(t){switch(t){case 5126:return nc;case 35664:return ic;case 35665:return rc;case 35666:return sc;case 35674:return oc;case 35675:return ac;case 35676:return lc;case 5124:case 35670:return cc;case 35667:case 35671:return hc;case 35668:case 35672:return uc;case 35669:case 35673:return dc;case 5125:return pc;case 36294:return mc;case 36295:return fc;case 36296:return gc;case 35678:case 36198:case 36298:case 36306:case 35682:return vc;case 35679:case 36299:case 36307:return yc;case 35680:case 36300:case 36308:case 36293:return xc;case 36289:case 36303:case 36311:case 36292:return bc}}class wc{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=ec(e.type)}}class Mc{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=_c(e.type)}}class Sc{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}}}const Tc=/(\w+)(\])?(\[|\.)?/g;function Ac(t,e){t.seq.push(e),t.map[e.id]=e}function Ec(t,e,n){const i=t.name,r=i.length;Tc.lastIndex=0;while(1){const s=Tc.exec(i),o=Tc.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){Ac(n,void 0===c?new wc(a,t,e):new Mc(a,t,e));break}{const t=n.map;let e=t[a];void 0===e&&(e=new Sc(a),Ac(n,e)),n=e}}}class Cc{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i),r=t.getUniformLocation(e,n.name);Ec(n,r,this)}}setValue(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n}}function Pc(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}let Lc=0;function Rc(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=r;o<s;o++){const t=o+1;i.push(`${t===e?">":" "} ${t}: ${n[o]}`)}return i.join("\n")}function Ic(t){switch(t){case Ae:return["Linear","( value )"];case Ee:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function Dc(t,e,n){const i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+Rc(t.getShaderSource(e),i)}return r}function Oc(t,e){const n=Ic(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Nc(t,e){let n;switch(e){case $:n="Linear";break;case Q:n="Reinhard";break;case tt:n="OptimizedCineon";break;case et:n="ACESFilmic";break;case nt:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function kc(t){const e=[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return e.filter(Fc).join("\n")}function zc(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}function Bc(t,e){const n={},i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let o=1;35674===i.type&&(o=2),35675===i.type&&(o=3),35676===i.type&&(o=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}function Fc(t){return""!==t}function Uc(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Vc(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Hc=/^[ \t]*#include +<([\w\d./]+)>/gm;function Wc(t){return t.replace(Hc,Gc)}function Gc(t,e){const n=Va[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Wc(n)}const jc=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function qc(t){return t.replace(jc,Xc)}function Xc(t,e,n,i){let r="";for(let s=parseInt(e);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Yc(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Zc(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===d?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===p?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===m&&(e="SHADOWMAP_TYPE_VSM"),e}function Jc(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case rt:case st:e="ENVMAP_TYPE_CUBE";break;case lt:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Kc(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case st:e="ENVMAP_MODE_REFRACTION";break}return e}function $c(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Y:e="ENVMAP_BLENDING_MULTIPLY";break;case Z:e="ENVMAP_BLENDING_MIX";break;case J:e="ENVMAP_BLENDING_ADD";break}return e}function Qc(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e,r=1/(3*Math.max(Math.pow(2,n),112));return{texelWidth:r,texelHeight:i,maxMip:n}}function th(t,e,n,i){const r=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=Zc(n),c=Jc(n),h=Kc(n),u=$c(n),d=Qc(n),p=n.isWebGL2?"":kc(n),m=zc(s),f=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[m].filter(Fc).join("\n"),g.length>0&&(g+="\n"),v=[p,m].filter(Fc).join("\n"),v.length>0&&(v+="\n")):(g=[Yc(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Fc).join("\n"),v=[p,Yc(n),"#define SHADER_NAME "+n.shaderName,m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",n.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==K?"#define TONE_MAPPING":"",n.toneMapping!==K?Va["tonemapping_pars_fragment"]:"",n.toneMapping!==K?Nc("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Va["encodings_pars_fragment"],Oc("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Fc).join("\n")),o=Wc(o),o=Uc(o,n),o=Vc(o,n),a=Wc(a),a=Uc(a,n),a=Vc(a,n),o=qc(o),a=qc(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===ze?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===ze?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const x=y+g+o,b=y+v+a,_=Pc(r,35633,x),w=Pc(r,35632,b);if(r.attachShader(f,_),r.attachShader(f,w),void 0!==n.index0AttributeName?r.bindAttribLocation(f,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(f,0,"position"),r.linkProgram(f),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(f).trim(),e=r.getShaderInfoLog(_).trim(),n=r.getShaderInfoLog(w).trim();let i=!0,s=!0;if(!1===r.getProgramParameter(f,35714)){i=!1;const e=Dc(r,_,"vertex"),n=Dc(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(f,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==n||(s=!1);s&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:n,prefix:v}})}let M,S;return r.deleteShader(_),r.deleteShader(w),this.getUniforms=function(){return void 0===M&&(M=new Cc(r,f)),M},this.getAttributes=function(){return void 0===S&&(S=Bc(r,f)),S},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(f),this.program=void 0},this.name=n.shaderName,this.id=Lc++,this.cacheKey=e,this.usedTimes=1,this.program=f,this.vertexShader=_,this.fragmentShader=w,this}let eh=0;class nh{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const n of e)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new ih(t),e.set(t,n)),n}}class ih{constructor(t){this.id=eh++,this.code=t,this.usedTimes=0}}function rh(t,e,n,i,r,s,o){const a=new Li,l=new nh,c=[],h=r.isWebGL2,u=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function f(s,a,c,f,y){const b=f.fog,_=y.geometry,w=s.isMeshStandardMaterial?f.environment:null,M=(s.isMeshStandardMaterial?n:e).get(s.envMap||w),S=M&&M.mapping===lt?M.image.height:null,T=m[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const A=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,E=void 0!==A?A.length:0;let C,P,L,R,I=0;if(void 0!==_.morphAttributes.position&&(I=1),void 0!==_.morphAttributes.normal&&(I=2),void 0!==_.morphAttributes.color&&(I=3),T){const t=Wa[T];C=t.vertexShader,P=t.fragmentShader}else C=s.vertexShader,P=s.fragmentShader,l.update(s),L=l.getVertexShaderID(s),R=l.getFragmentShaderID(s);const D=t.getRenderTarget(),O=s.alphaTest>0,N=s.clearcoat>0,k=s.iridescence>0,z={isWebGL2:h,shaderID:T,shaderName:s.type,vertexShader:C,fragmentShader:P,defines:s.defines,customVertexShaderID:L,customFragmentShaderID:R,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:d,outputEncoding:null===D?t.outputEncoding:!0===D.isXRRenderTarget?D.texture.encoding:Ae,map:!!s.map,matcap:!!s.matcap,envMap:!!M,envMapMode:M&&M.mapping,envMapCubeUVHeight:S,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===Re,tangentSpaceNormalMap:s.normalMapType===Le,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===Ee,clearcoat:N,clearcoatMap:N&&!!s.clearcoatMap,clearcoatRoughnessMap:N&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:N&&!!s.clearcoatNormalMap,iridescence:k,iridescenceMap:k&&!!s.iridescenceMap,iridescenceThicknessMap:k&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&s.blending===x,alphaMap:!!s.alphaMap,alphaTest:O,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!_.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,vertexUvs:!!s.map||!!s.bumpMap||!!s.normalMap||!!s.specularMap||!!s.alphaMap||!!s.emissiveMap||!!s.roughnessMap||!!s.metalnessMap||!!s.clearcoatMap||!!s.clearcoatRoughnessMap||!!s.clearcoatNormalMap||!!s.iridescenceMap||!!s.iridescenceThicknessMap||!!s.displacementMap||!!s.transmissionMap||!!s.thicknessMap||!!s.specularIntensityMap||!!s.specularColorMap||!!s.sheenColorMap||!!s.sheenRoughnessMap,uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap)&&!!s.displacementMap,fog:!!b,useFog:!0===s.fog,fogExp2:b&&b.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:E,morphTextureStride:I,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:K,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===v,flipSided:s.side===g,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()};return z}function y(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(b(n,e),_(n,e),n.push(t.outputEncoding)),n.push(e.customProgramCacheKey),n.join()}function b(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}function _(t,e){a.disableAll(),e.isWebGL2&&a.enable(0),e.supportsVertexTextures&&a.enable(1),e.instancing&&a.enable(2),e.instancingColor&&a.enable(3),e.map&&a.enable(4),e.matcap&&a.enable(5),e.envMap&&a.enable(6),e.lightMap&&a.enable(7),e.aoMap&&a.enable(8),e.emissiveMap&&a.enable(9),e.bumpMap&&a.enable(10),e.normalMap&&a.enable(11),e.objectSpaceNormalMap&&a.enable(12),e.tangentSpaceNormalMap&&a.enable(13),e.clearcoat&&a.enable(14),e.clearcoatMap&&a.enable(15),e.clearcoatRoughnessMap&&a.enable(16),e.clearcoatNormalMap&&a.enable(17),e.iridescence&&a.enable(18),e.iridescenceMap&&a.enable(19),e.iridescenceThicknessMap&&a.enable(20),e.displacementMap&&a.enable(21),e.specularMap&&a.enable(22),e.roughnessMap&&a.enable(23),e.metalnessMap&&a.enable(24),e.gradientMap&&a.enable(25),e.alphaMap&&a.enable(26),e.alphaTest&&a.enable(27),e.vertexColors&&a.enable(28),e.vertexAlphas&&a.enable(29),e.vertexUvs&&a.enable(30),e.vertexTangents&&a.enable(31),e.uvsVertexOnly&&a.enable(32),t.push(a.mask),a.disableAll(),e.fog&&a.enable(0),e.useFog&&a.enable(1),e.flatShading&&a.enable(2),e.logarithmicDepthBuffer&&a.enable(3),e.skinning&&a.enable(4),e.morphTargets&&a.enable(5),e.morphNormals&&a.enable(6),e.morphColors&&a.enable(7),e.premultipliedAlpha&&a.enable(8),e.shadowMapEnabled&&a.enable(9),e.physicallyCorrectLights&&a.enable(10),e.doubleSided&&a.enable(11),e.flipSided&&a.enable(12),e.useDepthPacking&&a.enable(13),e.dithering&&a.enable(14),e.specularIntensityMap&&a.enable(15),e.specularColorMap&&a.enable(16),e.transmission&&a.enable(17),e.transmissionMap&&a.enable(18),e.thicknessMap&&a.enable(19),e.sheen&&a.enable(20),e.sheenColorMap&&a.enable(21),e.sheenRoughnessMap&&a.enable(22),e.decodeVideoTexture&&a.enable(23),e.opaque&&a.enable(24),t.push(a.mask)}function w(t){const e=m[t.type];let n;if(e){const t=Wa[e];n=Wr.clone(t.uniforms)}else n=t.uniforms;return n}function M(e,n){let i;for(let t=0,r=c.length;t<r;t++){const e=c[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new th(t,n,e,s),c.push(i)),i}function S(t){if(0===--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}}function T(t){l.remove(t)}function A(){l.dispose()}return{getParameters:f,getProgramCacheKey:y,getUniforms:w,acquireProgram:M,releaseProgram:S,releaseShaderCache:T,programs:c,dispose:A}}function sh(){let t=new WeakMap;function e(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n}function n(e){t.delete(e)}function i(e,n,i){t.get(e)[n]=i}function r(){t=new WeakMap}return{get:e,remove:n,update:i,dispose:r}}function oh(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ah(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function lh(){const t=[];let e=0;const n=[],i=[],r=[];function s(){e=0,n.length=0,i.length=0,r.length=0}function o(n,i,r,s,o,a){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),e++,l}function a(t,e,s,a,l,c){const h=o(t,e,s,a,l,c);s.transmission>0?i.push(h):!0===s.transparent?r.push(h):n.push(h)}function l(t,e,s,a,l,c){const h=o(t,e,s,a,l,c);s.transmission>0?i.unshift(h):!0===s.transparent?r.unshift(h):n.unshift(h)}function c(t,e){n.length>1&&n.sort(t||oh),i.length>1&&i.sort(e||ah),r.length>1&&r.sort(e||ah)}function h(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}}return{opaque:n,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:h,sort:c}}function ch(){let t=new WeakMap;function e(e,n){const i=t.get(e);let r;return void 0===i?(r=new lh,t.set(e,[r])):n>=i.length?(r=new lh,i.push(r)):r=i[n],r}function n(){t=new WeakMap}return{get:e,dispose:n}}function hh(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Hn,color:new Ln};break;case"SpotLight":n={position:new Hn,direction:new Hn,color:new Ln,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Hn,color:new Ln,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Hn,skyColor:new Ln,groundColor:new Ln};break;case"RectAreaLight":n={color:new Ln,position:new Hn,halfWidth:new Hn,halfHeight:new Hn};break}return t[e.id]=n,n}}}function uh(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mn};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mn,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let dh=0;function ph(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function mh(t,e){const n=new hh,i=uh(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)r.probe.push(new Hn);const s=new Hn,o=new xi,a=new xi;function l(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let h=0,u=0,d=0,p=0,m=0,f=0,g=0,v=0,y=0,x=0;s.sort(ph);const b=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,_=e.intensity,w=e.distance,M=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*_*b,l+=o.g*_*b,c+=o.b*_*b;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],_);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.directionalShadow[h]=n,r.directionalShadowMap[h]=M,r.directionalShadowMatrix[h]=e.shadow.matrix,f++}r.directional[h]=t,h++}else if(e.isSpotLight){const t=n.get(e);t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(_*b),t.distance=w,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,r.spot[d]=t;const s=e.shadow;if(e.map&&(r.spotLightMap[y]=e.map,y++,s.updateMatrices(e),e.castShadow&&x++),r.spotLightMatrix[d]=s.matrix,e.castShadow){const t=i.get(e);t.shadowBias=s.bias,t.shadowNormalBias=s.normalBias,t.shadowRadius=s.radius,t.shadowMapSize=s.mapSize,r.spotShadow[d]=t,r.spotShadowMap[d]=M,v++}d++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(o).multiplyScalar(_),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,r.pointShadow[u]=n,r.pointShadowMap[u]=M,r.pointShadowMatrix[u]=e.shadow.matrix,g++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(_*b),t.groundColor.copy(e.groundColor).multiplyScalar(_*b),r.hemi[m]=t,m++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Ha.LTC_FLOAT_1,r.rectAreaLTC2=Ha.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Ha.LTC_HALF_1,r.rectAreaLTC2=Ha.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const _=r.hash;_.directionalLength===h&&_.pointLength===u&&_.spotLength===d&&_.rectAreaLength===p&&_.hemiLength===m&&_.numDirectionalShadows===f&&_.numPointShadows===g&&_.numSpotShadows===v&&_.numSpotMaps===y||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=m,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-x,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=x,_.directionalLength=h,_.pointLength=u,_.spotLength=d,_.rectAreaLength=p,_.hemiLength=m,_.numDirectionalShadows=f,_.numPointShadows=g,_.numSpotShadows=v,_.numSpotMaps=y,r.version=dh++)}function c(t,e){let n=0,i=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let d=0,p=t.length;d<p;d++){const e=t[d];if(e.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),n++}else if(e.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(e.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(u),a.identity(),o.copy(e.matrixWorld),o.premultiply(u),a.extractRotation(o),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(e.isPointLight){const t=r.point[i];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(u),i++}else if(e.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(u),h++}}}return{setup:l,setupView:c,state:r}}function fh(t,e){const n=new mh(t,e),i=[],r=[];function s(){i.length=0,r.length=0}function o(t){i.push(t)}function a(t){r.push(t)}function l(t){n.setup(i,t)}function c(t){n.setupView(i,t)}const h={lightsArray:i,shadowsArray:r,lights:n};return{init:s,state:h,setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function gh(t,e){let n=new WeakMap;function i(i,r=0){const s=n.get(i);let o;return void 0===s?(o=new fh(t,e),n.set(i,[o])):r>=s.length?(o=new fh(t,e),s.push(o)):o=s[r],o}function r(){n=new WeakMap}return{get:i,dispose:r}}class vh extends ir{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ce,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class yh extends ir{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Hn,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const xh="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",bh="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function _h(t,e,n){let i=new os;const r=new mn,s=new mn,o=new zn,a=new vh({depthPacking:Pe}),l=new yh,c={},h=n.maxTextureSize,u={0:g,1:f,2:v},p=new qr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new mn},radius:{value:4}},vertexShader:xh,fragmentShader:bh}),x=p.clone();x.defines.HORIZONTAL_PASS=1;const b=new yr;b.setAttribute("position",new ar(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new kr(b,p),w=this;function M(n,i){const s=e.update(_);p.defines.VSM_SAMPLES!==n.blurSamples&&(p.defines.VSM_SAMPLES=n.blurSamples,x.defines.VSM_SAMPLES=n.blurSamples,p.needsUpdate=!0,x.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Bn(r.x,r.y)),p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,s,p,_,null),x.uniforms.shadow_pass.value=n.mapPass.texture,x.uniforms.resolution.value=n.mapSize,x.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,s,x,_,null)}function S(e,n,i,r,s,o){let h=null;const d=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(h=void 0!==d?d:!0===i.isPointLight?l:a,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const t=h.uuid,e=n.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=h.clone(),i[e]=r),h=r}return h.visible=n.visible,h.wireframe=n.wireframe,h.side=o===m?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],h.alphaMap=n.alphaMap,h.alphaTest=n.alphaTest,h.clipShadows=n.clipShadows,h.clippingPlanes=n.clippingPlanes,h.clipIntersection=n.clipIntersection,h.displacementMap=n.displacementMap,h.displacementScale=n.displacementScale,h.displacementBias=n.displacementBias,h.wireframeLinewidth=n.wireframeLinewidth,h.linewidth=n.linewidth,!0===i.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(i.matrixWorld),h.nearDistance=r,h.farDistance=s),h}function T(n,r,s,o,a){if(!1===n.visible)return;const l=n.layers.test(r.layers);if(l&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===m)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],h=r[c.materialIndex];if(h&&h.visible){const e=S(n,h,o,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,c)}}}else if(r.visible){const e=S(n,r,o,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,null)}}const c=n.children;for(let t=0,e=c.length;t<e;t++)T(c[t],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=d,this.render=function(e,n,a){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(y),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let p=0,f=e.length;p<f;p++){const l=e[p],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const u=c.getFrameExtents();if(r.multiply(u),s.copy(c.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/u.x),r.x=s.x*u.x,c.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/u.y),r.y=s.y*u.y,c.mapSize.y=s.y)),null===c.map){const t=this.type!==m?{minFilter:dt,magFilter:dt}:{};c.map=new Bn(r.x,r.y,t),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();const f=c.getViewportCount();for(let t=0;t<f;t++){const e=c.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),c.updateMatrices(l,t),i=c.getFrustum(),T(n,a,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===m&&M(c,a),c.needsUpdate=!1}w.needsUpdate=!1,t.setRenderTarget(l,c,u)}}function wh(t,e,n){const i=n.isWebGL2;function r(){let e=!1;const n=new zn;let i=null;const r=new zn(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,o,a){!0===a&&(e*=o,i*=o,s*=o),n.set(e,i,s,o),!1===r.equals(n)&&(t.clearColor(e,i,s,o),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}}function s(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){t?St(2929):Tt(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case U:t.depthFunc(512);break;case V:t.depthFunc(519);break;case H:t.depthFunc(513);break;case W:t.depthFunc(515);break;case G:t.depthFunc(514);break;case j:t.depthFunc(518);break;case q:t.depthFunc(516);break;case X:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}}function o(){let e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?St(2960):Tt(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,o){i===e&&r===n&&s===o||(t.stencilFunc(e,n,o),i=e,r=n,s=o)},setOp:function(e,n,i){o===e&&a===n&&l===i||(t.stencilOp(e,n,i),o=e,a=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null}}}const a=new r,l=new s,d=new o,p=new WeakMap,m=new WeakMap;let f={},Y={},Z=new WeakMap,J=[],K=null,$=!1,Q=null,tt=null,et=null,nt=null,it=null,rt=null,st=null,ot=!1,at=null,lt=null,ct=null,ht=null,ut=null;const dt=t.getParameter(35661);let pt=!1,mt=0;const ft=t.getParameter(7938);-1!==ft.indexOf("WebGL")?(mt=parseFloat(/^WebGL (\d)/.exec(ft)[1]),pt=mt>=1):-1!==ft.indexOf("OpenGL ES")&&(mt=parseFloat(/^OpenGL ES (\d)/.exec(ft)[1]),pt=mt>=2);let gt=null,vt={};const yt=t.getParameter(3088),xt=t.getParameter(2978),bt=(new zn).fromArray(yt),_t=(new zn).fromArray(xt);function wt(e,n,i){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let o=0;o<i;o++)t.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return s}const Mt={};function St(e){!0!==f[e]&&(t.enable(e),f[e]=!0)}function Tt(e){!1!==f[e]&&(t.disable(e),f[e]=!1)}function At(e,n){return Y[e]!==n&&(t.bindFramebuffer(e,n),Y[e]=n,i&&(36009===e&&(Y[36160]=n),36160===e&&(Y[36009]=n)),!0)}function Et(i,r){let s=J,o=!1;if(i)if(s=Z.get(r),void 0===s&&(s=[],Z.set(r,s)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(s.length!==t.length||36064!==s[0]){for(let e=0,n=t.length;e<n;e++)s[e]=36064+e;s.length=t.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(n.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))}function Ct(e){return K!==e&&(t.useProgram(e),K=e,!0)}Mt[3553]=wt(3553,3553,1),Mt[34067]=wt(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),d.setClear(0),St(2929),l.setFunc(W),Dt(!1),Ot(h),St(2884),Rt(y);const Pt={[S]:32774,[T]:32778,[A]:32779};if(i)Pt[E]=32775,Pt[C]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(Pt[E]=t.MIN_EXT,Pt[C]=t.MAX_EXT)}const Lt={[P]:0,[L]:1,[R]:768,[D]:770,[F]:776,[z]:774,[N]:772,[I]:769,[O]:771,[B]:775,[k]:773};function Rt(e,n,i,r,s,o,a,l){if(e!==y){if(!1===$&&(St(3042),$=!0),e===M)s=s||n,o=o||i,a=a||r,n===tt&&s===it||(t.blendEquationSeparate(Pt[n],Pt[s]),tt=n,it=s),i===et&&r===nt&&o===rt&&a===st||(t.blendFuncSeparate(Lt[i],Lt[r],Lt[o],Lt[a]),et=i,nt=r,rt=o,st=a),Q=e,ot=null;else if(e!==Q||l!==ot){if(tt===S&&it===S||(t.blendEquation(32774),tt=S,it=S),l)switch(e){case x:t.blendFuncSeparate(1,771,1,771);break;case b:t.blendFunc(1,1);break;case _:t.blendFuncSeparate(0,769,0,1);break;case w:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case x:t.blendFuncSeparate(770,771,1,771);break;case b:t.blendFunc(770,1);break;case _:t.blendFuncSeparate(0,769,0,1);break;case w:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}et=null,nt=null,rt=null,st=null,Q=e,ot=l}}else!0===$&&(Tt(3042),$=!1)}function It(t,e){t.side===v?Tt(2884):St(2884);let n=t.side===g;e&&(n=!n),Dt(n),t.blending===x&&!1===t.transparent?Rt(y):Rt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),l.setFunc(t.depthFunc),l.setTest(t.depthTest),l.setMask(t.depthWrite),a.setMask(t.colorWrite);const i=t.stencilWrite;d.setTest(i),i&&(d.setMask(t.stencilWriteMask),d.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),d.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),kt(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?St(32926):Tt(32926)}function Dt(e){at!==e&&(e?t.frontFace(2304):t.frontFace(2305),at=e)}function Ot(e){e!==c?(St(2884),e!==lt&&(e===h?t.cullFace(1029):e===u?t.cullFace(1028):t.cullFace(1032))):Tt(2884),lt=e}function Nt(e){e!==ct&&(pt&&t.lineWidth(e),ct=e)}function kt(e,n,i){e?(St(32823),ht===n&&ut===i||(t.polygonOffset(n,i),ht=n,ut=i)):Tt(32823)}function zt(t){t?St(3089):Tt(3089)}function Bt(e){void 0===e&&(e=33984+dt-1),gt!==e&&(t.activeTexture(e),gt=e)}function Ft(e,n){null===gt&&Bt();let i=vt[gt];void 0===i&&(i={type:void 0,texture:void 0},vt[gt]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||Mt[e]),i.type=e,i.texture=n)}function Ut(){const e=vt[gt];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)}function Vt(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function Ht(){try{t.texSubImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function Wt(){try{t.texSubImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function Gt(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function jt(){try{t.texStorage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function qt(){try{t.texStorage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function Xt(){try{t.texImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function Yt(){try{t.texImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function Zt(e){!1===bt.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),bt.copy(e))}function Jt(e){!1===_t.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),_t.copy(e))}function Kt(e,n){let i=m.get(n);void 0===i&&(i=new WeakMap,m.set(n,i));let r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r))}function $t(e,n){const i=m.get(n),r=i.get(e);p.get(e)!==r&&(t.uniformBlockBinding(n,r,e.__bindingPointIndex),p.set(e,r))}function Qt(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===i&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),f={},gt=null,vt={},Y={},Z=new WeakMap,J=[],K=null,$=!1,Q=null,tt=null,et=null,nt=null,it=null,rt=null,st=null,ot=!1,at=null,lt=null,ct=null,ht=null,ut=null,bt.set(0,0,t.canvas.width,t.canvas.height),_t.set(0,0,t.canvas.width,t.canvas.height),a.reset(),l.reset(),d.reset()}return{buffers:{color:a,depth:l,stencil:d},enable:St,disable:Tt,bindFramebuffer:At,drawBuffers:Et,useProgram:Ct,setBlending:Rt,setMaterial:It,setFlipSided:Dt,setCullFace:Ot,setLineWidth:Nt,setPolygonOffset:kt,setScissorTest:zt,activeTexture:Bt,bindTexture:Ft,unbindTexture:Ut,compressedTexImage2D:Vt,texImage2D:Xt,texImage3D:Yt,updateUBOMapping:Kt,uniformBlockBinding:$t,texStorage2D:jt,texStorage3D:qt,texSubImage2D:Ht,texSubImage3D:Wt,compressedTexSubImage2D:Gt,scissor:Zt,viewport:Jt,reset:Qt}}function Mh(t,e,n,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let f;const g=new WeakMap;let v=!1;try{v="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(rt){}function y(t,e){return v?new OffscreenCanvas(t,e):xn("canvas")}function x(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?cn:Math.floor,s=i(r*t.width),o=i(r*t.height);void 0===f&&(f=y(s,o));const a=n?y(s,o):f;a.width=s,a.height=o;const l=a.getContext("2d");return l.drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function b(t){return an(t.width)&&an(t.height)}function _(t){return!a&&(t.wrapS!==ht||t.wrapT!==ht||t.minFilter!==dt&&t.minFilter!==ft)}function w(t,e){return t.generateMipmaps&&e&&t.minFilter!==dt&&t.minFilter!==ft}function M(e){t.generateMipmap(e)}function S(n,i,r,s,o=!1){if(!1===a)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;return 6403===i&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===i&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===i&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=s===Ee&&!1===o?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||e.get("EXT_color_buffer_float"),l}function T(t,e,n){return!0===w(t,n)||t.isFramebufferTexture&&t.minFilter!==dt&&t.minFilter!==ft?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function A(t){return t===dt||t===pt||t===mt?9728:9729}function E(t){const e=t.target;e.removeEventListener("dispose",E),P(e),e.isVideoTexture&&m.delete(e)}function C(t){const e=t.target;e.removeEventListener("dispose",C),R(e)}function P(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=g.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&L(t),0===Object.keys(r).length&&g.delete(n)}i.remove(t)}function L(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source,s=g.get(r);delete s[n.__cacheKey],o.memory.textures--}function R(e){const n=e.texture,r=i.get(e),s=i.get(n);if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let i=0;i<6;i++)t.deleteFramebuffer(r.__webglFramebuffer[i]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[i]);else{if(t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let e=0;e<r.__webglColorRenderbuffer.length;e++)r.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(r.__webglColorRenderbuffer[e]);r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let a=0,l=n.length;a<l;a++){const e=i.get(n[a]);e.__webglTexture&&(t.deleteTexture(e.__webglTexture),o.memory.textures--),i.remove(n[a])}i.remove(n),i.remove(e)}let I=0;function D(){I=0}function O(){const t=I;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),I+=1,t}function N(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}function k(t,e){const r=i.get(t);if(t.isVideoTexture&&nt(t),!1===t.isRenderTargetTexture&&t.version>0&&r.__version!==t.version){const n=t.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void G(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}function z(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?G(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))}function B(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?G(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))}function F(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?j(r,t,e):(n.activeTexture(33984+e),n.bindTexture(34067,r.__webglTexture))}const U={[ct]:10497,[ht]:33071,[ut]:33648},V={[dt]:9728,[pt]:9984,[mt]:9986,[ft]:9729,[gt]:9985,[vt]:9987};function H(n,s,o){if(o?(t.texParameteri(n,10242,U[s.wrapS]),t.texParameteri(n,10243,U[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,U[s.wrapR]),t.texParameteri(n,10240,V[s.magFilter]),t.texParameteri(n,10241,V[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),s.wrapS===ht&&s.wrapT===ht||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,A(s.magFilter)),t.texParameteri(n,10241,A(s.minFilter)),s.minFilter!==dt&&s.minFilter!==ft&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.type===St&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===Tt&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function W(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",E));const r=n.source;let s=g.get(r);void 0===s&&(s={},g.set(r,s));const a=N(n);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,i=!0),s[a].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&L(n)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return i}function G(e,i,r){let o=3553;i.isDataArrayTexture&&(o=35866),i.isData3DTexture&&(o=32879);const l=W(e,i),c=i.source;if(n.activeTexture(33984+r),n.bindTexture(o,e.__webglTexture),c.version!==c.__currentVersion||!0===l){t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const e=_(i)&&!1===b(i.image);let r=x(i.image,e,!1,h);r=it(i,r);const u=b(r)||a,d=s.convert(i.format,i.encoding);let p,m=s.convert(i.type),f=S(i.internalFormat,d,m,i.encoding,i.isVideoTexture);H(o,i,u);const g=i.mipmaps,v=a&&!0!==i.isVideoTexture,y=void 0===c.__currentVersion||!0===l,A=T(i,r,u);if(i.isDepthTexture)f=6402,a?f=i.type===St?36012:i.type===Mt?33190:i.type===Ct?35056:33189:i.type===St&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Ot&&6402===f&&i.type!==_t&&i.type!==Mt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Mt,m=s.convert(i.type)),i.format===Nt&&6402===f&&(f=34041,i.type!==Ct&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Ct,m=s.convert(i.type))),y&&(v?n.texStorage2D(3553,1,f,r.width,r.height):n.texImage2D(3553,0,f,r.width,r.height,0,d,m,null));else if(i.isDataTexture)if(g.length>0&&u){v&&y&&n.texStorage2D(3553,A,f,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)p=g[t],v?n.texSubImage2D(3553,t,0,0,p.width,p.height,d,m,p.data):n.texImage2D(3553,t,f,p.width,p.height,0,d,m,p.data);i.generateMipmaps=!1}else v?(y&&n.texStorage2D(3553,A,f,r.width,r.height),n.texSubImage2D(3553,0,0,0,r.width,r.height,d,m,r.data)):n.texImage2D(3553,0,f,r.width,r.height,0,d,m,r.data);else if(i.isCompressedTexture){v&&y&&n.texStorage2D(3553,A,f,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)p=g[t],i.format!==Rt?null!==d?v?n.compressedTexSubImage2D(3553,t,0,0,p.width,p.height,d,p.data):n.compressedTexImage2D(3553,t,f,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):v?n.texSubImage2D(3553,t,0,0,p.width,p.height,d,m,p.data):n.texImage2D(3553,t,f,p.width,p.height,0,d,m,p.data)}else if(i.isDataArrayTexture)v?(y&&n.texStorage3D(35866,A,f,r.width,r.height,r.depth),n.texSubImage3D(35866,0,0,0,0,r.width,r.height,r.depth,d,m,r.data)):n.texImage3D(35866,0,f,r.width,r.height,r.depth,0,d,m,r.data);else if(i.isData3DTexture)v?(y&&n.texStorage3D(32879,A,f,r.width,r.height,r.depth),n.texSubImage3D(32879,0,0,0,0,r.width,r.height,r.depth,d,m,r.data)):n.texImage3D(32879,0,f,r.width,r.height,r.depth,0,d,m,r.data);else if(i.isFramebufferTexture){if(y)if(v)n.texStorage2D(3553,A,f,r.width,r.height);else{let t=r.width,e=r.height;for(let i=0;i<A;i++)n.texImage2D(3553,i,f,t,e,0,d,m,null),t>>=1,e>>=1}}else if(g.length>0&&u){v&&y&&n.texStorage2D(3553,A,f,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)p=g[t],v?n.texSubImage2D(3553,t,0,0,d,m,p):n.texImage2D(3553,t,f,d,m,p);i.generateMipmaps=!1}else v?(y&&n.texStorage2D(3553,A,f,r.width,r.height),n.texSubImage2D(3553,0,0,0,d,m,r)):n.texImage2D(3553,0,f,d,m,r);w(i,u)&&M(o),c.__currentVersion=c.version,i.onUpdate&&i.onUpdate(i)}e.__version=i.version}function j(e,i,r){if(6!==i.image.length)return;const o=W(e,i),l=i.source;if(n.activeTexture(33984+r),n.bindTexture(34067,e.__webglTexture),l.version!==l.__currentVersion||!0===o){t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const e=i.isCompressedTexture||i.image[0].isCompressedTexture,r=i.image[0]&&i.image[0].isDataTexture,h=[];for(let t=0;t<6;t++)h[t]=e||r?r?i.image[t].image:i.image[t]:x(i.image[t],!1,!0,c),h[t]=it(i,h[t]);const u=h[0],d=b(u)||a,p=s.convert(i.format,i.encoding),m=s.convert(i.type),f=S(i.internalFormat,p,m,i.encoding),g=a&&!0!==i.isVideoTexture,v=void 0===l.__currentVersion||!0===o;let y,_=T(i,u,d);if(H(34067,i,d),e){g&&v&&n.texStorage2D(34067,_,f,u.width,u.height);for(let t=0;t<6;t++){y=h[t].mipmaps;for(let e=0;e<y.length;e++){const r=y[e];i.format!==Rt?null!==p?g?n.compressedTexSubImage2D(34069+t,e,0,0,r.width,r.height,p,r.data):n.compressedTexImage2D(34069+t,e,f,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?n.texSubImage2D(34069+t,e,0,0,r.width,r.height,p,m,r.data):n.texImage2D(34069+t,e,f,r.width,r.height,0,p,m,r.data)}}}else{y=i.mipmaps,g&&v&&(y.length>0&&_++,n.texStorage2D(34067,_,f,h[0].width,h[0].height));for(let t=0;t<6;t++)if(r){g?n.texSubImage2D(34069+t,0,0,0,h[t].width,h[t].height,p,m,h[t].data):n.texImage2D(34069+t,0,f,h[t].width,h[t].height,0,p,m,h[t].data);for(let e=0;e<y.length;e++){const i=y[e],r=i.image[t].image;g?n.texSubImage2D(34069+t,e+1,0,0,r.width,r.height,p,m,r.data):n.texImage2D(34069+t,e+1,f,r.width,r.height,0,p,m,r.data)}}else{g?n.texSubImage2D(34069+t,0,0,0,p,m,h[t]):n.texImage2D(34069+t,0,f,p,m,h[t]);for(let e=0;e<y.length;e++){const i=y[e];g?n.texSubImage2D(34069+t,e+1,0,0,p,m,i.image[t]):n.texImage2D(34069+t,e+1,f,p,m,i.image[t])}}}w(i,d)&&M(34067),l.__currentVersion=l.version,i.onUpdate&&i.onUpdate(i)}e.__version=i.version}function q(e,r,o,a,l){const c=s.convert(o.format,o.encoding),h=s.convert(o.type),u=S(o.internalFormat,c,h,o.encoding),p=i.get(r);p.__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):n.texImage2D(l,0,u,r.width,r.height,0,c,h,null)),n.bindFramebuffer(36160,e),et(r)?d.framebufferTexture2DMultisampleEXT(36160,a,l,i.get(o).__webglTexture,0,tt(r)):t.framebufferTexture2D(36160,a,l,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function X(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||et(n)){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===St?r=36012:e.type===Mt&&(r=33190));const i=tt(n);et(n)?d.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):t.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){const r=tt(n);i&&!1===et(n)?t.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):et(n)?d.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<e.length;r++){const o=e[r],a=s.convert(o.format,o.encoding),l=s.convert(o.type),c=S(o.internalFormat,a,l,o.encoding),h=tt(n);i&&!1===et(n)?t.renderbufferStorageMultisample(36161,h,c,n.width,n.height):et(n)?d.renderbufferStorageMultisampleEXT(36161,h,c,n.width,n.height):t.renderbufferStorage(36161,c,n.width,n.height)}}t.bindRenderbuffer(36161,null)}function Y(e,r){const s=r&&r.isWebGLCubeRenderTarget;if(s)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),k(r.depthTexture,0);const o=i.get(r.depthTexture).__webglTexture,a=tt(r);if(r.depthTexture.format===Ot)et(r)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,o,0,a):t.framebufferTexture2D(36160,36096,3553,o,0);else{if(r.depthTexture.format!==Nt)throw new Error("Unknown depthTexture format");et(r)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,o,0,a):t.framebufferTexture2D(36160,33306,3553,o,0)}}function Z(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");Y(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),X(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),X(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function J(t,e,n){const r=i.get(t);void 0!==e&&q(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==n&&Z(t)}function K(e){const l=e.texture,c=i.get(e),h=i.get(l);e.addEventListener("dispose",C),!0!==e.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=l.version,o.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=b(e)||a;if(u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else{if(c.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const n=e.texture;for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&e.samples>0&&!1===et(e)){const i=d?l:[l];c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];c.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer[n]);const o=s.convert(r.format,r.encoding),a=s.convert(r.type),l=S(r.internalFormat,o,a,r.encoding),h=tt(e);t.renderbufferStorageMultisample(36161,h,l,e.width,e.height),t.framebufferRenderbuffer(36160,36064+n,36161,c.__webglColorRenderbuffer[n])}t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),X(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}}if(u){n.bindTexture(34067,h.__webglTexture),H(34067,l,p);for(let t=0;t<6;t++)q(c.__webglFramebuffer[t],e,l,36064,34069+t);w(l,p)&&M(34067),n.unbindTexture()}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=i.get(s);n.bindTexture(3553,o.__webglTexture),H(3553,s,p),q(c.__webglFramebuffer,e,s,36064+r,3553),w(s,p)&&M(3553)}n.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(a?t=e.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(t,h.__webglTexture),H(t,l,p),q(c.__webglFramebuffer,e,l,36064,t),w(l,p)&&M(t),n.unbindTexture()}e.depthBuffer&&Z(e)}function $(t){const e=b(t)||a,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(w(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=i.get(o).__webglTexture;n.bindTexture(e,r),M(e),n.unbindTexture()}}}function Q(e){if(a&&e.samples>0&&!1===et(e)){const r=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],s=e.width,o=e.height;let a=16384;const l=[],c=e.stencilBuffer?33306:36096,h=i.get(e),u=!0===e.isWebGLMultipleRenderTargets;if(u)for(let e=0;e<r.length;e++)n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+e,36161,null),n.bindFramebuffer(36160,h.__webglFramebuffer),t.framebufferTexture2D(36009,36064+e,3553,null,0);n.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,h.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(36064+n),e.depthBuffer&&l.push(c);const d=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===d&&(e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024)),u&&t.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[n]),!0===d&&(t.invalidateFramebuffer(36008,[c]),t.invalidateFramebuffer(36009,[c])),u){const e=i.get(r[n]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,e,0)}t.blitFramebuffer(0,0,s,o,0,0,s,o,a,9728),p&&t.invalidateFramebuffer(36008,l)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),u)for(let e=0;e<r.length;e++){n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+e,36161,h.__webglColorRenderbuffer[e]);const s=i.get(r[e]).__webglTexture;n.bindFramebuffer(36160,h.__webglFramebuffer),t.framebufferTexture2D(36009,36064+e,3553,s,0)}n.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}}function tt(t){return Math.min(u,t.samples)}function et(t){const n=i.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function nt(t){const e=o.render.frame;m.get(t)!==e&&(m.set(t,e),t.update())}function it(t,n){const i=t.encoding,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===Be||i!==Ae&&(i===Ee?!1===a?!0===e.has("EXT_sRGB")&&r===Rt?(t.format=Be,t.minFilter=ft,t.generateMipmaps=!1):n=In.sRGBToLinear(n):r===Rt&&s===yt||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}this.allocateTextureUnit=O,this.resetTextureUnits=D,this.setTexture2D=k,this.setTexture2DArray=z,this.setTexture3D=B,this.setTextureCube=F,this.rebindTextures=J,this.setupRenderTarget=K,this.updateRenderTargetMipmap=$,this.updateMultisampleRenderTarget=Q,this.setupDepthRenderbuffer=Z,this.setupFrameBufferTexture=q,this.useMultisampledRTT=et}function Sh(t,e,n){const i=n.isWebGL2;function r(n,r=null){let s;if(n===yt)return 5121;if(n===At)return 32819;if(n===Et)return 32820;if(n===xt)return 5120;if(n===bt)return 5122;if(n===_t)return 5123;if(n===wt)return 5124;if(n===Mt)return 5125;if(n===St)return 5126;if(n===Tt)return i?5131:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(n===Pt)return 6406;if(n===Rt)return 6408;if(n===It)return 6409;if(n===Dt)return 6410;if(n===Ot)return 6402;if(n===Nt)return 34041;if(n===kt)return 6403;if(n===Lt)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(n===Be)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(n===zt)return 36244;if(n===Bt)return 33319;if(n===Ft)return 33320;if(n===Ut)return 36249;if(n===Vt||n===Ht||n===Wt||n===Gt)if(r===Ee){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===Vt)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Ht)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Wt)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Gt)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===Vt)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ht)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Wt)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Gt)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===jt||n===qt||n===Xt||n===Yt){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(n===jt)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===qt)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Xt)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Yt)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Zt)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===Jt||n===Kt){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(n===Jt)return r===Ee?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===Kt)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(n===$t||n===Qt||n===te||n===ee||n===ne||n===ie||n===re||n===se||n===oe||n===ae||n===le||n===ce||n===he||n===ue){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(n===$t)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Qt)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===te)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===ee)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===ne)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===ie)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===re)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===se)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===oe)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===ae)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===le)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===ce)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===he)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===ue)return r===Ee?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===de){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(n===de)return r===Ee?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===Ct?i?34042:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[n]?t[n]:null}return{convert:r}}class Th extends Yr{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Ah extends Gi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Eh={type:"move"};class Ch{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ah,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ah,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Hn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Hn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ah,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Hn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Hn),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const s of t.hand.values()){const t=e.getJointPose(s,n);if(void 0===l.joints[s.jointName]){const t=new Ah;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[s.jointName]=t,l.add(t)}const i=l.joints[s.jointName];null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=t.radius),i.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Eh)))}return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Ph extends kn{constructor(t,e,n,i,r,s,o,a,l,c){if(c=void 0!==c?c:Ot,c!==Ot&&c!==Nt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Ot&&(n=Mt),void 0===n&&c===Nt&&(n=Ct),super(null,i,r,s,o,a,c,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:dt,this.minFilter=void 0!==a?a:dt,this.flipY=!1,this.generateMipmaps=!1}}class Lh extends Fe{constructor(t,e){super();const n=this;let i=null,r=1,s=null,o="local-floor",a=null,l=null,c=null,h=null,u=null,d=null;const p=e.getContextAttributes();let m=null,f=null;const g=[],v=[],y=new Yr;y.layers.enable(1),y.viewport=new zn;const x=new Yr;x.layers.enable(2),x.viewport=new zn;const b=[y,x],_=new Th;_.layers.enable(1),_.layers.enable(2);let w=null,M=null;function S(t){const e=v.indexOf(t.inputSource);if(-1===e)return;const n=g[e];void 0!==n&&n.dispatchEvent({type:t.type,data:t.inputSource})}function T(){i.removeEventListener("select",S),i.removeEventListener("selectstart",S),i.removeEventListener("selectend",S),i.removeEventListener("squeeze",S),i.removeEventListener("squeezestart",S),i.removeEventListener("squeezeend",S),i.removeEventListener("end",T),i.removeEventListener("inputsourceschange",A);for(let t=0;t<g.length;t++){const e=v[t];null!==e&&(v[t]=null,g[t].disconnect(e))}w=null,M=null,t.setRenderTarget(m),u=null,h=null,c=null,i=null,f=null,D.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function A(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=v.indexOf(n);i>=0&&(v[i]=null,g[i].dispatchEvent({type:"disconnected",data:n}))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let i=v.indexOf(n);if(-1===i){for(let t=0;t<g.length;t++){if(t>=v.length){v.push(n),i=t;break}if(null===v[t]){v[t]=n,i=t;break}}if(-1===i)break}const r=g[i];r&&r.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=g[t];return void 0===e&&(e=new Ch,g[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=g[t];return void 0===e&&(e=new Ch,g[t]=e),e.getGripSpace()},this.getHand=function(t){let e=g[t];return void 0===e&&(e=new Ch,g[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a||s},this.setReferenceSpace=function(t){a=t},this.getBaseLayer=function(){return null!==h?h:u},this.getBinding=function(){return c},this.getFrame=function(){return d},this.getSession=function(){return i},this.setSession=async function(l){if(i=l,null!==i){if(m=t.getRenderTarget(),i.addEventListener("select",S),i.addEventListener("selectstart",S),i.addEventListener("selectend",S),i.addEventListener("squeeze",S),i.addEventListener("squeezestart",S),i.addEventListener("squeezeend",S),i.addEventListener("end",T),i.addEventListener("inputsourceschange",A),!0!==p.xrCompatible&&await e.makeXRCompatible(),void 0===i.renderState.layers||!1===t.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:u}),f=new Bn(u.framebufferWidth,u.framebufferHeight,{format:Rt,type:yt,encoding:t.outputEncoding,stencilBuffer:p.stencil})}else{let n=null,s=null,o=null;p.depth&&(o=p.stencil?35056:33190,n=p.stencil?Nt:Ot,s=p.stencil?Ct:Mt);const a={colorFormat:32856,depthFormat:o,scaleFactor:r};c=new XRWebGLBinding(i,e),h=c.createProjectionLayer(a),i.updateRenderState({layers:[h]}),f=new Bn(h.textureWidth,h.textureHeight,{format:Rt,type:yt,depthTexture:new Ph(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0});const l=t.properties.get(f);l.__ignoreDepthValues=h.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(1),a=null,s=await i.requestReferenceSpace(o),D.setContext(i),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const E=new Hn,C=new Hn;function P(t,e,n){E.setFromMatrixPosition(e.matrixWorld),C.setFromMatrixPosition(n.matrixWorld);const i=E.distanceTo(C),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*h,p=o*u,m=i/(-h+u),f=m*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+m,v=a+m,y=d-f,x=p+(i-f),b=l*a/v*g,_=c*a/v*g;t.projectionMatrix.makePerspective(y,x,b,_,g,v)}function L(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;_.near=x.near=y.near=t.near,_.far=x.far=y.far=t.far,w===_.near&&M===_.far||(i.updateRenderState({depthNear:_.near,depthFar:_.far}),w=_.near,M=_.far);const e=t.parent,n=_.cameras;L(_,e);for(let i=0;i<n.length;i++)L(n[i],e);_.matrixWorld.decompose(_.position,_.quaternion,_.scale),t.matrix.copy(_.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale);const r=t.children;for(let i=0,s=r.length;i<s;i++)r[i].updateMatrixWorld(!0);2===n.length?P(_,y,x):_.projectionMatrix.copy(y.projectionMatrix)},this.getCamera=function(){return _},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==h&&(h.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let R=null;function I(e,n){if(l=n.getViewerPose(a||s),d=n,null!==l){const e=l.views;null!==u&&(t.setRenderTargetFramebuffer(f,u.framebuffer),t.setRenderTarget(f));let n=!1;e.length!==_.cameras.length&&(_.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==u)s=u.getViewport(r);else{const e=c.getViewSubImage(h,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(f,e.colorTexture,h.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(f))}let o=b[i];void 0===o&&(o=new Yr,o.layers.enable(i),o.viewport=new zn,b[i]=o),o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&_.matrix.copy(o.matrix),!0===n&&_.cameras.push(o)}}for(let t=0;t<g.length;t++){const e=v[t],i=g[t];null!==e&&void 0!==i&&i.update(e,n,a||s)}R&&R(e,n),d=null}const D=new as;D.setAnimationLoop(I),this.setAnimationLoop=function(t){R=t},this.dispose=function(){}}}function Rh(t,e){function n(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}function i(t,e,n,i,f){e.isMeshBasicMaterial||e.isMeshLambertMaterial?r(t,e):e.isMeshToonMaterial?(r(t,e),h(t,e)):e.isMeshPhongMaterial?(r(t,e),c(t,e)):e.isMeshStandardMaterial?(r(t,e),u(t,e),e.isMeshPhysicalMaterial&&d(t,e,f)):e.isMeshMatcapMaterial?(r(t,e),p(t,e)):e.isMeshDepthMaterial?r(t,e):e.isMeshDistanceMaterial?(r(t,e),m(t,e)):e.isMeshNormalMaterial?r(t,e):e.isLineBasicMaterial?(s(t,e),e.isLineDashedMaterial&&o(t,e)):e.isPointsMaterial?a(t,e,n,i):e.isSpriteMaterial?l(t,e):e.isShadowMaterial?(t.color.value.copy(e.color),t.opacity.value=e.opacity):e.isShaderMaterial&&(e.uniformsNeedUpdate=!1)}function r(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,i.side===g&&(n.bumpScale.value*=-1)),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),i.side===g&&n.normalScale.value.negate()),i.specularMap&&(n.specularMap.value=i.specularMap),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);const r=e.get(i).envMap;if(r&&(n.envMap.value=r,n.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;const e=!0!==t.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*e}let s,o;i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.roughnessMap?s=i.roughnessMap:i.metalnessMap?s=i.metalnessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap?s=i.emissiveMap:i.clearcoatMap?s=i.clearcoatMap:i.clearcoatNormalMap?s=i.clearcoatNormalMap:i.clearcoatRoughnessMap?s=i.clearcoatRoughnessMap:i.iridescenceMap?s=i.iridescenceMap:i.iridescenceThicknessMap?s=i.iridescenceThicknessMap:i.specularIntensityMap?s=i.specularIntensityMap:i.specularColorMap?s=i.specularColorMap:i.transmissionMap?s=i.transmissionMap:i.thicknessMap?s=i.thicknessMap:i.sheenColorMap?s=i.sheenColorMap:i.sheenRoughnessMap&&(s=i.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),n.uvTransform.value.copy(s.matrix)),i.aoMap?o=i.aoMap:i.lightMap&&(o=i.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),n.uv2Transform.value.copy(o.matrix))}function s(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}function o(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function a(t,e,n,i){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}function l(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}function c(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}function h(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}function u(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap);const i=e.get(n).envMap;i&&(t.envMapIntensity.value=n.envMapIntensity)}function d(t,e,n){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap)),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===g&&t.clearcoatNormalScale.value.negate())),e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap)),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}function p(t,e){e.matcap&&(t.matcap.value=e.matcap)}function m(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function Ih(t,e,n,i){let r={},s={},o=[];const a=n.isWebGL2?t.getParameter(35375):0;function l(t,e){const n=e.program;i.uniformBlockBinding(t,n)}function c(t,n){let o=r[t.id];void 0===o&&(m(t),o=h(t),r[t.id]=o,t.addEventListener("dispose",g));const a=n.program;i.updateUBOMapping(t,a);const l=e.render.frame;s[t.id]!==l&&(d(t),s[t.id]=l)}function h(e){const n=u();e.__bindingPointIndex=n;const i=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(35345,i),t.bufferData(35345,r,s),t.bindBuffer(35345,null),t.bindBufferBase(35345,n,i),i}function u(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(e){const n=r[e.id],i=e.uniforms,s=e.__cache;t.bindBuffer(35345,n);for(let r=0,o=i.length;r<o;r++){const e=i[r];if(!0===p(e,r,s)){const n=e.value,i=e.__offset;"number"===typeof n?(e.__data[0]=n,t.bufferSubData(35345,i,e.__data)):(e.value.isMatrix3?(e.__data[0]=e.value.elements[0],e.__data[1]=e.value.elements[1],e.__data[2]=e.value.elements[2],e.__data[3]=e.value.elements[0],e.__data[4]=e.value.elements[3],e.__data[5]=e.value.elements[4],e.__data[6]=e.value.elements[5],e.__data[7]=e.value.elements[0],e.__data[8]=e.value.elements[6],e.__data[9]=e.value.elements[7],e.__data[10]=e.value.elements[8],e.__data[11]=e.value.elements[0]):n.toArray(e.__data),t.bufferSubData(35345,i,e.__data))}}t.bindBuffer(35345,null)}function p(t,e,n){const i=t.value;if(void 0===n[e])return n[e]="number"===typeof i?i:i.clone(),!0;if("number"===typeof i){if(n[e]!==i)return n[e]=i,!0}else{const t=n[e];if(!1===t.equals(i))return t.copy(i),!0}return!1}function m(t){const e=t.uniforms;let n=0;const i=16;let r=0;for(let s=0,o=e.length;s<o;s++){const t=e[s],o=f(t);if(t.__data=new Float32Array(o.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=n,s>0){r=n%i;const e=i-r;0!==r&&e-o.boundary<0&&(n+=i-r,t.__offset=n)}n+=o.storage}return r=n%i,r>0&&(n+=i-r),t.__size=n,t.__cache={},this}function f(t){const e=t.value,n={boundary:0,storage:0};return"number"===typeof e?(n.boundary=4,n.storage=4):e.isVector2?(n.boundary=8,n.storage=8):e.isVector3||e.isColor?(n.boundary=16,n.storage=12):e.isVector4?(n.boundary=16,n.storage=16):e.isMatrix3?(n.boundary=48,n.storage=48):e.isMatrix4?(n.boundary=64,n.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),n}function g(e){const n=e.target;n.removeEventListener("dispose",g);const i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}function v(){for(const e in r)t.deleteBuffer(r[e]);o=[],r={},s={}}return{bind:l,update:c,dispose:v}}function Dh(){const t=xn("canvas");return t.style.display="block",t}function Oh(t={}){this.isWebGLRenderer=!0;const e=void 0!==t.canvas?t.canvas:Dh(),n=void 0!==t.context?t.context:null,i=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",h=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u;u=null!==n?n.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let d=null,p=null;const m=[],y=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ae,this.physicallyCorrectLights=!1,this.toneMapping=K,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const x=this;let b=!1,_=0,w=0,M=null,S=-1,T=null;const A=new zn,E=new zn;let C=null,P=e.width,L=e.height,R=1,I=null,D=null;const O=new zn(0,0,P,L),N=new zn(0,0,P,L);let k=!1;const z=new os;let B=!1,F=!1,U=null;const V=new xi,H=new mn,W=new Hn,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function j(){return null===M?R:1}let q,X,Y,Z,J,$,Q,tt,et,nt,it,rt,st,ot,at,lt,ct,ht,ut,dt,pt,mt,ft,gt,xt=n;function bt(t,n){for(let i=0;i<t.length;i++){const r=t[i],s=e.getContext(r,n);if(null!==s)return s}return null}try{const t={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${o}`),e.addEventListener("webglcontextlost",Mt,!1),e.addEventListener("webglcontextrestored",At,!1),e.addEventListener("webglcontextcreationerror",Et,!1),null===xt){const e=["webgl2","webgl","experimental-webgl"];if(!0===x.isWebGL1Renderer&&e.shift(),xt=bt(e,t),null===xt)throw bt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===xt.getShaderPrecisionFormat&&(xt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Xt){throw console.error("THREE.WebGLRenderer: "+Xt.message),Xt}function _t(){q=new fl(xt),X=new Xa(xt,q,t),q.init(X),mt=new Sh(xt,q,X),Y=new wh(xt,q,X),Z=new yl,J=new sh,$=new Mh(xt,q,Y,J,X,mt,Z),Q=new Za(x),tt=new ml(x),et=new ls(xt,X),ft=new ja(xt,q,et,X),nt=new gl(xt,et,Z,ft),it=new wl(xt,nt,et,Z),ut=new _l(xt,X,$),lt=new Ya(J),rt=new rh(x,Q,tt,q,X,ft,lt),st=new Rh(x,J),ot=new ch,at=new gh(q,X),ht=new Ga(x,Q,Y,it,u,a),ct=new _h(x,it,X),gt=new Ih(xt,Z,X,Y),dt=new qa(xt,q,Z,X),pt=new vl(xt,q,Z,X),Z.programs=rt.programs,x.capabilities=X,x.extensions=q,x.properties=J,x.renderLists=ot,x.shadowMap=ct,x.state=Y,x.info=Z}_t();const wt=new Lh(x,xt);function Mt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function At(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const t=Z.autoReset,e=ct.enabled,n=ct.autoUpdate,i=ct.needsUpdate,r=ct.type;_t(),Z.autoReset=t,ct.enabled=e,ct.autoUpdate=n,ct.needsUpdate=i,ct.type=r}function Et(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Ct(t){const e=t.target;e.removeEventListener("dispose",Ct),Pt(e)}function Pt(t){Lt(t),J.remove(t)}function Lt(t){const e=J.get(t).programs;void 0!==e&&(e.forEach((function(t){rt.releaseProgram(t)})),t.isShaderMaterial&&rt.releaseShaderCache(t))}this.xr=wt,this.getContext=function(){return xt},this.getContextAttributes=function(){return xt.getContextAttributes()},this.forceContextLoss=function(){const t=q.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=q.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(t){void 0!==t&&(R=t,this.setSize(P,L,!1))},this.getSize=function(t){return t.set(P,L)},this.setSize=function(t,n,i){wt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=t,L=n,e.width=Math.floor(t*R),e.height=Math.floor(n*R),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(P*R,L*R).floor()},this.setDrawingBufferSize=function(t,n,i){P=t,L=n,R=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(A)},this.getViewport=function(t){return t.copy(O)},this.setViewport=function(t,e,n,i){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,n,i),Y.viewport(A.copy(O).multiplyScalar(R).floor())},this.getScissor=function(t){return t.copy(N)},this.setScissor=function(t,e,n,i){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,n,i),Y.scissor(E.copy(N).multiplyScalar(R).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(t){Y.setScissorTest(k=t)},this.setOpaqueSort=function(t){I=t},this.setTransparentSort=function(t){D=t},this.getClearColor=function(t){return t.copy(ht.getClearColor())},this.setClearColor=function(){ht.setClearColor.apply(ht,arguments)},this.getClearAlpha=function(){return ht.getClearAlpha()},this.setClearAlpha=function(){ht.setClearAlpha.apply(ht,arguments)},this.clear=function(t=!0,e=!0,n=!0){let i=0;t&&(i|=16384),e&&(i|=256),n&&(i|=1024),xt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Mt,!1),e.removeEventListener("webglcontextrestored",At,!1),e.removeEventListener("webglcontextcreationerror",Et,!1),ot.dispose(),at.dispose(),J.dispose(),Q.dispose(),tt.dispose(),it.dispose(),ft.dispose(),gt.dispose(),rt.dispose(),wt.dispose(),wt.removeEventListener("sessionstart",Ot),wt.removeEventListener("sessionend",Nt),U&&(U.dispose(),U=null),kt.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=G);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=Gt(t,e,n,i,r);Y.setMaterial(i,o);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===i.wireframe&&(l=nt.getWireframeAttribute(n),u=2),ft.setup(r,i,a,n,l);let d=dt;null!==l&&(h=et.get(l),d=pt,d.setIndex(h));const p=null!==l?l.count:c.count,m=n.drawRange.start*u,f=n.drawRange.count*u,g=null!==s?s.start*u:0,v=null!==s?s.count*u:1/0,y=Math.max(m,g),x=Math.min(p,m+f,g+v)-1,b=Math.max(0,x-y+1);if(0!==b){if(r.isMesh)!0===i.wireframe?(Y.setLineWidth(i.wireframeLinewidth*j()),d.setMode(1)):d.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),Y.setLineWidth(t*j()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(y,b,r.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,b,t)}else d.render(y,b)}},this.compile=function(t,e){function n(t,e,n){!0===t.transparent&&t.side===v?(t.side=g,t.needsUpdate=!0,Ht(t,e,n),t.side=f,t.needsUpdate=!0,Ht(t,e,n),t.side=v):Ht(t,e,n)}p=at.get(t),p.init(),y.push(p),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights(x.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];n(s,t,e)}else n(i,t,e)})),y.pop(),p=null};let It=null;function Dt(t){It&&It(t)}function Ot(){kt.stop()}function Nt(){kt.start()}const kt=new as;function zt(t,e,n,i){if(!1===t.visible)return;const r=t.layers.test(e.layers);if(r)if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||z.intersectsSprite(t)){i&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=it.update(t),r=t.material;r.visible&&d.push(t,e,r,n,W.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==Z.render.frame&&(t.skeleton.update(),t.skeleton.frame=Z.render.frame),!t.frustumCulled||z.intersectsObject(t))){i&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=it.update(t),r=t.material;if(Array.isArray(r)){const i=e.groups;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=r[o.materialIndex];a&&a.visible&&d.push(t,e,a,n,W.z,o)}}else r.visible&&d.push(t,e,r,n,W.z,null)}const s=t.children;for(let o=0,a=s.length;o<a;o++)zt(s[o],e,n,i)}function Bt(t,e,n,i){const r=t.opaque,s=t.transmissive,o=t.transparent;p.setupLightsView(n),s.length>0&&Ft(r,e,n),i&&Y.viewport(A.copy(i)),r.length>0&&Ut(r,e,n),s.length>0&&Ut(s,e,n),o.length>0&&Ut(o,e,n),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function Ft(t,e,n){const i=X.isWebGL2;null===U&&(U=new Bn(1,1,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")?Tt:yt,minFilter:vt,samples:i&&!0===s?4:0})),x.getDrawingBufferSize(H),i?U.setSize(H.x,H.y):U.setSize(cn(H.x),cn(H.y));const r=x.getRenderTarget();x.setRenderTarget(U),x.clear();const o=x.toneMapping;x.toneMapping=K,Ut(t,e,n),x.toneMapping=o,$.updateMultisampleRenderTarget(U),$.updateRenderTargetMipmap(U),x.setRenderTarget(r)}function Ut(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,l=null===i?s.material:i,c=s.group;o.layers.test(n.layers)&&Vt(o,e,n,a,l,c)}}function Vt(t,e,n,i,r,s){t.onBeforeRender(x,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(x,e,n,i,t,s),!0===r.transparent&&r.side===v?(r.side=g,r.needsUpdate=!0,x.renderBufferDirect(n,e,i,r,t,s),r.side=f,r.needsUpdate=!0,x.renderBufferDirect(n,e,i,r,t,s),r.side=v):x.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(x,e,n,i,r,s)}function Ht(t,e,n){!0!==e.isScene&&(e=G);const i=J.get(t),r=p.state.lights,s=p.state.shadowsArray,o=r.state.version,a=rt.getParameters(t,r.state,s,e,n),l=rt.getProgramCacheKey(a);let c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?tt:Q).get(t.envMap||i.environment),void 0===c&&(t.addEventListener("dispose",Ct),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===o)return Wt(t,a),h}else a.uniforms=rt.getUniforms(t),t.onBuild(n,a,x),t.onBeforeCompile(a,x),h=rt.acquireProgram(a,l),c.set(l,h),i.uniforms=a.uniforms;const u=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=lt.uniform),Wt(t,a),i.needsLights=qt(t),i.lightsStateVersion=o,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=h.getUniforms(),m=Cc.seqWithValue(d.seq,u);return i.currentProgram=h,i.uniformsList=m,h}function Wt(t,e){const n=J.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}function Gt(t,e,n,i,r){!0!==e.isScene&&(e=G),$.resetTextureUnits();const s=e.fog,o=i.isMeshStandardMaterial?e.environment:null,a=null===M?x.outputEncoding:!0===M.isXRRenderTarget?M.texture.encoding:Ae,l=(i.isMeshStandardMaterial?tt:Q).get(i.envMap||o),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!i.normalMap&&!!n.attributes.tangent,u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,m=!!n.morphAttributes.color,f=i.toneMapped?x.toneMapping:K,g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,y=J.get(i),b=p.state.lights;if(!0===B&&(!0===F||t!==T)){const e=t===T&&i.id===S;lt.setState(i,t,e)}let _=!1;i.version===y.__version?y.needsLights&&y.lightsStateVersion!==b.state.version||y.outputEncoding!==a||r.isInstancedMesh&&!1===y.instancing?_=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?_=!0:r.isSkinnedMesh||!0!==y.skinning?y.envMap!==l||!0===i.fog&&y.fog!==s?_=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===lt.numPlanes&&y.numIntersection===lt.numIntersection?(y.vertexAlphas!==c||y.vertexTangents!==h||y.morphTargets!==u||y.morphNormals!==d||y.morphColors!==m||y.toneMapping!==f||!0===X.isWebGL2&&y.morphTargetsCount!==v)&&(_=!0):_=!0:_=!0:_=!0:(_=!0,y.__version=i.version);let w=y.currentProgram;!0===_&&(w=Ht(i,e,r));let A=!1,E=!1,C=!1;const P=w.getUniforms(),I=y.uniforms;if(Y.useProgram(w.program)&&(A=!0,E=!0,C=!0),i.id!==S&&(S=i.id,E=!0),A||T!==t){if(P.setValue(xt,"projectionMatrix",t.projectionMatrix),X.logarithmicDepthBuffer&&P.setValue(xt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),T!==t&&(T=t,E=!0,C=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const e=P.map.cameraPosition;void 0!==e&&e.setValue(xt,W.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(xt,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&P.setValue(xt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){P.setOptional(xt,r,"bindMatrix"),P.setOptional(xt,r,"bindMatrixInverse");const t=r.skeleton;t&&(X.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(xt,"boneTexture",t.boneTexture,$),P.setValue(xt,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const D=n.morphAttributes;if((void 0!==D.position||void 0!==D.normal||void 0!==D.color&&!0===X.isWebGL2)&&ut.update(r,n,i,w),(E||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,P.setValue(xt,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),E&&(P.setValue(xt,"toneMappingExposure",x.toneMappingExposure),y.needsLights&&jt(I,C),s&&!0===i.fog&&st.refreshFogUniforms(I,s),st.refreshMaterialUniforms(I,i,R,L,U),Cc.upload(xt,y.uniformsList,I,$)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Cc.upload(xt,y.uniformsList,I,$),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&P.setValue(xt,"center",r.center),P.setValue(xt,"modelViewMatrix",r.modelViewMatrix),P.setValue(xt,"normalMatrix",r.normalMatrix),P.setValue(xt,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const t=i.uniformsGroups;for(let e=0,n=t.length;e<n;e++)if(X.isWebGL2){const n=t[e];gt.update(n,w),gt.bind(n,w)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return w}function jt(t,e){t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}function qt(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}kt.setAnimationLoop(Dt),"undefined"!==typeof self&&kt.setContext(self),this.setAnimationLoop=function(t){It=t,wt.setAnimationLoop(t),null===t?kt.stop():kt.start()},wt.addEventListener("sessionstart",Ot),wt.addEventListener("sessionend",Nt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===wt.enabled&&!0===wt.isPresenting&&(!0===wt.cameraAutoUpdate&&wt.updateCamera(e),e=wt.getCamera()),!0===t.isScene&&t.onBeforeRender(x,t,e,M),p=at.get(t,y.length),p.init(),y.push(p),V.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),z.setFromProjectionMatrix(V),F=this.localClippingEnabled,B=lt.init(this.clippingPlanes,F,e),d=ot.get(t,m.length),d.init(),m.push(d),zt(t,e,0,x.sortObjects),d.finish(),!0===x.sortObjects&&d.sort(I,D),!0===B&&lt.beginShadows();const n=p.state.shadowsArray;if(ct.render(n,t,e),!0===B&&lt.endShadows(),!0===this.info.autoReset&&this.info.reset(),ht.render(d,t),p.setupLights(x.physicallyCorrectLights),e.isArrayCamera){const n=e.cameras;for(let e=0,i=n.length;e<i;e++){const i=n[e];Bt(d,t,i,i.viewport)}}else Bt(d,t,e);null!==M&&($.updateMultisampleRenderTarget(M),$.updateRenderTargetMipmap(M)),!0===t.isScene&&t.onAfterRender(x,t,e),ft.resetDefaultState(),S=-1,T=null,y.pop(),p=y.length>0?y[y.length-1]:null,m.pop(),d=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(t,e,n){J.get(t.texture).__webglTexture=e,J.get(t.depthTexture).__webglTexture=n;const i=J.get(t);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===q.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const n=J.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){M=t,_=e,w=n;let i=!0;if(t){const e=J.get(t);void 0!==e.__useDefaultFramebuffer?(Y.bindFramebuffer(36160,null),i=!1):void 0===e.__webglFramebuffer?$.setupRenderTarget(t):e.__hasExternalTextures&&$.rebindTextures(t,J.get(t.texture).__webglTexture,J.get(t.depthTexture).__webglTexture)}let r=null,s=!1,o=!1;if(t){const n=t.texture;(n.isData3DTexture||n.isDataArrayTexture)&&(o=!0);const i=J.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=i[e],s=!0):r=X.isWebGL2&&t.samples>0&&!1===$.useMultisampledRTT(t)?J.get(t).__webglMultisampledFramebuffer:i,A.copy(t.viewport),E.copy(t.scissor),C=t.scissorTest}else A.copy(O).multiplyScalar(R).floor(),E.copy(N).multiplyScalar(R).floor(),C=k;const a=Y.bindFramebuffer(36160,r);if(a&&X.drawBuffers&&i&&Y.drawBuffers(t,r),Y.viewport(A),Y.scissor(E),Y.setScissorTest(C),s){const i=J.get(t.texture);xt.framebufferTexture2D(36160,36064,34069+e,i.__webglTexture,n)}else if(o){const i=J.get(t.texture),r=e||0;xt.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}S=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=J.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){Y.bindFramebuffer(36160,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==Rt&&mt.convert(a)!==xt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Tt&&(q.has("EXT_color_buffer_half_float")||X.isWebGL2&&q.has("EXT_color_buffer_float"));if(l!==yt&&mt.convert(l)!==xt.getParameter(35738)&&(l!==St||!(X.isWebGL2||q.has("OES_texture_float")||q.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&xt.readPixels(e,n,i,r,mt.convert(a),mt.convert(l),s)}finally{const t=null!==M?J.get(M).__webglFramebuffer:null;Y.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);$.setTexture2D(e,0),xt.copyTexSubImage2D(3553,n,0,0,t.x,t.y,r,s),Y.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const r=e.image.width,s=e.image.height,o=mt.convert(n.format),a=mt.convert(n.type);$.setTexture2D(n,0),xt.pixelStorei(37440,n.flipY),xt.pixelStorei(37441,n.premultiplyAlpha),xt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?xt.texSubImage2D(3553,i,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?xt.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):xt.texSubImage2D(3553,i,t.x,t.y,o,a,e.image),0===i&&n.generateMipmaps&&xt.generateMipmap(3553),Y.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,r=0){if(x.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=mt.convert(i.format),c=mt.convert(i.type);let h;if(i.isData3DTexture)$.setTexture3D(i,0),h=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(i,0),h=35866}xt.pixelStorei(37440,i.flipY),xt.pixelStorei(37441,i.premultiplyAlpha),xt.pixelStorei(3317,i.unpackAlignment);const u=xt.getParameter(3314),d=xt.getParameter(32878),p=xt.getParameter(3316),m=xt.getParameter(3315),f=xt.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;xt.pixelStorei(3314,g.width),xt.pixelStorei(32878,g.height),xt.pixelStorei(3316,t.min.x),xt.pixelStorei(3315,t.min.y),xt.pixelStorei(32877,t.min.z),n.isDataTexture||n.isData3DTexture?xt.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),xt.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,g.data)):xt.texSubImage3D(h,r,e.x,e.y,e.z,s,o,a,l,c,g),xt.pixelStorei(3314,u),xt.pixelStorei(32878,d),xt.pixelStorei(3316,p),xt.pixelStorei(3315,m),xt.pixelStorei(32877,f),0===r&&i.generateMipmaps&&xt.generateMipmap(h),Y.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?$.setTextureCube(t,0):t.isData3DTexture?$.setTexture3D(t,0):t.isDataArrayTexture?$.setTexture2DArray(t,0):$.setTexture2D(t,0),Y.unbindTexture()},this.resetState=function(){_=0,w=0,M=null,Y.reset(),ft.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Nh extends Oh{}Nh.prototype.isWebGL1Renderer=!0;class kh{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ln(t),this.density=e}clone(){return new kh(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class zh{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new Ln(t),this.near=e,this.far=n}clone(){return new zh(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Bh extends Gi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}class Fh{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=ke,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ge()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ge()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ge()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Uh=new Hn;class Vh{constructor(t,e,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Uh.fromBufferAttribute(this,e),Uh.applyMatrix4(t),this.setXYZ(e,Uh.x,Uh.y,Uh.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Uh.fromBufferAttribute(this,e),Uh.applyNormalMatrix(t),this.setXYZ(e,Uh.x,Uh.y,Uh.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Uh.fromBufferAttribute(this,e),Uh.transformDirection(t),this.setXYZ(e,Uh.x,Uh.y,Uh.z);return this}setX(t,e){return this.normalized&&(e=dn(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=dn(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=dn(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=dn(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=un(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=un(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=un(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=un(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=dn(e,this.array),n=dn(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=dn(e,this.array),n=dn(n,this.array),i=dn(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=dn(e,this.array),n=dn(n,this.array),i=dn(i,this.array),r=dn(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new ar(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Vh(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Hh extends ir{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ln(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let Wh;const Gh=new Hn,jh=new Hn,qh=new Hn,Xh=new mn,Yh=new mn,Zh=new xi,Jh=new Hn,Kh=new Hn,$h=new Hn,Qh=new mn,tu=new mn,eu=new mn;class nu extends Gi{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Wh){Wh=new yr;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new Fh(t,5);Wh.setIndex([0,1,2,0,2,3]),Wh.setAttribute("position",new Vh(e,3,0,!1)),Wh.setAttribute("uv",new Vh(e,2,3,!1))}this.geometry=Wh,this.material=void 0!==t?t:new Hh,this.center=new mn(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),jh.setFromMatrixScale(this.matrixWorld),Zh.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),qh.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&jh.multiplyScalar(-qh.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;iu(Jh.set(-.5,-.5,0),qh,s,jh,i,r),iu(Kh.set(.5,-.5,0),qh,s,jh,i,r),iu($h.set(.5,.5,0),qh,s,jh,i,r),Qh.set(0,0),tu.set(1,0),eu.set(1,1);let o=t.ray.intersectTriangle(Jh,Kh,$h,!1,Gh);if(null===o&&(iu(Kh.set(-.5,.5,0),qh,s,jh,i,r),tu.set(0,1),o=t.ray.intersectTriangle(Jh,$h,Kh,!1,Gh),null===o))return;const a=t.ray.origin.distanceTo(Gh);a<t.near||a>t.far||e.push({distance:a,point:Gh.clone(),uv:er.getUV(Gh,Jh,Kh,$h,Qh,tu,eu,new mn),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function iu(t,e,n,i,r,s){Xh.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(Yh.x=s*Xh.x-r*Xh.y,Yh.y=r*Xh.x+s*Xh.y):Yh.copy(Xh),t.copy(e),t.x+=Yh.x,t.y+=Yh.y,t.applyMatrix4(Zh)}const ru=new Hn,su=new Hn;class ou extends Gi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let n=0,i=e.length;n<i;n++){const t=e[n];this.addLevel(t.object.clone(),t.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const n=this.levels;let i;for(i=0;i<n.length;i++)if(e<n[i].distance)break;return n.splice(i,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i;n++)if(t<e[n].distance)break;return e[n-1].object}return null}raycast(t,e){const n=this.levels;if(n.length>0){ru.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(ru);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){ru.setFromMatrixPosition(t.matrixWorld),su.setFromMatrixPosition(this.matrixWorld);const n=ru.distanceTo(su)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r;i++){if(!(n>=e[i].distance))break;e[i-1].object.visible=!1,e[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const t=n[i];e.object.levels.push({object:t.object.uuid,distance:t.distance})}return e}}const au=new Hn,lu=new zn,cu=new zn,hu=new Hn,uu=new xi;class du extends kr{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new xi,this.bindMatrixInverse=new xi}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new zn,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,i=this.geometry;lu.fromBufferAttribute(i.attributes.skinIndex,t),cu.fromBufferAttribute(i.attributes.skinWeight,t),au.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const t=cu.getComponent(r);if(0!==t){const i=lu.getComponent(r);uu.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(hu.copy(au).applyMatrix4(uu),t)}}return e.applyMatrix4(this.bindMatrixInverse)}}class pu extends Gi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class mu extends kn{constructor(t=null,e=1,n=1,i,r,s,o,a,l=dt,c=dt,h,u){super(null,s,o,a,l,c,i,r,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const fu=new xi,gu=new xi;class vu{constructor(t=[],e=[]){this.uuid=Ge(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new xi)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new xi;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=t.length;r<s;r++){const i=t[r]?t[r].matrixWorld:gu;fu.multiplyMatrices(i,e[r]),fu.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new vu(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=ln(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new mu(e,t,t,Rt,St);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let r=e[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new pu),this.bones.push(r),this.boneInverses.push((new xi).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}}class yu extends ar{constructor(t,e,n,i=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const xu=new xi,bu=new xi,_u=[],wu=new kr;class Mu extends kr{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new yu(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,i=this.count;if(wu.geometry=this.geometry,wu.material=this.material,void 0!==wu.material)for(let r=0;r<i;r++){this.getMatrixAt(r,xu),bu.multiplyMatrices(n,xu),wu.matrixWorld=bu,wu.raycast(t,_u);for(let t=0,n=_u.length;t<n;t++){const n=_u[t];n.instanceId=r,n.object=this,e.push(n)}_u.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new yu(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Su extends ir{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ln(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Tu=new Hn,Au=new Hn,Eu=new xi,Cu=new yi,Pu=new hi;class Lu extends Gi{constructor(t=new yr,e=new Su){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)Tu.fromBufferAttribute(e,t-1),Au.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Tu.distanceTo(Au);t.setAttribute("lineDistance",new hr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Pu.copy(n.boundingSphere),Pu.applyMatrix4(i),Pu.radius+=r,!1===t.ray.intersectsSphere(Pu))return;Eu.copy(i).invert(),Cu.copy(t.ray).applyMatrix4(Eu);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Hn,c=new Hn,h=new Hn,u=new Hn,d=this.isLineSegments?2:1,p=n.index,m=n.attributes,f=m.position;if(null!==p){const n=Math.max(0,s.start),i=Math.min(p.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=d){const n=p.getX(r),i=p.getX(r+1);l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,i);const s=Cu.distanceSqToSegment(l,c,u,h);if(s>a)continue;u.applyMatrix4(this.matrixWorld);const o=t.ray.origin.distanceTo(u);o<t.near||o>t.far||e.push({distance:o,point:h.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else{const n=Math.max(0,s.start),i=Math.min(f.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=d){l.fromBufferAttribute(f,r),c.fromBufferAttribute(f,r+1);const n=Cu.distanceSqToSegment(l,c,u,h);if(n>a)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry,e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}}const Ru=new Hn,Iu=new Hn;class Du extends Lu{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Ru.fromBufferAttribute(e,t),Iu.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Ru.distanceTo(Iu);t.setAttribute("lineDistance",new hr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Ou extends Lu{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Nu extends ir{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ln(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const ku=new xi,zu=new yi,Bu=new hi,Fu=new Hn;class Uu extends Gi{constructor(t=new yr,e=new Nu){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Bu.copy(n.boundingSphere),Bu.applyMatrix4(i),Bu.radius+=r,!1===t.ray.intersectsSphere(Bu))return;ku.copy(i).invert(),zu.copy(t.ray).applyMatrix4(ku);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=n.index,c=n.attributes,h=c.position;if(null!==l){const n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);for(let s=n,o=r;s<o;s++){const n=l.getX(s);Fu.fromBufferAttribute(h,n),Vu(Fu,n,a,i,t,e,this)}}else{const n=Math.max(0,s.start),r=Math.min(h.count,s.start+s.count);for(let s=n,o=r;s<o;s++)Fu.fromBufferAttribute(h,s),Vu(Fu,s,a,i,t,e,this)}}updateMorphTargets(){const t=this.geometry,e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}}function Vu(t,e,n,i,r,s,o){const a=zu.distanceSqToPoint(t);if(a<n){const n=new Hn;zu.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}class Hu{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let o,a=0,l=r-1;while(a<=l)if(i=Math.floor(a+(l-a)/2),o=n[i]-s,o<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i],h=n[i+1],u=h-c,d=(s-c)/u,p=(i+d)/(r-1);return p}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),o=this.getPoint(r),a=e||(s.isVector2?new mn:new Hn);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new Hn,i=[],r=[],s=[],o=new Hn,a=new xi;for(let d=0;d<=t;d++){const e=d/t;i[d]=this.getTangentAt(e,new Hn)}r[0]=new Hn,s[0]=new Hn;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let d=1;d<=t;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),o.crossVectors(i[d-1],i[d]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(je(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(a.makeRotationAxis(o,t))}s[d].crossVectors(i[d],r[d])}if(!0===e){let e=Math.acos(je(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Wu extends Hu{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const n=e||new mn,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;while(r<0)r+=i;while(r>i)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class Gu extends Wu{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function ju(){let t=0,e=0,n=0,i=0;function r(r,s,o,a){t=r,e=o,n=-3*r+3*s-2*o-a,i=2*r-2*s+o+a}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,c=(n-e)/o-(i-e)/(o+a)+(i-n)/a;l*=o,c*=o,r(e,n,l,c)},calc:function(r){const s=r*r,o=s*r;return t+e*r+n*s+i*o}}}const qu=new Hn,Xu=new ju,Yu=new ju,Zu=new ju;class Ju extends Hu{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new Hn){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=i[(l-1)%r]:(qu.subVectors(i[0],i[1]).add(i[0]),o=qu);const h=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?a=i[(l+2)%r]:(qu.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=qu),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),Xu.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,e,n,i),Yu.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,e,n,i),Zu.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,e,n,i)}else"catmullrom"===this.curveType&&(Xu.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),Yu.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),Zu.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return n.set(Xu.calc(c),Yu.calc(c),Zu.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Hn).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Ku(t,e,n,i,r){const s=.5*(i-e),o=.5*(r-n),a=t*t,l=t*a;return(2*n-2*i+s+o)*l+(-3*n+3*i-2*s-o)*a+s*t+n}function $u(t,e){const n=1-t;return n*n*e}function Qu(t,e){return 2*(1-t)*t*e}function td(t,e){return t*t*e}function ed(t,e,n,i){return $u(t,e)+Qu(t,n)+td(t,i)}function nd(t,e){const n=1-t;return n*n*n*e}function id(t,e){const n=1-t;return 3*n*n*t*e}function rd(t,e){return 3*(1-t)*t*t*e}function sd(t,e){return t*t*t*e}function od(t,e,n,i,r){return nd(t,e)+id(t,n)+rd(t,i)+sd(t,r)}class ad extends Hu{constructor(t=new mn,e=new mn,n=new mn,i=new mn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new mn){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(od(t,i.x,r.x,s.x,o.x),od(t,i.y,r.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class ld extends Hu{constructor(t=new Hn,e=new Hn,n=new Hn,i=new Hn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Hn){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(od(t,i.x,r.x,s.x,o.x),od(t,i.y,r.y,s.y,o.y),od(t,i.z,r.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class cd extends Hu{constructor(t=new mn,e=new mn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new mn){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new mn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class hd extends Hu{constructor(t=new Hn,e=new Hn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new Hn){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ud extends Hu{constructor(t=new mn,e=new mn,n=new mn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new mn){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(ed(t,i.x,r.x,s.x),ed(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class dd extends Hu{constructor(t=new Hn,e=new Hn,n=new Hn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Hn){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(ed(t,i.x,r.x,s.x),ed(t,i.y,r.y,s.y),ed(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class pd extends Hu{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new mn){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),o=r-s,a=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(Ku(o,a.x,l.x,c.x,h.x),Ku(o,a.y,l.y,c.y,h.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new mn).fromArray(n))}return this}}var md=Object.freeze({__proto__:null,ArcCurve:Gu,CatmullRomCurve3:Ju,CubicBezierCurve:ad,CubicBezierCurve3:ld,EllipseCurve:Wu,LineCurve:cd,LineCurve3:hd,QuadraticBezierCurve:ud,QuadraticBezierCurve3:dd,SplineCurve:pd});class fd extends Hu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new cd(e,t))}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;while(r<i.length){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],o=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const i=a[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new md[n.type]).fromJSON(n))}return this}}class gd extends fd{constructor(t){super(),this.type="Path",this.currentPoint=new mn,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new cd(this.currentPoint.clone(),new mn(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new ud(this.currentPoint.clone(),new mn(t,e),new mn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const o=new ad(this.currentPoint.clone(),new mn(t,e),new mn(n,i),new mn(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new pd(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,r,s,o,a),this}absellipse(t,e,n,i,r,s,o,a){const l=new Wu(t,e,n,i,r,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class vd extends yr{constructor(t=[new mn(0,-.5),new mn(.5,0),new mn(0,.5)],e=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=je(i,0,2*Math.PI);const r=[],s=[],o=[],a=[],l=[],c=1/e,h=new Hn,u=new mn,d=new Hn,p=new Hn,m=new Hn;let f=0,g=0;for(let v=0;v<=t.length-1;v++)switch(v){case 0:f=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,d.x=1*g,d.y=-f,d.z=0*g,m.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case t.length-1:a.push(m.x,m.y,m.z);break;default:f=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,d.x=1*g,d.y=-f,d.z=0*g,p.copy(d),d.x+=m.x,d.y+=m.y,d.z+=m.z,d.normalize(),a.push(d.x,d.y,d.z),m.copy(p)}for(let v=0;v<=e;v++){const r=n+v*c*i,d=Math.sin(r),p=Math.cos(r);for(let n=0;n<=t.length-1;n++){h.x=t[n].x*d,h.y=t[n].y,h.z=t[n].x*p,s.push(h.x,h.y,h.z),u.x=v/e,u.y=n/(t.length-1),o.push(u.x,u.y);const i=a[3*n+0]*d,r=a[3*n+1],c=a[3*n+0]*p;l.push(i,r,c)}}for(let v=0;v<e;v++)for(let e=0;e<t.length-1;e++){const n=e+v*t.length,i=n,s=n+t.length,o=n+t.length+1,a=n+1;r.push(i,s,a),r.push(o,a,s)}this.setIndex(r),this.setAttribute("position",new hr(s,3)),this.setAttribute("uv",new hr(o,2)),this.setAttribute("normal",new hr(l,3))}static fromJSON(t){return new vd(t.points,t.segments,t.phiStart,t.phiLength)}}class yd extends vd{constructor(t=1,e=1,n=4,i=8){const r=new gd;r.absarc(0,-e/2,t,1.5*Math.PI,0),r.absarc(0,e/2,t,0,.5*Math.PI),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:n,radialSegments:i}}static fromJSON(t){return new yd(t.radius,t.length,t.capSegments,t.radialSegments)}}class xd extends yr{constructor(t=1,e=8,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],s=[],o=[],a=[],l=new Hn,c=new mn;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let h=0,u=3;h<=e;h++,u+=3){const r=n+h/e*i;l.x=t*Math.cos(r),l.y=t*Math.sin(r),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[u]/t+1)/2,c.y=(s[u+1]/t+1)/2,a.push(c.x,c.y)}for(let h=1;h<=e;h++)r.push(h,h+1,0);this.setIndex(r),this.setAttribute("position",new hr(s,3)),this.setAttribute("normal",new hr(o,3)),this.setAttribute("uv",new hr(a,2))}static fromJSON(t){return new xd(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class bd extends yr{constructor(t=1,e=1,n=1,i=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const m=[],f=n/2;let g=0;function v(){const s=new Hn,v=new Hn;let y=0;const x=(e-t)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*a+o,l=Math.sin(r),m=Math.cos(r);v.x=y*l,v.y=-g*n+f,v.z=y*m,h.push(v.x,v.y,v.z),s.set(l,x,m).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}m.push(c)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=m[e][t],i=m[e+1][t],r=m[e+1][t+1],s=m[e][t+1];c.push(n,i,s),c.push(i,r,s),y+=6}l.addGroup(g,y,0),g+=y}function y(n){const r=p,s=new mn,m=new Hn;let v=0;const y=!0===n?t:e,x=!0===n?1:-1;for(let t=1;t<=i;t++)h.push(0,f*x,0),u.push(0,x,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=i;t++){const e=t/i,n=e*a+o,r=Math.cos(n),l=Math.sin(n);m.x=y*l,m.y=f*x,m.z=y*r,h.push(m.x,m.y,m.z),u.push(0,x,0),s.x=.5*r+.5,s.y=.5*l*x+.5,d.push(s.x,s.y),p++}for(let t=0;t<i;t++){const e=r+t,i=b+t;!0===n?c.push(i,i+1,e):c.push(i+1,i,e),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}v(),!1===s&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new hr(h,3)),this.setAttribute("normal",new hr(u,3)),this.setAttribute("uv",new hr(d,2))}static fromJSON(t){return new bd(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class _d extends bd{constructor(t=1,e=1,n=8,i=1,r=!1,s=0,o=2*Math.PI){super(0,t,e,n,i,r,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(t){return new _d(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class wd extends yr{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],s=[];function o(t){const n=new Hn,i=new Hn,r=new Hn;for(let s=0;s<e.length;s+=3)d(e[s+0],n),d(e[s+1],i),d(e[s+2],r),a(n,i,r,t)}function a(t,e,n,i){const r=i+1,s=[];for(let o=0;o<=r;o++){s[o]=[];const i=t.clone().lerp(n,o/r),a=e.clone().lerp(n,o/r),l=r-o;for(let t=0;t<=l;t++)s[o][t]=0===t&&o===r?i:i.clone().lerp(a,t/l)}for(let o=0;o<r;o++)for(let t=0;t<2*(r-o)-1;t++){const e=Math.floor(t/2);t%2===0?(u(s[o][e+1]),u(s[o+1][e]),u(s[o][e])):(u(s[o][e+1]),u(s[o+1][e+1]),u(s[o+1][e]))}}function l(t){const e=new Hn;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}function c(){const t=new Hn;for(let e=0;e<r.length;e+=3){t.x=r[e+0],t.y=r[e+1],t.z=r[e+2];const n=f(t)/2/Math.PI+.5,i=g(t)/Math.PI+.5;s.push(n,1-i)}p(),h()}function h(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],i=s[t+4],r=Math.max(e,n,i),o=Math.min(e,n,i);r>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),i<.2&&(s[t+4]+=1))}}function u(t){r.push(t.x,t.y,t.z)}function d(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function p(){const t=new Hn,e=new Hn,n=new Hn,i=new Hn,o=new mn,a=new mn,l=new mn;for(let c=0,h=0;c<r.length;c+=9,h+=6){t.set(r[c+0],r[c+1],r[c+2]),e.set(r[c+3],r[c+4],r[c+5]),n.set(r[c+6],r[c+7],r[c+8]),o.set(s[h+0],s[h+1]),a.set(s[h+2],s[h+3]),l.set(s[h+4],s[h+5]),i.copy(t).add(e).add(n).divideScalar(3);const u=f(i);m(o,h+0,t,u),m(a,h+2,e,u),m(l,h+4,n,u)}}function m(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5)}function f(t){return Math.atan2(t.z,-t.x)}function g(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}o(i),l(n),c(),this.setAttribute("position",new hr(r,3)),this.setAttribute("normal",new hr(r.slice(),3)),this.setAttribute("uv",new hr(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new wd(t.vertices,t.indices,t.radius,t.details)}}class Md extends wd{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,s,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Md(t.radius,t.detail)}}const Sd=new Hn,Td=new Hn,Ad=new Hn,Ed=new er;class Cd extends yr{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const n=4,i=Math.pow(10,n),r=Math.cos(He*e),s=t.getIndex(),o=t.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<a;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:n,c:a}=Ed;if(e.fromBufferAttribute(o,l[0]),n.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),Ed.getNormal(Ad),h[0]=`${Math.round(e.x*i)},${Math.round(e.y*i)},${Math.round(e.z*i)}`,h[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,h[2]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=h[t],i=h[e],s=Ed[c[t]],o=Ed[c[e]],a=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(Ad.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(o.x,o.y,o.z)),u[p]=null):a in u||(u[a]={index0:l[t],index1:l[e],normal:Ad.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:n}=u[t];Sd.fromBufferAttribute(o,e),Td.fromBufferAttribute(o,n),d.push(Sd.x,Sd.y,Sd.z),d.push(Td.x,Td.y,Td.z)}this.setAttribute("position",new hr(d,3))}}}class Pd extends gd{constructor(t){super(t),this.uuid=Ge(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new gd).fromJSON(n))}return this}}const Ld={triangulate:function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=Rd(t,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,h,u,d,p;if(i&&(s=Bd(t,e,s,n)),t.length>80*n){a=c=t[0],l=h=t[1];for(let e=n;e<r;e+=n)u=t[e],d=t[e+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=0!==p?1/p:0}return Dd(s,o,n,a,l,p),o}};function Rd(t,e,n,i,r){let s,o;if(r===ap(t,e,n,i)>0)for(s=e;s<n;s+=i)o=rp(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=rp(s,t[s],t[s+1],o);return o&&Jd(o,o.next)&&(sp(o),o=o.next),o}function Id(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!Jd(i,i.next)&&0!==Zd(i.prev,i,i.next))i=i.next;else{if(sp(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function Dd(t,e,n,i,r,s,o){if(!t)return;!o&&s&&Wd(t,i,r,s);let a,l,c=t;while(t.prev!==t.next)if(a=t.prev,l=t.next,s?Nd(t,i,r,s):Od(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),sp(t),t=l.next,c=l.next;else if(t=l,t===c){o?1===o?(t=kd(Id(t),e,n),Dd(t,e,n,i,r,s,2)):2===o&&zd(t,e,n,i,r,s):Dd(Id(t),e,n,i,r,s,1);break}}function Od(t){const e=t.prev,n=t,i=t.next;if(Zd(e,n,i)>=0)return!1;let r=t.next.next;while(r!==t.prev){if(Xd(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Zd(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Nd(t,e,n,i){const r=t.prev,s=t,o=t.next;if(Zd(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,h=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=jd(a,l,e,n,i),d=jd(c,h,e,n,i);let p=t.prevZ,m=t.nextZ;while(p&&p.z>=u&&m&&m.z<=d){if(p!==t.prev&&p!==t.next&&Xd(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Zd(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==t.prev&&m!==t.next&&Xd(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Zd(m.prev,m,m.next)>=0)return!1;m=m.nextZ}while(p&&p.z>=u){if(p!==t.prev&&p!==t.next&&Xd(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Zd(p.prev,p,p.next)>=0)return!1;p=p.prevZ}while(m&&m.z<=d){if(m!==t.prev&&m!==t.next&&Xd(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Zd(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function kd(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Jd(r,s)&&Kd(r,i,i.next,s)&&ep(r,s)&&ep(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),sp(i),sp(i.next),i=t=s),i=i.next}while(i!==t);return Id(i)}function zd(t,e,n,i,r,s){let o=t;do{let t=o.next.next;while(t!==o.prev){if(o.i!==t.i&&Yd(o,t)){let a=ip(o,t);return o=Id(o,o.next),a=Id(a,a.next),Dd(o,e,n,i,r,s),void Dd(a,e,n,i,r,s)}t=t.next}o=o.next}while(o!==t)}function Bd(t,e,n,i){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=Rd(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(qd(c));for(r.sort(Fd),s=0;s<r.length;s++)Ud(r[s],n),n=Id(n,n.next);return n}function Fd(t,e){return t.x-e.x}function Ud(t,e){if(e=Vd(t,e),e){const n=ip(e,t);Id(e,e.next),Id(n,n.next)}}function Vd(t,e){let n=e;const i=t.x,r=t.y;let s,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>o){if(o=t,t===i){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(i===o)return s;const a=s,l=s.x,c=s.y;let h,u=1/0;n=s;do{i>=n.x&&n.x>=l&&i!==n.x&&Xd(r<c?i:o,r,l,c,r<c?o:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),ep(n,t)&&(h<u||h===u&&(n.x>s.x||n.x===s.x&&Hd(s,n)))&&(s=n,u=h)),n=n.next}while(n!==a);return s}function Hd(t,e){return Zd(t.prev,t,e.prev)<0&&Zd(e.next,t,t.next)<0}function Wd(t,e,n,i){let r=t;do{null===r.z&&(r.z=jd(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,Gd(r)}function Gd(t){let e,n,i,r,s,o,a,l,c=1;do{n=t,t=null,s=null,o=0;while(n){for(o++,i=n,a=0,e=0;e<c;e++)if(a++,i=i.nextZ,!i)break;l=c;while(a>0||l>0&&i)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1);return t}function jd(t,e,n,i,r){return t=32767*(t-n)*r,e=32767*(e-i)*r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function qd(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Xd(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function Yd(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!tp(t,e)&&(ep(t,e)&&ep(e,t)&&np(t,e)&&(Zd(t.prev,t,e.prev)||Zd(t,e.prev,e))||Jd(t,e)&&Zd(t.prev,t,t.next)>0&&Zd(e.prev,e,e.next)>0)}function Zd(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Jd(t,e){return t.x===e.x&&t.y===e.y}function Kd(t,e,n,i){const r=Qd(Zd(t,e,n)),s=Qd(Zd(t,e,i)),o=Qd(Zd(n,i,t)),a=Qd(Zd(n,i,e));return r!==s&&o!==a||(!(0!==r||!$d(t,n,e))||(!(0!==s||!$d(t,i,e))||(!(0!==o||!$d(n,t,i))||!(0!==a||!$d(n,e,i)))))}function $d(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Qd(t){return t>0?1:t<0?-1:0}function tp(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Kd(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function ep(t,e){return Zd(t.prev,t,t.next)<0?Zd(t,e,t.next)>=0&&Zd(t,t.prev,e)>=0:Zd(t,e,t.prev)<0||Zd(t,t.next,e)<0}function np(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!==n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}function ip(t,e){const n=new op(t.i,t.x,t.y),i=new op(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function rp(t,e,n,i){const r=new op(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function sp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function op(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ap(t,e,n,i){let r=0;for(let s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}class lp{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return lp.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];cp(t),hp(n,t);let s=t.length;e.forEach(cp);for(let a=0;a<e.length;a++)i.push(s),s+=e[a].length,hp(n,e[a]);const o=Ld.triangulate(n,i);for(let a=0;a<o.length;a+=3)r.push(o.slice(a,a+3));return r}}function cp(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function hp(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class up extends yr{constructor(t=new Pd([new mn(.5,.5),new mn(-.5,.5),new mn(-.5,-.5),new mn(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let o=0,a=t.length;o<a;o++){const e=t[o];s(e)}function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const m=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:dp;let g,v,y,x,b,_=!1;m&&(g=m.getSpacedPoints(a),_=!0,c=!1,v=m.computeFrenetFrames(a,!1),y=new Hn,x=new Hn,b=new Hn),c||(p=0,h=0,u=0,d=0);const w=t.extractPoints(o);let M=w.shape;const S=w.holes,T=!lp.isClockWise(M);if(T){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];lp.isClockWise(e)&&(S[t]=e.reverse())}}const A=lp.triangulateShape(M,S),E=M;for(let e=0,n=S.length;e<n;e++){const t=S[e];M=M.concat(t)}function C(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const P=M.length,L=A.length;function R(t,e,n){let i,r,s;const o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,c=n.y-t.y,h=o*o+a*a,u=o*c-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-a/u,m=e.y+o/u,f=n.x-c/d,g=n.y+l/d,v=((f-p)*c-(g-m)*l)/(o*c-a*l);i=p+o*v-t.x,r=m+a*v-t.y;const y=i*i+r*r;if(y<=2)return new mn(i,r);s=Math.sqrt(y/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(i=-a,r=o,s=Math.sqrt(h)):(i=o,r=a,s=Math.sqrt(h/2))}return new mn(i/s,r/s)}const I=[];for(let e=0,n=E.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),I[e]=R(E[e],E[i],E[r]);const D=[];let O,N=I.concat();for(let e=0,n=S.length;e<n;e++){const t=S[e];O=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),O[e]=R(t[e],t[i],t[r]);D.push(O),N=N.concat(O)}for(let e=0;e<p;e++){const t=e/p,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,r=E.length;e<r;e++){const t=C(E[e],I[e],i);U(t.x,t.y,-n)}for(let e=0,r=S.length;e<r;e++){const t=S[e];O=D[e];for(let e=0,r=t.length;e<r;e++){const r=C(t[e],O[e],i);U(r.x,r.y,-n)}}}const k=u+d;for(let e=0;e<P;e++){const t=c?C(M[e],N[e],k):M[e];_?(x.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(x).add(y),U(b.x,b.y,b.z)):U(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<P;t++){const n=c?C(M[t],N[t],k):M[t];_?(x.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(x).add(y),U(b.x,b.y,b.z)):U(n.x,n.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,r=E.length;e<r;e++){const t=C(E[e],I[e],i);U(t.x,t.y,l+n)}for(let e=0,r=S.length;e<r;e++){const t=S[e];O=D[e];for(let e=0,r=t.length;e<r;e++){const r=C(t[e],O[e],i);_?U(r.x,r.y+g[a-1].y,g[a-1].x+n):U(r.x,r.y,l+n)}}}function z(){const t=i.length/3;if(c){let t=0,e=P*t;for(let n=0;n<L;n++){const t=A[n];V(t[2]+e,t[1]+e,t[0]+e)}t=a+2*p,e=P*t;for(let n=0;n<L;n++){const t=A[n];V(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<L;t++){const e=A[t];V(e[2],e[1],e[0])}for(let t=0;t<L;t++){const e=A[t];V(e[0]+P*a,e[1]+P*a,e[2]+P*a)}}n.addGroup(t,i.length/3-t,0)}function B(){const t=i.length/3;let e=0;F(E,e),e+=E.length;for(let n=0,i=S.length;n<i;n++){const t=S[n];F(t,e),e+=t.length}n.addGroup(t,i.length/3-t,1)}function F(t,e){let n=t.length;while(--n>=0){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=a+2*p;t<n;t++){const n=P*t,s=P*(t+1),o=e+i+n,a=e+r+n,l=e+r+s,c=e+i+s;H(o,a,l,c)}}}function U(t,e,n){s.push(t),s.push(e),s.push(n)}function V(t,e,r){W(t),W(e),W(r);const s=i.length/3,o=f.generateTopUV(n,i,s-3,s-2,s-1);G(o[0]),G(o[1]),G(o[2])}function H(t,e,r,s){W(t),W(e),W(s),W(e),W(r),W(s);const o=i.length/3,a=f.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);G(a[0]),G(a[1]),G(a[3]),G(a[1]),G(a[2]),G(a[3])}function W(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function G(t){r.push(t.x),r.push(t.y)}z(),B()}this.setAttribute("position",new hr(i,3)),this.setAttribute("uv",new hr(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,n=this.parameters.options;return pp(e,n,t)}static fromJSON(t,e){const n=[];for(let r=0,s=t.shapes.length;r<s;r++){const i=e[t.shapes[r]];n.push(i)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new md[i.type]).fromJSON(i)),new up(n,t.options)}}const dp={generateTopUV:function(t,e,n,i,r){const s=e[3*n],o=e[3*n+1],a=e[3*i],l=e[3*i+1],c=e[3*r],h=e[3*r+1];return[new mn(s,o),new mn(a,l),new mn(c,h)]},generateSideWallUV:function(t,e,n,i,r,s){const o=e[3*n],a=e[3*n+1],l=e[3*n+2],c=e[3*i],h=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],m=e[3*r+2],f=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-h)<Math.abs(o-c)?[new mn(o,1-l),new mn(c,1-u),new mn(d,1-m),new mn(f,1-v)]:[new mn(a,1-l),new mn(h,1-u),new mn(p,1-m),new mn(g,1-v)]}};function pp(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const e=t[i];n.shapes.push(e.uuid)}else n.shapes.push(t.uuid);return n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class mp extends wd{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,r,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new mp(t.radius,t.detail)}}class fp extends wd{constructor(t=1,e=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new fp(t.radius,t.detail)}}class gp extends yr{constructor(t=.5,e=1,n=8,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n),i=Math.max(1,i);const o=[],a=[],l=[],c=[];let h=t;const u=(e-t)/i,d=new Hn,p=new mn;for(let m=0;m<=i;m++){for(let t=0;t<=n;t++){const i=r+t/n*s;d.x=h*Math.cos(i),d.y=h*Math.sin(i),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}h+=u}for(let m=0;m<i;m++){const t=m*(n+1);for(let e=0;e<n;e++){const i=e+t,r=i,s=i+n+1,a=i+n+2,l=i+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new hr(a,3)),this.setAttribute("normal",new hr(l,3)),this.setAttribute("uv",new hr(c,2))}static fromJSON(t){return new gp(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class vp extends yr{constructor(t=new Pd([new mn(0,.5),new mn(-.5,-.5),new mn(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let c=0;c<t.length;c++)l(t[c]),this.addGroup(o,a,c),o+=a,a=0;function l(t){const o=i.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===lp.isClockWise(c)&&(c=c.reverse());for(let e=0,n=h.length;e<n;e++){const t=h[e];!0===lp.isClockWise(t)&&(h[e]=t.reverse())}const u=lp.triangulateShape(c,h);for(let e=0,n=h.length;e<n;e++){const t=h[e];c=c.concat(t)}for(let e=0,n=c.length;e<n;e++){const t=c[e];i.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,i=u.length;e<i;e++){const t=u[e],i=t[0]+o,r=t[1]+o,s=t[2]+o;n.push(i,r,s),a+=3}}this.setIndex(n),this.setAttribute("position",new hr(i,3)),this.setAttribute("normal",new hr(r,3)),this.setAttribute("uv",new hr(s,2))}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return yp(e,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new vp(n,t.curveSegments)}}function yp(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}class xp extends yr{constructor(t=1,e=32,n=16,i=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const c=[],h=new Hn,u=new Hn,d=[],p=[],m=[],f=[];for(let g=0;g<=n;g++){const d=[],v=g/n;let y=0;0==g&&0==s?y=.5/e:g==n&&a==Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;h.x=-t*Math.cos(i+a*r)*Math.sin(s+v*o),h.y=t*Math.cos(s+v*o),h.z=t*Math.sin(i+a*r)*Math.sin(s+v*o),p.push(h.x,h.y,h.z),u.copy(h).normalize(),m.push(u.x,u.y,u.z),f.push(a+y,1-v),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let t=0;t<e;t++){const e=c[g][t+1],i=c[g][t],r=c[g+1][t],o=c[g+1][t+1];(0!==g||s>0)&&d.push(e,i,o),(g!==n-1||a<Math.PI)&&d.push(i,r,o)}this.setIndex(d),this.setAttribute("position",new hr(p,3)),this.setAttribute("normal",new hr(m,3)),this.setAttribute("uv",new hr(f,2))}static fromJSON(t){return new xp(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class bp extends wd{constructor(t=1,e=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new bp(t.radius,t.detail)}}class _p extends yr{constructor(t=1,e=.4,n=8,i=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],o=[],a=[],l=[],c=new Hn,h=new Hn,u=new Hn;for(let d=0;d<=n;d++)for(let s=0;s<=i;s++){const p=s/i*r,m=d/n*Math.PI*2;h.x=(t+e*Math.cos(m))*Math.cos(p),h.y=(t+e*Math.cos(m))*Math.sin(p),h.z=e*Math.sin(m),o.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),a.push(u.x,u.y,u.z),l.push(s/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let t=1;t<=i;t++){const e=(i+1)*d+t-1,n=(i+1)*(d-1)+t-1,r=(i+1)*(d-1)+t,o=(i+1)*d+t;s.push(e,n,o),s.push(n,r,o)}this.setIndex(s),this.setAttribute("position",new hr(o,3)),this.setAttribute("normal",new hr(a,3)),this.setAttribute("uv",new hr(l,2))}static fromJSON(t){return new _p(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class wp extends yr{constructor(t=1,e=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const o=[],a=[],l=[],c=[],h=new Hn,u=new Hn,d=new Hn,p=new Hn,m=new Hn,f=new Hn,g=new Hn;for(let y=0;y<=n;++y){const o=y/n*r*Math.PI*2;v(o,r,s,t,d),v(o+.01,r,s,t,p),f.subVectors(p,d),g.addVectors(p,d),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,s=-e*Math.cos(r),o=e*Math.sin(r);h.x=d.x+(s*g.x+o*m.x),h.y=d.y+(s*g.y+o*m.y),h.z=d.z+(s*g.z+o*m.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(y/n),c.push(t/i)}}for(let y=1;y<=n;y++)for(let t=1;t<=i;t++){const e=(i+1)*(y-1)+(t-1),n=(i+1)*y+(t-1),r=(i+1)*y+t,s=(i+1)*(y-1)+t;o.push(e,n,s),o.push(n,r,s)}function v(t,e,n,i,r){const s=Math.cos(t),o=Math.sin(t),a=n/e*t,l=Math.cos(a);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*o*.5,r.z=i*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new hr(a,3)),this.setAttribute("normal",new hr(l,3)),this.setAttribute("uv",new hr(c,2))}static fromJSON(t){return new wp(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Mp extends yr{constructor(t=new dd(new Hn(-1,-1,0),new Hn(-1,1,0),new Hn(1,1,0)),e=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new Hn,a=new Hn,l=new mn;let c=new Hn;const h=[],u=[],d=[],p=[];function m(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),v(),g()}function f(r){c=t.getPointAt(r/e,c);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+r*d.x,a.y=s*l.y+r*d.y,a.z=s*l.z+r*d.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=c.x+n*a.x,o.y=c.y+n*a.y,o.z=c.z+n*a.z,h.push(o.x,o.y,o.z)}}function g(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,o=(i+1)*(t-1)+e;p.push(n,r,o),p.push(r,s,o)}}function v(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)l.x=t/e,l.y=n/i,d.push(l.x,l.y)}m(),this.setIndex(p),this.setAttribute("position",new hr(h,3)),this.setAttribute("normal",new hr(u,3)),this.setAttribute("uv",new hr(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Mp((new md[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Sp extends yr{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],n=new Set,i=new Hn,r=new Hn;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,l=a.length;t<l;++t){const l=a[t],c=l.start,h=l.count;for(let t=c,a=c+h;t<a;t+=3)for(let l=0;l<3;l++){const a=o.getX(t+l),c=o.getX(t+(l+1)%3);i.fromBufferAttribute(s,a),r.fromBufferAttribute(s,c),!0===Tp(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,o=s.count/3;t<o;t++)for(let a=0;a<3;a++){const o=3*t+a,l=3*t+(a+1)%3;i.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===Tp(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new hr(e,3))}}}function Tp(t,e,n){const i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var Ap=Object.freeze({__proto__:null,BoxGeometry:Fr,CapsuleGeometry:yd,CircleGeometry:xd,ConeGeometry:_d,CylinderGeometry:bd,DodecahedronGeometry:Md,EdgesGeometry:Cd,ExtrudeGeometry:up,IcosahedronGeometry:mp,LatheGeometry:vd,OctahedronGeometry:fp,PlaneGeometry:cs,PolyhedronGeometry:wd,RingGeometry:gp,ShapeGeometry:vp,SphereGeometry:xp,TetrahedronGeometry:bp,TorusGeometry:_p,TorusKnotGeometry:wp,TubeGeometry:Mp,WireframeGeometry:Sp});class Ep extends ir{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ln(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Cp extends qr{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Pp extends ir{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ln(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Le,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Lp extends Pp{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return je(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ln(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Ln(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ln(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!==t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!==t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!==t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!==t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Rp extends ir{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ln(16777215),this.specular=new Ln(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Le,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Ip extends ir{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ln(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Le,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Dp extends ir{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Le,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Op extends ir{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ln(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Le,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Np extends ir{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ln(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Le,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class kp extends Su{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function zp(t,e,n){return Fp(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)}function Bp(t,e,n){return!t||!n&&t.constructor===e?t:"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function Fp(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Up(t){function e(e,n){return t[e]-t[n]}const n=t.length,i=new Array(n);for(let r=0;r!==n;++r)i[r]=r;return i.sort(e),i}function Vp(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,o=0;o!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)r[o++]=t[i+n]}return r}function Hp(t,e,n,i){let r=1,s=t[0];while(void 0!==s&&void 0===s[i])s=t[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(e.push(s.time),n.push(o)),s=t[r++]}while(void 0!==s)}class Wp{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=r)break t;{const o=e[1];t<o&&(n=2,r=o);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0}}while(n<s){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let s=0;s!==i;++s)e[s]=n[r+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Gp extends Wp{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:xe,endingEnd:xe}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case be:r=t,o=2*e-n;break;case _e:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case be:s=t,a=2*n-e;break;case _e:s=1,a=n+i[1]-i[0];break;default:s=t-1,a=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),m=p*p,f=m*p,g=-u*f+2*u*m-u*p,v=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,y=(-1-d)*f+(1.5+d)*m+.5*p,x=d*f-d*m;for(let b=0;b!==o;++b)r[b]=g*s[c+b]+v*s[l+b]+y*s[a+b]+x*s[h+b];return r}}class jp extends Wp{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(i-e),h=1-c;for(let u=0;u!==o;++u)r[u]=s[l+u]*h+s[a+u]*c;return r}}class qp extends Wp{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Xp{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Bp(e,this.TimeBufferType),this.values=Bp(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Bp(t.times,Array),values:Bp(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new qp(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new jp(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Gp(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case ge:e=this.InterpolantFactoryMethodDiscrete;break;case ve:e=this.InterpolantFactoryMethodLinear;break;case ye:e=this.InterpolantFactoryMethodSmooth;break}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ge;case this.InterpolantFactoryMethodLinear:return ve;case this.InterpolantFactoryMethodSmooth:return ye}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;while(r!==i&&n[r]<t)++r;while(-1!==s&&n[s]>e)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=zp(n,r,s),this.values=zp(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let o=0;o!==r;o++){const e=n[o];if("number"===typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,e),t=!1;break}if(null!==s&&s>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,e,s),t=!1;break}s=e}if(void 0!==i&&Fp(i))for(let o=0,a=i.length;o!==a;++o){const e=i[o];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,e),t=!1;break}}return t}optimize(){const t=zp(this.times),e=zp(this.values),n=this.getValueSize(),i=this.getInterpolation()===ye,r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o],l=t[o+1];if(a!==l&&(1!==o||a!==t[0]))if(i)r=!0;else{const t=o*n,i=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[i+o]||n!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const i=o*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,o=0;o!==n;++o)e[i+o]=e[t+o];++s}return s!==t.length?(this.times=zp(t,0,s),this.values=zp(e,0,s*n)):(this.times=t,this.values=e),this}clone(){const t=zp(this.times,0),e=zp(this.values,0),n=this.constructor,i=new n(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Xp.prototype.TimeBufferType=Float32Array,Xp.prototype.ValueBufferType=Float32Array,Xp.prototype.DefaultInterpolation=ve;class Yp extends Xp{}Yp.prototype.ValueTypeName="bool",Yp.prototype.ValueBufferType=Array,Yp.prototype.DefaultInterpolation=ge,Yp.prototype.InterpolantFactoryMethodLinear=void 0,Yp.prototype.InterpolantFactoryMethodSmooth=void 0;class Zp extends Xp{}Zp.prototype.ValueTypeName="color";class Jp extends Xp{}Jp.prototype.ValueTypeName="number";class Kp extends Wp{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(i-e);let l=t*o;for(let c=l+o;l!==c;l+=4)Vn.slerpFlat(r,0,s,l-o,s,l,a);return r}}class $p extends Xp{InterpolantFactoryMethodLinear(t){return new Kp(this.times,this.values,this.getValueSize(),t)}}$p.prototype.ValueTypeName="quaternion",$p.prototype.DefaultInterpolation=ve,$p.prototype.InterpolantFactoryMethodSmooth=void 0;class Qp extends Xp{}Qp.prototype.ValueTypeName="string",Qp.prototype.ValueBufferType=Array,Qp.prototype.DefaultInterpolation=ge,Qp.prototype.InterpolantFactoryMethodLinear=void 0,Qp.prototype.InterpolantFactoryMethodSmooth=void 0;class tm extends Xp{}tm.prototype.ValueTypeName="vector";class em{constructor(t,e=-1,n,i=we){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=Ge(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let s=0,o=n.length;s!==o;++s)e.push(im(n[s]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,s=n.length;r!==s;++r)e.push(Xp.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,s=[];for(let o=0;o<r;o++){let t=[],a=[];t.push((o+r-1)%r,o,(o+1)%r),a.push(0,1,0);const l=Up(t);t=Vp(t,1,l),a=Vp(a,1,l),i||0!==t[0]||(t.push(r),a.push(a[0])),s.push(new Jp(".morphTargetInfluences["+e[o].name+"]",t,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,a=t.length;o<a;o++){const e=t[o],n=e.name.match(r);if(n&&n.length>1){const t=n[1];let r=i[t];r||(i[t]=r=[]),r.push(e)}}const s=[];for(const o in i)s.push(this.CreateFromMorphTargetSequence(o,i[o],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const s=[],o=[];Hp(n,s,o,i),0!==s.length&&r.push(new t(e,s,o))}},i=[],r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let h=0;h<l.length;h++){const t=l[h].keys;if(t&&0!==t.length)if(t[0].morphTargets){const e={};let n;for(n=0;n<t.length;n++)if(t[n].morphTargets)for(let i=0;i<t[n].morphTargets.length;i++)e[t[n].morphTargets[i]]=-1;for(const r in e){const e=[],s=[];for(let i=0;i!==t[n].morphTargets.length;++i){const i=t[n];e.push(i.time),s.push(i.morphTarget===r?1:0)}i.push(new Jp(".morphTargetInfluence["+r+"]",e,s))}a=e.length*s}else{const r=".bones["+e[h].name+"]";n(tm,r+".position",t,"pos",i),n($p,r+".quaternion",t,"rot",i),n(tm,r+".scale",t,"scl",i)}}if(0===i.length)return null;const c=new this(r,a,i,o);return c}resetDuration(){const t=this.tracks;let e=0;for(let n=0,i=t.length;n!==i;++n){const t=this.tracks[n];e=Math.max(e,t.times[t.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function nm(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Jp;case"vector":case"vector2":case"vector3":case"vector4":return tm;case"color":return Zp;case"quaternion":return $p;case"bool":case"boolean":return Yp;case"string":return Qp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function im(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=nm(t.type);if(void 0===t.times){const e=[],n=[];Hp(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const rm={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class sm{constructor(t,e,n){const i=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==i.onStart&&i.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const om=new sm;class am{constructor(t){this.manager=void 0!==t?t:om,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const lm={};class cm extends Error{constructor(t,e){super(t),this.response=e}}class hm extends am{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=rm.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==lm[t])return void lm[t].push({onLoad:e,onProgress:n,onError:i});lm[t]=[],lm[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=lm[t],i=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;const l=new ReadableStream({start(t){function e(){i.read().then((({done:i,value:r})=>{if(i)t.close();else{a+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}}))}e()}});return new Response(l)}throw new cm(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>{const e=new DOMParser;return e.parseFromString(t,o)}));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i,n=e.exec(o),i=n&&n[1]?n[1].toLowerCase():void 0,r=new TextDecoder(i);return t.arrayBuffer().then((t=>r.decode(t)))}}})).then((e=>{rm.add(t,e);const n=lm[t];delete lm[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}})).catch((e=>{const n=lm[t];if(void 0===n)throw this.manager.itemError(t),e;delete lm[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class um extends am{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=rm.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o=xn("img");function a(){c(),rm.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class dm extends am{constructor(t){super(t)}load(t,e,n,i){const r=new kn,s=new um(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}class pm extends Gi{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Ln(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class mm extends pm{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Gi.DefaultUp),this.updateMatrix(),this.groundColor=new Ln(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const fm=new xi,gm=new Hn,vm=new Hn;class ym{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new mn(512,512),this.map=null,this.mapPass=null,this.matrix=new xi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new os,this._frameExtents=new mn(1,1),this._viewportCount=1,this._viewports=[new zn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;gm.setFromMatrixPosition(t.matrixWorld),e.position.copy(gm),vm.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(vm),e.updateMatrixWorld(),fm.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(fm),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class xm extends ym{constructor(){super(new Yr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*We*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class bm extends pm{constructor(t,e,n=0,i=Math.PI/3,r=0,s=1){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Gi.DefaultUp),this.updateMatrix(),this.target=new Gi,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new xm}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const _m=new xi,wm=new Hn,Mm=new Hn;class Sm extends ym{constructor(){super(new Yr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new mn(4,2),this._viewportCount=6,this._viewports=[new zn(2,1,1,1),new zn(0,1,1,1),new zn(3,1,1,1),new zn(1,1,1,1),new zn(3,0,1,1),new zn(1,0,1,1)],this._cubeDirections=[new Hn(1,0,0),new Hn(-1,0,0),new Hn(0,0,1),new Hn(0,0,-1),new Hn(0,1,0),new Hn(0,-1,0)],this._cubeUps=[new Hn(0,1,0),new Hn(0,1,0),new Hn(0,1,0),new Hn(0,1,0),new Hn(0,0,1),new Hn(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),wm.setFromMatrixPosition(t.matrixWorld),n.position.copy(wm),Mm.copy(n.position),Mm.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Mm),n.updateMatrixWorld(),i.makeTranslation(-wm.x,-wm.y,-wm.z),_m.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_m)}}class Tm extends pm{constructor(t,e,n=0,i=1){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Sm}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Am extends ym{constructor(){super(new Ja(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Em extends pm{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Gi.DefaultUp),this.updateMatrix(),this.target=new Gi,this.shadow=new Am}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Cm extends pm{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Pm extends pm{constructor(t,e,n=10,i=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class Lm{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Hn)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*i),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*i*1.092548),e.addScaledVector(s[5],i*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],n*r*1.092548),e.addScaledVector(s[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*i),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*i),e.addScaledVector(s[5],.858086*i*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*n*r),e.addScaledVector(s[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(t=[],e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}class Rm extends pm{constructor(t=new Lm,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class Im extends am{constructor(t){super(t),this.textures={}}load(t,e,n,i){const r=this,s=new hm(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(s){i?i(s):console.error(s),r.manager.itemError(t)}}),n,i)}parse(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=Im.createMaterialFromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new Ln).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.iridescence&&(i.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(i.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"===typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const r in t.uniforms){const e=t.uniforms[r];switch(i.uniforms[r]={},e.type){case"t":i.uniforms[r].value=n(e.value);break;case"c":i.uniforms[r].value=(new Ln).setHex(e.value);break;case"v2":i.uniforms[r].value=(new mn).fromArray(e.value);break;case"v3":i.uniforms[r].value=(new Hn).fromArray(e.value);break;case"v4":i.uniforms[r].value=(new zn).fromArray(e.value);break;case"m3":i.uniforms[r].value=(new fn).fromArray(e.value);break;case"m4":i.uniforms[r].value=(new xi).fromArray(e.value);break;default:i.uniforms[r].value=e.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(i.glslVersion=t.glslVersion),void 0!==t.extensions)for(const r in t.extensions)i.extensions[r]=t.extensions[r];if(void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new mn).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=n(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new mn).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(i.iridescenceMap=n(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=n(t.thicknessMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=n(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=n(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const e={ShadowMaterial:Ep,SpriteMaterial:Hh,RawShaderMaterial:Cp,ShaderMaterial:qr,PointsMaterial:Nu,MeshPhysicalMaterial:Lp,MeshStandardMaterial:Pp,MeshPhongMaterial:Rp,MeshToonMaterial:Ip,MeshNormalMaterial:Dp,MeshLambertMaterial:Op,MeshDepthMaterial:vh,MeshDistanceMaterial:yh,MeshBasicMaterial:rr,MeshMatcapMaterial:Np,LineDashedMaterial:kp,LineBasicMaterial:Su,Material:ir};return new e[t]}}class Dm{static decodeText(t){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(n){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!==typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Om extends yr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class Nm extends am{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new hm(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(s){i?i(s):console.error(s),r.manager.itemError(t)}}),n,i)}parse(t){const e={},n={};function i(t,n){if(void 0!==e[n])return e[n];const i=t.interleavedBuffers,s=i[n],o=r(t,s.buffer),a=yn(s.type,o),l=new Fh(a,s.stride);return l.uuid=s.uuid,e[n]=l,l}function r(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers,r=i[e],s=new Uint32Array(r).buffer;return n[e]=s,s}const s=t.isInstancedBufferGeometry?new Om:new yr,o=t.data.index;if(void 0!==o){const t=yn(o.type,o.array);s.setIndex(new ar(t,1))}const a=t.data.attributes;for(const d in a){const e=a[d];let n;if(e.isInterleavedBufferAttribute){const r=i(t.data,e.data);n=new Vh(r,e.itemSize,e.offset,e.normalized)}else{const t=yn(e.type,e.array),i=e.isInstancedBufferAttribute?yu:ar;n=new i(t,e.itemSize,e.normalized)}void 0!==e.name&&(n.name=e.name),void 0!==e.usage&&n.setUsage(e.usage),void 0!==e.updateRange&&(n.updateRange.offset=e.updateRange.offset,n.updateRange.count=e.updateRange.count),s.setAttribute(d,n)}const l=t.data.morphAttributes;if(l)for(const d in l){const e=l[d],n=[];for(let r=0,s=e.length;r<s;r++){const s=e[r];let o;if(s.isInterleavedBufferAttribute){const e=i(t.data,s.data);o=new Vh(e,s.itemSize,s.offset,s.normalized)}else{const t=yn(s.type,s.array);o=new ar(t,s.itemSize,s.normalized)}void 0!==s.name&&(o.name=s.name),n.push(o)}s.morphAttributes[d]=n}const c=t.data.morphTargetsRelative;c&&(s.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==h)for(let d=0,p=h.length;d!==p;++d){const t=h[d];s.addGroup(t.start,t.count,t.materialIndex)}const u=t.data.boundingSphere;if(void 0!==u){const t=new Hn;void 0!==u.center&&t.fromArray(u.center),s.boundingSphere=new hi(t,u.radius)}return t.name&&(s.name=t.name),t.userData&&(s.userData=t.userData),s}}class km extends am{constructor(t){super(t)}load(t,e,n,i){const r=this,s=""===this.path?Dm.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new hm(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){let s=null;try{s=JSON.parse(n)}catch(a){return void 0!==i&&i(a),void console.error("THREE:ObjectLoader: Can't parse "+t+".",a.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,i)}async loadAsync(t,e){const n=this,i=""===this.path?Dm.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const r=new hm(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const s=await r.loadAsync(t,e),o=JSON.parse(s),a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await n.parseAsync(o)}parse(t,e){const n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,r,a,o,n),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,n),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,i,o,s,e),l=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new Pd).fromJSON(t[n]);e[i.uuid]=i}return e}parseSkeletons(t,e){const n={},i={};if(e.traverse((function(t){t.isBone&&(i[t.uuid]=t)})),void 0!==t)for(let r=0,s=t.length;r<s;r++){const e=(new vu).fromJSON(t[r],i);n[e.uuid]=e}return n}parseGeometries(t,e){const n={};if(void 0!==t){const i=new Nm;for(let r=0,s=t.length;r<s;r++){let s;const o=t[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(o);break;default:o.type in Ap?s=Ap[o.type].fromJSON(o,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),n[o.uuid]=s}}return n}parseMaterials(t,e){const n={},i={};if(void 0!==t){const r=new Im;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const i=t[n],r=em.parse(i);e[r.uuid]=r}return e}parseImages(t,e){const n=this,i={};let r;function s(t){return n.manager.itemStart(t),r.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}function o(t){if("string"===typeof t){const e=t,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;return s(i)}return t.data?{data:yn(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new sm(e);r=new um(n),r.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const n=t[e],r=n.url;if(Array.isArray(r)){const t=[];for(let e=0,n=r.length;e<n;e++){const n=r[e],i=o(n);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new mu(i.data,i.width,i.height)))}i[n.uuid]=new Dn(t)}else{const t=o(n.url);i[n.uuid]=new Dn(t)}}}return i}async parseImagesAsync(t){const e=this,n={};let i;async function r(t){if("string"===typeof t){const n=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return await i.loadAsync(r)}return t.data?{data:yn(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){i=new um(this.manager),i.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.url;if(Array.isArray(s)){const t=[];for(let e=0,n=s.length;e<n;e++){const n=s[e],i=await r(n);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new mu(i.data,i.width,i.height)))}n[i.uuid]=new Dn(t)}else{const t=await r(i.url);n[i.uuid]=new Dn(t)}}}return n}parseTextures(t,e){function n(t,e){return"number"===typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=e[s.image],a=o.data;let l;Array.isArray(a)?(l=new $r,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new mu:new kn,a&&(l.needsUpdate=!0)),l.source=o,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,zm)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Bm),l.wrapT=n(s.wrap[1],Bm)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,Fm)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,Fm)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(l.userData=s.userData),i[s.uuid]=l}return i}parseObject(t,e,n,i,r){let s,o,a;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(n[r])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}function h(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),i[t]}switch(t.type){case"Scene":s=new Bh,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new Ln(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new zh(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new kh(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new Yr(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Ja(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new Cm(t.color,t.intensity);break;case"DirectionalLight":s=new Em(t.color,t.intensity);break;case"PointLight":s=new Tm(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new Pm(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new bm(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new mm(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new Rm).fromJSON(t);break;case"SkinnedMesh":o=l(t.geometry),a=c(t.material),s=new du(o,a),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":o=l(t.geometry),a=c(t.material),s=new kr(o,a);break;case"InstancedMesh":o=l(t.geometry),a=c(t.material);const e=t.count,n=t.instanceMatrix,i=t.instanceColor;s=new Mu(o,a,e),s.instanceMatrix=new yu(new Float32Array(n.array),16),void 0!==i&&(s.instanceColor=new yu(new Float32Array(i.array),i.itemSize));break;case"LOD":s=new ou;break;case"Line":s=new Lu(l(t.geometry),c(t.material));break;case"LineLoop":s=new Ou(l(t.geometry),c(t.material));break;case"LineSegments":s=new Du(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":s=new Uu(l(t.geometry),c(t.material));break;case"Sprite":s=new nu(c(t.material));break;case"Group":s=new Ah;break;case"Bone":s=new pu;break;default:s=new Gi}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)s.add(this.parseObject(o[t],e,n,i,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];s.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}}const zm={UVMapping:it,CubeReflectionMapping:rt,CubeRefractionMapping:st,EquirectangularReflectionMapping:ot,EquirectangularRefractionMapping:at,CubeUVReflectionMapping:lt},Bm={RepeatWrapping:ct,ClampToEdgeWrapping:ht,MirroredRepeatWrapping:ut},Fm={NearestFilter:dt,NearestMipmapNearestFilter:pt,NearestMipmapLinearFilter:mt,LinearFilter:ft,LinearMipmapNearestFilter:gt,LinearMipmapLinearFilter:vt};class Um extends am{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=rm.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){rm.add(t,n),e&&e(n),r.manager.itemEnd(t)})).catch((function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}class Vm{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Hm(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Hm();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Hm(){return("undefined"===typeof performance?Date:performance).now()}class Wm{constructor(t,e,n){let i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let a=e,l=e+e;a!==l;++a)if(n[a]!==n[a+e]){o.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let r=n,s=i;r!==s;++r)e[r]=e[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)t[e+s]=t[n+s]}_slerp(t,e,n,i){Vn.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const s=this._workIndex*r;Vn.multiplyQuaternionsFlat(t,s,t,e,t,n),Vn.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,r){const s=1-i;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*s+t[n+o]*i}}_lerpAdditive(t,e,n,i,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[n+s]*i}}}const Gm="\\[\\]\\.:\\/",jm=new RegExp("["+Gm+"]","g"),qm="[^"+Gm+"]",Xm="[^"+Gm.replace("\\.","")+"]",Ym=/((?:WC+[\/:])*)/.source.replace("WC",qm),Zm=/(WCOD+)?/.source.replace("WCOD",Xm),Jm=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",qm),Km=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",qm),$m=new RegExp("^"+Ym+Zm+Jm+Km+"$"),Qm=["material","materials","bones","map"];class tf{constructor(t,e,n){const i=n||ef.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}class ef{constructor(t,e,n){this.path=e,this.parsedPath=n||ef.parseTrackName(e),this.node=ef.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new ef.Composite(t,e,n):new ef(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(jm,"")}static parseTrackName(t){const e=$m.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==Qm.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=ef.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ef.Composite=tf,ef.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ef.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ef.prototype.GetterByBindingType=[ef.prototype._getValue_direct,ef.prototype._getValue_array,ef.prototype._getValue_arrayElement,ef.prototype._getValue_toArray],ef.prototype.SetterByBindingTypeAndVersioning=[[ef.prototype._setValue_direct,ef.prototype._setValue_direct_setNeedsUpdate,ef.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ef.prototype._setValue_array,ef.prototype._setValue_array_setNeedsUpdate,ef.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ef.prototype._setValue_arrayElement,ef.prototype._setValue_arrayElement_setNeedsUpdate,ef.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ef.prototype._setValue_fromArray,ef.prototype._setValue_fromArray_setNeedsUpdate,ef.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class nf{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,o=new Array(s),a={endingStart:xe,endingEnd:xe};for(let l=0;l!==s;++l){const t=r[l].createInterpolant(null);o[l]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=me,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,s=n/i;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;i<0||0===n?e=0:(this._startTime=null,e=n*i)}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case Me:for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);break;case we:default:for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulate(i,o)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const s=n===fe;if(0===t)return-1===r?i:s&&1===(1&r)?e-i:i;if(n===pe){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1===(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=be,i.endingEnd=be):(i.endingStart=t?this.zeroSlopeAtStart?be:xe:_e,i.endingEnd=e?this.zeroSlopeAtEnd?be:xe:_e)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=n,this}}const rf=new Float32Array(1);class sf extends Fe{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let h=0;h!==r;++h){const t=i[h],r=t.name;let l=c[r];if(void 0!==l)++l.referenceCount,s[h]=l;else{if(l=s[h],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,r));continue}const i=e&&e._propertyBindings[h].binding.parsedPath;l=new Wm(ef.create(n,r,i),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,r),s[h]=l}o[h].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null;const h=o.actionByRoot,u=(t._localRoot||this._root).uuid;delete h[u],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const t=e[n];0===--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,o=s[i],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new jp(new Float32Array(2),new Float32Array(2),1,rf),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let s="string"===typeof t?em.findByName(i,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:we),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new nf(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"===typeof t?em.findByName(n,t):t,s=r?r.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let n=e-1;n>=0;--n)t[n].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==n;++l){const n=e[l];n._update(i,t,r,s)}const o=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)o[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const s in n){const t=n[s].actionByRoot,i=t[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName,r=i[e];if(void 0!==r)for(const s in r){const t=r[s];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class of{constructor(t,e,n=0,i=1/0){this.ray=new yi(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new Li,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,n=[]){return lf(t,this,n,e),n.sort(af),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)lf(t[i],this,n,e);return n.sort(af),n}}function af(t,e){return t.distance-e.distance}function lf(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)lf(i[t],e,n,!0)}}class cf{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(je(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const hf=new mn;class uf{constructor(t=new mn(1/0,1/0),e=new mn(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=hf.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){const e=hf.copy(t).clamp(this.min,this.max);return e.sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const df=new Hn,pf=new Hn;class mf{constructor(t=new Hn,e=new Hn){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){df.subVectors(t,this.start),pf.subVectors(this.end,this.start);const n=pf.dot(pf),i=pf.dot(df);let r=i/n;return e&&(r=je(r,0,1)),r}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const ff=new Hn;class gf extends Gi{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new yr,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,o=1,a=32;s<a;s++,o++){const t=s/a*Math.PI*2,e=o/a*Math.PI*2;i.push(Math.cos(t),Math.sin(t),1,Math.cos(e),Math.sin(e),1)}n.setAttribute("position",new hr(i,3));const r=new Su({fog:!1,toneMapped:!1});this.cone=new Du(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),ff.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ff),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const vf=new Hn,yf=new Hn,xf=new Hn;class bf extends Gi{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let i=new yr;i.setAttribute("position",new hr([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Su({fog:!1,toneMapped:!1});this.lightPlane=new Lu(i,r),this.add(this.lightPlane),i=new yr,i.setAttribute("position",new hr([0,0,0,0,0,1],3)),this.targetLine=new Lu(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){vf.setFromMatrixPosition(this.light.matrixWorld),yf.setFromMatrixPosition(this.light.target.matrixWorld),xf.subVectors(yf,vf),this.lightPlane.lookAt(yf),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(yf),this.targetLine.scale.z=xf.length()}}class _f{constructor(){this.type="ShapePath",this.color=new Ln,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new gd,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,s){return this.currentPath.bezierCurveTo(t,e,n,i,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new Pd;r.curves=i.curves,e.push(r)}return e}function n(t,e){const n=e.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=e[r],o=e[s],a=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],a=-a,o=e[r],l=-l),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return i}const i=lp.isClockWise,r=this.subPaths;if(0===r.length)return[];let s,o,a;const l=[];if(1===r.length)return o=r[0],a=new Pd,a.curves=o.curves,l.push(a),l;let c=!i(r[0].getPoints());c=t?!c:c;const h=[],u=[];let d,p,m=[],f=0;u[f]=void 0,m[f]=[];for(let g=0,v=r.length;g<v;g++)o=r[g],d=o.getPoints(),s=i(d),s=t?!s:s,s?(!c&&u[f]&&f++,u[f]={s:new Pd,p:d},u[f].s.curves=o.curves,c&&f++,m[f]=[]):m[f].push({h:o,p:d[0]});if(!u[0])return e(r);if(u.length>1){let t=!1,e=0;for(let n=0,i=u.length;n<i;n++)h[n]=[];for(let i=0,r=u.length;i<r;i++){const r=m[i];for(let s=0;s<r.length;s++){const o=r[s];let a=!0;for(let r=0;r<u.length;r++)n(o.p,u[r].p)&&(i!==r&&e++,a?(a=!1,h[r].push(o)):t=!0);a&&h[i].push(o)}}e>0&&!1===t&&(m=h)}for(let g=0,v=u.length;g<v;g++){a=u[g].s,l.push(a),p=m[g];for(let t=0,e=p.length;t<e;t++)a.holes.push(p[t].h)}return l}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:o}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=o);class wf{constructor(t){this.top=0,this.array=new Float32Array(t)}write(t){this.array[this.top++]=t.x,this.array[this.top++]=t.y,this.array[this.top++]=t.z}}class Mf{constructor(t){this.top=0,this.array=new Float32Array(t)}write(t){this.array[this.top++]=t.x,this.array[this.top++]=t.y}}class Sf{constructor(t){this.plane=null,this.front=null,this.back=null,this.polygons=[],t&&this.build(t)}clone(){const t=new Sf;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map((t=>t.clone())),t}invert(){for(let e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const t=this.front;this.front=this.back,this.back=t}clipPolygons(t){if(!this.plane)return t.slice();let e=new Array,n=new Array;for(let i=0;i<t.length;i++)this.plane.splitPolygon(t[i],e,n,e,n);return this.front&&(e=this.front.clipPolygons(e)),n=this.back?this.back.clipPolygons(n):[],e.concat(n)}clipTo(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)}allPolygons(){let t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t}build(t){if(!t.length)return;this.plane||(this.plane=t[0].plane.clone());const e=[],n=[];for(let i=0;i<t.length;i++)this.plane.splitPolygon(t[i],this.polygons,this.polygons,e,n);e.length&&(this.front||(this.front=new Sf),this.front.build(e)),n.length&&(this.back||(this.back=new Sf),this.back.build(n))}}class Tf{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new Tf(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}times(t){return this.x*=t,this.y*=t,this.z*=t,this}dividedBy(t){return this.x/=t,this.y/=t,this.z/=t,this}lerp(t,e){return this.add((new Tf).copy(t).sub(this).times(e))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(t){const e=this.clone(),n=e.x,i=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}toVector3(){return new Hn(this.x,this.y,this.z)}}class Af{constructor(t,e){this.normal=t,this.w=e,this.normal=t,this.w=e}clone(){return new Af(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(t,e,n,i,r){const s=0,o=1,a=2,l=3;let c=0;const h=[];for(let u=0;u<t.vertices.length;u++){const e=this.normal.dot(t.vertices[u].pos)-this.w,n=e<-Af.EPSILON?a:e>Af.EPSILON?o:s;c|=n,h.push(n)}switch(c){case s:(this.normal.dot(t.plane.normal)>0?e:n).push(t);break;case o:i.push(t);break;case a:r.push(t);break;case l:{const e=[],n=[];for(let i=0;i<t.vertices.length;i++){const r=(i+1)%t.vertices.length,s=h[i],c=h[r],u=t.vertices[i],d=t.vertices[r];if(s!=a&&e.push(u),s!=o&&n.push(s!=a?u.clone():u),(s|c)==l){const t=(this.w-this.normal.dot(u.pos))/this.normal.dot((new Tf).copy(d.pos).sub(u.pos)),i=u.interpolate(d,t);e.push(i),n.push(i.clone())}}e.length>=3&&i.push(new Ef(e,t.shared)),n.length>=3&&r.push(new Ef(n,t.shared));break}}}static fromPoints(t,e,n){const i=(new Tf).copy(e).sub(t).cross((new Tf).copy(n).sub(t)).normalize();return new Af(i.clone(),i.dot(t))}}Af.EPSILON=1e-5;class Ef{constructor(t,e){this.vertices=t,this.shared=e,this.plane=Af.fromPoints(t[0].pos,t[1].pos,t[2].pos)}clone(){return new Ef(this.vertices.map((t=>t.clone())),this.shared)}flip(){this.vertices.reverse().map((t=>t.flip())),this.plane.flip()}}class Cf{constructor(t,e,n,i){this.pos=(new Tf).copy(t),this.normal=(new Tf).copy(e),this.uv=(new Tf).copy(n),this.uv.z=0,i&&(this.color=(new Tf).copy(i))}clone(){return new Cf(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(t,e){return new Cf(this.pos.clone().lerp(t.pos,e),this.normal.clone().lerp(t.normal,e),this.uv.clone().lerp(t.uv,e),this.color&&t.color&&this.color.clone().lerp(t.color,e))}}class Pf{constructor(){this.polygons=new Array}static fromPolygons(t){const e=new Pf;return e.polygons=t,e}static fromGeometry(t,e){let n=[];const i=t.attributes.position,r=t.attributes.normal,s=t.attributes.uv,o=t.attributes.color,a=t.groups;let l;if(t.index)l=t.index.array;else{l=new Array(i.array.length/i.itemSize|0);for(let t=0;t<l.length;t++)l[t]=t}const c=l.length/3|0;n=new Array(c);for(let h=0,u=0,d=l.length;h<d;h+=3,u++){const t=new Array(3);for(let e=0;e<3;e++){const n=l[h+e],a=3*n,c=2*n,u=i.array[a],d=i.array[a+1],p=i.array[a+2],m=r.array[a],f=r.array[a+1],g=r.array[a+2],v=null===s||void 0===s?void 0:s.array[c],y=null===s||void 0===s?void 0:s.array[c+1];t[e]=new Cf(new Tf(u,d,p),new Tf(m,f,g),new Tf(v,y,0),o&&new Tf(o.array[c],o.array[c+1],o.array[c+2]))}if(void 0===e&&a&&a.length>0)for(const e of a)h>=e.start&&h<e.start+e.count&&(n[u]=new Ef(t,e.materialIndex));else n[u]=new Ef(t,e)}return Pf.fromPolygons(n.filter((t=>!isNaN(t.plane.normal.x))))}static toGeometry(t,e){let n=0;const i=t.polygons;for(const d of i)n+=d.vertices.length-2;const r=new yr,s=new wf(3*n*3),o=new wf(3*n*3),a=new Mf(2*n*3);let l;const c=[],h=[];for(const d of i){const t=d.vertices,e=t.length;void 0!==d.shared&&(c[d.shared]||(c[d.shared]=[])),e&&void 0!==t[0].color&&(l||(l=new wf(3*n*3)));for(let n=3;n<=e;n++){const e=void 0===d.shared?h:c[d.shared];e.push(s.top/3,s.top/3+1,s.top/3+2),s.write(t[0].pos),s.write(t[n-2].pos),s.write(t[n-1].pos),o.write(t[0].normal),o.write(t[n-2].normal),o.write(t[n-1].normal),a&&(a.write(t[0].uv),a.write(t[n-2].uv),a.write(t[n-1].uv)),l&&(l.write(t[0].color),l.write(t[n-2].color),l.write(t[n-1].color))}}r.setAttribute("position",new ar(s.array,3)),r.setAttribute("normal",new ar(o.array,3)),a&&r.setAttribute("uv",new ar(a.array,2)),l&&r.setAttribute("color",new ar(l.array,3));for(let d=0;d<c.length;d++)void 0===c[d]&&(c[d]=[]);if(c.length){let t=[],e=0;for(let n=0;n<c.length;n++)r.addGroup(e,c[n].length,n),e+=c[n].length,t=t.concat(c[n]);r.addGroup(e,h.length,c.length),t=t.concat(h),r.setIndex(t)}const u=(new xi).copy(e).invert();return r.applyMatrix4(u),r.computeBoundingSphere(),r.computeBoundingBox(),r}static fromMesh(t,e){const n=Pf.fromGeometry(t.geometry,e),i=new Hn,r=new fn;r.getNormalMatrix(t.matrix);for(let s=0;s<n.polygons.length;s++){const e=n.polygons[s];for(let n=0;n<e.vertices.length;n++){const s=e.vertices[n];s.pos.copy(i.copy(s.pos.toVector3()).applyMatrix4(t.matrix)),s.normal.copy(i.copy(s.normal.toVector3()).applyMatrix3(r))}}return n}static toMesh(t,e,n){const i=Pf.toGeometry(t,e),r=new kr(i,n);return r.matrix.copy(e),r.matrix.decompose(r.position,r.quaternion,r.scale),r.rotation.setFromQuaternion(r.quaternion),r.updateMatrixWorld(),r.castShadow=r.receiveShadow=!0,r}static union(t,e){const n=Pf.fromMesh(t),i=Pf.fromMesh(e);return Pf.toMesh(n.union(i),t.matrix,t.material)}static subtract(t,e){const n=Pf.fromMesh(t),i=Pf.fromMesh(e);return Pf.toMesh(n.subtract(i),t.matrix,t.material)}static intersect(t,e){const n=Pf.fromMesh(t),i=Pf.fromMesh(e);return Pf.toMesh(n.intersect(i),t.matrix,t.material)}clone(){const t=new Pf;return t.polygons=this.polygons.map((t=>t.clone())).filter((t=>Number.isFinite(t.plane.w))),t}toPolygons(){return this.polygons}union(t){const e=new Sf(this.clone().polygons),n=new Sf(t.clone().polygons);return e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),Pf.fromPolygons(e.allPolygons())}subtract(t){const e=new Sf(this.clone().polygons),n=new Sf(t.clone().polygons);return e.invert(),e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),e.invert(),Pf.fromPolygons(e.allPolygons())}intersect(t){const e=new Sf(this.clone().polygons),n=new Sf(t.clone().polygons);return e.invert(),n.clipTo(e),n.invert(),e.clipTo(n),n.clipTo(e),e.build(n.allPolygons()),e.invert(),Pf.fromPolygons(e.allPolygons())}inverse(){const t=this.clone();for(const e of t.polygons)e.flip();return t}toMesh(t,e){return Pf.toMesh(this,t,e)}toGeometry(t){return Pf.toGeometry(this,t)}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2022 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Lf{static union(t,e){const n=this.doCSG(t,e,"union");return n}static subtract(t,e){const n=this.doCSG(t,e,"subtract");return n}static intersect(t,e){const n=this.doCSG(t,e,"intersect");return n}static doCSG(t,e,n){return t.updateMatrix(),e.updateMatrix(),"union"===n?Pf.union(t,e):"subtract"===n?Pf.subtract(t,e):"intersect"===n?Pf.intersect(t,e):void 0}}
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/
var Rf={},If=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Df=function(t){return new Worker(t)};try{URL.revokeObjectURL(If(""))}catch(Y_){If=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)},Df=function(t){return new Worker(t,{type:"module"})}}var Of=function(t,e,n,i,r){var s=Df(Rf[e]||(Rf[e]=If(t)));return s.onerror=function(t){return r(t.error,null)},s.onmessage=function(t){return r(null,t.data)},s.postMessage(n,i),s},Nf=Uint8Array,kf=Uint16Array,zf=Uint32Array,Bf=new Nf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ff=new Nf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Uf=new Nf([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vf=function(t,e){for(var n=new kf(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];var r=new zf(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},Hf=Vf(Bf,2),Wf=Hf[0],Gf=Hf[1];Wf[28]=258,Gf[258]=28;for(var jf=Vf(Ff,0),qf=jf[0],Xf=jf[1],Yf=new kf(32768),Zf=0;Zf<32768;++Zf){var Jf=(43690&Zf)>>>1|(21845&Zf)<<1;Jf=(52428&Jf)>>>2|(13107&Jf)<<2,Jf=(61680&Jf)>>>4|(3855&Jf)<<4,Yf[Zf]=((65280&Jf)>>>8|(255&Jf)<<8)>>>1}var Kf=function(t,e,n){for(var i=t.length,r=0,s=new kf(e);r<i;++r)++s[t[r]-1];var o,a=new kf(e);for(r=0;r<e;++r)a[r]=a[r-1]+s[r-1]<<1;if(n){o=new kf(1<<e);var l=15-e;for(r=0;r<i;++r)if(t[r])for(var c=r<<4|t[r],h=e-t[r],u=a[t[r]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)o[Yf[u]>>>l]=c}else for(o=new kf(i),r=0;r<i;++r)t[r]&&(o[r]=Yf[a[t[r]-1]++]>>>15-t[r]);return o},$f=new Nf(288);for(Zf=0;Zf<144;++Zf)$f[Zf]=8;for(Zf=144;Zf<256;++Zf)$f[Zf]=9;for(Zf=256;Zf<280;++Zf)$f[Zf]=7;for(Zf=280;Zf<288;++Zf)$f[Zf]=8;var Qf=new Nf(32);for(Zf=0;Zf<32;++Zf)Qf[Zf]=5;var tg=Kf($f,9,0),eg=Kf($f,9,1),ng=Kf(Qf,5,0),ig=Kf(Qf,5,1),rg=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},sg=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&n},og=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},ag=function(t){return(t/8|0)+(7&t&&1)},lg=function(t,e,n){(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length);var i=new(t instanceof kf?kf:t instanceof zf?zf:Nf)(n-e);return i.set(t.subarray(e,n)),i},cg=function(t,e,n){var i=t.length;if(!i||n&&!n.l&&i<5)return e||new Nf(0);var r=!e||n,s=!n||n.i;n||(n={}),e||(e=new Nf(3*i));var o=function(t){var n=e.length;if(t>n){var i=new Nf(Math.max(2*n,t));i.set(e),e=i}},a=n.f||0,l=n.p||0,c=n.b||0,h=n.l,u=n.d,d=n.m,p=n.n,m=8*i;do{if(!h){n.f=a=sg(t,l,1);var f=sg(t,l+1,3);if(l+=3,!f){var g=ag(l)+4,v=t[g-4]|t[g-3]<<8,y=g+v;if(y>i){if(s)throw"unexpected EOF";break}r&&o(c+v),e.set(t.subarray(g,y),c),n.b=c+=v,n.p=l=8*y;continue}if(1==f)h=eg,u=ig,d=9,p=5;else{if(2!=f)throw"invalid block type";var x=sg(t,l,31)+257,b=sg(t,l+10,15)+4,_=x+sg(t,l+5,31)+1;l+=14;for(var w=new Nf(_),M=new Nf(19),S=0;S<b;++S)M[Uf[S]]=sg(t,l+3*S,7);l+=3*b;var T=rg(M),A=(1<<T)-1,E=Kf(M,T,1);for(S=0;S<_;){var C=E[sg(t,l,A)];l+=15&C;g=C>>>4;if(g<16)w[S++]=g;else{var P=0,L=0;16==g?(L=3+sg(t,l,3),l+=2,P=w[S-1]):17==g?(L=3+sg(t,l,7),l+=3):18==g&&(L=11+sg(t,l,127),l+=7);while(L--)w[S++]=P}}var R=w.subarray(0,x),I=w.subarray(x);d=rg(R),p=rg(I),h=Kf(R,d,1),u=Kf(I,p,1)}if(l>m){if(s)throw"unexpected EOF";break}}r&&o(c+131072);for(var D=(1<<d)-1,O=(1<<p)-1,N=l;;N=l){P=h[og(t,l)&D];var k=P>>>4;if(l+=15&P,l>m){if(s)throw"unexpected EOF";break}if(!P)throw"invalid length/literal";if(k<256)e[c++]=k;else{if(256==k){N=l,h=null;break}var z=k-254;if(k>264){S=k-257;var B=Bf[S];z=sg(t,l,(1<<B)-1)+Wf[S],l+=B}var F=u[og(t,l)&O],U=F>>>4;if(!F)throw"invalid distance";l+=15&F;I=qf[U];if(U>3){B=Ff[U];I+=og(t,l)&(1<<B)-1,l+=B}if(l>m){if(s)throw"unexpected EOF";break}r&&o(c+131072);for(var V=c+z;c<V;c+=4)e[c]=e[c-I],e[c+1]=e[c+1-I],e[c+2]=e[c+2-I],e[c+3]=e[c+3-I];c=V}}n.l=h,n.p=N,n.b=c,h&&(a=1,n.m=d,n.d=u,n.n=p)}while(!a);return c==e.length?e:lg(e,0,c)},hg=function(t,e,n){n<<=7&e;var i=e/8|0;t[i]|=n,t[i+1]|=n>>>8},ug=function(t,e,n){n<<=7&e;var i=e/8|0;t[i]|=n,t[i+1]|=n>>>8,t[i+2]|=n>>>16},dg=function(t,e){for(var n=[],i=0;i<t.length;++i)t[i]&&n.push({s:i,f:t[i]});var r=n.length,s=n.slice();if(!r)return[xg,0];if(1==r){var o=new Nf(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(t,e){return t.f-e.f})),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,h=1,u=2;n[0]={s:-1,f:a.f+l.f,l:a,r:l};while(h!=r-1)a=n[n[c].f<n[u].f?c++:u++],l=n[c!=h&&n[c].f<n[u].f?c++:u++],n[h++]={s:-1,f:a.f+l.f,l:a,r:l};var d=s[0].s;for(i=1;i<r;++i)s[i].s>d&&(d=s[i].s);var p=new kf(d+1),m=pg(n[h-1],p,0);if(m>e){i=0;var f=0,g=m-e,v=1<<g;for(s.sort((function(t,e){return p[e.s]-p[t.s]||t.f-e.f}));i<r;++i){var y=s[i].s;if(!(p[y]>e))break;f+=v-(1<<m-p[y]),p[y]=e}f>>>=g;while(f>0){var x=s[i].s;p[x]<e?f-=1<<e-p[x]++-1:++i}for(;i>=0&&f;--i){var b=s[i].s;p[b]==e&&(--p[b],++f)}m=e}return[new Nf(p),m]},pg=function(t,e,n){return-1==t.s?Math.max(pg(t.l,e,n+1),pg(t.r,e,n+1)):e[t.s]=n},mg=function(t){var e=t.length;while(e&&!t[--e]);for(var n=new kf(++e),i=0,r=t[0],s=1,o=function(t){n[i++]=t},a=1;a<=e;++a)if(t[a]==r&&a!=e)++s;else{if(!r&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(r),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}while(s--)o(r);s=1,r=t[a]}return[n.subarray(0,i),e]},fg=function(t,e){for(var n=0,i=0;i<e.length;++i)n+=t[i]*e[i];return n},gg=function(t,e,n){var i=n.length,r=ag(e+2);t[r]=255&i,t[r+1]=i>>>8,t[r+2]=255^t[r],t[r+3]=255^t[r+1];for(var s=0;s<i;++s)t[r+s+4]=n[s];return 8*(r+4+i)},vg=function(t,e,n,i,r,s,o,a,l,c,h){hg(e,h++,n),++r[256];for(var u=dg(r,15),d=u[0],p=u[1],m=dg(s,15),f=m[0],g=m[1],v=mg(d),y=v[0],x=v[1],b=mg(f),_=b[0],w=b[1],M=new kf(19),S=0;S<y.length;++S)M[31&y[S]]++;for(S=0;S<_.length;++S)M[31&_[S]]++;for(var T=dg(M,7),A=T[0],E=T[1],C=19;C>4&&!A[Uf[C-1]];--C);var P,L,R,I,D=c+5<<3,O=fg(r,$f)+fg(s,Qf)+o,N=fg(r,d)+fg(s,f)+o+14+3*C+fg(M,A)+(2*M[16]+3*M[17]+7*M[18]);if(D<=O&&D<=N)return gg(e,h,t.subarray(l,l+c));if(hg(e,h,1+(N<O)),h+=2,N<O){P=Kf(d,p,0),L=d,R=Kf(f,g,0),I=f;var k=Kf(A,E,0);hg(e,h,x-257),hg(e,h+5,w-1),hg(e,h+10,C-4),h+=14;for(S=0;S<C;++S)hg(e,h+3*S,A[Uf[S]]);h+=3*C;for(var z=[y,_],B=0;B<2;++B){var F=z[B];for(S=0;S<F.length;++S){var U=31&F[S];hg(e,h,k[U]),h+=A[U],U>15&&(hg(e,h,F[S]>>>5&127),h+=F[S]>>>12)}}}else P=tg,L=$f,R=ng,I=Qf;for(S=0;S<a;++S)if(i[S]>255){U=i[S]>>>18&31;ug(e,h,P[U+257]),h+=L[U+257],U>7&&(hg(e,h,i[S]>>>23&31),h+=Bf[U]);var V=31&i[S];ug(e,h,R[V]),h+=I[V],V>3&&(ug(e,h,i[S]>>>5&8191),h+=Ff[V])}else ug(e,h,P[i[S]]),h+=L[i[S]];return ug(e,h,P[256]),h+L[256]},yg=new zf([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),xg=new Nf(0),bg=function(t,e,n,i,r,s){var o=t.length,a=new Nf(i+o+5*(1+Math.ceil(o/7e3))+r),l=a.subarray(i,a.length-r),c=0;if(!e||o<8)for(var h=0;h<=o;h+=65535){var u=h+65535;u<o?c=gg(l,c,t.subarray(h,u)):(l[h]=s,c=gg(l,c,t.subarray(h,o)))}else{for(var d=yg[e-1],p=d>>>13,m=8191&d,f=(1<<n)-1,g=new kf(32768),v=new kf(f+1),y=Math.ceil(n/3),x=2*y,b=function(e){return(t[e]^t[e+1]<<y^t[e+2]<<x)&f},_=new zf(25e3),w=new kf(288),M=new kf(32),S=0,T=0,A=(h=0,0),E=0,C=0;h<o;++h){var P=b(h),L=32767&h,R=v[P];if(g[L]=R,v[P]=L,E<=h){var I=o-h;if((S>7e3||A>24576)&&I>423){c=vg(t,l,0,_,w,M,T,A,C,h-C,c),A=S=T=0,C=h;for(var D=0;D<286;++D)w[D]=0;for(D=0;D<30;++D)M[D]=0}var O=2,N=0,k=m,z=L-R&32767;if(I>2&&P==b(h-z)){var B=Math.min(p,I)-1,F=Math.min(32767,h),U=Math.min(258,I);while(z<=F&&--k&&L!=R){if(t[h+O]==t[h+O-z]){for(var V=0;V<U&&t[h+V]==t[h+V-z];++V);if(V>O){if(O=V,N=z,V>B)break;var H=Math.min(z,V-2),W=0;for(D=0;D<H;++D){var G=h-z+D+32768&32767,j=g[G],q=G-j+32768&32767;q>W&&(W=q,R=G)}}}L=R,R=g[L],z+=L-R+32768&32767}}if(N){_[A++]=268435456|Gf[O]<<18|Xf[N];var X=31&Gf[O],Y=31&Xf[N];T+=Bf[X]+Ff[Y],++w[257+X],++M[Y],E=h+O,++S}else _[A++]=t[h],++w[t[h]]}}c=vg(t,l,s,_,w,M,T,A,C,h-C,c),!s&&7&c&&(c=gg(l,c+1,xg))}return lg(a,0,i+ag(c)+r)},_g=function(){for(var t=new zf(256),e=0;e<256;++e){var n=e,i=9;while(--i)n=(1&n&&3988292384)^n>>>1;t[e]=n}return t}(),wg=function(){var t=-1;return{p:function(e){for(var n=t,i=0;i<e.length;++i)n=_g[255&n^e[i]]^n>>>8;t=n},d:function(){return~t}}},Mg=function(){var t=1,e=0;return{p:function(n){for(var i=t,r=e,s=n.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)r+=i+=n[o];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}t=i,e=r},d:function(){return t%=65521,e%=65521,(255&t)<<24|t>>>8<<16|(255&e)<<8|e>>>8}}},Sg=function(t,e,n,i,r){return bg(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,i,!r)},Tg=function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n},Ag=function(t,e,n){for(var i=t(),r=t.toString(),s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=s[o];if("function"==typeof a){e+=";"+l+"=";var c=a.toString();if(a.prototype)if(-1!=c.indexOf("[native code]")){var h=c.indexOf(" ",8)+1;e+=c.slice(h,c.indexOf("(",h))}else for(var u in e+=c,a.prototype)e+=";"+l+".prototype."+u+"="+a.prototype[u].toString();else e+=c}else n[l]=a}return[e,n]},Eg=[],Cg=function(t){var e=[];for(var n in t)(t[n]instanceof Nf||t[n]instanceof kf||t[n]instanceof zf)&&e.push((t[n]=new t[n].constructor(t[n])).buffer);return e},Pg=function(t,e,n,i){var r;if(!Eg[n]){for(var s="",o={},a=t.length-1,l=0;l<a;++l)r=Ag(t[l],s,o),s=r[0],o=r[1];Eg[n]=Ag(t[a],s,o)}var c=Tg({},Eg[n][1]);return Of(Eg[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",n,c,Cg(c),i)},Lg=function(){return[Nf,kf,zf,Bf,Ff,Uf,Wf,qf,eg,ig,Yf,Kf,rg,sg,og,ag,lg,cg,sv,kg,zg]},Rg=function(){return[Nf,kf,zf,Bf,Ff,Uf,Gf,Xf,tg,$f,ng,Qf,Yf,yg,xg,Kf,hg,ug,dg,pg,mg,fg,gg,vg,ag,lg,bg,Sg,ev,kg]},Ig=function(){return[jg,Yg,Gg,wg,_g]},Dg=function(){return[qg,Xg]},Og=function(){return[Zg,Gg,Mg]},Ng=function(){return[Jg]},kg=function(t){return postMessage(t,[t.buffer])},zg=function(t){return t&&t.size&&new Nf(t.size)},Bg=function(t,e,n,i,r,s){var o=Pg(n,i,r,(function(t,e){o.terminate(),s(t,e)}));return o.postMessage([t,e],e.consume?[t.buffer]:[]),function(){o.terminate()}},Fg=function(t){return t.ondata=function(t,e){return postMessage([t,e],[t.buffer])},function(e){return t.push(e.data[0],e.data[1])}},Ug=function(t,e,n,i,r){var s,o=Pg(t,i,r,(function(t,n){t?(o.terminate(),e.ondata.call(e,t)):(n[1]&&o.terminate(),e.ondata.call(e,t,n[0],n[1]))}));o.postMessage(n),e.push=function(t,n){if(s)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([t,s=n],[t.buffer])},e.terminate=function(){o.terminate()}},Vg=function(t,e){return t[e]|t[e+1]<<8},Hg=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},Wg=function(t,e){return Hg(t,e)+4294967296*Hg(t,e+4)},Gg=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},jg=function(t,e){var n=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&Gg(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),n){t[3]=8;for(var i=0;i<=n.length;++i)t[i+10]=n.charCodeAt(i)}},qg=function(t){if(31!=t[0]||139!=t[1]||8!=t[2])throw"invalid gzip data";var e=t[3],n=10;4&e&&(n+=t[10]|2+(t[11]<<8));for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[n++]);return n+(2&e)},Xg=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},Yg=function(t){return 10+(t.filename&&t.filename.length+1||0)},Zg=function(t,e){var n=e.level,i=0==n?0:n<6?1:9==n?3:2;t[0]=120,t[1]=i<<6|(i?32-2*i:1)},Jg=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function Kg(t,e){return e||"function"!=typeof t||(e=t,t={}),this.ondata=e,t}var $g=function(){function t(t,e){e||"function"!=typeof t||(e=t,t={}),this.ondata=e,this.o=t||{}}return t.prototype.p=function(t,e){this.ondata(Sg(t,this.o,0,0,!e),e)},t.prototype.push=function(t,e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=e,this.p(t,e||!1)},t}(),Qg=function(){function t(t,e){Ug([Rg,function(){return[Fg,$g]}],this,Kg.call(this,t,e),(function(t){var e=new $g(t.data);onmessage=Fg(e)}),6)}return t}();function tv(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Bg(t,e,[Rg],(function(t){return kg(ev(t.data[0],t.data[1]))}),0,n)}function ev(t,e){return Sg(t,e||{},0,0)}var nv=function(){function t(t){this.s={},this.p=new Nf(0),this.ondata=t}return t.prototype.e=function(t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var e=this.p.length,n=new Nf(e+t.length);n.set(this.p),n.set(t,e),this.p=n},t.prototype.c=function(t){this.d=this.s.i=t||!1;var e=this.s.b,n=cg(this.p,this.o,this.s);this.ondata(lg(n,e,this.s.b),this.d),this.o=lg(n,this.s.b-32768),this.s.b=this.o.length,this.p=lg(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(t,e){this.e(t),this.c(e)},t}(),iv=function(){function t(t){this.ondata=t,Ug([Lg,function(){return[Fg,nv]}],this,0,(function(){var t=new nv;onmessage=Fg(t)}),7)}return t}();function rv(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Bg(t,e,[Lg],(function(t){return kg(sv(t.data[0],zg(t.data[1])))}),1,n)}function sv(t,e){return cg(t,e)}var ov=function(){function t(t,e){this.c=wg(),this.l=0,this.v=1,$g.call(this,t,e)}return t.prototype.push=function(t,e){$g.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t),this.l+=t.length;var n=Sg(t,this.o,this.v&&Yg(this.o),e&&8,!e);this.v&&(jg(n,this.o),this.v=0),e&&(Gg(n,n.length-8,this.c.d()),Gg(n,n.length-4,this.l)),this.ondata(n,e)},t}(),av=function(){function t(t,e){Ug([Rg,Ig,function(){return[Fg,$g,ov]}],this,Kg.call(this,t,e),(function(t){var e=new ov(t.data);onmessage=Fg(e)}),8)}return t}();function lv(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Bg(t,e,[Rg,Ig,function(){return[cv]}],(function(t){return kg(cv(t.data[0],t.data[1]))}),2,n)}function cv(t,e){e||(e={});var n=wg(),i=t.length;n.p(t);var r=Sg(t,e,Yg(e),8),s=r.length;return jg(r,e),Gg(r,s-8,n.d()),Gg(r,s-4,i),r}var hv=function(){function t(t){this.v=1,nv.call(this,t)}return t.prototype.push=function(t,e){if(nv.prototype.e.call(this,t),this.v){var n=this.p.length>3?qg(this.p):4;if(n>=this.p.length&&!e)return;this.p=this.p.subarray(n),this.v=0}if(e){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}nv.prototype.c.call(this,e)},t}(),uv=function(){function t(t){this.ondata=t,Ug([Lg,Dg,function(){return[Fg,nv,hv]}],this,0,(function(){var t=new hv;onmessage=Fg(t)}),9)}return t}();function dv(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Bg(t,e,[Lg,Dg,function(){return[pv]}],(function(t){return kg(pv(t.data[0]))}),3,n)}function pv(t,e){return cg(t.subarray(qg(t),-8),e||new Nf(Xg(t)))}var mv=function(){function t(t,e){this.c=Mg(),this.v=1,$g.call(this,t,e)}return t.prototype.push=function(t,e){$g.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t);var n=Sg(t,this.o,this.v&&2,e&&4,!e);this.v&&(Zg(n,this.o),this.v=0),e&&Gg(n,n.length-4,this.c.d()),this.ondata(n,e)},t}(),fv=function(){function t(t,e){Ug([Rg,Og,function(){return[Fg,$g,mv]}],this,Kg.call(this,t,e),(function(t){var e=new mv(t.data);onmessage=Fg(e)}),10)}return t}();function gv(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Bg(t,e,[Rg,Og,function(){return[vv]}],(function(t){return kg(vv(t.data[0],t.data[1]))}),4,n)}function vv(t,e){e||(e={});var n=Mg();n.p(t);var i=Sg(t,e,2,4);return Zg(i,e),Gg(i,i.length-4,n.d()),i}var yv=function(){function t(t){this.v=1,nv.call(this,t)}return t.prototype.push=function(t,e){if(nv.prototype.e.call(this,t),this.v){if(this.p.length<2&&!e)return;this.p=this.p.subarray(2),this.v=0}if(e){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}nv.prototype.c.call(this,e)},t}(),xv=function(){function t(t){this.ondata=t,Ug([Lg,Ng,function(){return[Fg,nv,yv]}],this,0,(function(){var t=new yv;onmessage=Fg(t)}),11)}return t}();function bv(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Bg(t,e,[Lg,Ng,function(){return[_v]}],(function(t){return kg(_v(t.data[0],zg(t.data[1])))}),5,n)}function _v(t,e){return cg((Jg(t),t.subarray(2,-4)),e)}var wv=function(){function t(t){this.G=hv,this.I=nv,this.Z=yv,this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(t,e);else{if(this.p&&this.p.length){var n=new Nf(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(r):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,e),this.p=null}}},t}(),Mv=function(){function t(t){this.G=uv,this.I=iv,this.Z=xv,this.ondata=t}return t.prototype.push=function(t,e){wv.prototype.push.call(this,t,e)},t}();function Sv(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return 31==t[0]&&139==t[1]&&8==t[2]?dv(t,e,n):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?rv(t,e,n):bv(t,e,n)}function Tv(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?pv(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?sv(t,e):_v(t,e)}var Av=function(t,e,n,i){for(var r in t){var s=t[r],o=e+r;s instanceof Nf?n[o]=[s,i]:Array.isArray(s)?n[o]=[s[0],Tg(i,s[1])]:Av(s,o+"/",n,i)}},Ev="undefined"!=typeof TextEncoder&&new TextEncoder,Cv="undefined"!=typeof TextDecoder&&new TextDecoder,Pv=0;try{Cv.decode(xg,{stream:!0}),Pv=1}catch(Y_){}var Lv=function(t){for(var e="",n=0;;){var i=t[n++],r=(i>127)+(i>223)+(i>239);if(n+r>t.length)return[e,lg(t,n-1)];r?3==r?(i=((15&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,e+=String.fromCharCode(55296|i>>10,56320|1023&i)):e+=1&r?String.fromCharCode((31&i)<<6|63&t[n++]):String.fromCharCode((15&i)<<12|(63&t[n++])<<6|63&t[n++]):e+=String.fromCharCode(i)}},Rv=function(){function t(t){this.ondata=t,Pv?this.t=new TextDecoder:this.p=xg}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(e=!!e,this.t){if(this.ondata(this.t.decode(t,{stream:!0}),e),e){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new Nf(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length);var i=Lv(n),r=i[0],s=i[1];if(e){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(r,e)}},t}(),Iv=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Dv(t),this.d=e||!1)},t}();function Dv(t,e){if(e){for(var n=new Nf(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}if(Ev)return Ev.encode(t);var r=t.length,s=new Nf(t.length+(t.length>>1)),o=0,a=function(t){s[o++]=t};for(i=0;i<r;++i){if(o+5>s.length){var l=new Nf(o+8+(r-i<<1));l.set(s),s=l}var c=t.charCodeAt(i);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|63&c)):c>55295&&c<57344?(c=65536+(1047552&c)|1023&t.charCodeAt(++i),a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|63&c)):(a(224|c>>12),a(128|c>>6&63),a(128|63&c))}return lg(s,0,o)}function Ov(t,e){if(e){for(var n="",i=0;i<t.length;i+=16384)n+=String.fromCharCode.apply(null,t.subarray(i,i+16384));return n}if(Cv)return Cv.decode(t);var r=Lv(t),s=r[0],o=r[1];if(o.length)throw"invalid utf-8 data";return s}var Nv=function(t){return 1==t?3:t<6?2:9==t?1:0},kv=function(t,e){return e+30+Vg(t,e+26)+Vg(t,e+28)},zv=function(t,e,n){var i=Vg(t,e+28),r=Ov(t.subarray(e+46,e+46+i),!(2048&Vg(t,e+8))),s=e+46+i,o=Hg(t,e+20),a=n&&4294967295==o?Bv(t,s):[o,Hg(t,e+24),Hg(t,e+42)],l=a[0],c=a[1],h=a[2];return[Vg(t,e+10),l,c,r,s+Vg(t,e+30)+Vg(t,e+32),h]},Bv=function(t,e){for(;1!=Vg(t,e);e+=4+Vg(t,e+2));return[Wg(t,e+12),Wg(t,e+4),Wg(t,e+20)]},Fv=function(t){var e=0;if(t)for(var n in t){var i=t[n].length;if(i>65535)throw"extra field too long";e+=i+4}return e},Uv=function(t,e,n,i,r,s,o,a){var l=i.length,c=n.extra,h=a&&a.length,u=Fv(c);Gg(t,e,null!=o?33639248:67324752),e+=4,null!=o&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(null==s&&8),t[e++]=r&&8,t[e++]=255&n.compression,t[e++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),p=d.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(Gg(t,e,p<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),e+=4,null!=s&&(Gg(t,e,n.crc),Gg(t,e+4,s),Gg(t,e+8,n.size)),Gg(t,e+12,l),Gg(t,e+14,u),e+=16,null!=o&&(Gg(t,e,h),Gg(t,e+6,n.attrs),Gg(t,e+10,o),e+=14),t.set(i,e),e+=l,u)for(var m in c){var f=c[m],g=f.length;Gg(t,e,+m),Gg(t,e+2,g),t.set(f,e+4),e+=4+g}return h&&(t.set(a,e),e+=h),e},Vv=function(t,e,n,i,r){Gg(t,e,101010256),Gg(t,e+8,n),Gg(t,e+10,n),Gg(t,e+12,i),Gg(t,e+16,r)},Hv=function(){function t(t){this.filename=t,this.c=wg(),this.size=0,this.compression=0}return t.prototype.process=function(t,e){this.ondata(null,t,e)},t.prototype.push=function(t,e){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},t}(),Wv=function(){function t(t,e){var n=this;e||(e={}),Hv.call(this,t),this.d=new $g(e,(function(t,e){n.ondata(null,t,e)})),this.compression=8,this.flag=Nv(e.level)}return t.prototype.process=function(t,e){try{this.d.push(t,e)}catch(Y_){this.ondata(Y_,null,e)}},t.prototype.push=function(t,e){Hv.prototype.push.call(this,t,e)},t}(),Gv=function(){function t(t,e){var n=this;e||(e={}),Hv.call(this,t),this.d=new Qg(e,(function(t,e,i){n.ondata(t,e,i)})),this.compression=8,this.flag=Nv(e.level),this.terminate=this.d.terminate}return t.prototype.process=function(t,e){this.d.push(t,e)},t.prototype.push=function(t,e){Hv.prototype.push.call(this,t,e)},t}(),jv=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var e=this;if(2&this.d)throw"stream finished";var n=Dv(t.filename),i=n.length,r=t.comment,s=r&&Dv(r),o=i!=t.filename.length||s&&r.length!=s.length,a=i+Fv(t.extra)+30;if(i>65535)throw"filename too long";var l=new Nf(a);Uv(l,0,t,n,o);var c=[l],h=function(){for(var t=0,n=c;t<n.length;t++){var i=n[t];e.ondata(null,i,!1)}c=[]},u=this.d;this.d=0;var d=this.u.length,p=Tg(t,{f:n,u:o,o:s,t:function(){t.terminate&&t.terminate()},r:function(){if(h(),u){var t=e.u[d+1];t?t.r():e.d=1}u=1}}),m=0;t.ondata=function(n,i,r){if(n)e.ondata(n,i,r),e.terminate();else if(m+=i.length,c.push(i),r){var s=new Nf(16);Gg(s,0,134695760),Gg(s,4,t.crc),Gg(s,8,m),Gg(s,12,t.size),c.push(s),p.c=m,p.b=a+m+16,p.crc=t.crc,p.size=t.size,u&&p.r(),u=1}else u&&h()},this.u.push(p)},t.prototype.end=function(){var t=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var t=0,e=0,n=0,i=0,r=this.u;i<r.length;i++){var s=r[i];n+=46+s.f.length+Fv(s.extra)+(s.o?s.o.length:0)}for(var o=new Nf(n+22),a=0,l=this.u;a<l.length;a++){s=l[a];Uv(o,t,s,s.f,s.u,s.c,e,s.o),t+=46+s.f.length+Fv(s.extra)+(s.o?s.o.length:0),e+=s.b}Vv(o,t,this.u.length,n,e),this.ondata(null,o,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++){var n=e[t];n.t()}this.d=2},t}();function qv(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";var i={};Av(t,"",i,e);var r=Object.keys(i),s=r.length,o=0,a=0,l=s,c=new Array(s),h=[],u=function(){for(var t=0;t<h.length;++t)h[t]()},d=function(){var t=new Nf(a+22),e=o,i=a-o;a=0;for(var r=0;r<l;++r){var s=c[r];try{var h=s.c.length;Uv(t,a,s,s.f,s.u,h);var u=30+s.f.length+Fv(s.extra),d=a+u;t.set(s.c,d),Uv(t,o,s,s.f,s.u,h,a,s.m),o+=16+u+(s.m?s.m.length:0),a=d+h}catch(Y_){return n(Y_,null)}}Vv(t,o,c.length,i,e),n(null,t)};s||d();for(var p=function(t){var e=r[t],l=i[e],p=l[0],m=l[1],f=wg(),g=p.length;f.p(p);var v=Dv(e),y=v.length,x=m.comment,b=x&&Dv(x),_=b&&b.length,w=Fv(m.extra),M=0==m.level?0:8,S=function(i,r){if(i)u(),n(i,null);else{var l=r.length;c[t]=Tg(m,{size:g,crc:f.d(),c:r,f:v,m:b,u:y!=e.length||b&&x.length!=_,compression:M}),o+=30+y+w+l,a+=76+2*(y+w)+(_||0)+l,--s||d()}};if(y>65535&&S("filename too long",null),M)if(g<16e4)try{S(null,ev(p,m))}catch(Y_){S(Y_,null)}else h.push(tv(p,m,S));else S(null,p)},m=0;m<l;++m)p(m);return u}function Xv(t,e){e||(e={});var n={},i=[];Av(t,"",n,e);var r=0,s=0;for(var o in n){var a=n[o],l=a[0],c=a[1],h=0==c.level?0:8,u=Dv(o),d=u.length,p=c.comment,m=p&&Dv(p),f=m&&m.length,g=Fv(c.extra);if(d>65535)throw"filename too long";var v=h?ev(l,c):l,y=v.length,x=wg();x.p(l),i.push(Tg(c,{size:l.length,crc:x.d(),c:v,f:u,m:m,u:d!=o.length||m&&p.length!=f,o:r,compression:h})),r+=30+d+g+y,s+=76+2*(d+g)+(f||0)+y}for(var b=new Nf(s+22),_=r,w=s-r,M=0;M<i.length;++M){u=i[M];Uv(b,u.o,u,u.f,u.u,u.c.length);var S=30+u.f.length+Fv(u.extra);b.set(u.c,u.o+S),Uv(b,r,u,u.f,u.u,u.c.length,u.o,u.m),r+=16+S+(u.m?u.m.length:0)}return Vv(b,r,i.length,w,_),b}var Yv=function(){function t(){}return t.prototype.push=function(t,e){this.ondata(null,t,e)},t.compression=0,t}(),Zv=function(){function t(){var t=this;this.i=new nv((function(e,n){t.ondata(null,e,n)}))}return t.prototype.push=function(t,e){try{this.i.push(t,e)}catch(Y_){this.ondata(Y_,t,e)}},t.compression=8,t}(),Jv=function(){function t(t,e){var n=this;e<32e4?this.i=new nv((function(t,e){n.ondata(null,t,e)})):(this.i=new iv((function(t,e,i){n.ondata(t,e,i)})),this.terminate=this.i.terminate)}return t.prototype.push=function(t,e){this.i.terminate&&(t=lg(t,0)),this.i.push(t,e)},t.compression=8,t}(),Kv=function(){function t(t){this.onfile=t,this.k=[],this.o={0:Yv},this.p=xg}return t.prototype.push=function(t,e){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,t.length),r=t.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),t=t.subarray(i),t.length)return this.push(t,e)}else{var s=0,o=0,a=void 0,l=void 0;this.p.length?t.length?(l=new Nf(this.p.length+t.length),l.set(this.p),l.set(t,this.p.length)):l=this.p:l=t;for(var c=l.length,h=this.c,u=h&&this.d,d=function(){var t,e=Hg(l,o);if(67324752==e){s=1,a=o,p.d=null,p.c=0;var i=Vg(l,o+6),r=Vg(l,o+8),u=2048&i,d=8&i,m=Vg(l,o+26),f=Vg(l,o+28);if(c>o+30+m+f){var g=[];p.k.unshift(g),s=2;var v,y=Hg(l,o+18),x=Hg(l,o+22),b=Ov(l.subarray(o+30,o+=30+m),!u);4294967295==y?(t=d?[-2]:Bv(l,o),y=t[0],x=t[1]):d&&(y=-1),o+=f,p.c=y;var _={name:b,compression:r,start:function(){if(!_.ondata)throw"no callback";if(y){var t=n.o[r];if(!t)throw"unknown compression type "+r;v=y<0?new t(b):new t(b,y,x),v.ondata=function(t,e,n){_.ondata(t,e,n)};for(var e=0,i=g;e<i.length;e++){var s=i[e];v.push(s,!1)}n.k[0]==g&&n.c?n.d=v:v.push(xg,!0)}else _.ondata(null,xg,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};y>=0&&(_.size=y,_.originalSize=x),p.onfile(_)}return"break"}if(h){if(134695760==e)return a=o+=12+(-2==h&&8),s=3,p.c=0,"break";if(33639248==e)return a=o-=4,s=3,p.c=0,"break"}},p=this;o<c-4;++o){var m=d();if("break"===m)break}if(this.p=xg,h<0){var f=s?l.subarray(0,a-12-(-2==h&&8)-(134695760==Hg(l,a-16)&&4)):l.subarray(0,o);u?u.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(l.subarray(o),e);this.p=l.subarray(o)}if(e){if(this.c)throw"invalid zip file";this.p=null}},t.prototype.register=function(t){this.o[t.compression]=t},t}();function $v(t,e){if("function"!=typeof e)throw"no callback";for(var n=[],i=function(){for(var t=0;t<n.length;++t)n[t]()},r={},s=t.length-22;101010256!=Hg(t,s);--s)if(!s||t.length-s>65558)return void e("invalid zip file",null);var o=Vg(t,s+8);o||e(null,{});var a=o,l=Hg(t,s+16),c=4294967295==l;if(c){if(s=Hg(t,s-12),101075792!=Hg(t,s))return void e("invalid zip file",null);a=o=Hg(t,s+32),l=Hg(t,s+48)}for(var h=function(a){var h=zv(t,l,c),u=h[0],d=h[1],p=h[2],m=h[3],f=h[4],g=h[5],v=kv(t,g);l=f;var y=function(t,n){t?(i(),e(t,null)):(r[m]=n,--o||e(null,r))};if(u)if(8==u){var x=t.subarray(v,v+d);if(d<32e4)try{y(null,sv(x,new Nf(p)))}catch(s){y(s,null)}else n.push(rv(x,{size:p},y))}else y("unknown compression type "+u,null);else y(null,lg(t,v,v+d))},u=0;u<a;++u)h(u);return i}function Qv(t){for(var e={},n=t.length-22;101010256!=Hg(t,n);--n)if(!n||t.length-n>65558)throw"invalid zip file";var i=Vg(t,n+8);if(!i)return{};var r=Hg(t,n+16),s=4294967295==r;if(s){if(n=Hg(t,n-12),101075792!=Hg(t,n))throw"invalid zip file";i=Hg(t,n+32),r=Hg(t,n+48)}for(var o=0;o<i;++o){var a=zv(t,r,s),l=a[0],c=a[1],h=a[2],u=a[3],d=a[4],p=a[5],m=kv(t,p);if(r=d,l){if(8!=l)throw"unknown compression type "+l;e[u]=sv(t.subarray(m,m+c),new Nf(h))}else e[u]=lg(t,m,m+c)}return e}function ty(t,e,n){const i=n.length-t-1;if(e>=n[i])return i-1;if(e<=n[t])return t;let r=t,s=i,o=Math.floor((r+s)/2);while(e<n[o]||e>=n[o+1])e<n[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function ey(t,e,n,i){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=n;++a){s[a]=e-i[t+1-a],o[a]=i[t+a]-e;let n=0;for(let t=0;t<a;++t){const e=o[t+1],i=s[a-t],l=r[t]/(e+i);r[t]=n+e*l,n=i*l}r[a]=n}return r}function ny(t,e,n,i){const r=ty(t,i,e),s=ey(r,i,t,e),o=new zn(0,0,0,0);for(let a=0;a<=t;++a){const e=n[r-t+a],i=s[a],l=e.w*i;o.x+=e.x*l,o.y+=e.y*l,o.z+=e.z*l,o.w+=e.w*i}return o}function iy(t,e,n,i,r){const s=[];for(let u=0;u<=n;++u)s[u]=0;const o=[];for(let u=0;u<=i;++u)o[u]=s.slice(0);const a=[];for(let u=0;u<=n;++u)a[u]=s.slice(0);a[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let u=1;u<=n;++u){l[u]=e-r[t+1-u],c[u]=r[t+u]-e;let n=0;for(let t=0;t<u;++t){const e=c[t+1],i=l[u-t];a[u][t]=e+i;const r=a[t][u-1]/a[u][t];a[t][u]=n+e*r,n=i*r}a[u][u]=n}for(let u=0;u<=n;++u)o[0][u]=a[u][n];for(let u=0;u<=n;++u){let t=0,e=1;const r=[];for(let i=0;i<=n;++i)r[i]=s.slice(0);r[0][0]=1;for(let s=1;s<=i;++s){let i=0;const l=u-s,c=n-s;u>=s&&(r[e][0]=r[t][0]/a[c+1][l],i=r[e][0]*a[l][c]);const h=l>=-1?1:-l,d=u-1<=c?s-1:n-u;for(let n=h;n<=d;++n)r[e][n]=(r[t][n]-r[t][n-1])/a[c+1][l+n],i+=r[e][n]*a[l+n][c];u<=c&&(r[e][s]=-r[t][s-1]/a[c+1][u],i+=r[e][s]*a[u][c]),o[s][u]=i;const p=t;t=e,e=p}}let h=n;for(let u=1;u<=i;++u){for(let t=0;t<=n;++t)o[u][t]*=h;h*=n-u}return o}function ry(t,e,n,i,r){const s=r<t?r:t,o=[],a=ty(t,i,e),l=iy(a,i,t,s,e),c=[];for(let h=0;h<n.length;++h){const t=n[h].clone(),e=t.w;t.x*=e,t.y*=e,t.z*=e,c[h]=t}for(let h=0;h<=s;++h){const e=c[a-t].clone().multiplyScalar(l[h][0]);for(let n=1;n<=t;++n)e.add(c[a-t+n].clone().multiplyScalar(l[h][n]));o[h]=e}for(let h=s+1;h<=r+1;++h)o[h]=new zn(0,0,0);return o}function sy(t,e){let n=1;for(let r=2;r<=t;++r)n*=r;let i=1;for(let r=2;r<=e;++r)i*=r;for(let r=2;r<=t-e;++r)i*=r;return n/i}function oy(t){const e=t.length,n=[],i=[];for(let s=0;s<e;++s){const e=t[s];n[s]=new Hn(e.x,e.y,e.z),i[s]=e.w}const r=[];for(let s=0;s<e;++s){const t=n[s].clone();for(let e=1;e<=s;++e)t.sub(r[s-e].clone().multiplyScalar(sy(s,e)*i[e]));r[s]=t.divideScalar(i[0])}return r}function ay(t,e,n,i,r){const s=ry(t,e,n,i,r);return oy(s)}class ly extends Hu{constructor(t,e,n,i,r){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let s=0;s<n.length;++s){const t=n[s];this.controlPoints[s]=new zn(t.x,t.y,t.z,t.w)}}getPoint(t,e=new Hn){const n=e,i=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=ny(this.degree,this.knots,this.controlPoints,i);return 1!==r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(t,e=new Hn){const n=e,i=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),r=ay(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}}let cy,hy,uy;class dy extends am{constructor(t){super(t)}load(t,e,n,i){const r=this,s=""===r.path?Dm.extractUrlBase(t):r.path,o=new hm(this.manager);o.setPath(r.path),o.setResponseType("arraybuffer"),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(t,(function(n){try{e(r.parse(n,s))}catch(Y_){i?i(Y_):console.error(Y_),r.manager.itemError(t)}}),n,i)}parse(t,e){if(by(t))cy=(new vy).parse(t);else{const e=Ry(t);if(!_y(e))throw new Error("THREE.FBXLoader: Unknown format.");if(wy(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+wy(e));cy=(new gy).parse(e)}const n=new dm(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new py(n,this.manager).parse(cy)}}class py{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){hy=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),n=this.parseMaterials(e),i=this.parseDeformers(),r=(new my).parse(i);return this.parseScene(i,r,n),uy}parseConnections(){const t=new Map;if("Connections"in cy){const e=cy.Connections.connections;e.forEach((function(e){const n=e[0],i=e[1],r=e[2];t.has(n)||t.set(n,{parents:[],children:[]});const s={ID:i,relationship:r};t.get(n).parents.push(s),t.has(i)||t.set(i,{parents:[],children:[]});const o={ID:n,relationship:r};t.get(i).children.push(o)}))}return t}parseImages(){const t={},e={};if("Video"in cy.Objects){const n=cy.Objects.Video;for(const i in n){const r=n[i],s=parseInt(i);if(t[s]=r.RelativeFilename||r.Filename,"Content"in r){const t=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,s="string"===typeof r.Content&&""!==r.Content;if(t||s){const t=this.parseImage(n[i]);e[r.RelativeFilename||r.Filename]=t}}}}for(const n in t){const i=t[n];void 0!==e[i]?t[n]=e[i]:t[n]=t[n].split("\\").pop()}return t}parseImage(t){const e=t.Content,n=t.RelativeFilename||t.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"===typeof e)return"data:"+r+";base64,"+e;{const t=new Uint8Array(e);return window.URL.createObjectURL(new Blob([t],{type:r}))}}parseTextures(t){const e=new Map;if("Texture"in cy.Objects){const n=cy.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],t);e.set(parseInt(i),r)}}return e}parseTexture(t,e){const n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;const i=t.WrapModeU,r=t.WrapModeV,s=void 0!==i?i.value:0,o=void 0!==r?r.value:0;if(n.wrapS=0===s?ct:ht,n.wrapT=0===o?ct:ht,"Scaling"in t){const e=t.Scaling.value;n.repeat.x=e[0],n.repeat.y=e[1]}if("Translation"in t){const e=t.Translation.value;n.offset.x=e[0],n.offset.y=e[1]}return n}loadTexture(t,e){let n;const i=this.textureLoader.path,r=hy.get(t.id).children;let s;void 0!==r&&r.length>0&&void 0!==e[r[0].ID]&&(n=e[r[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const o=t.FileName.slice(-3).toLowerCase();if("tga"===o){const e=this.manager.getHandler(".tga");null===e?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),s=new kn):(e.setPath(this.textureLoader.path),s=e.load(n))}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),s=new kn):s=this.textureLoader.load(n);return this.textureLoader.setPath(i),s}parseMaterials(t){const e=new Map;if("Material"in cy.Objects){const n=cy.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],t);null!==r&&e.set(parseInt(i),r)}}return e}parseMaterial(t,e){const n=t.id,i=t.attrName;let r=t.ShadingModel;if("object"===typeof r&&(r=r.value),!hy.has(n))return null;const s=this.parseParameters(t,e,n);let o;switch(r.toLowerCase()){case"phong":o=new Rp;break;case"lambert":o=new Op;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),o=new Rp;break}return o.setValues(s),o.name=i,o}parseParameters(t,e,n){const i={};t.BumpFactor&&(i.bumpScale=t.BumpFactor.value),t.Diffuse?i.color=(new Ln).fromArray(t.Diffuse.value):!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(i.color=(new Ln).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(i.displacementScale=t.DisplacementFactor.value),t.Emissive?i.emissive=(new Ln).fromArray(t.Emissive.value):!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(i.emissive=(new Ln).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(i.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(i.opacity=parseFloat(t.Opacity.value)),i.opacity<1&&(i.transparent=!0),t.ReflectionFactor&&(i.reflectivity=t.ReflectionFactor.value),t.Shininess&&(i.shininess=t.Shininess.value),t.Specular?i.specular=(new Ln).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(i.specular=(new Ln).fromArray(t.SpecularColor.value));const r=this;return hy.get(n).children.forEach((function(t){const n=t.relationship;switch(n){case"Bump":i.bumpMap=r.getTexture(e,t.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(e,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(e,t.ID),void 0!==i.map&&(i.map.encoding=Ee);break;case"DisplacementColor":i.displacementMap=r.getTexture(e,t.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(e,t.ID),void 0!==i.emissiveMap&&(i.emissiveMap.encoding=Ee);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(e,t.ID);break;case"ReflectionColor":i.envMap=r.getTexture(e,t.ID),void 0!==i.envMap&&(i.envMap.mapping=ot,i.envMap.encoding=Ee);break;case"SpecularColor":i.specularMap=r.getTexture(e,t.ID),void 0!==i.specularMap&&(i.specularMap.encoding=Ee);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(e,t.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n);break}})),i}getTexture(t,e){return"LayeredTexture"in cy.Objects&&e in cy.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=hy.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in cy.Objects){const n=cy.Objects.Deformer;for(const i in n){const r=n[i],s=hy.get(parseInt(i));if("Skin"===r.attrType){const e=this.parseSkeleton(s,n);e.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),e.geometryID=s.parents[0].ID,t[i]=e}else if("BlendShape"===r.attrType){const t={id:i};t.rawTargets=this.parseMorphTargets(s,n),t.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[i]=t}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const n=[];return t.children.forEach((function(t){const i=e[t.ID];if("Cluster"!==i.attrType)return;const r={ID:t.ID,indices:[],weights:[],transformLink:(new xi).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)})),{rawBones:n,bones:[]}}parseMorphTargets(t,e){const n=[];for(let i=0;i<t.children.length;i++){const r=t.children[i],s=e[r.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=hy.get(parseInt(r.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,n.push(o)}return n}parseScene(t,e,n){uy=new Ah;const i=this.parseModels(t.skeletons,e,n),r=cy.Objects.Model,s=this;i.forEach((function(t){const e=r[t.ID];s.setLookAtProperties(t,e);const n=hy.get(t.ID).parents;n.forEach((function(e){const n=i.get(e.ID);void 0!==n&&n.add(t)})),null===t.parent&&uy.add(t)})),this.bindSkeleton(t.skeletons,e,i),this.createAmbientLight(),uy.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrix=t.parent.matrix,t.userData.transformData.parentMatrixWorld=t.parent.matrixWorld);const e=Cy(t.userData.transformData);t.applyMatrix4(e),t.updateWorldMatrix()}}));const o=(new fy).parse();1===uy.children.length&&uy.children[0].isGroup&&(uy.children[0].animations=o,uy=uy.children[0]),uy.animations=o}parseModels(t,e,n){const i=new Map,r=cy.Objects.Model;for(const s in r){const o=parseInt(s),a=r[s],l=hy.get(o);let c=this.buildSkeleton(l,t,o,a.attrName);if(!c){switch(a.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,e,n);break;case"NurbsCurve":c=this.createCurve(l,e);break;case"LimbNode":case"Root":c=new pu;break;case"Null":default:c=new Ah;break}c.name=a.attrName?ef.sanitizeNodeName(a.attrName):"",c.ID=o}this.getTransformData(c,a),i.set(o,c)}return i}buildSkeleton(t,e,n,i){let r=null;return t.parents.forEach((function(t){for(const s in e){const o=e[s];o.rawBones.forEach((function(e,s){if(e.ID===t.ID){const t=r;r=new pu,r.matrixWorld.copy(e.transformLink),r.name=i?ef.sanitizeNodeName(i):"",r.ID=n,o.bones[s]=r,null!==t&&r.add(t)}}))}})),r}createCamera(t){let e,n;if(t.children.forEach((function(t){const e=cy.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new Gi;else{let t=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(t=1);let i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);let r=1e3;void 0!==n.FarPlane&&(r=n.FarPlane.value/1e3);let s=window.innerWidth,o=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,o=n.AspectHeight.value);const a=s/o;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const c=n.FocalLength?n.FocalLength.value:null;switch(t){case 0:e=new Yr(l,a,i,r),null!==c&&e.setFocalLength(c);break;case 1:e=new Ja(-s/2,s/2,o/2,-o/2,i,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),e=new Gi;break}}return e}createLight(t){let e,n;if(t.children.forEach((function(t){const e=cy.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new Gi;else{let t;t=void 0===n.LightType?0:n.LightType.value;let i=16777215;void 0!==n.Color&&(i=(new Ln).fromArray(n.Color.value));let r=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(r=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const o=1;switch(t){case 0:e=new Tm(i,r,s,o);break;case 1:e=new Em(i,r);break;case 2:let t=Math.PI/3;void 0!==n.InnerAngle&&(t=pn.degToRad(n.InnerAngle.value));let a=0;void 0!==n.OuterAngle&&(a=pn.degToRad(n.OuterAngle.value),a=Math.max(a,1)),e=new bm(i,r,s,t,a,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),e=new Tm(i,r);break}void 0!==n.CastShadows&&1===n.CastShadows.value&&(e.castShadow=!0)}return e}createMesh(t,e,n){let i,r=null,s=null;const o=[];return t.children.forEach((function(t){e.has(t.ID)&&(r=e.get(t.ID)),n.has(t.ID)&&o.push(n.get(t.ID))})),o.length>1?s=o:o.length>0?s=o[0]:(s=new Rp({color:13421772}),o.push(s)),"color"in r.attributes&&o.forEach((function(t){t.vertexColors=!0})),r.FBX_Deformer?(i=new du(r,s),i.normalizeSkinWeights()):i=new kr(r,s),i}createCurve(t,e){const n=t.children.reduce((function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t}),null),i=new Su({color:3342591,linewidth:1});return new Lu(n,i)}getTransformData(t,e){const n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),n.eulerOrder="RotationOrder"in e?Py(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n}setLookAtProperties(t,e){if("LookAtProperty"in e){const e=hy.get(t.ID).children;e.forEach((function(e){if("LookAtProperty"===e.relationship){const n=cy.Objects.Model[e.ID];if("Lcl_Translation"in n){const e=n.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(e),uy.add(t.target)):t.lookAt((new Hn).fromArray(e))}}}))}}bindSkeleton(t,e,n){const i=this.parsePoseNodes();for(const r in t){const s=t[r],o=hy.get(parseInt(s.ID)).parents;o.forEach((function(t){if(e.has(t.ID)){const e=t.ID,r=hy.get(e);r.parents.forEach((function(t){if(n.has(t.ID)){const e=n.get(t.ID);e.bind(new vu(s.bones),i[t.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in cy.Objects){const e=cy.Objects.Pose;for(const n in e)if("BindPose"===e[n].attrType&&e[n].NbPoseNodes>0){const i=e[n].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new xi).fromArray(e.Matrix.a)})):t[i.Node]=(new xi).fromArray(i.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in cy&&"AmbientColor"in cy.GlobalSettings){const t=cy.GlobalSettings.AmbientColor.value,e=t[0],n=t[1],i=t[2];if(0!==e||0!==n||0!==i){const t=new Ln(e,n,i);uy.add(new Cm(t,1))}}}}class my{parse(t){const e=new Map;if("Geometry"in cy.Objects){const n=cy.Objects.Geometry;for(const i in n){const r=hy.get(parseInt(i)),s=this.parseGeometry(r,n[i],t);e.set(parseInt(i),s)}}return e}parseGeometry(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,n){const i=n.skeletons,r=[],s=t.parents.map((function(t){return cy.Objects.Model[t.ID]}));if(0===s.length)return;const o=t.children.reduce((function(t,e){return void 0!==i[e.ID]&&(t=i[e.ID]),t}),null);t.children.forEach((function(t){void 0!==n.morphTargets[t.ID]&&r.push(n.morphTargets[t.ID])}));const a=s[0],l={};"RotationOrder"in a&&(l.eulerOrder=Py(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const c=Cy(l);return this.genGeometry(e,o,r,c)}genGeometry(t,e,n,i){const r=new yr;t.attrName&&(r.name=t.attrName);const s=this.parseGeoNode(t,e),o=this.genBuffers(s),a=new hr(o.vertex,3);if(a.applyMatrix4(i),r.setAttribute("position",a),o.colors.length>0&&r.setAttribute("color",new hr(o.colors,3)),e&&(r.setAttribute("skinIndex",new lr(o.weightsIndices,4)),r.setAttribute("skinWeight",new hr(o.vertexWeights,4)),r.FBX_Deformer=e),o.normal.length>0){const t=(new fn).getNormalMatrix(i),e=new hr(o.normal,3);e.applyNormalMatrix(t),r.setAttribute("normal",e)}if(o.uvs.forEach((function(t,e){let n="uv"+(e+1).toString();0===e&&(n="uv"),r.setAttribute(n,new hr(o.uvs[e],2))})),s.material&&"AllSame"!==s.material.mappingType){let t=o.materialIndex[0],e=0;if(o.materialIndex.forEach((function(n,i){n!==t&&(r.addGroup(e,i-e,t),t=n,e=i)})),r.groups.length>0){const e=r.groups[r.groups.length-1],n=e.start+e.count;n!==o.materialIndex.length&&r.addGroup(n,o.materialIndex.length-n,t)}0===r.groups.length&&r.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(r,t,n,i),r}parseGeoNode(t,e){const n={};if(n.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],n.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];let e=0;while(t.LayerElementUV[e])t.LayerElementUV[e].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[e])),e++}return n.weightTable={},null!==e&&(n.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:e,weight:t.weights[r]})}))}))),n}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,s=[],o=[],a=[],l=[],c=[],h=[];const u=this;return t.vertexIndices.forEach((function(d,p){let m,f=!1;d<0&&(d^=-1,f=!0);let g=[],v=[];if(s.push(3*d,3*d+1,3*d+2),t.color){const e=Ty(p,n,d,t.color);a.push(e[0],e[1],e[2])}if(t.skeleton){if(void 0!==t.weightTable[d]&&t.weightTable[d].forEach((function(t){v.push(t.weight),g.push(t.id)})),v.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const t=[0,0,0,0],e=[0,0,0,0];v.forEach((function(n,i){let r=n,s=g[i];e.forEach((function(e,n,i){if(r>e){i[n]=r,r=e;const o=t[n];t[n]=s,s=o}}))})),g=t,v=e}while(v.length<4)v.push(0),g.push(0);for(let t=0;t<4;++t)c.push(v[t]),h.push(g[t])}if(t.normal){const e=Ty(p,n,d,t.normal);o.push(e[0],e[1],e[2])}t.material&&"AllSame"!==t.material.mappingType&&(m=Ty(p,n,d,t.material)[0],m<0&&(console.warn("THREE.FBXLoader: Invalid material index:",m),m=0)),t.uv&&t.uv.forEach((function(t,e){const i=Ty(p,n,d,t);void 0===l[e]&&(l[e]=[]),l[e].push(i[0]),l[e].push(i[1])})),i++,f&&(u.genFace(e,t,s,m,o,a,l,c,h,i),n++,i=0,s=[],o=[],a=[],l=[],c=[],h=[])})),e}genFace(t,e,n,i,r,s,o,a,l,c){for(let h=2;h<c;h++)t.vertex.push(e.vertexPositions[n[0]]),t.vertex.push(e.vertexPositions[n[1]]),t.vertex.push(e.vertexPositions[n[2]]),t.vertex.push(e.vertexPositions[n[3*(h-1)]]),t.vertex.push(e.vertexPositions[n[3*(h-1)+1]]),t.vertex.push(e.vertexPositions[n[3*(h-1)+2]]),t.vertex.push(e.vertexPositions[n[3*h]]),t.vertex.push(e.vertexPositions[n[3*h+1]]),t.vertex.push(e.vertexPositions[n[3*h+2]]),e.skeleton&&(t.vertexWeights.push(a[0]),t.vertexWeights.push(a[1]),t.vertexWeights.push(a[2]),t.vertexWeights.push(a[3]),t.vertexWeights.push(a[4*(h-1)]),t.vertexWeights.push(a[4*(h-1)+1]),t.vertexWeights.push(a[4*(h-1)+2]),t.vertexWeights.push(a[4*(h-1)+3]),t.vertexWeights.push(a[4*h]),t.vertexWeights.push(a[4*h+1]),t.vertexWeights.push(a[4*h+2]),t.vertexWeights.push(a[4*h+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[4*(h-1)]),t.weightsIndices.push(l[4*(h-1)+1]),t.weightsIndices.push(l[4*(h-1)+2]),t.weightsIndices.push(l[4*(h-1)+3]),t.weightsIndices.push(l[4*h]),t.weightsIndices.push(l[4*h+1]),t.weightsIndices.push(l[4*h+2]),t.weightsIndices.push(l[4*h+3])),e.color&&(t.colors.push(s[0]),t.colors.push(s[1]),t.colors.push(s[2]),t.colors.push(s[3*(h-1)]),t.colors.push(s[3*(h-1)+1]),t.colors.push(s[3*(h-1)+2]),t.colors.push(s[3*h]),t.colors.push(s[3*h+1]),t.colors.push(s[3*h+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(i),t.materialIndex.push(i),t.materialIndex.push(i)),e.normal&&(t.normal.push(r[0]),t.normal.push(r[1]),t.normal.push(r[2]),t.normal.push(r[3*(h-1)]),t.normal.push(r[3*(h-1)+1]),t.normal.push(r[3*(h-1)+2]),t.normal.push(r[3*h]),t.normal.push(r[3*h+1]),t.normal.push(r[3*h+2])),e.uv&&e.uv.forEach((function(e,n){void 0===t.uvs[n]&&(t.uvs[n]=[]),t.uvs[n].push(o[n][0]),t.uvs[n].push(o[n][1]),t.uvs[n].push(o[n][2*(h-1)]),t.uvs[n].push(o[n][2*(h-1)+1]),t.uvs[n].push(o[n][2*h]),t.uvs[n].push(o[n][2*h+1])}))}addMorphTargets(t,e,n,i){if(0===n.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=cy.Objects.Geometry[n.geoID];void 0!==s&&r.genMorphGeometry(t,e,s,i,n.name)}))}))}genMorphGeometry(t,e,n,i,r){const s=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],o=void 0!==n.Vertices?n.Vertices.a:[],a=void 0!==n.Indexes?n.Indexes.a:[],l=3*t.attributes.position.count,c=new Float32Array(l);for(let p=0;p<a.length;p++){const t=3*a[p];c[t]=o[3*p],c[t+1]=o[3*p+1],c[t+2]=o[3*p+2]}const h={vertexIndices:s,vertexPositions:c},u=this.genBuffers(h),d=new hr(u.vertex,3);d.name=r||n.attrName,d.applyMatrix4(i),t.morphAttributes.position.push(d)}parseNormals(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in t?r=t.NormalIndex.a:"NormalsIndex"in t&&(r=t.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:e,referenceType:n}}parseUVs(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.UV.a;let r=[];return"IndexToDirect"===n&&(r=t.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:e,referenceType:n}}parseVertexColors(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.Colors.a;let r=[];return"IndexToDirect"===n&&(r=t.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:e,referenceType:n}}parseMaterialIndices(t){const e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=t.Materials.a,r=[];for(let s=0;s<i.length;++s)r.push(s);return{dataSize:1,buffer:i,indices:r,mappingType:e,referenceType:n}}parseNurbsGeometry(t){if(void 0===ly)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new yr;const e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new yr;const n=e-1,i=t.KnotVector.a,r=[],s=t.Points.a;for(let h=0,u=s.length;h<u;h+=4)r.push((new zn).fromArray(s,h));let o,a;if("Closed"===t.Form)r.push(r[0]);else if("Periodic"===t.Form){o=n,a=i.length-1-o;for(let t=0;t<n;++t)r.push(r[t])}const l=new ly(n,i,r,o,a),c=l.getPoints(12*r.length);return(new yr).setFromPoints(c)}}class fy{parse(){const t=[],e=this.parseClips();if(void 0!==e)for(const n in e){const i=e[n],r=this.addClip(i);t.push(r)}return t}parseClips(){if(void 0===cy.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t),n=this.parseAnimStacks(e);return n}parseAnimationCurveNodes(){const t=cy.Objects.AnimationCurveNode,e=new Map;for(const n in t){const i=t[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const t={id:i.id,attr:i.attrName,curves:{}};e.set(t.id,t)}}return e}parseAnimationCurves(t){const e=cy.Objects.AnimationCurve;for(const n in e){const i={id:e[n].id,times:e[n].KeyTime.a.map(My),values:e[n].KeyValueFloat.a},r=hy.get(i.id);if(void 0!==r){const e=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?t.get(e).curves["x"]=i:n.match(/Y/)?t.get(e).curves["y"]=i:n.match(/Z/)?t.get(e).curves["z"]=i:n.match(/d|DeformPercent/)&&t.has(e)&&(t.get(e).curves["morph"]=i)}}}parseAnimationLayers(t){const e=cy.Objects.AnimationLayer,n=new Map;for(const i in e){const e=[],r=hy.get(parseInt(i));if(void 0!==r){const s=r.children;s.forEach((function(n,i){if(t.has(n.ID)){const r=t.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===e[i]){const t=hy.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==t){const r=cy.Objects.Model[t.toString()];if(void 0===r)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const s={modelName:r.attrName?ef.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};uy.traverse((function(t){t.ID===r.id&&(s.transform=t.matrix,t.userData.transformData&&(s.eulerOrder=t.userData.transformData.eulerOrder))})),s.transform||(s.transform=new xi),"PreRotation"in r&&(s.preRotation=r.PreRotation.value),"PostRotation"in r&&(s.postRotation=r.PostRotation.value),e[i]=s}}e[i]&&(e[i][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===e[i]){const t=hy.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,r=hy.get(t).parents[0].ID,s=hy.get(r).parents[0].ID,o=hy.get(s).parents[0].ID,a=cy.Objects.Model[o],l={modelName:a.attrName?ef.sanitizeNodeName(a.attrName):"",morphName:cy.Objects.Deformer[t].attrName};e[i]=l}e[i][r.attr]=r}}})),n.set(parseInt(i),e)}}return n}parseAnimStacks(t){const e=cy.Objects.AnimationStack,n={};for(const i in e){const r=hy.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=t.get(r[0].ID);n[i]={name:e[i].attrName,layer:s}}return n}addClip(t){let e=[];const n=this;return t.layer.forEach((function(t){e=e.concat(n.generateTracks(t))})),new em(t.name,-1,e)}generateTracks(t){const e=[];let n=new Hn,i=new Vn,r=new Hn;if(t.transform&&t.transform.decompose(n,i,r),n=n.toArray(),i=(new Pi).setFromQuaternion(i,t.eulerOrder).toArray(),r=r.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const i=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==i&&e.push(i)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const n=this.generateRotationTrack(t.modelName,t.R.curves,i,t.preRotation,t.postRotation,t.eulerOrder);void 0!==n&&e.push(n)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const n=this.generateVectorTrack(t.modelName,t.S.curves,r,"scale");void 0!==n&&e.push(n)}if(void 0!==t.DeformPercent){const n=this.generateMorphTrack(t);void 0!==n&&e.push(n)}return e}generateVectorTrack(t,e,n,i){const r=this.getTimesForAllAxes(e),s=this.getKeyframeTrackValues(r,e,n);return new tm(t+"."+i,r,s)}generateRotationTrack(t,e,n,i,r,s){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(pn.degToRad)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(pn.degToRad)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(pn.degToRad));const o=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(o,e,n);void 0!==i&&(i=i.map(pn.degToRad),i.push(s),i=(new Pi).fromArray(i),i=(new Vn).setFromEuler(i)),void 0!==r&&(r=r.map(pn.degToRad),r.push(s),r=(new Pi).fromArray(r),r=(new Vn).setFromEuler(r).invert());const l=new Vn,c=new Pi,h=[];for(let u=0;u<a.length;u+=3)c.set(a[u],a[u+1],a[u+2],s),l.setFromEuler(c),void 0!==i&&l.premultiply(i),void 0!==r&&l.multiply(r),l.toArray(h,u/3*4);return new $p(t+".quaternion",o,h)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,n=e.values.map((function(t){return t/100})),i=uy.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new Jp(t.modelName+".morphTargetInfluences["+i+"]",e.times,n)}getTimesForAllAxes(t){let e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})),e.length>1){let t=1,n=e[0];for(let i=1;i<e.length;i++){const r=e[i];r!==n&&(e[t]=r,n=r,t++)}e=e.slice(0,t)}return e}getKeyframeTrackValues(t,e,n){const i=n,r=[];let s=-1,o=-1,a=-1;return t.forEach((function(t){if(e.x&&(s=e.x.times.indexOf(t)),e.y&&(o=e.y.times.indexOf(t)),e.z&&(a=e.z.times.indexOf(t)),-1!==s){const t=e.x.values[s];r.push(t),i[0]=t}else r.push(i[0]);if(-1!==o){const t=e.y.values[o];r.push(t),i[1]=t}else r.push(i[1]);if(-1!==a){const t=e.z.values[a];r.push(t),i[2]=t}else r.push(i[2])})),r}interpolateRotations(t){for(let e=1;e<t.values.length;e++){const n=t.values[e-1],i=t.values[e]-n,r=Math.abs(i);if(r>=180){const s=r/180,o=i/s;let a=n+o;const l=t.times[e-1],c=t.times[e]-l,h=c/s;let u=l+h;const d=[],p=[];while(u<t.times[e])d.push(u),u+=h,p.push(a),a+=o;t.times=Oy(t.times,e,d),t.values=Oy(t.values,e,p)}}}}class gy{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new xy,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,n=t.split(/[\r\n]+/);return n.forEach((function(t,i){const r=t.match(/^[\s\t]*;/),s=t.match(/^[\s\t]*$/);if(r||s)return;const o=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),a=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");o?e.parseNodeBegin(t,o):a?e.parseNodeProperty(t,a,n[++i]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)})),this.allNodes}parseNodeBegin(t,e){const n=e[1].trim().replace(/^"/,"").replace(/"$/,""),i=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},s=this.parseNodeAttr(i),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in o?("PoseNode"===n?o.PoseNode.push(r):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==s.id&&(o[n][s.id]=r)):"number"===typeof s.id?(o[n]={},o[n][s.id]=r):"Properties70"!==n&&(o[n]="PoseNode"===n?[r]:r),"number"===typeof s.id&&(r.id=s.id),""!==s.name&&(r.attrName=s.name),""!==s.type&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(t){let e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let n="",i="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),i=t[2]),{id:e,name:n,type:i}}parseNodeProperty(t,e,n){let i=e[1].replace(/^"/,"").replace(/"$/,"").trim(),r=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode(),o=s.name;if("Properties70"!==o){if("C"===i){const t=r.split(",").slice(1),e=parseInt(t[0]),n=parseInt(t[1]);let o=r.split(",").slice(3);o=o.map((function(t){return t.trim().replace(/^"/,"")})),i="connections",r=[e,n],Iy(r,o),void 0===s[i]&&(s[i]=[])}"Node"===i&&(s.id=r),i in s&&Array.isArray(s[i])?s[i].push(r):"a"!==i?s[i]=r:s.a=r,this.setCurrentProp(s,i),"a"===i&&","!==r.slice(-1)&&(s.a=Ly(r))}else this.parseNodeSpecialProperty(t,i,r)}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=Ly(e.a))}parseNodeSpecialProperty(t,e,n){const i=n.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],s=i[1],o=i[2],a=i[3];let l=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Ly(l);break}this.getPrevNode()[r]={type:s,type2:o,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class vy{parse(t){const e=new yy(t);e.skip(23);const n=e.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new xy;while(!this.endOfContent(e)){const t=this.parseNode(e,n);null!==t&&i.add(t.name,t)}return i}endOfContent(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const n={},i=e>=7500?t.getUint64():t.getUint32(),r=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const s=t.getUint8(),o=t.getString(s);if(0===i)return null;const a=[];for(let u=0;u<r;u++)a.push(this.parseProperty(t));const l=a.length>0?a[0]:"",c=a.length>1?a[1]:"",h=a.length>2?a[2]:"";n.singleProperty=1===r&&t.getOffset()===i;while(i>t.getOffset()){const i=this.parseNode(t,e);null!==i&&this.parseSubNode(o,n,i)}return n.propertyList=a,"number"===typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==h&&(n.attrType=h),""!==o&&(n.name=o),n}parseSubNode(t,e,n){if(!0===n.singleProperty){const t=n.propertyList[0];Array.isArray(t)?(e[n.name]=n,n.a=t):e[n.name]=t}else if("Connections"===t&&"C"===n.name){const t=[];n.propertyList.forEach((function(e,n){0!==n&&t.push(e)})),void 0===e.connections&&(e.connections=[]),e.connections.push(t)}else if("Properties70"===n.name){const t=Object.keys(n);t.forEach((function(t){e[t]=n[t]}))}else if("Properties70"===t&&"P"===n.name){let t=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],s=n.propertyList[3];let o;0===t.indexOf("Lcl ")&&(t=t.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),o="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[t]={type:i,type2:r,flag:s,value:o}}else void 0===e[n.name]?"number"===typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)}parseProperty(t){const e=t.getString(1);let n;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return n=t.getUint32(),t.getArrayBuffer(n);case"S":return n=t.getUint32(),t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=t.getUint32(),s=t.getUint32(),o=t.getUint32();if(0===s)switch(e){case"b":case"c":return t.getBooleanArray(r);case"d":return t.getFloat64Array(r);case"f":return t.getFloat32Array(r);case"i":return t.getInt32Array(r);case"l":return t.getInt64Array(r)}"undefined"===typeof i&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=_v(new Uint8Array(t.getArrayBuffer(o))),l=new yy(a.buffer);switch(e){case"b":case"c":return l.getBooleanArray(r);case"d":return l.getFloat64Array(r);case"f":return l.getFloat32Array(r);case"i":return l.getInt32Array(r);case"l":return l.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class yy{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return 1===(1&this.getUint8())}getBooleanArray(t){const e=[];for(let n=0;n<t;n++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t}getInt64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){let e=[];for(let i=0;i<t;i++)e[i]=this.getUint8();const n=e.indexOf(0);return n>=0&&(e=e.slice(0,n)),Dm.decodeText(new Uint8Array(e))}}class xy{add(t,e){this[t]=e}}function by(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===Ry(t,0,e.length)}function _y(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(e){const i=t[e-1];return t=t.slice(n+e),n++,i}for(let r=0;r<e.length;++r){const t=i(1);if(t===e[r])return!1}return!0}function wy(t){const e=/FBXVersion: (\d+)/,n=t.match(e);if(n){const t=parseInt(n[1]);return t}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function My(t){return t/46186158e3}const Sy=[];function Ty(t,e,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=t;break;case"ByPolygon":r=e;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const s=r*i.dataSize,o=s+i.dataSize;return Dy(Sy,i.buffer,s,o)}const Ay=new Pi,Ey=new Hn;function Cy(t){const e=new xi,n=new xi,i=new xi,r=new xi,s=new xi,o=new xi,a=new xi,l=new xi,c=new xi,h=new xi,u=new xi,d=new xi,p=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(Ey.fromArray(t.translation)),t.preRotation){const e=t.preRotation.map(pn.degToRad);e.push(t.eulerOrder||Pi.DefaultOrder),n.makeRotationFromEuler(Ay.fromArray(e))}if(t.rotation){const e=t.rotation.map(pn.degToRad);e.push(t.eulerOrder||Pi.DefaultOrder),i.makeRotationFromEuler(Ay.fromArray(e))}if(t.postRotation){const e=t.postRotation.map(pn.degToRad);e.push(t.eulerOrder||Pi.DefaultOrder),r.makeRotationFromEuler(Ay.fromArray(e)),r.invert()}t.scale&&s.scale(Ey.fromArray(t.scale)),t.scalingOffset&&a.setPosition(Ey.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(Ey.fromArray(t.scalingPivot)),t.rotationOffset&&l.setPosition(Ey.fromArray(t.rotationOffset)),t.rotationPivot&&c.setPosition(Ey.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(u.copy(t.parentMatrix),h.copy(t.parentMatrixWorld));const m=n.clone().multiply(i).multiply(r),f=new xi;f.extractRotation(h);const g=new xi;g.copyPosition(h);const v=g.clone().invert().multiply(h),y=f.clone().invert().multiply(v),x=s,b=new xi;if(0===p)b.copy(f).multiply(m).multiply(y).multiply(x);else if(1===p)b.copy(f).multiply(y).multiply(m).multiply(x);else{const t=(new xi).scale((new Hn).setFromMatrixScale(u)),e=t.clone().invert(),n=y.clone().multiply(e);b.copy(f).multiply(m).multiply(n).multiply(x)}const _=c.clone().invert(),w=o.clone().invert();let M=e.clone().multiply(l).multiply(c).multiply(n).multiply(i).multiply(r).multiply(_).multiply(a).multiply(o).multiply(s).multiply(w);const S=(new xi).copyPosition(M),T=h.clone().multiply(S);return d.copyPosition(T),M=d.clone().multiply(b),M.premultiply(h.invert()),M}function Py(t){t=t||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===t?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function Ly(t){const e=t.split(",").map((function(t){return parseFloat(t)}));return e}function Ry(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),Dm.decodeText(new Uint8Array(t,e,n))}function Iy(t,e){for(let n=0,i=t.length,r=e.length;n<r;n++,i++)t[i]=e[n]}function Dy(t,e,n,i){for(let r=n,s=0;r<i;r++,s++)t[s]=e[r];return t}function Oy(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}class Ny extends am{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new Vy(t)})),this.register((function(t){return new Yy(t)})),this.register((function(t){return new Zy(t)})),this.register((function(t){return new Wy(t)})),this.register((function(t){return new Gy(t)})),this.register((function(t){return new jy(t)})),this.register((function(t){return new qy(t)})),this.register((function(t){return new Uy(t)})),this.register((function(t){return new Xy(t)})),this.register((function(t){return new Hy(t)})),this.register((function(t){return new By(t)})),this.register((function(t){return new Jy(t)}))}load(t,e,n,i){const r=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Dm.extractUrlBase(t),this.manager.itemStart(t);const o=function(e){i?i(e):console.error(e),r.manager.itemError(t),r.manager.itemEnd(t)},a=new hm(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){try{r.parse(n,s,(function(n){e(n),r.manager.itemEnd(t)}),o)}catch(Y_){o(Y_)}}),n,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let r;const s={},o={};if("string"===typeof t)r=t;else{const e=Dm.decodeText(new Uint8Array(t,0,4));if(e===Ky){try{s[zy.KHR_BINARY_GLTF]=new tx(t)}catch(c){return void(i&&i(c))}r=s[zy.KHR_BINARY_GLTF].content}else r=Dm.decodeText(new Uint8Array(t))}const a=JSON.parse(r);if(void 0===a.asset||a.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Ex(a,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const t=this.pluginCallbacks[h](l);o[t.name]=t,s[t.name]=!0}if(a.extensionsUsed)for(let h=0;h<a.extensionsUsed.length;++h){const t=a.extensionsUsed[h],e=a.extensionsRequired||[];switch(t){case zy.KHR_MATERIALS_UNLIT:s[t]=new Fy;break;case zy.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[t]=new rx;break;case zy.KHR_DRACO_MESH_COMPRESSION:s[t]=new ex(a,this.dracoLoader);break;case zy.KHR_TEXTURE_TRANSFORM:s[t]=new nx;break;case zy.KHR_MESH_QUANTIZATION:s[t]=new sx;break;default:e.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(o),l.parse(n,i)}parseAsync(t,e){const n=this;return new Promise((function(i,r){n.parse(t,e,i,r)}))}}function ky(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const zy={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class By{constructor(t){this.parser=t,this.name=zy.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const e=this.parser,n="light:"+t;let i=e.cache.get(n);if(i)return i;const r=e.json,s=r.extensions&&r.extensions[this.name]||{},o=s.lights||[],a=o[t];let l;const c=new Ln(16777215);void 0!==a.color&&c.fromArray(a.color);const h=void 0!==a.range?a.range:0;switch(a.type){case"directional":l=new Em(c),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Tm(c),l.distance=h;break;case"spot":l=new bm(c),l.distance=h,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,void 0!==a.intensity&&(l.intensity=a.intensity),l.name=e.createUniqueName(a.name||"light_"+t),i=Promise.resolve(l),e.cache.add(n,i),i}createNodeAttachment(t){const e=this,n=this.parser,i=n.json,r=i.nodes[t],s=r.extensions&&r.extensions[this.name]||{},o=s.light;return void 0===o?null:this._loadLight(o).then((function(t){return n._getNodeRef(e.cache,o,t)}))}}class Fy{constructor(){this.name=zy.KHR_MATERIALS_UNLIT}getMaterialType(){return rr}extendParams(t,e,n){const i=[];t.color=new Ln(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(t,"map",r.baseColorTexture,Ee))}return Promise.all(i)}}class Uy{constructor(t){this.parser=t,this.name=zy.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return void 0!==r&&(e.emissiveIntensity=r),Promise.resolve()}}class Vy{constructor(t){this.parser=t,this.name=zy.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser,n=e.json.materials[t];return n.extensions&&n.extensions[this.name]?Lp:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(e.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const t=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new mn(t,t)}return Promise.all(r)}}class Hy{constructor(t){this.parser=t,this.name=zy.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser,n=e.json.materials[t];return n.extensions&&n.extensions[this.name]?Lp:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(e.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(e.iridescenceIOR=s.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class Wy{constructor(t){this.parser=t,this.name=zy.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser,n=e.json.materials[t];return n.extensions&&n.extensions[this.name]?Lp:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new Ln(0,0,0),e.sheenRoughness=0,e.sheen=1;const s=i.extensions[this.name];return void 0!==s.sheenColorFactor&&e.sheenColor.fromArray(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&(e.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture,Ee)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class Gy{constructor(t){this.parser=t,this.name=zy.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser,n=e.json.materials[t];return n.extensions&&n.extensions[this.name]?Lp:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class jy{constructor(t){this.parser=t,this.name=zy.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser,n=e.json.materials[t];return n.extensions&&n.extensions[this.name]?Lp:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||0;const o=s.attenuationColor||[1,1,1];return e.attenuationColor=new Ln(o[0],o[1],o[2]),Promise.all(r)}}class qy{constructor(t){this.parser=t,this.name=zy.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser,n=e.json.materials[t];return n.extensions&&n.extensions[this.name]?Lp:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return e.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class Xy{constructor(t){this.parser=t,this.name=zy.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser,n=e.json.materials[t];return n.extensions&&n.extensions[this.name]?Lp:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return e.specularColor=new Ln(o[0],o[1],o[2]),void 0!==s.specularColorTexture&&r.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture,Ee)),Promise.all(r)}}class Yy{constructor(t){this.parser=t,this.name=zy.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,s)}}class Zy{constructor(t){this.parser=t,this.name=zy.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const t=n.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(t,s.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class Jy{constructor(t){this.name=zy.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const t=n.extensions[this.name],i=this.parser.getDependency("buffer",t.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(e){const n=t.byteOffset||0,i=t.byteLength||0,s=t.count,o=t.byteStride,a=new Uint8Array(e,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,o,a,t.mode,t.filter).then((function(t){return t.buffer})):r.ready.then((function(){const e=new ArrayBuffer(s*o);return r.decodeGltfBuffer(new Uint8Array(e),s,o,a,t.mode,t.filter),e}))}))}return null}}const Ky="glTF",$y=12,Qy={JSON:1313821514,BIN:5130562};class tx{constructor(t){this.name=zy.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,$y);if(this.header={magic:Dm.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Ky)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-$y,i=new DataView(t,$y);let r=0;while(r<n){const e=i.getUint32(r,!0);r+=4;const n=i.getUint32(r,!0);if(r+=4,n===Qy.JSON){const n=new Uint8Array(t,$y+r,e);this.content=Dm.decodeText(n)}else if(n===Qy.BIN){const n=$y+r;this.body=t.slice(n,n+e)}r+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ex{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=zy.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const n=this.json,i=this.dracoLoader,r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},a={},l={};for(const c in s){const t=mx[c]||c.toLowerCase();o[t]=s[c]}for(const c in t.attributes){const e=mx[c]||c.toLowerCase();if(void 0!==s[c]){const i=n.accessors[t.attributes[c]],r=hx[i.componentType];l[e]=r.name,a[e]=!0===i.normalized}}return e.getDependency("bufferView",r).then((function(t){return new Promise((function(e){i.decodeDracoFile(t,(function(t){for(const e in t.attributes){const n=t.attributes[e],i=a[e];void 0!==i&&(n.normalized=i)}e(t)}),o,l)}))}))}}class nx{constructor(){this.name=zy.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class ix extends Pp{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new Ln).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(t){for(const e in o)t.uniforms[e]=o[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(t){o.specular.value=t}},specularMap:{get:function(){return o.specularMap.value},set:function(t){o.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(t){o.glossiness.value=t}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(t){o.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class rx{constructor(){this.name=zy.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return ix}extendParams(t,e,n){const i=e.extensions[this.name];t.color=new Ln(1,1,1),t.opacity=1;const r=[];if(Array.isArray(i.diffuseFactor)){const e=i.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(t,"map",i.diffuseTexture,Ee)),t.emissive=new Ln(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new Ln(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const e=i.specularGlossinessTexture;r.push(n.assignTexture(t,"glossinessMap",e)),r.push(n.assignTexture(t,"specularMap",e,Ee))}return Promise.all(r)}createMaterial(t){const e=new ix(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=void 0===t.emissiveIntensity?1:t.emissiveIntensity,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=Le,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e}}class sx{constructor(){this.name=zy.KHR_MESH_QUANTIZATION}}class ox extends Wp{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i*3+i;for(let s=0;s!==i;s++)e[s]=n[r+s];return e}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=i-e,h=(n-e)/c,u=h*h,d=u*h,p=t*l,m=p-l,f=-2*d+3*u,g=d-u,v=1-f,y=g-u+h;for(let x=0;x!==o;x++){const t=s[m+x+o],e=s[m+x+a]*c,n=s[p+x+o],i=s[p+x]*c;r[x]=v*t+y*e+f*n+g*i}return r}}const ax=new Vn;class lx extends ox{interpolate_(t,e,n,i){const r=super.interpolate_(t,e,n,i);return ax.fromArray(r).normalize().toArray(r),r}}const cx={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},hx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ux={9728:dt,9729:ft,9984:pt,9985:gt,9986:mt,9987:vt},dx={33071:ht,33648:ut,10497:ct},px={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mx={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},fx={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},gx={CUBICSPLINE:void 0,LINEAR:ve,STEP:ge},vx={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function yx(t){return void 0===t["DefaultMaterial"]&&(t["DefaultMaterial"]=new Pp({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:f})),t["DefaultMaterial"]}function xx(t,e,n){for(const i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function bx(t,e){void 0!==e.extras&&("object"===typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function _x(t,e,n){let i=!1,r=!1,s=!1;for(let c=0,h=e.length;c<h;c++){const t=e[c];if(void 0!==t.POSITION&&(i=!0),void 0!==t.NORMAL&&(r=!0),void 0!==t.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(t);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const h=e[c];if(i){const e=void 0!==h.POSITION?n.getDependency("accessor",h.POSITION):t.attributes.position;o.push(e)}if(r){const e=void 0!==h.NORMAL?n.getDependency("accessor",h.NORMAL):t.attributes.normal;a.push(e)}if(s){const e=void 0!==h.COLOR_0?n.getDependency("accessor",h.COLOR_0):t.attributes.color;l.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){const n=e[0],o=e[1],a=e[2];return i&&(t.morphAttributes.position=n),r&&(t.morphAttributes.normal=o),s&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}function wx(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++)t.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Mx(t){const e=t.extensions&&t.extensions[zy.KHR_DRACO_MESH_COMPRESSION];let n;return n=e?"draco:"+e.bufferView+":"+e.indices+":"+Sx(e.attributes):t.indices+":"+Sx(t.attributes)+":"+t.mode,n}function Sx(t){let e="";const n=Object.keys(t).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function Tx(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ax(t){return t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"}class Ex{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new ky,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"===typeof createImageBitmap||n||i&&r<98?this.textureLoader=new dm(this.options.manager):this.textureLoader=new Um(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new hm(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){const s={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};xx(r,s,i),bx(s,i),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){t(s)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=e.length;i<r;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let i=0,r=t.length;i<r;i++){const e=t[i];void 0!==e.mesh&&(this._addNodeRef(this.meshCache,e.mesh),void 0!==e.skin&&(n[e.mesh].isSkinnedMesh=!0)),void 0!==e.camera&&this._addNodeRef(this.cameraCache,e.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone(),r=(t,e)=>{const n=this.associations.get(t);null!=n&&this.associations.set(e,n);for(const[i,s]of t.children.entries())r(s,e.children[i])};return r(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){const i=t(e[n]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const n=[];for(let i=0;i<e.length;i++){const r=t(e[i]);r&&n.push(r)}return n}getDependency(t,e){const n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":i=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":i=this.loadSkin(e);break;case"animation":i=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const n=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map((function(e,i){return n.getDependency(t,i)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[zy.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(t,r){n.load(Dm.resolveURL(e.uri,i.path),t,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const n=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+n)}))}loadAccessor(t){const e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(t){const r=t[0],s=px[i.type],o=hx[i.componentType],a=o.BYTES_PER_ELEMENT,l=a*s,c=i.byteOffset||0,h=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,u=!0===i.normalized;let d,p;if(h&&h!==l){const t=Math.floor(c/h),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+t+":"+i.count;let l=e.cache.get(n);l||(d=new o(r,t*h,i.count*h/a),l=new Fh(d,h/a),e.cache.add(n,l)),p=new Vh(l,s,c%h/a,u)}else d=null===r?new o(i.count*s):new o(r,c,i.count*s),p=new ar(d,s,u);if(void 0!==i.sparse){const e=px.SCALAR,n=hx[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(t[1],a,i.sparse.count*e),h=new o(t[2],l,i.sparse.count*s);null!==r&&(p=new ar(p.array.slice(),p.itemSize,p.normalized));for(let t=0,i=c.length;t<i;t++){const e=c[t];if(p.setX(e,h[t*s]),s>=2&&p.setY(e,h[t*s+1]),s>=3&&p.setZ(e,h[t*s+2]),s>=4&&p.setW(e,h[t*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(t){const e=this.json,n=this.options,i=e.textures[t],r=i.source,s=e.images[r];let o=this.textureLoader;if(s.uri){const t=n.manager.getHandler(s.uri);null!==t&&(o=t)}return this.loadTextureImage(t,r,o)}loadTextureImage(t,e,n){const i=this,r=this.json,s=r.textures[t],o=r.images[e],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(e,n).then((function(e){e.flipY=!1,s.name&&(e.name=s.name);const n=r.samplers||{},o=n[s.sampler]||{};return e.magFilter=ux[o.magFilter]||ft,e.minFilter=ux[o.minFilter]||vt,e.wrapS=dx[o.wrapS]||ct,e.wrapT=dx[o.wrapT]||ct,i.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(t,e){const n=this,i=this.json,r=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));const s=i.images[t],o=self.URL||self.webkitURL;let a=s.uri||"",l=!1;if(void 0!==s.bufferView)a=n.getDependency("bufferView",s.bufferView).then((function(t){l=!0;const e=new Blob([t],{type:s.mimeType});return a=o.createObjectURL(e),a}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const c=Promise.resolve(a).then((function(t){return new Promise((function(n,i){let s=n;!0===e.isImageBitmapLoader&&(s=function(t){const e=new kn(t);e.needsUpdate=!0,n(e)}),e.load(Dm.resolveURL(t,r.path),s,void 0,i)}))})).then((function(t){return!0===l&&o.revokeObjectURL(a),t.userData.mimeType=s.mimeType||Ax(s.uri),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),t}));return this.sourceCache[t]=c,c}assignTexture(t,e,n,i){const r=this;return this.getDependency("texture",n.index).then((function(s){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===e&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),r.extensions[zy.KHR_TEXTURE_TRANSFORM]){const t=void 0!==n.extensions?n.extensions[zy.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=r.associations.get(s);s=r.extensions[zy.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),r.associations.set(s,e)}}return void 0!==i&&(s.encoding=i),t[e]=s,s}))}assignFinalMaterial(t){const e=t.geometry;let n=t.material;const i=void 0===e.attributes.tangent,r=void 0!==e.attributes.color,s=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new Nu,ir.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new Su,ir.prototype.copy.call(e,n),e.color.copy(n.color),this.cache.add(t,e)),n=e}if(i||r||s){let t="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),i&&(t+="derivative-tangents:"),r&&(t+="vertex-colors:"),s&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),r&&(e.vertexColors=!0),s&&(e.flatShading=!0),i&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return Pp}loadMaterial(t){const e=this,n=this.json,i=this.extensions,r=n.materials[t];let s;const o={},a=r.extensions||{},l=[];if(a[zy.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=i[zy.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=t.getMaterialType(),l.push(t.extendParams(o,r,e))}else if(a[zy.KHR_MATERIALS_UNLIT]){const t=i[zy.KHR_MATERIALS_UNLIT];s=t.getMaterialType(),l.push(t.extendParams(o,r,e))}else{const n=r.pbrMetallicRoughness||{};if(o.color=new Ln(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;o.color.fromArray(t),o.opacity=t[3]}void 0!==n.baseColorTexture&&l.push(e.assignTexture(o,"map",n.baseColorTexture,Ee)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(e.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),l.push(e.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===r.doubleSided&&(o.side=v);const c=r.alphaMode||vx.OPAQUE;if(c===vx.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===vx.MASK&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==rr&&(l.push(e.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new mn(1,1),void 0!==r.normalTexture.scale)){const t=r.normalTexture.scale;o.normalScale.set(t,t)}return void 0!==r.occlusionTexture&&s!==rr&&(l.push(e.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==rr&&(o.emissive=(new Ln).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&s!==rr&&l.push(e.assignTexture(o,"emissiveMap",r.emissiveTexture,Ee)),Promise.all(l).then((function(){let n;return n=s===ix?i[zy.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new s(o),r.name&&(n.name=r.name),bx(n,r),e.associations.set(n,{materials:t}),r.extensions&&xx(i,n,r),n}))}createUniqueName(t){const e=ef.sanitizeNodeName(t||"");let n=e;for(let i=1;this.nodeNamesUsed[n];++i)n=e+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){const e=this,n=this.extensions,i=this.primitiveCache;function r(t){return n[zy.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return Lx(n,t,e)}))}const s=[];for(let o=0,a=t.length;o<a;o++){const n=t[o],a=Mx(n),l=i[a];if(l)s.push(l.promise);else{let t;t=n.extensions&&n.extensions[zy.KHR_DRACO_MESH_COMPRESSION]?r(n):Lx(new yr,n,e),i[a]={primitive:n,promise:t},s.push(t)}}return Promise.all(s)}loadMesh(t){const e=this,n=this.json,i=this.extensions,r=n.meshes[t],s=r.primitives,o=[];for(let a=0,l=s.length;a<l;a++){const t=void 0===s[a].material?yx(this.cache):this.getDependency("material",s[a].material);o.push(t)}return o.push(e.loadGeometries(s)),Promise.all(o).then((function(n){const o=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let h=0,u=a.length;h<u;h++){const n=a[h],c=s[h];let u;const d=o[h];if(c.mode===cx.TRIANGLES||c.mode===cx.TRIANGLE_STRIP||c.mode===cx.TRIANGLE_FAN||void 0===c.mode)u=!0===r.isSkinnedMesh?new du(n,d):new kr(n,d),!0!==u.isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),c.mode===cx.TRIANGLE_STRIP?u.geometry=Rx(u.geometry,Se):c.mode===cx.TRIANGLE_FAN&&(u.geometry=Rx(u.geometry,Te));else if(c.mode===cx.LINES)u=new Du(n,d);else if(c.mode===cx.LINE_STRIP)u=new Lu(n,d);else if(c.mode===cx.LINE_LOOP)u=new Ou(n,d);else{if(c.mode!==cx.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);u=new Uu(n,d)}Object.keys(u.geometry.morphAttributes).length>0&&wx(u,r),u.name=e.createUniqueName(r.name||"mesh_"+t),bx(u,r),c.extensions&&xx(i,u,c),e.assignFinalMaterial(u),l.push(u)}for(let i=0,r=l.length;i<r;i++)e.associations.set(l[i],{meshes:t,primitives:i});if(1===l.length)return l[0];const c=new Ah;e.associations.set(c,{meshes:t});for(let t=0,e=l.length;t<e;t++)c.add(l[t]);return c}))}loadCamera(t){let e;const n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new Yr(pn.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new Ja(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),bx(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))}loadAnimation(t){const e=this.json,n=e.animations[t],i=[],r=[],s=[],o=[],a=[];for(let l=0,c=n.channels.length;l<c;l++){const t=n.channels[l],e=n.samplers[t.sampler],c=t.target,h=c.node,u=void 0!==n.parameters?n.parameters[e.input]:e.input,d=void 0!==n.parameters?n.parameters[e.output]:e.output;i.push(this.getDependency("node",h)),r.push(this.getDependency("accessor",u)),s.push(this.getDependency("accessor",d)),o.push(e),a.push(c)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(a)]).then((function(e){const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=[];for(let t=0,n=i.length;t<n;t++){const e=i[t],n=r[t],c=s[t],h=o[t],u=a[t];if(void 0===e)continue;let d;switch(e.updateMatrix(),fx[u.path]){case fx.weights:d=Jp;break;case fx.rotation:d=$p;break;case fx.position:case fx.scale:default:d=tm;break}const p=e.name?e.name:e.uuid,m=void 0!==h.interpolation?gx[h.interpolation]:ve,f=[];fx[u.path]===fx.weights?e.traverse((function(t){t.morphTargetInfluences&&f.push(t.name?t.name:t.uuid)})):f.push(p);let g=c.array;if(c.normalized){const t=Tx(g.constructor),e=new Float32Array(g.length);for(let n=0,i=g.length;n<i;n++)e[n]=g[n]*t;g=e}for(let t=0,i=f.length;t<i;t++){const e=new d(f[t]+"."+fx[u.path],n.array,g,m);"CUBICSPLINE"===h.interpolation&&(e.createInterpolant=function(t){const e=this instanceof $p?lx:ox;return new e(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}const c=n.name?n.name:"animation_"+t;return new em(c,void 0,l)}))}createNodeMesh(t){const e=this.json,n=this,i=e.nodes[t];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(t){const e=n._getNodeRef(n.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,n=i.weights.length;e<n;e++)t.morphTargetInfluences[e]=i.weights[e]})),e}))}loadNode(t){const e=this.json,n=this.extensions,i=this,r=e.nodes[t],s=r.name?i.createUniqueName(r.name):"";return function(){const e=[],n=i._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return n&&e.push(n),void 0!==r.camera&&e.push(i.getDependency("camera",r.camera).then((function(t){return i._getNodeRef(i.cameraCache,r.camera,t)}))),i._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){let o;if(o=!0===r.isBone?new pu:e.length>1?new Ah:1===e.length?e[0]:new Gi,o!==e[0])for(let t=0,n=e.length;t<n;t++)o.add(e[t]);if(r.name&&(o.userData.name=r.name,o.name=s),bx(o,r),r.extensions&&xx(n,o,r),void 0!==r.matrix){const t=new xi;t.fromArray(r.matrix),o.applyMatrix4(t)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);return i.associations.has(o)||i.associations.set(o,{}),i.associations.get(o).nodes=t,o}))}loadScene(t){const e=this.json,n=this.extensions,i=this.json.scenes[t],r=this,s=new Ah;i.name&&(s.name=r.createUniqueName(i.name)),bx(s,i),i.extensions&&xx(n,s,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(Cx(o[l],s,e,r));return Promise.all(a).then((function(){const t=t=>{const e=new Map;for(const[n,i]of r.associations)(n instanceof ir||n instanceof kn)&&e.set(n,i);return t.traverse((t=>{const n=r.associations.get(t);null!=n&&e.set(t,n)})),e};return r.associations=t(s),s}))}}function Cx(t,e,n,i){const r=n.nodes[t];return i.getDependency("node",t).then((function(t){if(void 0===r.skin)return t;let e;return i.getDependency("skin",r.skin).then((function(t){e=t;const n=[];for(let r=0,s=e.joints.length;r<s;r++)n.push(i.getDependency("node",e.joints[r]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(!t.isMesh)return;const i=[],r=[];for(let s=0,o=n.length;s<o;s++){const t=n[s];if(t){i.push(t);const n=new xi;void 0!==e.inverseBindMatrices&&n.fromArray(e.inverseBindMatrices.array,16*s),r.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[s])}t.bind(new vu(i,r),t.matrixWorld)})),t}))})).then((function(t){e.add(t);const s=[];if(r.children){const e=r.children;for(let r=0,o=e.length;r<o;r++){const o=e[r];s.push(Cx(o,t,n,i))}}return Promise.all(s)}))}function Px(t,e,n){const i=e.attributes,r=new jn;if(void 0===i.POSITION)return;{const t=n.json.accessors[i.POSITION],e=t.min,s=t.max;if(void 0===e||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new Hn(e[0],e[1],e[2]),new Hn(s[0],s[1],s[2])),t.normalized){const e=Tx(hx[t.componentType]);r.min.multiplyScalar(e),r.max.multiplyScalar(e)}}const s=e.targets;if(void 0!==s){const t=new Hn,e=new Hn;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,o=i.max;if(void 0!==s&&void 0!==o){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),i.normalized){const t=Tx(hx[i.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(t)}t.boundingBox=r;const o=new hi;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=o}function Lx(t,e,n){const i=e.attributes,r=[];function s(e,i){return n.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(const o in i){const e=mx[o]||o.toLowerCase();e in t.attributes||r.push(s(i[o],e))}if(void 0!==e.indices&&!t.index){const i=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));r.push(i)}return bx(t,e),Px(t,e,n),Promise.all(r).then((function(){return void 0!==e.targets?_x(t,e.targets,n):t}))}function Rx(t,e){let n=t.getIndex();if(null===n){const e=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const i=n.count-2,r=[];if(e===Te)for(let o=1;o<=i;o++)r.push(n.getX(0)),r.push(n.getX(o)),r.push(n.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(r.push(n.getX(o)),r.push(n.getX(o+1)),r.push(n.getX(o+2))):(r.push(n.getX(o+2)),r.push(n.getX(o+1)),r.push(n.getX(o)));r.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(r),s}class Ix extends am{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(t,e,n,i){const r=this,s=new hm(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(n){try{e(r.parse(n))}catch(Y_){i?i(Y_):console.error(Y_),r.manager.itemError(t)}}),n,i)}parse(t){const e=this;function n(t,e){if(1!==t.nodeType)return;const s=x(t);let o=!1,m=null;switch(t.nodeName){case"svg":e=p(t,e);break;case"style":r(t);break;case"g":e=p(t,e);break;case"path":e=p(t,e),t.hasAttribute("d")&&(m=i(t));break;case"rect":e=p(t,e),m=a(t);break;case"polygon":e=p(t,e),m=l(t);break;case"polyline":e=p(t,e),m=c(t);break;case"circle":e=p(t,e),m=h(t);break;case"ellipse":e=p(t,e),m=u(t);break;case"line":e=p(t,e),m=d(t);break;case"defs":o=!0;break;case"use":e=p(t,e);const s=t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"",f=s.substring(1),g=t.viewportElement.getElementById(f);g?n(g,e):console.warn("SVGLoader: 'use node' references non-existent node id: "+f);break;default:}m&&(void 0!==e.fill&&"none"!==e.fill&&m.color.setStyle(e.fill),_(m,O),T.push(m),m.userData={node:t,style:e});const f=t.childNodes;for(let i=0;i<f.length;i++){const t=f[i];o&&"style"!==t.nodeName&&"defs"!==t.nodeName||n(t,e)}s&&(E.pop(),E.length>0?O.copy(E[E.length-1]):O.identity())}function i(t){const e=new _f,n=new mn,i=new mn,r=new mn;let o=!0,a=!1;const l=t.getAttribute("d"),c=l.match(/[a-df-z][^a-df-z]*/gi);for(let h=0,u=c.length;h<u;h++){const t=c[h],l=t.charAt(0),u=t.slice(1).trim();let d;switch(!0===o&&(a=!0,o=!1),l){case"M":d=f(u);for(let t=0,s=d.length;t<s;t+=2)n.x=d[t+0],n.y=d[t+1],i.x=n.x,i.y=n.y,0===t?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y),0===t&&r.copy(n);break;case"H":d=f(u);for(let t=0,s=d.length;t<s;t++)n.x=d[t],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===t&&!0===a&&r.copy(n);break;case"V":d=f(u);for(let t=0,s=d.length;t<s;t++)n.y=d[t],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===t&&!0===a&&r.copy(n);break;case"L":d=f(u);for(let t=0,s=d.length;t<s;t+=2)n.x=d[t+0],n.y=d[t+1],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===t&&!0===a&&r.copy(n);break;case"C":d=f(u);for(let t=0,s=d.length;t<s;t+=6)e.bezierCurveTo(d[t+0],d[t+1],d[t+2],d[t+3],d[t+4],d[t+5]),i.x=d[t+2],i.y=d[t+3],n.x=d[t+4],n.y=d[t+5],0===t&&!0===a&&r.copy(n);break;case"S":d=f(u);for(let t=0,s=d.length;t<s;t+=4)e.bezierCurveTo(m(n.x,i.x),m(n.y,i.y),d[t+0],d[t+1],d[t+2],d[t+3]),i.x=d[t+0],i.y=d[t+1],n.x=d[t+2],n.y=d[t+3],0===t&&!0===a&&r.copy(n);break;case"Q":d=f(u);for(let t=0,s=d.length;t<s;t+=4)e.quadraticCurveTo(d[t+0],d[t+1],d[t+2],d[t+3]),i.x=d[t+0],i.y=d[t+1],n.x=d[t+2],n.y=d[t+3],0===t&&!0===a&&r.copy(n);break;case"T":d=f(u);for(let t=0,s=d.length;t<s;t+=2){const s=m(n.x,i.x),o=m(n.y,i.y);e.quadraticCurveTo(s,o,d[t+0],d[t+1]),i.x=s,i.y=o,n.x=d[t+0],n.y=d[t+1],0===t&&!0===a&&r.copy(n)}break;case"A":d=f(u,[3,4],7);for(let t=0,o=d.length;t<o;t+=7){if(d[t+5]==n.x&&d[t+6]==n.y)continue;const o=n.clone();n.x=d[t+5],n.y=d[t+6],i.x=n.x,i.y=n.y,s(e,d[t],d[t+1],d[t+2],d[t+3],d[t+4],o,n),0===t&&!0===a&&r.copy(n)}break;case"m":d=f(u);for(let t=0,s=d.length;t<s;t+=2)n.x+=d[t+0],n.y+=d[t+1],i.x=n.x,i.y=n.y,0===t?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y),0===t&&r.copy(n);break;case"h":d=f(u);for(let t=0,s=d.length;t<s;t++)n.x+=d[t],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===t&&!0===a&&r.copy(n);break;case"v":d=f(u);for(let t=0,s=d.length;t<s;t++)n.y+=d[t],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===t&&!0===a&&r.copy(n);break;case"l":d=f(u);for(let t=0,s=d.length;t<s;t+=2)n.x+=d[t+0],n.y+=d[t+1],i.x=n.x,i.y=n.y,e.lineTo(n.x,n.y),0===t&&!0===a&&r.copy(n);break;case"c":d=f(u);for(let t=0,s=d.length;t<s;t+=6)e.bezierCurveTo(n.x+d[t+0],n.y+d[t+1],n.x+d[t+2],n.y+d[t+3],n.x+d[t+4],n.y+d[t+5]),i.x=n.x+d[t+2],i.y=n.y+d[t+3],n.x+=d[t+4],n.y+=d[t+5],0===t&&!0===a&&r.copy(n);break;case"s":d=f(u);for(let t=0,s=d.length;t<s;t+=4)e.bezierCurveTo(m(n.x,i.x),m(n.y,i.y),n.x+d[t+0],n.y+d[t+1],n.x+d[t+2],n.y+d[t+3]),i.x=n.x+d[t+0],i.y=n.y+d[t+1],n.x+=d[t+2],n.y+=d[t+3],0===t&&!0===a&&r.copy(n);break;case"q":d=f(u);for(let t=0,s=d.length;t<s;t+=4)e.quadraticCurveTo(n.x+d[t+0],n.y+d[t+1],n.x+d[t+2],n.y+d[t+3]),i.x=n.x+d[t+0],i.y=n.y+d[t+1],n.x+=d[t+2],n.y+=d[t+3],0===t&&!0===a&&r.copy(n);break;case"t":d=f(u);for(let t=0,s=d.length;t<s;t+=2){const s=m(n.x,i.x),o=m(n.y,i.y);e.quadraticCurveTo(s,o,n.x+d[t+0],n.y+d[t+1]),i.x=s,i.y=o,n.x=n.x+d[t+0],n.y=n.y+d[t+1],0===t&&!0===a&&r.copy(n)}break;case"a":d=f(u,[3,4],7);for(let t=0,o=d.length;t<o;t+=7){if(0==d[t+5]&&0==d[t+6])continue;const o=n.clone();n.x+=d[t+5],n.y+=d[t+6],i.x=n.x,i.y=n.y,s(e,d[t],d[t+1],d[t+2],d[t+3],d[t+4],o,n),0===t&&!0===a&&r.copy(n)}break;case"Z":case"z":e.currentPath.autoClose=!0,e.currentPath.curves.length>0&&(n.copy(r),e.currentPath.currentPoint.copy(n),o=!0);break;default:console.warn(t)}a=!1}return e}function r(t){if(t.sheet&&t.sheet.cssRules&&t.sheet.cssRules.length)for(let e=0;e<t.sheet.cssRules.length;e++){const n=t.sheet.cssRules[e];if(1!==n.type)continue;const i=n.selectorText.split(/,/gm).filter(Boolean).map((t=>t.trim()));for(let t=0;t<i.length;t++){const e=Object.fromEntries(Object.entries(n.style).filter((([,t])=>""!==t)));A[i[t]]=Object.assign(A[i[t]]||{},e)}}}function s(t,e,n,i,r,s,a,l){if(0==e||0==n)return void t.lineTo(l.x,l.y);i=i*Math.PI/180,e=Math.abs(e),n=Math.abs(n);const c=(a.x-l.x)/2,h=(a.y-l.y)/2,u=Math.cos(i)*c+Math.sin(i)*h,d=-Math.sin(i)*c+Math.cos(i)*h;let p=e*e,m=n*n;const f=u*u,g=d*d,v=f/p+g/m;if(v>1){const t=Math.sqrt(v);e*=t,n*=t,p=e*e,m=n*n}const y=p*g+m*f,x=(p*m-y)/y;let b=Math.sqrt(Math.max(0,x));r===s&&(b=-b);const _=b*e*d/n,w=-b*n*u/e,M=Math.cos(i)*_-Math.sin(i)*w+(a.x+l.x)/2,S=Math.sin(i)*_+Math.cos(i)*w+(a.y+l.y)/2,T=o(1,0,(u-_)/e,(d-w)/n),A=o((u-_)/e,(d-w)/n,(-u-_)/e,(-d-w)/n)%(2*Math.PI);t.currentPath.absellipse(M,S,e,n,T,T+A,0===s,i)}function o(t,e,n,i){const r=t*n+e*i,s=Math.sqrt(t*t+e*e)*Math.sqrt(n*n+i*i);let o=Math.acos(Math.max(-1,Math.min(1,r/s)));return t*i-e*n<0&&(o=-o),o}function a(t){const e=y(t.getAttribute("x")||0),n=y(t.getAttribute("y")||0),i=y(t.getAttribute("rx")||t.getAttribute("ry")||0),r=y(t.getAttribute("ry")||t.getAttribute("rx")||0),s=y(t.getAttribute("width")),o=y(t.getAttribute("height")),a=.448084975506,l=new _f;return l.moveTo(e+i,n),l.lineTo(e+s-i,n),0===i&&0===r||l.bezierCurveTo(e+s-i*a,n,e+s,n+r*a,e+s,n+r),l.lineTo(e+s,n+o-r),0===i&&0===r||l.bezierCurveTo(e+s,n+o-r*a,e+s-i*a,n+o,e+s-i,n+o),l.lineTo(e+i,n+o),0===i&&0===r||l.bezierCurveTo(e+i*a,n+o,e,n+o-r*a,e,n+o-r),l.lineTo(e,n+r),0===i&&0===r||l.bezierCurveTo(e,n+r*a,e+i*a,n,e+i,n),l}function l(t){function e(t,e,n){const s=y(e),o=y(n);0===r?i.moveTo(s,o):i.lineTo(s,o),r++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,i=new _f;let r=0;return t.getAttribute("points").replace(n,e),i.currentPath.autoClose=!0,i}function c(t){function e(t,e,n){const s=y(e),o=y(n);0===r?i.moveTo(s,o):i.lineTo(s,o),r++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,i=new _f;let r=0;return t.getAttribute("points").replace(n,e),i.currentPath.autoClose=!1,i}function h(t){const e=y(t.getAttribute("cx")||0),n=y(t.getAttribute("cy")||0),i=y(t.getAttribute("r")||0),r=new gd;r.absarc(e,n,i,0,2*Math.PI);const s=new _f;return s.subPaths.push(r),s}function u(t){const e=y(t.getAttribute("cx")||0),n=y(t.getAttribute("cy")||0),i=y(t.getAttribute("rx")||0),r=y(t.getAttribute("ry")||0),s=new gd;s.absellipse(e,n,i,r,0,2*Math.PI);const o=new _f;return o.subPaths.push(s),o}function d(t){const e=y(t.getAttribute("x1")||0),n=y(t.getAttribute("y1")||0),i=y(t.getAttribute("x2")||0),r=y(t.getAttribute("y2")||0),s=new _f;return s.moveTo(e,n),s.lineTo(i,r),s.currentPath.autoClose=!1,s}function p(t,e){e=Object.assign({},e);let n={};if(t.hasAttribute("class")){const e=t.getAttribute("class").split(/\s/).filter(Boolean).map((t=>t.trim()));for(let t=0;t<e.length;t++)n=Object.assign(n,A["."+e[t]])}function i(i,r,s){void 0===s&&(s=function(t){return t.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),t}),t.hasAttribute(i)&&(e[r]=s(t.getAttribute(i))),n[i]&&(e[r]=s(n[i])),t.style&&""!==t.style[i]&&(e[r]=s(t.style[i]))}function r(t){return Math.max(0,Math.min(1,y(t)))}function s(t){return Math.max(0,y(t))}return t.hasAttribute("id")&&(n=Object.assign(n,A["#"+t.getAttribute("id")])),i("fill","fill"),i("fill-opacity","fillOpacity",r),i("fill-rule","fillRule"),i("opacity","opacity",r),i("stroke","stroke"),i("stroke-opacity","strokeOpacity",r),i("stroke-width","strokeWidth",s),i("stroke-linejoin","strokeLineJoin"),i("stroke-linecap","strokeLineCap"),i("stroke-miterlimit","strokeMiterLimit",s),i("visibility","visibility"),e}function m(t,e){return t-(e-t)}function f(t,e,n){if("string"!==typeof t)throw new TypeError("Invalid input: "+typeof t);const i={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},r=0,s=1,o=2,a=3;let l=r,c=!0,h="",u="";const d=[];function p(t,e,n){const i=new SyntaxError('Unexpected character "'+t+'" at index '+e+".");throw i.partial=n,i}function m(){""!==h&&(""===u?d.push(Number(h)):d.push(Number(h)*Math.pow(10,Number(u)))),h="",u=""}let f;const g=t.length;for(let v=0;v<g;v++)if(f=t[v],Array.isArray(e)&&e.includes(d.length%n)&&i.FLAGS.test(f))l=s,h=f,m();else{if(l===r){if(i.WHITESPACE.test(f))continue;if(i.DIGIT.test(f)||i.SIGN.test(f)){l=s,h=f;continue}if(i.POINT.test(f)){l=o,h=f;continue}i.COMMA.test(f)&&(c&&p(f,v,d),c=!0)}if(l===s){if(i.DIGIT.test(f)){h+=f;continue}if(i.POINT.test(f)){h+=f,l=o;continue}if(i.EXP.test(f)){l=a;continue}i.SIGN.test(f)&&1===h.length&&i.SIGN.test(h[0])&&p(f,v,d)}if(l===o){if(i.DIGIT.test(f)){h+=f;continue}if(i.EXP.test(f)){l=a;continue}i.POINT.test(f)&&"."===h[h.length-1]&&p(f,v,d)}if(l===a){if(i.DIGIT.test(f)){u+=f;continue}if(i.SIGN.test(f)){if(""===u){u+=f;continue}1===u.length&&i.SIGN.test(u)&&p(f,v,d)}}i.WHITESPACE.test(f)?(m(),l=r,c=!1):i.COMMA.test(f)?(m(),l=r,c=!0):i.SIGN.test(f)?(m(),l=s,h=f):i.POINT.test(f)?(m(),l=o,h=f):p(f,v,d)}return m(),d}const g=["mm","cm","in","pt","pc","px"],v={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function y(t){let n,i="px";if("string"===typeof t||t instanceof String)for(let e=0,r=g.length;e<r;e++){const n=g[e];if(t.endsWith(n)){i=n,t=t.substring(0,t.length-n.length);break}}return"px"===i&&"px"!==e.defaultUnit?n=v["in"][e.defaultUnit]/e.defaultDPI:(n=v[i][e.defaultUnit],n<0&&(n=v[i]["in"]*e.defaultDPI)),n*parseFloat(t)}function x(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;const e=b(t);return E.length>0&&e.premultiply(E[E.length-1]),O.copy(e),E.push(e),e}function b(t){const e=new fn,n=C;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))){const n=y(t.getAttribute("x")),i=y(t.getAttribute("y"));e.translate(n,i)}if(t.hasAttribute("transform")){const i=t.getAttribute("transform").split(")");for(let t=i.length-1;t>=0;t--){const r=i[t].trim();if(""===r)continue;const s=r.indexOf("("),o=r.length;if(s>0&&s<o){const t=r.slice(0,s),e=f(r.slice(s+1));switch(n.identity(),t){case"translate":if(e.length>=1){const t=e[0];let i=0;e.length>=2&&(i=e[1]),n.translate(t,i)}break;case"rotate":if(e.length>=1){let t=0,i=0,r=0;t=-e[0]*Math.PI/180,e.length>=3&&(i=e[1],r=e[2]),P.identity().translate(-i,-r),L.identity().rotate(t),R.multiplyMatrices(L,P),P.identity().translate(i,r),n.multiplyMatrices(P,R)}break;case"scale":if(e.length>=1){const t=e[0];let i=t;e.length>=2&&(i=e[1]),n.scale(t,i)}break;case"skewX":1===e.length&&n.set(1,Math.tan(e[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===e.length&&n.set(1,0,0,Math.tan(e[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===e.length&&n.set(e[0],e[2],e[4],e[1],e[3],e[5],0,0,1);break}}e.premultiply(n)}}return e}function _(t,e){function n(t){D.set(t.x,t.y,1).applyMatrix3(e),t.set(D.x,D.y)}const i=w(e),r=t.subPaths;for(let s=0,o=r.length;s<o;s++){const t=r[s],o=t.curves;for(let r=0;r<o.length;r++){const t=o[r];t.isLineCurve?(n(t.v1),n(t.v2)):t.isCubicBezierCurve?(n(t.v0),n(t.v1),n(t.v2),n(t.v3)):t.isQuadraticBezierCurve?(n(t.v0),n(t.v1),n(t.v2)):t.isEllipseCurve&&(i&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),I.set(t.aX,t.aY),n(I),t.aX=I.x,t.aY=I.y,t.xRadius*=M(e),t.yRadius*=S(e))}}}function w(t){return 0!==t.elements[1]||0!==t.elements[3]}function M(t){const e=t.elements;return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function S(t){const e=t.elements;return Math.sqrt(e[3]*e[3]+e[4]*e[4])}const T=[],A={},E=[],C=new fn,P=new fn,L=new fn,R=new fn,I=new mn,D=new Hn,O=new fn,N=(new DOMParser).parseFromString(t,"image/svg+xml");n(N.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});const k={paths:T,xml:N.documentElement};return k}static createShapes(t){const e=999999999,n={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},i={loc:n.ORIGIN,t:0};function r(t,e,r,o){const a=t.x,l=e.x,c=r.x,h=o.x,u=t.y,d=e.y,p=r.y,m=o.y,f=(h-c)*(u-p)-(m-p)*(a-c),g=(l-a)*(u-p)-(d-u)*(a-c),v=(m-p)*(l-a)-(h-c)*(d-u),y=f/v,x=g/v;if(0===v&&0!==f||y<=0||y>=1||x<0||x>1)return null;if(0===f&&0===v){for(let c=0;c<2;c++){if(s(0===c?r:o,t,e),i.loc==n.ORIGIN){const t=0===c?r:o;return{x:t.x,y:t.y,t:i.t}}if(i.loc==n.BETWEEN){const t=+(a+i.t*(l-a)).toPrecision(10),e=+(u+i.t*(d-u)).toPrecision(10);return{x:t,y:e,t:i.t}}}return null}{for(let a=0;a<2;a++)if(s(0===a?r:o,t,e),i.loc==n.ORIGIN){const t=0===a?r:o;return{x:t.x,y:t.y,t:i.t}}const c=+(a+y*(l-a)).toPrecision(10),h=+(u+y*(d-u)).toPrecision(10);return{x:c,y:h,t:y}}}function s(t,e,r){const s=r.x-e.x,o=r.y-e.y,a=t.x-e.x,l=t.y-e.y,c=s*l-a*o;if(t.x===e.x&&t.y===e.y)return i.loc=n.ORIGIN,void(i.t=0);if(t.x===r.x&&t.y===r.y)return i.loc=n.DESTINATION,void(i.t=1);if(c<-Number.EPSILON)return void(i.loc=n.LEFT);if(c>Number.EPSILON)return void(i.loc=n.RIGHT);if(s*a<0||o*l<0)return void(i.loc=n.BEHIND);if(Math.sqrt(s*s+o*o)<Math.sqrt(a*a+l*l))return void(i.loc=n.BEYOND);let h;h=0!==s?a/s:l/o,i.loc=n.BETWEEN,i.t=h}function o(t,e){const n=[],i=[];for(let s=1;s<t.length;s++){const o=t[s-1],a=t[s];for(let t=1;t<e.length;t++){const s=e[t-1],l=e[t],c=r(o,a,s,l);null!==c&&void 0===n.find((t=>t.t<=c.t+Number.EPSILON&&t.t>=c.t-Number.EPSILON))&&(n.push(c),i.push(new mn(c.x,c.y)))}}return i}function a(t,e,n){const i=new mn;e.getCenter(i);const r=[];return n.forEach((e=>{if(e.boundingBox.containsPoint(i)){const n=o(t,e.points);n.forEach((t=>{r.push({identifier:e.identifier,isCW:e.isCW,point:t})}))}})),r.sort(((t,e)=>t.point.x-e.point.x)),r}function l(t,e,n,i,r){null!==r&&void 0!==r&&""!==r||(r="nonzero");const s=new mn;t.boundingBox.getCenter(s);const o=[new mn(n,s.y),new mn(i,s.y)],l=a(o,t.boundingBox,e);l.sort(((t,e)=>t.point.x-e.point.x));const c=[],h=[];l.forEach((e=>{e.identifier===t.identifier?c.push(e):h.push(e)}));const u=c[0].point.x,d=[];let p=0;while(p<h.length&&h[p].point.x<u)d.length>0&&d[d.length-1]===h[p].identifier?d.pop():d.push(h[p].identifier),p++;if(d.push(t.identifier),"evenodd"===r){const e=d.length%2===0,n=d[d.length-2];return{identifier:t.identifier,isHole:e,for:n}}if("nonzero"===r){let n=!0,i=null,r=null;for(let t=0;t<d.length;t++){const s=d[t];n?(r=e[s].isCW,n=!1,i=s):r!==e[s].isCW&&(r=e[s].isCW,n=!0)}return{identifier:t.identifier,isHole:n,for:i}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}let c=0,h=e,u=-e,d=t.subPaths.map((t=>{const n=t.getPoints();let i=-e,r=e,s=-e,o=e;for(let e=0;e<n.length;e++){const t=n[e];t.y>i&&(i=t.y),t.y<r&&(r=t.y),t.x>s&&(s=t.x),t.x<o&&(o=t.x)}return u<=s&&(u=s+1),h>=o&&(h=o-1),{curves:t.curves,points:n,isCW:lp.isClockWise(n),identifier:c++,boundingBox:new uf(new mn(o,r),new mn(s,i))}}));d=d.filter((t=>t.points.length>1));const p=d.map((e=>l(e,d,h,u,t.userData?.style.fillRule))),m=[];return d.forEach((t=>{const e=p[t.identifier];if(!e.isHole){const e=new Pd;e.curves=t.curves;const n=p.filter((e=>e.isHole&&e.for===t.identifier));n.forEach((t=>{const n=d[t.identifier],i=new gd;i.curves=n.curves,e.holes.push(i)})),m.push(e)}})),m}static getStrokeStyle(t,e,n,i,r){return t=void 0!==t?t:1,e=void 0!==e?e:"#000",n=void 0!==n?n:"miter",i=void 0!==i?i:"butt",r=void 0!==r?r:4,{strokeColor:e,strokeWidth:t,strokeLineJoin:n,strokeLineCap:i,strokeMiterLimit:r}}static pointsToStroke(t,e,n,i){const r=[],s=[],o=[];if(0===Ix.pointsToStrokeWithBuffers(t,e,n,i,r,s,o))return null;const a=new yr;return a.setAttribute("position",new hr(r,3)),a.setAttribute("normal",new hr(s,3)),a.setAttribute("uv",new hr(o,2)),a}static pointsToStrokeWithBuffers(t,e,n,i,r,s,o,a){const l=new mn,c=new mn,h=new mn,u=new mn,d=new mn,p=new mn,m=new mn,f=new mn,g=new mn,v=new mn,y=new mn,x=new mn,b=new mn,_=new mn,w=new mn,M=new mn,S=new mn;n=void 0!==n?n:12,i=void 0!==i?i:.001,a=void 0!==a?a:0,t=Y(t);const T=t.length;if(T<2)return 0;const A=t[0].equals(t[T-1]);let E,C,P=t[0];const L=e.strokeWidth/2,R=1/(T-1);let I,D,O,N,k=0,z=!1,B=0,F=3*a,U=2*a;V(t[0],t[1],l).multiplyScalar(L),f.copy(t[0]).sub(l),g.copy(t[0]).add(l),v.copy(f),y.copy(g);for(let Z=1;Z<T;Z++){E=t[Z],C=Z===T-1?A?t[1]:void 0:t[Z+1];const n=l;if(V(P,E,n),h.copy(n).multiplyScalar(L),x.copy(E).sub(h),b.copy(E).add(h),I=k+R,D=!1,void 0!==C){V(E,C,c),h.copy(c).multiplyScalar(L),_.copy(E).sub(h),w.copy(E).add(h),O=!0,h.subVectors(C,P),n.dot(h)<0&&(O=!1),1===Z&&(z=O),h.subVectors(C,E),h.normalize();const t=Math.abs(n.dot(h));if(t>Number.EPSILON){const n=L/t;h.multiplyScalar(-n),u.subVectors(E,P),d.copy(u).setLength(n).add(h),M.copy(d).negate();const i=d.length(),r=u.length();u.divideScalar(r),p.subVectors(C,E);const s=p.length();switch(p.divideScalar(s),u.dot(M)<r&&p.dot(M)<s&&(D=!0),S.copy(d).add(E),M.add(E),N=!1,D?O?(w.copy(M),b.copy(M)):(_.copy(M),x.copy(M)):G(),e.strokeLineJoin){case"bevel":j(O,D,I);break;case"round":q(O,D),O?W(E,x,_,I,0):W(E,w,b,I,1);break;case"miter":case"miter-clip":default:const t=L*e.strokeMiterLimit/i;if(t<1){if("miter-clip"!==e.strokeLineJoin){j(O,D,I);break}q(O,D),O?(p.subVectors(S,x).multiplyScalar(t).add(x),m.subVectors(S,_).multiplyScalar(t).add(_),H(x,I,0),H(p,I,0),H(E,I,.5),H(E,I,.5),H(p,I,0),H(m,I,0),H(E,I,.5),H(m,I,0),H(_,I,0)):(p.subVectors(S,b).multiplyScalar(t).add(b),m.subVectors(S,w).multiplyScalar(t).add(w),H(b,I,1),H(p,I,1),H(E,I,.5),H(E,I,.5),H(p,I,1),H(m,I,1),H(E,I,.5),H(m,I,1),H(w,I,1))}else D?(O?(H(g,k,1),H(f,k,0),H(S,I,0),H(g,k,1),H(S,I,0),H(M,I,1)):(H(g,k,1),H(f,k,0),H(S,I,1),H(f,k,0),H(M,I,0),H(S,I,1)),O?_.copy(S):w.copy(S)):O?(H(x,I,0),H(S,I,0),H(E,I,.5),H(E,I,.5),H(S,I,0),H(_,I,0)):(H(b,I,1),H(S,I,1),H(E,I,.5),H(E,I,.5),H(S,I,1),H(w,I,1)),N=!0;break}}else G()}else G();A||Z!==T-1||X(t[0],v,y,O,!0,k),k=I,P=E,f.copy(_),g.copy(w)}if(A){if(D&&r){let t=S,e=M;z!==O&&(t=M,e=S),O?(N||z)&&(e.toArray(r,0),e.toArray(r,9),N&&t.toArray(r,3)):!N&&z||(e.toArray(r,3),e.toArray(r,9),N&&t.toArray(r,0))}}else X(E,x,b,O,!1,I);return B;function V(t,e,n){return n.subVectors(e,t),n.set(-n.y,n.x).normalize()}function H(t,e,n){r&&(r[F]=t.x,r[F+1]=t.y,r[F+2]=0,s&&(s[F]=0,s[F+1]=0,s[F+2]=1),F+=3,o&&(o[U]=e,o[U+1]=n,U+=2)),B+=3}function W(t,e,i,r,s){l.copy(e).sub(t).normalize(),c.copy(i).sub(t).normalize();let o=Math.PI;const a=l.dot(c);Math.abs(a)<1&&(o=Math.abs(Math.acos(a))),o/=n,h.copy(e);for(let l=0,c=n-1;l<c;l++)u.copy(h).rotateAround(t,o),H(h,r,s),H(u,r,s),H(t,r,.5),h.copy(u);H(u,r,s),H(i,r,s),H(t,r,.5)}function G(){H(g,k,1),H(f,k,0),H(x,I,0),H(g,k,1),H(x,I,1),H(b,I,0)}function j(t,e,n){e?t?(H(g,k,1),H(f,k,0),H(x,I,0),H(g,k,1),H(x,I,0),H(M,I,1),H(x,n,0),H(_,n,0),H(M,n,.5)):(H(g,k,1),H(f,k,0),H(b,I,1),H(f,k,0),H(M,I,0),H(b,I,1),H(b,n,1),H(w,n,0),H(M,n,.5)):t?(H(x,n,0),H(_,n,0),H(E,n,.5)):(H(b,n,1),H(w,n,0),H(E,n,.5))}function q(t,e){e&&(t?(H(g,k,1),H(f,k,0),H(x,I,0),H(g,k,1),H(x,I,0),H(M,I,1),H(x,k,0),H(E,I,.5),H(M,I,1),H(E,I,.5),H(_,k,0),H(M,I,1)):(H(g,k,1),H(f,k,0),H(b,I,1),H(f,k,0),H(M,I,0),H(b,I,1),H(b,k,1),H(M,I,0),H(E,I,.5),H(E,I,.5),H(M,I,0),H(w,k,1)))}function X(t,n,i,s,o,a){switch(e.strokeLineCap){case"round":o?W(t,i,n,a,.5):W(t,n,i,a,.5);break;case"square":if(o)l.subVectors(n,t),c.set(l.y,-l.x),h.addVectors(l,c).add(t),u.subVectors(c,l).add(t),s?(h.toArray(r,3),u.toArray(r,0),u.toArray(r,9)):(h.toArray(r,3),h.toArray(r,9),u.toArray(r,0));else{l.subVectors(i,t),c.set(l.y,-l.x),h.addVectors(l,c).add(t),u.subVectors(c,l).add(t);const e=r.length;s?(h.toArray(r,e-3),u.toArray(r,e-6),u.toArray(r,e-12)):(h.toArray(r,e-6),u.toArray(r,e-3),u.toArray(r,e-12))}break;case"butt":default:break}}function Y(t){let e=!1;for(let r=1,s=t.length-1;r<s;r++)if(t[r].distanceTo(t[r+1])<i){e=!0;break}if(!e)return t;const n=[];n.push(t[0]);for(let r=1,s=t.length-1;r<s;r++)t[r].distanceTo(t[r+1])>=i&&n.push(t[r]);return n.push(t[t.length-1]),n}}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Dx{constructor(t,e){this.cache=t,this.textureAnisotropy=e}get fileLoader(){return this._fileLoader||(this._fileLoader=new hm),this._fileLoader}get imageLoader(){return this._imgLoader||(this._imgLoader=new um),this._imgLoader}get svgLoader(){return this._svgLoader||(this._svgLoader=new Ix),this._svgLoader}get textureLoader(){return this._textureLoader||(this._textureLoader=new dm),this._textureLoader}get objectLoader(){return this._objectLoader||(this._objectLoader=new km),this._objectLoader}get gltfLoader(){return this._gltfLoader||(this._gltfLoader=new Ny),this._gltfLoader}get fbxLoader(){return this._fbxLoader||(this._fbxLoader=new dy),this._fbxLoader}async preload(t,e){return this.cache.add(t,e),new Promise((t=>{const n=/\.fbx$|\.glb$|\.gltf$/.test(e),i=/\.jpe?g$|\.png$/.test(e);i?this.textureLoader.load(e,(e=>t(e))):(n&&this.fileLoader.setResponseType("arraybuffer"),this.fileLoader.load(e,(e=>t(e))))}))}async textureAtlas(t,e,n="JSONHash"){let i=JSON.parse(await this.file(e));const r=i.textures;if(r){const t=i.textures[0].frames;let e={frames:{}};t.forEach((t=>{e={...e,frames:{...e.frames,[t.filename]:{frame:t.frame,rotated:t.rotated,sourceSize:t.sourceSize,spriteSourceSize:t.spriteSourceSize,trimmed:t.trimmed}}}})),i=e}const s={texture:await this.texture(t),json:i};return s}file(t){const e=this.cache.get(t);return t=e||t,new Promise((e=>{this.fileLoader.load(t,(t=>e(t)))}))}svg(t){const e=this.cache.get(t);return t=e||t,new Promise((e=>{this.svgLoader.load(t,(t=>e(t)))}))}texture(t){const e=/^data:image\/[\S]+;base64,/gm.test(t);if(!e){const e=this.cache.get(t);t=e||t}return new Promise((e=>{this.textureLoader.load(t,(t=>{t.anisotropy=this.textureAnisotropy,t.needsUpdate=!0,e(t)}))}))}object(t){const e=this.cache.get(t);return t=e||t,new Promise((e=>{this.objectLoader.load(t,(t=>{e(t)}))}))}gltf(t){const e=this.cache.get(t);return t=e||t,new Promise((e=>{this.gltfLoader.load(t,(t=>{e(t)}))}))}fbx(t){const e=this.cache.get(t);return t=e||t,new Promise((e=>{this.fbxLoader.load(t,(t=>{e(t)}))}))}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Ox extends Gi{constructor(t,e,n,i){super(),this.scene=t,this.light=e,this.size=n,this.color=i,this.geo=new xp(n||.2,16,8),this.mat=new rr({color:i||e.color}),this.mesh=new kr(this.geo,this.mat),this.add(this.mesh),e.add(this)}dispose(){this.mesh.geometry.dispose(),Array.isArray(this.mesh.material)?this.mesh.material.forEach((t=>t.dispose())):this.mesh.material.dispose(),this.remove(this.mesh)}update(){}}class Nx{constructor(t){this.scene=t}get helper(){return{directionalLightHelper:(t,e,n)=>{const i=new bf(t,e,n);return this.scene.add(i),i},spotLightHelper:(t,e)=>{const n=new gf(t,e);return this.scene.add(n),n},pointLightHelper:(t,e,n)=>new Ox(this.scene,t,e,n)}}directionalLight(t={}){const{color:e=16777215,intensity:n=1}=t,i=new Em(e,n);return i.castShadow=!0,this.scene.add(i),i}hemisphereLight(t={}){const{skyColor:e=16777215,groundColor:n=16777215,intensity:i=1}=t,r=new mm(e,n,i);return this.scene.add(r),r}ambientLight(t={}){const{color:e=16777215,intensity:n=1}=t,i=new Cm(e,n);return this.scene.add(i),i}pointLight(t={}){const{color:e=16777215,intensity:n=1,distance:i=0,decay:r=1}=t,s=new Tm(e,n,i,r);return s.castShadow=!0,this.scene.add(s),s}spotLight(t={}){const{color:e=16777215,intensity:n=1,distance:i=0,angle:r=Math.PI/8,penumbra:s=0,decay:o=1}=t,a=new bm(e,n,i,r,s,o);return a.castShadow=!0,this.scene.add(a),a}rectAreaLight(t={}){const{color:e=16777215,intensity:n=1,width:i=10,height:r=10}=t,s=new Pm(e,n,i,r);return this.scene.add(s),s}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class kx extends kr{constructor(t,e){super(t,e),this.isExtendedMesh=!0,this.isGroup=!1,this.vector3=new Hn,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}}const zx=new Map,Bx=5,Fx=(t,e=!1)=>{if(zx.has(t)){const e=zx.get(t);if("undefined"===typeof e)return;if(e>=Bx)return;zx.set(t,e+1)}else zx.set(t,1);e?console.error(`%c [enable3d] ${t} `,"background: #222; color: #bada55"):console.warn(`%c [enable3d] ${t} `,"background: #222; color: #bada55")};class Ux{constructor(){this._defaultMaterial=new Op({color:13421772})}get(){return this._defaultMaterial}}var Vx=Ux;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Hx{constructor(t){this.scene=t,this.isHeadless="headless"===t,this.defaultMaterial=new Vx}get make(){return{plane:(t={},e={})=>this.makePlane(t,e),box:(t={},e={})=>this.makeBox(t,e),sphere:(t={},e={})=>this.makeSphere(t,e),cylinder:(t={},e={})=>this.makeCylinder(t,e),cone:(t={},e={})=>this.makeCone(t,e),torus:(t={},e={})=>this.makeTorus(t,e),extrude:(t,e={})=>this.makeExtrude(t,e)}}get add(){return{mesh:t=>this.addMesh(t),existing:t=>this.addExisting(t),plane:(t={},e={})=>this.addPlane(t,e),box:(t={},e={})=>this.addBox(t,e),ground:(t,e={})=>this.addGround(t,e),sphere:(t={},e={})=>this.addSphere(t,e),cylinder:(t={},e={})=>this.addCylinder(t,e),cone:(t={},e={})=>this.addCone(t,e),torus:(t={},e={})=>this.addTorus(t,e),extrude:(t,e={})=>this.addExtrude(t,e),material:(t={})=>this.addMaterial(t)}}addExisting(...t){"headless"!==this.scene&&this.scene.add(...t)}addMesh(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.addExisting(t[e]);else this.addExisting(t);return this}createMesh(t,e,n){const{x:i=0,y:r=0,z:s=0}=n;let o;switch(!Array.isArray(e)&&e.type){case"LineBasicMaterial":o=new Lu(t,e);break;case"PointsMaterial":o=new Uu(t,e);break;default:o=new kx(t,e);break}return o.position.set(i,r,s),o.castShadow=o.receiveShadow=!0,o}makeExtrude(t,e){const{x:n,y:i,z:r,name:s,shape:o,autoCenter:a=!0,breakable:l=!1,...c}=t,{depth:h=1,bevelEnabled:u=!1}=c,d=new up(o,{depth:h,bevelEnabled:u,...c}),p=this.addMaterial(e),m=this.createMesh(d,p,{x:n,y:i,z:r});return a&&m.geometry.center(),m.name=s||`body_id_${m.id}`,m.shape="extrude",m}addExtrude(t,e={}){const n=this.makeExtrude(t,e);return this.addExisting(n),n}makePlane(t,e){const{x:n,y:i,z:r,name:s,breakable:o=!1,...a}=t,l=new cs(a.width||1,a.height||1,a.widthSegments||1,a.heightSegments||1),c=this.addMaterial(e);c.side=v;const h=this.createMesh(l,c,{x:n,y:i,z:r});return h.name=s||`body_id_${h.id}`,h.shape="plane",h}addPlane(t,e){const n=this.makePlane(t,e);return this.addExisting(n),n}makeSphere(t,e){const{x:n,y:i,z:r,name:s,breakable:o=!1,...a}=t,l=new xp(a.radius||1,a.widthSegments||16,a.heightSegments||12,a.phiStart||void 0,a.phiLength||void 0,a.thetaStart||void 0,a.thetaLength||void 0),c=this.addMaterial(e),h=this.createMesh(l,c,{x:n,y:i,z:r});return h.name=s||`body_id_${h.id}`,h.shape="sphere",h}addSphere(t={},e={}){const n=this.makeSphere(t,e);return this.addExisting(n),n}makeBox(t,e){const{x:n,y:i,z:r,name:s,breakable:o=!1,...a}=t,l=new Fr(a.width||1,a.height||1,a.depth||1,a.widthSegments||void 0,a.heightSegments||void 0,a.depthSegments||void 0),c=this.addMaterial(e),h=this.createMesh(l,c,{x:n,y:i,z:r});return h.name=s||`body_id_${h.id}`,h.shape="box",h}addBox(t={},e={}){const n=this.makeBox(t,e);return this.addExisting(n),n}addGround(t,e={}){const n=this.makeBox(t,e);return n.rotateX(pn.degToRad(90)),this.addExisting(n),n}makeCylinder(t={},e={}){const{x:n,y:i,z:r,name:s,breakable:o=!1,...a}=t,l=new bd(a.radiusTop||1,a.radiusBottom||1,a.height||1,a.radiusSegments||void 0,a.heightSegments||void 0,a.openEnded||void 0,a.thetaStart||void 0,a.thetaLength||void 0),c=this.addMaterial(e),h=this.createMesh(l,c,{x:n,y:i,z:r});return h.name=s||`body_id_${h.id}`,h.shape="cylinder",h}addCylinder(t={},e={}){const n=this.makeCylinder(t,e);return this.addExisting(n),n}makeCone(t={},e={}){const{x:n,y:i,z:r,name:s,breakable:o=!1,...a}=t,l=new _d(a.radius||1,a.height||1,a.radiusSegments||8,a.heightSegments||1,a.openEnded||!1,a.thetaStart||0,a.thetaLength||2*Math.PI),c=this.addMaterial(e),h=this.createMesh(l,c,{x:n,y:i,z:r});return h.name=s||`body_id_${h.id}`,h.shape="cone",h}addCone(t={},e={}){const n=this.makeCone(t,e);return this.addExisting(n),n}makeTorus(t={},e={}){const{x:n,y:i,z:r,name:s,breakable:o=!1,...a}=t,l=new _p(a.radius||void 0,a.tube||void 0,a.radialSegments||void 0,a.tubularSegments||void 0,a.arc||void 0),c=this.addMaterial(e),h=this.createMesh(l,c,{x:n,y:i,z:r});return h.name=s||`body_id_${h.id}`,h.shape="torus",h}addTorus(t={},e={}){const n=this.makeTorus(t,e);return this.addExisting(n),n}addMaterial(t={}){const e=Object.keys(t)[0];let n;if("headless"===this.scene)return this.defaultMaterial.get();switch(e){case"basic":n=new rr(t.basic);break;case"normal":n=new Dp(t.normal);break;case"standard":n=new Pp(t.standard);break;case"lambert":n=new Op(t.lambert);break;case"phong":n=new Rp(t.phong);break;case"physical":"undefined"!==typeof t.physical?n=new Lp(t.physical):(Fx("You need to pass parameters to the physical material. (Fallback to default material)"),n=this.defaultMaterial.get());break;case"toon":n=new Ip(t.toon);break;case"line":n=new Su(t.line);break;case"points":n=new Nu(t.points);break;case"custom":n=t.custom||this.defaultMaterial.get();break;default:n=this.defaultMaterial.get();break}return n}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2022 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Wx{constructor(t){this.scene=t}add(t,e={}){const n=this.make(t,e);return n?this.scene.add(n):console.warn("Could not make heightmap"),n}make(t,e={}){const{image:n}=t,{width:i,height:r}=n,{colorScale:s,heightScale:o=100}=e,a=document.createElement("canvas");a.width=i,a.height=r;const l=a.getContext("2d");if(!l)return;l.drawImage(t.image,0,0);const c=l.getImageData(0,0,i,r),h=new cs(10,10,i-1,r-1);let u={color:13421772,side:v};s&&(u={...u,vertexColors:!0});const d=new Rp(u),p=new kx(h,d);p.receiveShadow=p.castShadow=!0,p.shape="concave";const m=h.attributes.position.array;for(let f=0;f<m.length;f++){const t=c.data[4*f]/o;m[3*f+2]=t}if(s){const t=h.attributes.position.count;h.setAttribute("color",new ar(new Float32Array(3*t),3));const e=new Ln,n=h.attributes.position,i=h.attributes.color;let r,o;for(let a=0;a<t;a++)r=n.getZ(a),o=s(r).hsl(),e.setHSL(o[0]/360,o[1],o[2],o[3]),i.setXYZ(a,e.r,e.g,e.b)}return p.rotateX(-Math.PI/2),p.updateMatrix(),h.computeVertexNormals(),p.name="heightmap",p}}const Gx={type:"change"},jx={type:"start"},qx={type:"end"};class Xx extends Fe{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Hn,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:a.ROTATE,MIDDLE:a.DOLLY,RIGHT:a.PAN},this.touches={ONE:l.ROTATE,TWO:l.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",rt),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Gx),n.update(),r=i.NONE},this.update=function(){const e=new Hn,a=(new Vn).setFromUnitVectors(t.up,new Hn(0,1,0)),l=a.clone().invert(),p=new Hn,m=new Vn,f=2*Math.PI;return function(){const t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(a),o.setFromVector3(e),n.autoRotate&&r===i.NONE&&A(S()),n.enableDamping?(o.theta+=c.theta*n.dampingFactor,o.phi+=c.phi*n.dampingFactor):(o.theta+=c.theta,o.phi+=c.phi);let g=n.minAzimuthAngle,v=n.maxAzimuthAngle;return isFinite(g)&&isFinite(v)&&(g<-Math.PI?g+=f:g>Math.PI&&(g-=f),v<-Math.PI?v+=f:v>Math.PI&&(v-=f),o.theta=g<=v?Math.max(g,Math.min(v,o.theta)):o.theta>(g+v)/2?Math.max(g,o.theta):Math.min(v,o.theta)),o.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=h,o.radius=Math.max(n.minDistance,Math.min(n.maxDistance,o.radius)),!0===n.enableDamping?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),e.setFromSpherical(o),e.applyQuaternion(l),t.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),u.set(0,0,0)),h=1,!!(d||p.distanceToSquared(n.object.position)>s||8*(1-m.dot(n.object.quaternion))>s)&&(n.dispatchEvent(Gx),p.copy(n.object.position),m.copy(n.object.quaternion),d=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",at),n.domElement.removeEventListener("pointerdown",K),n.domElement.removeEventListener("pointercancel",tt),n.domElement.removeEventListener("wheel",it),n.domElement.removeEventListener("pointermove",$),n.domElement.removeEventListener("pointerup",Q),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",rt)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const s=1e-6,o=new cf,c=new cf;let h=1;const u=new Hn;let d=!1;const p=new mn,m=new mn,f=new mn,g=new mn,v=new mn,y=new mn,x=new mn,b=new mn,_=new mn,w=[],M={};function S(){return 2*Math.PI/60/60*n.autoRotateSpeed}function T(){return Math.pow(.95,n.zoomSpeed)}function A(t){c.theta-=t}function E(t){c.phi-=t}const C=function(){const t=new Hn;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),u.add(t)}}(),P=function(){const t=new Hn;return function(e,i){!0===n.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),u.add(t)}}(),L=function(){const t=new Hn;return function(e,i){const r=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;t.copy(s).sub(n.target);let o=t.length();o*=Math.tan(n.object.fov/2*Math.PI/180),C(2*e*o/r.clientHeight,n.object.matrix),P(2*i*o/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(C(e*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),P(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function R(t){n.object.isPerspectiveCamera?h/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(t){n.object.isPerspectiveCamera?h*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function D(t){p.set(t.clientX,t.clientY)}function O(t){x.set(t.clientX,t.clientY)}function N(t){g.set(t.clientX,t.clientY)}function k(t){m.set(t.clientX,t.clientY),f.subVectors(m,p).multiplyScalar(n.rotateSpeed);const e=n.domElement;A(2*Math.PI*f.x/e.clientHeight),E(2*Math.PI*f.y/e.clientHeight),p.copy(m),n.update()}function z(t){b.set(t.clientX,t.clientY),_.subVectors(b,x),_.y>0?R(T()):_.y<0&&I(T()),x.copy(b),n.update()}function B(t){v.set(t.clientX,t.clientY),y.subVectors(v,g).multiplyScalar(n.panSpeed),L(y.x,y.y),g.copy(v),n.update()}function F(t){t.deltaY<0?I(T()):t.deltaY>0&&R(T()),n.update()}function U(t){let e=!1;switch(t.code){case n.keys.UP:L(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:L(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:L(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:L(-n.keyPanSpeed,0),e=!0;break}e&&(t.preventDefault(),n.update())}function V(){if(1===w.length)p.set(w[0].pageX,w[0].pageY);else{const t=.5*(w[0].pageX+w[1].pageX),e=.5*(w[0].pageY+w[1].pageY);p.set(t,e)}}function H(){if(1===w.length)g.set(w[0].pageX,w[0].pageY);else{const t=.5*(w[0].pageX+w[1].pageX),e=.5*(w[0].pageY+w[1].pageY);g.set(t,e)}}function W(){const t=w[0].pageX-w[1].pageX,e=w[0].pageY-w[1].pageY,n=Math.sqrt(t*t+e*e);x.set(0,n)}function G(){n.enableZoom&&W(),n.enablePan&&H()}function j(){n.enableZoom&&W(),n.enableRotate&&V()}function q(t){if(1==w.length)m.set(t.pageX,t.pageY);else{const e=ut(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);m.set(n,i)}f.subVectors(m,p).multiplyScalar(n.rotateSpeed);const e=n.domElement;A(2*Math.PI*f.x/e.clientHeight),E(2*Math.PI*f.y/e.clientHeight),p.copy(m)}function X(t){if(1===w.length)v.set(t.pageX,t.pageY);else{const e=ut(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);v.set(n,i)}y.subVectors(v,g).multiplyScalar(n.panSpeed),L(y.x,y.y),g.copy(v)}function Y(t){const e=ut(t),i=t.pageX-e.x,r=t.pageY-e.y,s=Math.sqrt(i*i+r*r);b.set(0,s),_.set(0,Math.pow(b.y/x.y,n.zoomSpeed)),R(_.y),x.copy(b)}function Z(t){n.enableZoom&&Y(t),n.enablePan&&X(t)}function J(t){n.enableZoom&&Y(t),n.enableRotate&&q(t)}function K(t){!1!==n.enabled&&(0===w.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",$),n.domElement.addEventListener("pointerup",Q)),lt(t),"touch"===t.pointerType?st(t):et(t))}function $(t){!1!==n.enabled&&("touch"===t.pointerType?ot(t):nt(t))}function Q(t){ct(t),0===w.length&&(n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",$),n.domElement.removeEventListener("pointerup",Q)),n.dispatchEvent(qx),r=i.NONE}function tt(t){ct(t)}function et(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case a.DOLLY:if(!1===n.enableZoom)return;O(t),r=i.DOLLY;break;case a.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;N(t),r=i.PAN}else{if(!1===n.enableRotate)return;D(t),r=i.ROTATE}break;case a.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;D(t),r=i.ROTATE}else{if(!1===n.enablePan)return;N(t),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(jx)}function nt(t){switch(r){case i.ROTATE:if(!1===n.enableRotate)return;k(t);break;case i.DOLLY:if(!1===n.enableZoom)return;z(t);break;case i.PAN:if(!1===n.enablePan)return;B(t);break}}function it(t){!1!==n.enabled&&!1!==n.enableZoom&&r===i.NONE&&(t.preventDefault(),n.dispatchEvent(jx),F(t),n.dispatchEvent(qx))}function rt(t){!1!==n.enabled&&!1!==n.enablePan&&U(t)}function st(t){switch(ht(t),w.length){case 1:switch(n.touches.ONE){case l.ROTATE:if(!1===n.enableRotate)return;V(),r=i.TOUCH_ROTATE;break;case l.PAN:if(!1===n.enablePan)return;H(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case l.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;G(),r=i.TOUCH_DOLLY_PAN;break;case l.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;j(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(jx)}function ot(t){switch(ht(t),r){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;q(t),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;X(t),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;Z(t),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;J(t),n.update();break;default:r=i.NONE}}function at(t){!1!==n.enabled&&t.preventDefault()}function lt(t){w.push(t)}function ct(t){delete M[t.pointerId];for(let e=0;e<w.length;e++)if(w[e].pointerId==t.pointerId)return void w.splice(e,1)}function ht(t){let e=M[t.pointerId];void 0===e&&(e=new mn,M[t.pointerId]=e),e.set(t.pageX,t.pageY)}function ut(t){const e=t.pointerId===w[0].pointerId?w[1]:w[0];return M[e.pointerId]}n.domElement.addEventListener("contextmenu",at),n.domElement.addEventListener("pointerdown",K),n.domElement.addEventListener("pointercancel",tt),n.domElement.addEventListener("wheel",it,{passive:!1}),this.update()}}class Yx{constructor(t,e,n,i,r,s,o){this.scene=t,this.renderer=e,this.camera=n,this.lights=i,this.physics=r,this.load=s,this.factories=o}async warpSpeed(...t){let e={};const n=t.filter((t=>/^-\w+/.test(t))),i=n.length>0;if((0===t.length||i)&&(t=["light","camera","lookAtCenter","ground","grid","orbitControls","fog","sky"]),i){const e=n.map((t=>t.substr(1)));e.forEach((e=>{const n=t.indexOf(e);t.splice(n,1)}))}if(t.includes("sky")){const t=["varying vec3 vWorldPosition;","","void main() {","","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","","}"].join("\n"),e=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","","varying vec3 vWorldPosition;","","void main() {","","float h = normalize( vWorldPosition + offset ).y;","gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );","","}"].join("\n"),n={topColor:{value:new Ln(30719)},bottomColor:{value:new Ln(15595007)},offset:{value:33},exponent:{value:.6}};var r=new xp(500,32,15),s=new qr({uniforms:n,vertexShader:t,fragmentShader:e,side:g}),o=new kr(r,s);this.scene.add(o)}if(t.includes("camera")&&(this.camera.position.set(0,6,12),e={camera:this.camera,...e}),t.includes("light")){const t=.4,n=this.lights.hemisphereLight({skyColor:16777215,groundColor:0,intensity:t}),i=this.lights.ambientLight({color:16777215,intensity:t}),r=this.lights.directionalLight({color:16777215,intensity:t});r.position.set(100,200,50);const s=20;r.shadow.camera.top=s,r.shadow.camera.bottom=-s,r.shadow.camera.left=-s,r.shadow.camera.right=s,r.shadow.mapSize.set(1024,1024);const o={ambientLight:i,directionalLight:r,hemisphereLight:n};e={lights:o,...e}}if(t.includes("lookAtCenter")&&this.camera.lookAt(this.scene.position),t.includes("ground")){const n=t.includes("grid"),i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOnAAADusBZ+q87AAAAJtJREFUeJzt0EENwDAAxLDbNP6UOxh+NEYQ5dl2drFv286598GrA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAu37AD8eaBH5JQdVbAAAAAElFTkSuQmCC",r=await this.load.texture(i);r.wrapS=r.wrapT=ct,r.repeat.set(21,21);const s={name:"ground",width:21,height:21,depth:1,y:-.5},o={phong:{map:n?r:null,color:16777215}};let a;window.__loadPhysics?(a=this.physics.add.ground(s,o),a.body.setRestitution(1)):a=this.factories.add.ground(s,o),a.receiveShadow=!0,e={ground:a,...e}}if(t.includes("orbitControls")){const t=new Xx(this.camera,document.getElementById("enable3d-phaser-canvas")||this.renderer.domElement);e={orbitControls:t,...e}}return e}}class Zx{constructor(){this._mixers=[]}animationMixer(t){const e=new sf(t);return this.mixers.add(e),e}get mixers(){return{create:t=>this.animationMixer(t),add:t=>this._mixers.push(t),get:()=>this._mixers,update:t=>this._mixers?.forEach((e=>e.update(t/1e3)))}}}var Jx=Zx;class Kx extends kr{constructor(t,e={}){super(t),this.isReflector=!0,this.type="Reflector",this.camera=new Yr;const n=this,i=void 0!==e.color?new Ln(e.color):new Ln(8355711),r=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.shader||Kx.ReflectorShader,l=void 0!==e.multisample?e.multisample:4,c=new is,h=new Hn,u=new Hn,d=new Hn,p=new xi,m=new Hn(0,0,-1),f=new zn,g=new Hn,v=new Hn,y=new zn,x=new xi,b=this.camera,_=new Bn(r,s,{samples:l,type:Tt}),w=new qr({uniforms:Wr.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});w.uniforms["tDiffuse"].value=_.texture,w.uniforms["color"].value=i,w.uniforms["textureMatrix"].value=x,this.material=w,this.onBeforeRender=function(t,e,i){if(u.setFromMatrixPosition(n.matrixWorld),d.setFromMatrixPosition(i.matrixWorld),p.extractRotation(n.matrixWorld),h.set(0,0,1),h.applyMatrix4(p),g.subVectors(u,d),g.dot(h)>0)return;g.reflect(h).negate(),g.add(u),p.extractRotation(i.matrixWorld),m.set(0,0,-1),m.applyMatrix4(p),m.add(d),v.subVectors(u,m),v.reflect(h).negate(),v.add(u),b.position.copy(g),b.up.set(0,1,0),b.up.applyMatrix4(p),b.up.reflect(h),b.lookAt(v),b.far=i.far,b.updateMatrixWorld(),b.projectionMatrix.copy(i.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(b.projectionMatrix),x.multiply(b.matrixWorldInverse),x.multiply(n.matrixWorld),c.setFromNormalAndCoplanarPoint(h,u),c.applyMatrix4(b.matrixWorldInverse),f.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const r=b.projectionMatrix;y.x=(Math.sign(f.x)+r.elements[8])/r.elements[0],y.y=(Math.sign(f.y)+r.elements[9])/r.elements[5],y.z=-1,y.w=(1+r.elements[10])/r.elements[14],f.multiplyScalar(2/f.dot(y)),r.elements[2]=f.x,r.elements[6]=f.y,r.elements[10]=f.z+1-o,r.elements[14]=f.w,n.visible=!1;const s=t.getRenderTarget(),a=t.xr.enabled,l=t.shadowMap.autoUpdate,w=t.outputEncoding,M=t.toneMapping;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.outputEncoding=Ae,t.toneMapping=K,t.setRenderTarget(_),t.state.buffers.depth.setMask(!0),!1===t.autoClear&&t.clear(),t.render(e,b),t.xr.enabled=a,t.shadowMap.autoUpdate=l,t.outputEncoding=w,t.toneMapping=M,t.setRenderTarget(s);const S=i.viewport;void 0!==S&&t.state.viewport(S),n.visible=!0},this.getRenderTarget=function(){return _},this.dispose=function(){_.dispose(),n.material.dispose()}}}Kx.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\n\t\t}"};class $x extends kr{constructor(t,e={}){super(t),this.isRefractor=!0,this.type="Refractor",this.camera=new Yr;const n=this,i=void 0!==e.color?new Ln(e.color):new Ln(8355711),r=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.shader||$x.RefractorShader,l=void 0!==e.multisample?e.multisample:4,c=this.camera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;const h=new is,u=new xi,d=new Bn(r,s,{samples:l,type:Tt});this.material=new qr({uniforms:Wr.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,transparent:!0}),this.material.uniforms["color"].value=i,this.material.uniforms["tDiffuse"].value=d.texture,this.material.uniforms["textureMatrix"].value=u;const p=function(){const t=new Hn,e=new Hn,i=new xi,r=new Hn,s=new Hn;return function(o){return t.setFromMatrixPosition(n.matrixWorld),e.setFromMatrixPosition(o.matrixWorld),r.subVectors(t,e),i.extractRotation(n.matrixWorld),s.set(0,0,1),s.applyMatrix4(i),r.dot(s)<0}}(),m=function(){const t=new Hn,e=new Hn,i=new Vn,r=new Hn;return function(){n.matrixWorld.decompose(e,i,r),t.set(0,0,1).applyQuaternion(i).normalize(),t.negate(),h.setFromNormalAndCoplanarPoint(t,e)}}(),f=function(){const t=new is,e=new zn,n=new zn;return function(i){c.matrixWorld.copy(i.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(i.projectionMatrix),c.far=i.far,t.copy(h),t.applyMatrix4(c.matrixWorldInverse),e.set(t.normal.x,t.normal.y,t.normal.z,t.constant);const r=c.projectionMatrix;n.x=(Math.sign(e.x)+r.elements[8])/r.elements[0],n.y=(Math.sign(e.y)+r.elements[9])/r.elements[5],n.z=-1,n.w=(1+r.elements[10])/r.elements[14],e.multiplyScalar(2/e.dot(n)),r.elements[2]=e.x,r.elements[6]=e.y,r.elements[10]=e.z+1-o,r.elements[14]=e.w}}();function g(t){u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(t.projectionMatrix),u.multiply(t.matrixWorldInverse),u.multiply(n.matrixWorld)}function v(t,e,i){n.visible=!1;const r=t.getRenderTarget(),s=t.xr.enabled,o=t.shadowMap.autoUpdate,a=t.outputEncoding,l=t.toneMapping;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.outputEncoding=Ae,t.toneMapping=K,t.setRenderTarget(d),!1===t.autoClear&&t.clear(),t.render(e,c),t.xr.enabled=s,t.shadowMap.autoUpdate=o,t.outputEncoding=a,t.toneMapping=l,t.setRenderTarget(r);const h=i.viewport;void 0!==h&&t.state.viewport(h),n.visible=!0}this.onBeforeRender=function(t,e,n){!0!==n.userData.refractor&&!0!==!p(n)&&(m(),g(n),f(n),v(t,e,n))},this.getRenderTarget=function(){return d},this.dispose=function(){d.dispose(),n.material.dispose()}}}$x.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec4 vUv;\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\n\t\t}"};class Qx extends kr{constructor(t,e={}){super(t),this.isWater=!0,this.type="Water";const n=this,i=void 0!==e.color?new Ln(e.color):new Ln(16777215),r=e.textureWidth||512,s=e.textureHeight||512,o=e.clipBias||0,a=e.flowDirection||new mn(1,0),l=e.flowSpeed||.03,c=e.reflectivity||.02,h=e.scale||1,u=e.shader||Qx.WaterShader,d=new dm,p=e.flowMap||void 0,m=e.normalMap0||d.load("textures/water/Water_1_M_Normal.jpg"),f=e.normalMap1||d.load("textures/water/Water_2_M_Normal.jpg"),g=.15,v=.5*g,y=new xi,x=new Vm;if(void 0===Kx)return void console.error("THREE.Water: Required component Reflector not found.");if(void 0===$x)return void console.error("THREE.Water: Required component Refractor not found.");const b=new Kx(t,{textureWidth:r,textureHeight:s,clipBias:o}),_=new $x(t,{textureWidth:r,textureHeight:s,clipBias:o});function w(t){y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(t.projectionMatrix),y.multiply(t.matrixWorldInverse),y.multiply(n.matrixWorld)}function M(){const t=x.getDelta(),e=n.material.uniforms["config"];e.value.x+=l*t,e.value.y=e.value.x+v,e.value.x>=g?(e.value.x=0,e.value.y=v):e.value.y>=g&&(e.value.y=e.value.y-g)}b.matrixAutoUpdate=!1,_.matrixAutoUpdate=!1,this.material=new qr({uniforms:Wr.merge([Ha.fog,u.uniforms]),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,transparent:!0,fog:!0}),void 0!==p?(this.material.defines.USE_FLOWMAP="",this.material.uniforms["tFlowMap"]={type:"t",value:p}):this.material.uniforms["flowDirection"]={type:"v2",value:a},m.wrapS=m.wrapT=ct,f.wrapS=f.wrapT=ct,this.material.uniforms["tReflectionMap"].value=b.getRenderTarget().texture,this.material.uniforms["tRefractionMap"].value=_.getRenderTarget().texture,this.material.uniforms["tNormalMap0"].value=m,this.material.uniforms["tNormalMap1"].value=f,this.material.uniforms["color"].value=i,this.material.uniforms["reflectivity"].value=c,this.material.uniforms["textureMatrix"].value=y,this.material.uniforms["config"].value.x=0,this.material.uniforms["config"].value.y=v,this.material.uniforms["config"].value.z=v,this.material.uniforms["config"].value.w=h,this.onBeforeRender=function(t,e,i){w(i),M(),n.visible=!1,b.matrixWorld.copy(n.matrixWorld),_.matrixWorld.copy(n.matrixWorld),b.onBeforeRender(t,e,i),_.onBeforeRender(t,e,i),n.visible=!0}}}Qx.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new zn}},vertexShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tvCoord = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvToEye = cameraPosition - worldPosition.xyz;\n\n\t\t\tvec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tuniform sampler2D tReflectionMap;\n\t\tuniform sampler2D tRefractionMap;\n\t\tuniform sampler2D tNormalMap0;\n\t\tuniform sampler2D tNormalMap1;\n\n\t\t#ifdef USE_FLOWMAP\n\t\t\tuniform sampler2D tFlowMap;\n\t\t#else\n\t\t\tuniform vec2 flowDirection;\n\t\t#endif\n\n\t\tuniform vec3 color;\n\t\tuniform float reflectivity;\n\t\tuniform vec4 config;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tfloat flowMapOffset0 = config.x;\n\t\t\tfloat flowMapOffset1 = config.y;\n\t\t\tfloat halfCycle = config.z;\n\t\t\tfloat scale = config.w;\n\n\t\t\tvec3 toEye = normalize( vToEye );\n\n\t\t\t// determine flow direction\n\t\t\tvec2 flow;\n\t\t\t#ifdef USE_FLOWMAP\n\t\t\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n\t\t\t#else\n\t\t\t\tflow = flowDirection;\n\t\t\t#endif\n\t\t\tflow.x *= - 1.0;\n\n\t\t\t// sample normal maps (distort uvs with flowdata)\n\t\t\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n\t\t\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n\t\t\t// linear interpolate to get the final normal color\n\t\t\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n\t\t\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n\t\t\t// calculate normal vector\n\t\t\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n\n\t\t\t// calculate the fresnel term to blend reflection and refraction maps\n\t\t\tfloat theta = max( dot( toEye, normal ), 0.0 );\n\t\t\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n\n\t\t\t// calculate final uv coords\n\t\t\tvec3 coord = vCoord.xyz / vCoord.w;\n\t\t\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n\n\t\t\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n\t\t\tvec4 refractColor = texture2D( tRefractionMap, uv );\n\n\t\t\t// multiply water color with the mix of both textures\n\t\t\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}"};const tb=(t,e,n={})=>{const{width:i=20,height:r=20,x:s=0,y:o=0,z:a=0,color:l="#ffffff",scale:c=4,flowX:h=1,flowY:u=1,normalMap0:d,normalMap1:p}=n,m=new cs(i,r),f=new Pp({color:30654,transparent:!0,opacity:.8}),g=new kr(m,f);g.position.set(s,o,a),g.rotation.x=-.5*Math.PI,t.add(g);const v=new cs(i,r),y=new Qx(v,{color:l,scale:c,flowDirection:new mn(h,u),textureWidth:1024,textureHeight:1024,normalMap0:d,normalMap1:p,encoding:e.outputEncoding});return y.position.set(s,o+.1,a),y.rotation.x=-.5*Math.PI,t.add(y),{ground:g,water:y}};class eb{constructor(t,e,n){this.scene=t,this.renderer=e,this.factories=n}water(t={}){tb(this.scene,this.renderer,t)}textureCube(t){6!==t.length&&Fx("You need to pass 6 urls to textureCube()");const e=new nb;return t.forEach(((t,n)=>{t.wrapS=t.wrapT=ct;const i=this.factories.add.material({phong:{map:t}});e.materials[n]=i})),e}}class nb{constructor(){this.materials=new Array(6)}get texture(){return{left:this.getTexture(0),right:this.getTexture(1),up:this.getTexture(2),down:this.getTexture(3),front:this.getTexture(4),back:this.getTexture(5)}}getTexture(t){return this.materials[t].map}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class ib{constructor(t,e){this.camera=t,this.renderer=e}fromSVGtoShape(t){if(t){const e=new Ix,n=[];return e.parse(t).paths.forEach((t=>{Ix.createShapes(t).forEach((t=>{n.push(t)}))})),n}return[]}from3dto2d(t){const e=new Hn(t.x,t.y,t.z),n=this.renderer.domElement;this.camera.updateMatrixWorld(),e.project(this.camera);const i=Math.round((e.x+1)*(n.width/2)),r=Math.round((1-e.y)*(n.height/2));return new mn(i,r)}from2dto3d(t,e,n){if(!this.tmpPlane){const t=new cs(1e4,1e4),e=new rr({transparent:!0,opacity:.25});this.tmpPlane=new kr(t,e),this.tmpPlane.name="_tmp_raycast_plane"}let i;this.tmpRaycaster||(this.tmpRaycaster=new of),this.tmpVector3||(this.tmpVector3=new Hn),this.tmpPlane.setRotationFromEuler(this.camera.rotation);const r=this.camera.position;this.tmpPlane.position.set(r.x,r.y,r.z),this.camera.getWorldDirection(this.tmpVector3),this.tmpPlane.position.add(this.tmpVector3.clone().multiplyScalar(n)),this.tmpPlane.updateMatrix(),this.tmpPlane.updateMatrixWorld(!0),this.tmpRaycaster.setFromCamera({x:t,y:e},this.camera);const s=this.tmpRaycaster.intersectObjects([this.tmpPlane]);return"_tmp_raycast_plane"===s[0]?.object.name&&(i=s[0].point),i}}var rb=n(5795);
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class sb{constructor(t,e){this.physics=t,this.ammo=e,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.impact=[],this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new Pi,this.tmpQuaternion=new Vn,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new rb.Events,this.name=e.name}destructor(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}setupEventEmitter(){"undefined"===typeof this.eventEmitter&&(this.eventEmitter=new rb.Events)}get needUpdate(){return this._needUpdate}set needUpdate(t){!t&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=t}onUpdateEvent(t,e=!1){this.setupEventEmitter(),this._emitUpdateEvents=!0,e?this.eventEmitter.once("update",(()=>{t()})):this.eventEmitter.on("update",(()=>{t()}))}get on(){return{update:t=>this.onUpdateEvent(t),collision:t=>this.onCollision(t)}}get once(){return{update:t=>this.onUpdateEvent(t,!0)}}onCollision(t){this.checkCollisions=!0,this.physics.collisionEvents.on("collision",(e=>{const{bodies:n,event:i}=e;n[0].name===this.name?t(n[1],i):n[1].name===this.name&&t(n[0],i)}))}transform(){const t=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(t)}refresh(){const t=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(t)}setRotation(t,e,n){const i=this.tmpEuler.set(t,e,n),r=this.tmpQuaternion.set(0,0,0,1);r.setFromEuler(i),this.tmpBtQuaternion.setValue(0,0,0,1);const s=this.tmpBtQuaternion;s.setValue(r.x,r.y,r.z,r.w);const o=this.physics.worldTransform;o.setRotation(s)}get rotation(){let t,e,n;const i=this.physics.worldTransform,r=i.getRotation();let s=this.tmpQuaternion.set(r.x(),r.y(),r.z(),r.w());s.w>1&&(s=s.normalize());const o=2*Math.acos(s.w),a=Math.sqrt(1-s.w*s.w);return a<.001?(t=s.x,e=s.y,n=s.z):(t=s.x/a,e=s.y/a,n=s.z/a),{x:t*o,y:e*o,z:n*o}}get quaternion(){const t=this.physics.worldTransform,e=t.getRotation();return{x:e.x(),y:e.y(),z:e.z(),w:e.w()}}setPosition(t,e,n){const i=this.physics.worldTransform;i.getOrigin().setValue(t,e,n)}get position(){const t=this.physics.worldTransform;return{x:t.getOrigin().x(),y:t.getOrigin().y(),z:t.getOrigin().z()}}get velocity(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}get angularVelocity(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}setVelocity(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityX(t){this.tmpBtVector3.setValue(t,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityY(t){this.tmpBtVector3.setValue(this.velocity.x,t,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityZ(t){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,t),this.ammo.setLinearVelocity(this.tmpBtVector3)}setAngularVelocity(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityX(t){this.tmpBtVector3.setValue(t,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityY(t){this.tmpBtVector3.setValue(this.angularVelocity.x,t,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityZ(t){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,t),this.ammo.setAngularVelocity(this.tmpBtVector3)}applyForce(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceX(t){this.tmpBtVector3.setValue(t,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceY(t){this.tmpBtVector3.setValue(0,t,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceZ(t){this.tmpBtVector3.setValue(0,0,t),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralForce(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.applyCentralForce(this.tmpBtVector3)}applyCentralImpulse(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralLocalForce(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}applyImpulse(t,e){this.tmpBtVector3.setValue(t.x||0,t.y||0,t.z||0),this.tmpBtVector3_1.setValue(e.x||0,e.y||0,e.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}applyLocalTorque(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.applyLocalTorque(this.tmpBtVector3)}applyTorque(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.applyTorque(this.tmpBtVector3)}applyTorqueImpulse(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}setCollisionFlags(t){this.ammo.setCollisionFlags(t)}getCollisionFlags(){return this.ammo.getCollisionFlags()}setRestitution(t){this.ammo.setRestitution(t)}setBounciness(t){this.setRestitution(t)}setFriction(t){this.ammo.setFriction(t)}setDamping(t,e){this.ammo.setDamping(t,e)}setGravity(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.setGravity(this.tmpBtVector3)}setLinearFactor(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.setLinearFactor(this.tmpBtVector3)}setAngularFactor(t,e,n){this.tmpBtVector3.setValue(t,e,n),this.ammo.setAngularFactor(this.tmpBtVector3)}setCcdMotionThreshold(t){this.ammo.setCcdMotionThreshold(t)}setCcdSweptSphereRadius(t){this.ammo.setCcdSweptSphereRadius(t)}}var ob=sb;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class ab extends Gi{constructor(){super(),this.isExtendedObject3D=!0,this.isGroup=!1,this.vector3=new Hn,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this._currentAnimation="",this._animationActions=new Map,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}set animationMixer(t){this._animationMixer=t}get animationMixer(){return this._animationMixer||(this._animationMixer=new sf(this)),this._animationMixer}get anims(){return{current:this._currentAnimation,add:(t,e)=>this._animsAdd(t,e),get:t=>this._animsGet(t),play:(t,e=500,n=!0)=>this._animsPlay(t,e,n),mixer:this.animationMixer}}get animation(){return Fx('Please use "anims" instead of "animation"'),this.anims}_animsAdd(t,e){this._animationActions.set(t,this.animationMixer.clipAction(e))}_animsGet(t){const e=this._animationActions.get(t);return e||Fx(`Animation(${t}) not found!`),e}_animsPlay(t,e=500,n=!0){const i=this._animationActions.get(t),r=this._animationActions.get(this._currentAnimation);i&&(i.reset(),r&&(i.crossFadeFrom(r,e/1e3,!0),i.clampWhenFinished=!0),n||i.setLoop(pe,0),i.play()),this._currentAnimation=t}setAction(t){Fx(`setAction(${t}) is deprecated. Use animation.play(${t}) instead!`)}traverse(t){super.traverse(t)}traverseVisible(t){super.traverseVisible(t)}traverseAncestors(t){super.traverseAncestors(t)}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class lb{constructor(t,e){this.factory=t,this.addExisting=e}addPlane(t={},e={}){const n=this.factory.add.plane(t,e);return this.addExisting(n,t),n}addSphere(t={},e={}){const n=this.factory.add.sphere(t,e);return this.addExisting(n,t),n}addBox(t={},e={}){const n=this.factory.add.box(t,e);return this.addExisting(n,t),n}addGround(t,e={}){const n=this.factory.add.ground(t,e),i={...t,mass:0,collisionFlags:1};return this.addExisting(n,i),n}addCylinder(t={},e={}){const n=this.factory.add.cylinder(t,e);return this.addExisting(n,t),n}addCone(t={},e={}){const n=this.factory.add.cone(t,e);return this.addExisting(n,t),n}addTorus(t={},e={}){const n=this.factory.add.torus(t,e);return this.addExisting(n,t),n}addExtrude(t,e={}){const n=this.factory.add.extrude(t,e);return n.translateX(1),this.addExisting(n),n}}var cb=lb;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class hb{constructor(t,e){this.worldTransform=t,this.physicsWorld=e,this.tmpBtVector3=new Ammo.btVector3}toAmmoV3(t,e=0){return new Ammo.btVector3("undefined"!==typeof t?.x?t.x:e,"undefined"!==typeof t?.y?t.y:e,"undefined"!==typeof t?.z?t.z:e)}get addConstraints(){return{lock:(t,e,n)=>this.lock(t,e,n),fixed:(t,e,n)=>this.fixed(t,e,n),pointToPoint:(t,e,n,i)=>this.pointToPoint(t,e,n,i),hinge:(t,e,n,i)=>this.hinge(t,e,n,i),slider:(t,e,n={},i)=>this.slider(t,e,n,i),spring:(t,e,n={},i)=>this.spring(t,e,n,i),coneTwist:(t,e,n={frameA:{},frameB:{}},i)=>this.coneTwist(t,e,n,i),dof:(t,e,n,i)=>this.dof(t,e,n,i)}}getTransform(t,e,n={x:0,y:0,z:0},i=!1){n={x:0,y:0,z:0,...n};const r=(t,e)=>{var i=(t.x()-e.x())/2+n.x,r=(t.y()-e.y())/2+n.y,s=(t.z()-e.z())/2+n.z;return new Ammo.btVector3(i,r,s)},s=new Ammo.btTransform;if(s.setIdentity(),i){const n=r(t.getWorldTransform().getOrigin(),e.getWorldTransform().getOrigin()),i=new Ammo.btTransform;i.setIdentity(),i.setOrigin(n);const s=t.getCenterOfMassTransform().inverse().op_mul(e.getWorldTransform());return s.op_mul(i),{transformA:s,transformB:i}}{s.setOrigin(new Ammo.btVector3(n.x,n.y,n.z));const i=t.getCenterOfMassTransform().inverse().op_mul(e.getWorldTransform()).op_mul(s);return{transformA:i,transformB:s}}}lock(t,e,n=!0){const i={x:0,y:0,z:0};return this.dof(t,e,{angularLowerLimit:i,angularUpperLimit:i},n)}fixed(t,e,n=!0){const i=this.getTransform(t.ammo,e.ammo);i.transformA.setRotation(t.ammo.getWorldTransform().getRotation()),i.transformB.setRotation(e.ammo.getWorldTransform().getRotation());const r=new Ammo.btFixedConstraint(t.ammo,e.ammo,i.transformA,i.transformB);return this.physicsWorld.addConstraint(r,n),r}pointToPoint(t,e,n={},i=!0){const{pivotA:r,pivotB:s}=n,o=new Ammo.btVector3(r?.x||0,r?.y||0,r?.z||0),a=new Ammo.btVector3(s?.x||0,s?.y||0,s?.z||0),l=new Ammo.btPoint2PointConstraint(t.ammo,e.ammo,o,a);return this.physicsWorld.addConstraint(l,i),l}hinge(t,e,n={},i=!0){const{pivotA:r,pivotB:s,axisA:o,axisB:a}=n,l=new Ammo.btVector3(r?.x||0,r?.y||0,r?.z||0),c=new Ammo.btVector3(s?.x||0,s?.y||0,s?.z||0),h=new Ammo.btVector3(o?.x||0,o?.y||0,o?.z||0),u=new Ammo.btVector3(a?.x||0,a?.y||0,a?.z||0),d=new Ammo.btHingeConstraint(t.ammo,e.ammo,l,c,h,u,!0);return this.physicsWorld.addConstraint(d,i),d}slider(t,e,n={},i=!0){const r=this.getTransform(t.ammo,e.ammo),{frameA:s={},frameB:o={},linearLowerLimit:a=0,linearUpperLimit:l=0,angularLowerLimit:c=0,angularUpperLimit:h=0}=n,u=r.transformA.getRotation();u.setEulerZYX(s.x||0,s.y||0,s.z||0),r.transformA.setRotation(u);const d=r.transformB.getRotation();d.setEulerZYX(o.x||0,o.y||0,o.z||0),r.transformB.setRotation(d);const p=new Ammo.btSliderConstraint(t.ammo,e.ammo,r.transformA,r.transformB,!0);return p.setLowerLinLimit(a),p.setUpperLinLimit(l),p.setLowerAngLimit(c),p.setUpperAngLimit(h),this.physicsWorld.addConstraint(p,i),p}spring(t,e,n={},i=!0){const{stiffness:r=50,damping:s=.01,angularLock:o=!1,linearLowerLimit:a={},linearUpperLimit:l={},angularLowerLimit:c={},angularUpperLimit:h={},offset:u={},center:d=!1,enableSpring:p=!0}=n,m={x:0,y:0,z:0,...u},f=this.getTransform(t.ammo,e.ammo,m,d),g=new Ammo.btGeneric6DofSpringConstraint(t.ammo,e.ammo,f.transformA,f.transformB,!0);this.tmpBtVector3.setValue(a.x||0,a.y||0,a.z||0),g.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(l.x||0,l.y||0,l.z||0),g.setLinearUpperLimit(this.tmpBtVector3),o?(this.tmpBtVector3.setValue(0,0,0),g.setAngularLowerLimit(this.tmpBtVector3),g.setAngularUpperLimit(this.tmpBtVector3)):(console.log(c,h),g.setAngularLowerLimit(this.toAmmoV3(c,-Math.PI)),g.setAngularUpperLimit(this.toAmmoV3(h,Math.PI)));for(let v=0;v<3;v++)g.enableSpring(v,p),g.setStiffness(v,r),g.setDamping(v,s);return this.physicsWorld.addConstraint(g,i),g}coneTwist(t,e,n,i=!0){const{frameA:r,frameB:s}=n,o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue(r?.x||0,r?.y||0,r?.z||0);const a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue(s?.x||0,s?.y||0,s?.z||0);this.getTransform(t.ammo,e.ammo);const l=new Ammo.btConeTwistConstraint(e.ammo,t.ammo,o,a);return l.setAngularOnly(!0),this.physicsWorld.addConstraint(l,i),l}dof(t,e,n={},i=!0){const{offset:r,center:s=!1}=n,o={x:0,y:0,z:0,...r},a=this.getTransform(t.ammo,e.ammo,o,s),l=new Ammo.btGeneric6DofConstraint(t.ammo,e.ammo,a.transformA,a.transformB,!0),{linearLowerLimit:c,linearUpperLimit:h,angularLowerLimit:u,angularUpperLimit:d}=n,p=this.toAmmoV3(c),m=this.toAmmoV3(h),f=this.toAmmoV3(u,-Math.PI),g=this.toAmmoV3(d,Math.PI);return l.setLinearLowerLimit(p),l.setLinearUpperLimit(m),l.setAngularLowerLimit(f),l.setAngularUpperLimit(g),Ammo.destroy(p),Ammo.destroy(m),Ammo.destroy(f),Ammo.destroy(g),this.physicsWorld.addConstraint(l,i),l}}
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2020 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */
const ub={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},db={ALL:"all",MANUAL:"manual"},pb=function(){const t=new Hn,e=new Hn,n=new xi;return function(i,r,s,o={}){if(o.type=ub.HULL,vb(o),o.fit===db.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;const a=_b(i,r),l=new Ammo.btVector3,c=new Ammo.btConvexHullShape;c.setMargin(o.margin),e.addVectors(a.max,a.min).multiplyScalar(.5);let h=0;for(let t=0;t<i.length;t++)h+=i[t].length/3;const u=o.hullMaxVertices||1e5;h>u&&console.warn(`too many vertices for hull shape; sampling ~${u} from ~${h} vertices`);const d=Math.min(1,u/h);for(let m=0;m<i.length;m++){const s=i[m];n.fromArray(r[m]);for(let r=0;r<s.length;r+=3){const o=m===i.length-1&&r===s.length-3;(Math.random()<=d||o)&&(t.set(s[r],s[r+1],s[r+2]).applyMatrix4(n).sub(e),l.setValue(t.x,t.y,t.z),c.addPoint(l,o))}}let p=c;if(c.getNumVertices()>=100){const t=new Ammo.btShapeHull(c);t.buildHull(o.margin),Ammo.destroy(c),p=new Ammo.btConvexHullShape(Ammo.getPointer(t.getVertexPointer()),t.numVertices()),Ammo.destroy(t)}return Ammo.destroy(l),yb(p,o,bb(s,o)),p}}(),mb=function(){const t=new Hn,e=new Hn,n=new xi;return function(i,r,s,o,a={}){if(a.type=ub.HACD,vb(a),a.fit===db.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const l=_b(i,r),c=bb(o,a);let h=0,u=0;e.addVectors(l.max,l.min).multiplyScalar(.5);for(let t=0;t<i.length;t++)h+=i[t].length/3,s&&s[t]?u+=s[t].length/3:u+=i[t].length/9;const d=new Ammo.HACD;a.hasOwnProperty("compacityWeight")&&d.SetCompacityWeight(a.compacityWeight),a.hasOwnProperty("volumeWeight")&&d.SetVolumeWeight(a.volumeWeight),a.hasOwnProperty("nClusters")&&d.SetNClusters(a.nClusters),a.hasOwnProperty("nVerticesPerCH")&&d.SetNVerticesPerCH(a.nVerticesPerCH),a.hasOwnProperty("concavity")&&d.SetConcavity(a.concavity);const p=Ammo._malloc(3*h*8),m=Ammo._malloc(3*u*4);d.SetPoints(p),d.SetTriangles(m),d.SetNPoints(h),d.SetNTriangles(u);let f=p/8,g=m/4;for(let x=0;x<i.length;x++){const o=i[x];n.fromArray(r[x]);for(let i=0;i<o.length;i+=3)t.set(o[i+0],o[i+1],o[i+2]).applyMatrix4(n).sub(e),Ammo.HEAPF64[f+0]=t.x,Ammo.HEAPF64[f+1]=t.y,Ammo.HEAPF64[f+2]=t.z,f+=3;if(s[x]){const t=s[x];for(let e=0;e<t.length;e++)Ammo.HEAP32[g]=t[e],g++}else for(let t=0;t<o.length/3;t++)Ammo.HEAP32[g]=t,g++}d.Compute(),Ammo._free(p),Ammo._free(m);const v=d.GetNClusters(),y=[];for(let t=0;t<v;t++){const e=new Ammo.btConvexHullShape;e.setMargin(a.margin);const n=d.GetNPointsCH(t),i=d.GetNTrianglesCH(t),r=Ammo._malloc(3*n*8),s=Ammo._malloc(3*i*4);d.GetCH(t,r,s);const o=r/8;for(let t=0;t<n;t++){const i=new Ammo.btVector3,r=Ammo.HEAPF64[o+3*t+0],s=Ammo.HEAPF64[o+3*t+1],a=Ammo.HEAPF64[o+3*t+2];i.setValue(r,s,a),e.addPoint(i,t===n-1),Ammo.destroy(i)}yb(e,a,c),y.push(e)}return y}}(),fb=function(){const t=new Hn,e=new Hn,n=new xi;return function(i,r,s,o,a={}){if(a.type=ub.VHACD,vb(a),a.fit===db.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const l=_b(i,r),c=bb(o,a);let h=0,u=0;e.addVectors(l.max,l.min).multiplyScalar(.5);for(let t=0;t<i.length;t++)h+=i[t].length/3,s&&s[t]?u+=s[t].length/3:u+=i[t].length/9;const d=new Ammo.VHACD,p=new Ammo.Parameters;a.hasOwnProperty("resolution")&&p.set_m_resolution(a.resolution),a.hasOwnProperty("depth")&&p.set_m_depth(a.depth),a.hasOwnProperty("concavity")&&p.set_m_concavity(a.concavity),a.hasOwnProperty("planeDownsampling")&&p.set_m_planeDownsampling(a.planeDownsampling),a.hasOwnProperty("convexhullDownsampling")&&p.set_m_convexhullDownsampling(a.convexhullDownsampling),a.hasOwnProperty("alpha")&&p.set_m_alpha(a.alpha),a.hasOwnProperty("beta")&&p.set_m_beta(a.beta),a.hasOwnProperty("gamma")&&p.set_m_gamma(a.gamma),a.hasOwnProperty("pca")&&p.set_m_pca(a.pca),a.hasOwnProperty("mode")&&p.set_m_mode(a.mode),a.hasOwnProperty("maxNumVerticesPerCH")&&p.set_m_maxNumVerticesPerCH(a.maxNumVerticesPerCH),a.hasOwnProperty("minVolumePerCH")&&p.set_m_minVolumePerCH(a.minVolumePerCH),a.hasOwnProperty("convexhullApproximation")&&p.set_m_convexhullApproximation(a.convexhullApproximation),a.hasOwnProperty("oclAcceleration")&&p.set_m_oclAcceleration(a.oclAcceleration);const m=Ammo._malloc(3*h*8+3),f=Ammo._malloc(3*u*4);let g=m/8,v=f/4;for(let _=0;_<i.length;_++){const o=i[_];n.fromArray(r[_]);for(let i=0;i<o.length;i+=3)t.set(o[i+0],o[i+1],o[i+2]).applyMatrix4(n).sub(e),Ammo.HEAPF64[g+0]=t.x,Ammo.HEAPF64[g+1]=t.y,Ammo.HEAPF64[g+2]=t.z,g+=3;if(s[_]){const t=s[_];for(let e=0;e<t.length;e++)Ammo.HEAP32[v]=t[e],v++}else for(let t=0;t<o.length/3;t++)Ammo.HEAP32[v]=t,v++}d.Compute(m,3,h,f,3,u,p),Ammo._free(m),Ammo._free(f);const y=d.GetNConvexHulls(),x=[],b=new Ammo.ConvexHull;for(let t=0;t<y;t++){d.GetConvexHull(t,b);const e=b.get_m_nPoints(),n=(b.get_m_points(),new Ammo.btConvexHullShape);n.setMargin(a.margin);for(let t=0;t<e;t++){const i=new Ammo.btVector3,r=b.get_m_points(3*t+0),s=b.get_m_points(3*t+1),o=b.get_m_points(3*t+2);i.setValue(r,s,o),n.addPoint(i,t===e-1),Ammo.destroy(i)}yb(n,a,c),x.push(n)}return Ammo.destroy(b),Ammo.destroy(d),x}}(),gb=function(){const t=new Hn,e=new Hn,n=new Hn,i=new xi;return function(r,s,o,a,l={}){if(l.type=ub.MESH,vb(l),l.fit===db.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;const c=bb(a,l),h=new Ammo.btVector3,u=new Ammo.btVector3,d=new Ammo.btVector3,p=new Ammo.btTriangleMesh(!0,!1);for(let g=0;g<r.length;g++){const a=r[g],l=o[g]?o[g]:null;if(i.fromArray(s[g]),l)for(let r=0;r<l.length;r+=3){const s=3*l[r],o=3*l[r+1],c=3*l[r+2];t.set(a[s],a[s+1],a[s+2]).applyMatrix4(i),e.set(a[o],a[o+1],a[o+2]).applyMatrix4(i),n.set(a[c],a[c+1],a[c+2]).applyMatrix4(i),h.setValue(t.x,t.y,t.z),u.setValue(e.x,e.y,e.z),d.setValue(n.x,n.y,n.z),p.addTriangle(h,u,d,!1)}else for(let r=0;r<a.length;r+=9)t.set(a[r+0],a[r+1],a[r+2]).applyMatrix4(i),e.set(a[r+3],a[r+4],a[r+5]).applyMatrix4(i),n.set(a[r+6],a[r+7],a[r+8]).applyMatrix4(i),h.setValue(t.x,t.y,t.z),u.setValue(e.x,e.y,e.z),d.setValue(n.x,n.y,n.z),p.addTriangle(h,u,d,!1)}const m=new Ammo.btVector3(c.x,c.y,c.z);let f;return p.setScaling(m),Ammo.destroy(m),f=l.concave?new Ammo.btBvhTriangleMeshShape(p,!0,!0):new Ammo.btConvexTriangleMeshShape(p,!0),f.resources=[p],Ammo.destroy(h),Ammo.destroy(u),Ammo.destroy(d),yb(f,l),f}}();function vb(t){t.type=t.type||ub.HULL,t.margin=t.hasOwnProperty("margin")?t.margin:.01}const yb=function(t,e,n){},xb=function(){const t=new xi;return function(e,n,i){parseInt(o)>=123?t.copy(e.matrixWorld).invert():t.getInverse(e.matrixWorld);const r=new Hn;r.setFromMatrixScale(e.matrixWorld),e.traverse((r=>{const s=new xi;r.isMesh&&(n.includeInvisible||r.el&&r.el.object3D.visible||r.visible)&&(r===e?s.identity():(r.updateWorldMatrix(!0),s.multiplyMatrices(t,r.matrixWorld)),i(r.geometry.isBufferGeometry?r.geometry.attributes.position.array:r.geometry.vertices,s.elements,r.geometry.index?r.geometry.index.array:null))}))}}(),bb=function(){const t=new xi;return function(e,n={}){const i=new Hn(1,1,1);return n.fit===db.ALL&&(t.fromArray(e),i.setFromMatrixScale(t)),i}}(),_b=(function(){const t=new Hn}(),function(t,e){const n=new jn;let i=1/0,r=1/0,s=1/0,o=-1/0,a=-1/0,l=-1/0;return n.min.set(0,0,0),n.max.set(0,0,0),wb(t,e,(t=>{t.x<i&&(i=t.x),t.y<r&&(r=t.y),t.z<s&&(s=t.z),t.x>o&&(o=t.x),t.y>a&&(a=t.y),t.z>l&&(l=t.z)})),n.min.set(i,r,s),n.max.set(o,a,l),n}),wb=function(){const t=new Hn,e=new xi;return function(n,i,r){for(let s=0;s<n.length;s++){e.fromArray(i[s]);for(let i=0;i<n[s].length;i+=3)t.set(n[s][i],n[s][i+1],n[s][i+2]).applyMatrix4(e),r(t)}}}(),Mb=(t,e)=>{const{radius:n=1,tube:i=.4,tubularSegments:r=8}=t,s=Math.PI,o=r,a=Math.sqrt(2*i*i-2*i*i*Math.cos(2*s/o)),l=new Ammo.btVector3(i,s/o+.5*a,i),c=new Ammo.btCylinderShape(l);c.setMargin(.05);const h=new Ammo.btCompoundShape,u=new Ammo.btVector3(0,0,1),d=new Ammo.btVector3(0,n,0),p=new Ammo.btQuaternion(e.x,e.y,e.z,e.w);for(let m=0;m<o;m++){const t=2*m*s/o,e=d.rotate(u,t),n=new Ammo.btTransform;p.setRotation(u,t+Math.PI/2),n.setIdentity(),n.setOrigin(e),n.setRotation(p),h.addChildShape(n,c)}return h};
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Sb extends rb.Events{addCollider(t,e,n){t.body&&e.body&&(t.body.checkCollisions=!0,e.body.checkCollisions=!0,this.on("collision",(i=>{const{bodies:r,event:s}=i;r[0]?.name&&r[1]?.name&&t?.name&&e?.name&&(r[0].name===t.name&&r[1].name===e.name||r[1].name===t.name&&r[0].name===e.name)&&n(s)})))}}
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */
const Tb={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295};class Ab{constructor(t,e,n={}){this.scene=t,this.world=e,this.options=n,this.debugDrawMode=n.debugDrawMode||Tb.DrawWireframe;const i=this.debugDrawMode&Tb.DrawOnTop||!1,r=n.maxBufferSize||1e6;this.geometry=new yr;const s=new Float32Array(3*r),o=new Float32Array(3*r);this.geometry.setAttribute("position",new ar(s,3).setUsage(ke)),this.geometry.setAttribute("color",new ar(o,3).setUsage(ke)),this.index=0;const a=new Su({vertexColors:!0,depthTest:!i});this.mesh=new Du(this.geometry,a),i&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}enable(){this.enabled=!0,this.scene.add(this.mesh)}disable(){this.enabled=!1,this.scene.remove(this.mesh)}update(){this.enabled&&(0!=this.index&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}drawLine(t,e,n){const i=Ammo.HEAPF32,r=i[(n+0)/4],s=i[(n+4)/4],o=i[(n+8)/4],a=i[(t+0)/4],l=i[(t+4)/4],c=i[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,a,l,c),this.geometry.attributes.color.setXYZ(this.index++,r,s,o);const h=i[(e+0)/4],u=i[(e+4)/4],d=i[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,h,u,d),this.geometry.attributes.color.setXYZ(this.index++,r,s,o)}drawContactPoint(t,e,n,i,r){const s=Ammo.HEAPF32,o=s[(r+0)/4],a=s[(r+4)/4],l=s[(r+8)/4],c=s[(t+0)/4],h=s[(t+4)/4],u=s[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,c,h,u),this.geometry.attributes.color.setXYZ(this.index++,o,a,l);const d=s[(e+0)/4]*n,p=s[(e+4)/4]*n,m=s[(e+8)/4]*n;this.geometry.attributes.position.setXYZ(this.index,c+d,h+p,u+m),this.geometry.attributes.color.setXYZ(this.index++,o,a,l)}reportErrorWarning(t){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(t)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}draw3dText(t,e){console.warn("TODO: draw3dText")}setDebugMode(t){this.debugDrawMode=t}getDebugMode(){return this.debugDrawMode}}var Eb=Ab;const Cb=0,Pb=1,Lb=new Hn,Rb=new mf,Ib=new is,Db=new Hn,Ob=new er;class Nb{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Fb,this.unassigned=new Fb,this.vertices=[]}setFromPoints(t){if(t.length>=4){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.vertices.push(new Bb(t[e]));this.compute()}return this}setFromObject(t){const e=[];return t.updateMatrixWorld(!0),t.traverse((function(t){const n=t.geometry;if(void 0!==n){const i=n.attributes.position;if(void 0!==i)for(let n=0,r=i.count;n<r;n++){const r=new Hn;r.fromBufferAttribute(i,n).applyMatrix4(t.matrixWorld),e.push(r)}}})),this.setFromPoints(e)}containsPoint(t){const e=this.faces;for(let n=0,i=e.length;n<i;n++){const i=e[n];if(i.distanceToPoint(t)>this.tolerance)return!1}return!0}intersectRay(t,e){const n=this.faces;let i=-1/0,r=1/0;for(let s=0,o=n.length;s<o;s++){const e=n[s],o=e.distanceToPoint(t.origin),a=e.normal.dot(t.direction);if(o>0&&a>=0)return null;const l=0!==a?-o/a:0;if(!(l<=0)&&(a>0?r=Math.min(l,r):i=Math.max(l,i),i>r))return null}return i!==-1/0?t.at(i,e):t.at(r,e),e}intersectsRay(t){return null!==this.intersectRay(t,Lb)}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}removeVertexFromFace(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}removeAllVerticesFromFace(t){if(null!==t.outside){const e=t.outside;let n=t.outside;while(null!==n.next&&n.next.face===t)n=n.next;return this.assigned.removeSubList(e,n),e.prev=n.next=null,t.outside=null,e}}deleteFaceVertices(t,e){const n=this.removeAllVerticesFromFace(t);if(void 0!==n)if(void 0===e)this.unassigned.appendChain(n);else{let t=n;do{const n=t.next,i=e.distanceToPoint(t.point);i>this.tolerance?this.addVertexToFace(t,e):this.unassigned.append(t),t=n}while(null!==t)}return this}resolveUnassignedPoints(t){if(!1===this.unassigned.isEmpty()){let e=this.unassigned.first();do{const n=e.next;let i=this.tolerance,r=null;for(let s=0;s<t.length;s++){const n=t[s];if(n.mark===Cb){const t=n.distanceToPoint(e.point);if(t>i&&(i=t,r=n),i>1e3*this.tolerance)break}}null!==r&&this.addVertexToFace(e,r),e=n}while(null!==e)}return this}computeExtremes(){const t=new Hn,e=new Hn,n=[],i=[];for(let r=0;r<3;r++)n[r]=i[r]=this.vertices[0];t.copy(this.vertices[0].point),e.copy(this.vertices[0].point);for(let r=0,s=this.vertices.length;r<s;r++){const s=this.vertices[r],o=s.point;for(let e=0;e<3;e++)o.getComponent(e)<t.getComponent(e)&&(t.setComponent(e,o.getComponent(e)),n[e]=s);for(let t=0;t<3;t++)o.getComponent(t)>e.getComponent(t)&&(e.setComponent(t,o.getComponent(t)),i[t]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(e.x))+Math.max(Math.abs(t.y),Math.abs(e.y))+Math.max(Math.abs(t.z),Math.abs(e.z))),{min:n,max:i}}computeInitialHull(){const t=this.vertices,e=this.computeExtremes(),n=e.min,i=e.max;let r=0,s=0;for(let u=0;u<3;u++){const t=i[u].point.getComponent(u)-n[u].point.getComponent(u);t>r&&(r=t,s=u)}const o=n[s],a=i[s];let l,c;r=0,Rb.set(o.point,a.point);for(let u=0,d=this.vertices.length;u<d;u++){const e=t[u];if(e!==o&&e!==a){Rb.closestPointToPoint(e.point,!0,Db);const t=Db.distanceToSquared(e.point);t>r&&(r=t,l=e)}}r=-1,Ib.setFromCoplanarPoints(o.point,a.point,l.point);for(let u=0,d=this.vertices.length;u<d;u++){const e=t[u];if(e!==o&&e!==a&&e!==l){const t=Math.abs(Ib.distanceToPoint(e.point));t>r&&(r=t,c=e)}}const h=[];if(Ib.distanceToPoint(c.point)<0){h.push(kb.create(o,a,l),kb.create(c,a,o),kb.create(c,l,a),kb.create(c,o,l));for(let t=0;t<3;t++){const e=(t+1)%3;h[t+1].getEdge(2).setTwin(h[0].getEdge(e)),h[t+1].getEdge(1).setTwin(h[e+1].getEdge(0))}}else{h.push(kb.create(o,l,a),kb.create(c,o,a),kb.create(c,a,l),kb.create(c,l,o));for(let t=0;t<3;t++){const e=(t+1)%3;h[t+1].getEdge(2).setTwin(h[0].getEdge((3-t)%3)),h[t+1].getEdge(0).setTwin(h[e+1].getEdge(1))}}for(let u=0;u<4;u++)this.faces.push(h[u]);for(let u=0,d=t.length;u<d;u++){const e=t[u];if(e!==o&&e!==a&&e!==l&&e!==c){r=this.tolerance;let t=null;for(let n=0;n<4;n++){const i=this.faces[n].distanceToPoint(e.point);i>r&&(r=i,t=this.faces[n])}null!==t&&this.addVertexToFace(e,t)}}return this}reindexFaces(){const t=[];for(let e=0;e<this.faces.length;e++){const n=this.faces[e];n.mark===Cb&&t.push(n)}return this.faces=t,this}nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let t,e=0;const n=this.assigned.first().face;let i=n.outside;do{const r=n.distanceToPoint(i.point);r>e&&(e=r,t=i),i=i.next}while(null!==i&&i.face===n);return t}}computeHorizon(t,e,n,i){let r;this.deleteFaceVertices(n),n.mark=Pb,r=null===e?e=n.getEdge(0):e.next;do{const e=r.twin,n=e.face;n.mark===Cb&&(n.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,e,n,i):i.push(r)),r=r.next}while(r!==e);return this}addAdjoiningFace(t,e){const n=kb.create(t,e.tail(),e.head());return this.faces.push(n),n.getEdge(-1).setTwin(e.twin),n.getEdge(0)}addNewFaces(t,e){this.newFaces=[];let n=null,i=null;for(let r=0;r<e.length;r++){const s=e[r],o=this.addAdjoiningFace(t,s);null===n?n=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return n.next.setTwin(i),this}addVertexToHull(t){const e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let t;this.computeInitialHull();while(void 0!==(t=this.nextVertexToAdd()))this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}class kb{constructor(){this.normal=new Hn,this.midpoint=new Hn,this.area=0,this.constant=0,this.outside=null,this.mark=Cb,this.edge=null}static create(t,e,n){const i=new kb,r=new zb(t,i),s=new zb(e,i),o=new zb(n,i);return r.next=o.prev=s,s.next=r.prev=o,o.next=s.prev=r,i.edge=r,i.compute()}getEdge(t){let e=this.edge;while(t>0)e=e.next,t--;while(t<0)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),n=this.edge.next.head();return Ob.set(t.point,e.point,n.point),Ob.getNormal(this.normal),Ob.getMidpoint(this.midpoint),this.area=Ob.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class zb{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class Bb{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class Fb{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;while(null!==t.next)t=t.next;return this.tail=t,this}remove(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return null===this.head}}class Ub extends yr{constructor(t=[]){super();const e=[],n=[];void 0===Nb&&console.error("THREE.ConvexGeometry: ConvexGeometry relies on ConvexHull");const i=(new Nb).setFromPoints(t),r=i.faces;for(let s=0;s<r.length;s++){const t=r[s];let i=t.edge;do{const r=i.head().point;e.push(r.x,r.y,r.z),n.push(t.normal.x,t.normal.y,t.normal.z),i=i.next}while(i!==t.edge)}this.setAttribute("position",new hr(e,3)),this.setAttribute("normal",new hr(n,3))}}const Vb=t=>{const e=window.THREE&&window.THREE.ConvexGeometry?window.THREE.ConvexGeometry:Ub;return new e(t)},Hb=function(t,e){this.minSizeForBreak=t||1.4,this.smallDelta=e||1e-4,this.tempLine1=new mf,this.tempPlane1=new is,this.tempPlane2=new is,this.tempPlane_Cut=new is,this.tempCM1=new Hn,this.tempCM2=new Hn,this.tempVector3=new Hn,this.tempVector3_2=new Hn,this.tempVector3_3=new Hn,this.tempVector3_P0=new Hn,this.tempVector3_P1=new Hn,this.tempVector3_P2=new Hn,this.tempVector3_N0=new Hn,this.tempVector3_N1=new Hn,this.tempVector3_AB=new Hn,this.tempVector3_CB=new Hn,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var n=900,i=0;i<n;i++)this.segments[i]=!1};Hb.prototype={constructor:Hb,prepareBreakableObject:function(t,e,n,i,r){t.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry."),t.userData.ammoPhysicsData={};var s=t.userData.ammoPhysicsData;s.mass=e,s.velocity=n.clone(),s.angularVelocity=i.clone(),s.breakable=r},subdivideByImpact:function(t,e,n,i,r){var s=[],o=this.tempPlane1,a=this.tempPlane2;this.tempVector3.addVectors(e,n),o.setFromCoplanarPoints(e,t.position,this.tempVector3);var l=r+i,c=this;function h(r,u,d,p){if(Math.random()<.05*p||p>l)s.push(r);else{var m=Math.PI;0===p?(a.normal.copy(o.normal),a.constant=o.constant):p<=i?(m=(d-u)*(.2+.6*Math.random())+u,c.tempVector3_2.copy(t.position).sub(e).applyAxisAngle(n,m).add(e),a.setFromCoplanarPoints(e,c.tempVector3,c.tempVector3_2)):(m=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,c.tempVector3_2.copy(e).sub(r.position).applyAxisAngle(n,m).add(r.position),c.tempVector3_3.copy(n).add(r.position),a.setFromCoplanarPoints(r.position,c.tempVector3_3,c.tempVector3_2)),c.cutByPlane(r,a,c.tempResultObjects);var f=c.tempResultObjects.object1,g=c.tempResultObjects.object2;f&&h(f,u,m,p+1),g&&h(g,m,d,p+1)}}return h(t,0,2*Math.PI,0),s},cutByPlane:function(t,e,n){var i=t.geometry,r=i.attributes.position.array,s=i.attributes.normal.array,o=r.length/3,a=o/3,l=i.getIndex();function c(t,e){var n=3*t+e;return l?l[n]:n}l&&(l=l.array,a=l.length/3);for(var h=[],u=[],d=this.smallDelta,p=o*o,m=0;m<p;m++)this.segments[m]=!1;var f=this.tempVector3_P0,g=this.tempVector3_P1,v=this.tempVector3_N0,y=this.tempVector3_N1;for(m=0;m<a-1;m++){var x=c(m,0),b=c(m,1),_=c(m,2);v.set(s[x],s[x]+1,s[x]+2);for(var w=m+1;w<a;w++){var M=c(w,0),S=c(w,1),T=c(w,2);y.set(s[M],s[M]+1,s[M]+2);var A=1-v.dot(y)<d;A&&(x===M||x===S||x===T?b===M||b===S||b===T?(this.segments[x*o+b]=!0,this.segments[b*o+x]=!0):(this.segments[_*o+x]=!0,this.segments[x*o+_]=!0):b!==M&&b!==S&&b!==T||(this.segments[_*o+b]=!0,this.segments[b*o+_]=!0))}}var E=this.tempPlane_Cut;t.updateMatrix(),Hb.transformPlaneToLocalSpace(e,t.matrix,E);for(m=0;m<a;m++)for(var C=c(m,0),P=c(m,1),L=c(m,2),R=0;R<3;R++){var I=0===R?C:1===R?P:L,D=0===R?P:1===R?L:C,O=this.segments[I*o+D];if(!O){this.segments[I*o+D]=!0,this.segments[D*o+I]=!0,f.set(r[3*I],r[3*I+1],r[3*I+2]),g.set(r[3*D],r[3*D+1],r[3*D+2]);var N=0,k=E.distanceToPoint(f);k>d?(N=2,u.push(f.clone())):k<-d?(N=1,h.push(f.clone())):(N=3,h.push(f.clone()),u.push(f.clone()));var z=0;k=E.distanceToPoint(g);if(k>d?(z=2,u.push(g.clone())):k<-d?(z=1,h.push(g.clone())):(z=3,h.push(g.clone()),u.push(g.clone())),1===N&&2===z||2===N&&1===z){this.tempLine1.start.copy(f),this.tempLine1.end.copy(g);var B=new Hn;if(B=E.intersectLine(this.tempLine1,B),void 0===B)return console.error("Internal error: segment does not intersect plane."),n.segmentedObject1=null,n.segmentedObject2=null,0;h.push(B),u.push(B.clone())}}}var F=.5*t.userData.ammoPhysicsData.mass;this.tempCM1.set(0,0,0);var U=0,V=h.length;if(V>0){for(m=0;m<V;m++)this.tempCM1.add(h[m]);this.tempCM1.divideScalar(V);for(m=0;m<V;m++){var H=h[m];H.sub(this.tempCM1),U=Math.max(U,H.x,H.y,H.z)}this.tempCM1.add(t.position)}this.tempCM2.set(0,0,0);var W=0,G=u.length;if(G>0){for(m=0;m<G;m++)this.tempCM2.add(u[m]);this.tempCM2.divideScalar(G);for(m=0;m<G;m++){H=u[m];H.sub(this.tempCM2),W=Math.max(W,H.x,H.y,H.z)}this.tempCM2.add(t.position)}var j=null,q=null,X=0;if(V>4)try{j=new kr(Vb(h),t.material),j.position.copy(this.tempCM1),j.quaternion.copy(t.quaternion),j.userData=t.userData,this.prepareBreakableObject(j,F,t.userData.ammoPhysicsData.velocity,t.userData.ammoPhysicsData.angularVelocity,2*U>this.minSizeForBreak),X++}catch(Y){Fx("Error in ConvexObjectBreaker.ts",!0),Fx(Y,!0)}if(G>4)try{q=new kr(Vb(u),t.material),q.position.copy(this.tempCM2),q.quaternion.copy(t.quaternion),q.userData=t.userData,this.prepareBreakableObject(q,F,t.userData.ammoPhysicsData.velocity,t.userData.ammoPhysicsData.angularVelocity,2*W>this.minSizeForBreak),X++}catch(Y){Fx("Error in ConvexObjectBreaker.ts",!0),Fx(Y,!0)}return n.object1=j,n.object2=q,X}},Hb.transformFreeVector=function(t,e){var n=t.x,i=t.y,r=t.z,s=e.elements;return t.x=s[0]*n+s[4]*i+s[8]*r,t.y=s[1]*n+s[5]*i+s[9]*r,t.z=s[2]*n+s[6]*i+s[10]*r,t},Hb.transformFreeVectorInverse=function(t,e){var n=t.x,i=t.y,r=t.z,s=e.elements;return t.x=s[0]*n+s[1]*i+s[2]*r,t.y=s[4]*n+s[5]*i+s[6]*r,t.z=s[8]*n+s[9]*i+s[10]*r,t},Hb.transformTiedVectorInverse=function(t,e){var n=t.x,i=t.y,r=t.z,s=e.elements;return t.x=s[0]*n+s[1]*i+s[2]*r-s[12],t.y=s[4]*n+s[5]*i+s[6]*r-s[13],t.z=s[8]*n+s[9]*i+s[10]*r-s[14],t},Hb.transformPlaneToLocalSpace=function(){var t=new Hn;return function(e,n,i){i.normal.copy(e.normal),i.constant=e.constant;var r=Hb.transformTiedVectorInverse(e.coplanarPoint(t),n);Hb.transformFreeVectorInverse(i.normal,n),i.constant=-r.dot(i.normal)}}();const Wb=(()=>{try{if("object"===typeof WebAssembly&&"function"===typeof WebAssembly.instantiate){const t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){t instanceof Error&&console.error(t.message)}return!1})(),Gb=(t,e)=>{var n=document.createElement("script");n.onload=()=>{e()},n.onerror=()=>{throw new Error(`failed to load ${t}`)},n.async=!0,n.src=t,document.head.appendChild(n)},jb=(t,e)=>{Gb(Wb?`${t}/ammo.wasm.js`:`${t}/ammo.js`,(()=>e()))};var qb=jb;const Xb=(t,e)=>{"undefined"!==typeof window&&(window.__loadPhysics=!0),qb(t,(()=>{Ammo().then((()=>{e()}))}))};function Yb(t,e){e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((n=>{Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(e.prototype,n)||Object.create(null))}))}))}var Zb=Yb;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Jb{constructor(t){this.physics=t}getHitPointWorld(){const t=this._btRayCallback.get_m_hitPointWorld(),e={x:t.x(),y:t.y(),z:t.z()};return e}getHitNormalWorld(){const t=this._btRayCallback.get_m_hitNormalWorld(),e={x:t.x(),y:t.y(),z:t.z()};return e}getCollisionObject(){const t=Ammo.castObject(this._btRayCallback.get_m_collisionObject(),Ammo.btRigidBody);return t.threeObject}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class Kb{constructor(t){this.physics=t}getHitPointsWorld(){const t=this._btRayCallback.get_m_hitPointWorld(),e=[];for(let n=t.size()-1;n>=0;n--){const i=t.at(n);e.push({x:i.x(),y:i.y(),z:i.z()})}return e}getHitPointWorld(){return Fx("Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()}getHitNormalsWorld(){const t=this._btRayCallback.get_m_hitNormalWorld(),e=[];for(let n=t.size()-1;n>=0;n--){const i=t.at(n);e.push({x:i.x(),y:i.y(),z:i.z()})}return e}getCollisionObjects(){const t=[],e=this._btRayCallback.get_m_collisionObjects();for(let n=e.size()-1;n>=0;n--){const i=Ammo.castObject(e.at(n),Ammo.btRigidBody);t.push(i.threeObject)}return t}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class $b{constructor(t){this.physics=t}setRayFromWorld(t=0,e=0,n=0){this._btRayFrom.setValue(t,e,n)}setRayToWorld(t=0,e=0,n=0){this._btRayTo.setValue(t,e,n)}hasHit(){return this._btRayCallback.hasHit()}rayTest(){"undefined"!==typeof this._btRayCallback&&Ammo.destroy(this._btRayCallback),this._btRayCallback="closest"===this.type?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)}destroy(){"undefined"!==typeof this._btRayFrom&&Ammo.destroy(this._btRayFrom),"undefined"!==typeof this._btRayTo&&Ammo.destroy(this._btRayTo),"undefined"!==typeof this._btRayCallback&&Ammo.destroy(this._btRayCallback)}}class Qb{constructor(t){this.physics=t,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}class t_{constructor(t){this.physics=t,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}Zb(Qb,[$b,Jb]),Zb(t_,[$b,Kb]);
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class e_ extends rb.Events{constructor(t,e={}){super(),this.scene=t,this.config=e,this.rigidBodies=[],this.earlierDetectedCollisions=[],this.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],this.gravity=e.gravity||{x:0,y:-9.81,z:0},this.isHeadless="headless"===t,this.tmpEuler=new Pi,this.tmpQuaternion=new Vn,this.tmpVector3=new Hn,this.tmpVector3a=new Hn,this.tmpMatrix4=new xi,this.tmpMatrix4a=new xi,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.emptyV3=new Hn,this.impactPoint=new Hn,this.impactNormal=new Hn,"headless"!==t&&(this.defaultMaterial=new Vx),this.start()}get tmpTrans(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform}set tmpTrans(t){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=t}destroy(t){const e=Object.keys(t).includes("body")?t.body:t;if("undefined"===typeof e?.ammo)return;let n=e.ammo.threeObject;const i=n.name;if(i&&n&&n?.body?.ammo){n.body.isSoftBody?this.physicsWorld.removeSoftBody(n.body.ammo):this.physicsWorld.removeRigidBody(n.body.ammo),n.body.destructor(),n.body=void 0,n.hasBody=!1,delete e.ammo.threeObject;for(let t=0;t<this.rigidBodies.length;t++)this.rigidBodies[t].name===i&&(this.rigidBodies.splice(t,1),t--)}"headless"===this.scene&&n&&(n=null)}setup(){if(this.worldTransform=new Ammo.btTransform,"function"===typeof this.config.setupPhysicsWorld?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),"headless"!==this.scene){this.convexBreaker=new Hb,this.objectsToRemove=[],this.numObjectsToRemove=0;for(let t=0;t<500;t++)this.objectsToRemove[t]=null}this.collisionEvents=new Sb,this.factory=new Hx(this.scene),this.shapes=new cb(this.factory,((t,e)=>this.addExisting(t,e))),this.constraints=new hb(this.worldTransform,this.physicsWorld),"headless"!==this.scene&&(this.debugDrawer=new Eb(this.scene,this.physicsWorld,{}))}updateDebugger(){"headless"!==this.scene&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}setupPhysicsWorld(){const t=this.gravity,{softBodies:e=!1}=this.config;let n;if(!e){const t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),i=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver;n=new Ammo.btDiscreteDynamicsWorld(e,i,r,t)}if(e){const t=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),i=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver,s=new Ammo.btDefaultSoftBodySolver;n=new Ammo.btSoftRigidDynamicsWorld(e,i,r,t,s)}return n.setGravity(new Ammo.btVector3(t.x,t.y,t.z)),n}createDebrisFromBreakableObject(t,e){"headless"!==this.scene&&(t.material=e.material,t.shape="hull",t.fragmentDepth=e.fragmentDepth+1,t.name=`${e.name}__DEBRIS_${t.id}`,this.scene.add(t),this.addExisting(t,{autoCenter:!0}),t.body.fractureImpulse=e.body.fractureImpulse,t.body.breakable=!1,setTimeout((()=>{t.body.breakable=!0}),2500))}removeDebris(t){"headless"!==this.scene&&(this.scene.remove(t),this.destroy(t))}update(t){this.updatePhysics(t),this.detectCollisions()}updatePhysics(t){const e=t/1e3;this.physicsWorld.stepSimulation(e,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(let n=0;n<this.rigidBodies.length;n++){const t=this.rigidBodies[n];t.body.impact=[];const e=t.body.ammo,i=e.getMotionState();if(i)if(i.getWorldTransform(this.worldTransform),t.body.didUpdate&&(t.body._emitUpdateEvents&&t.body.eventEmitter.emit("update"),t.body.didUpdate=!1),t.body.ammo.isKinematicObject()&&t.body.needUpdate)t.getWorldQuaternion(this.tmpQuaternion),t.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),i.setWorldTransform(this.worldTransform),t.body.needUpdate=!1;else if(t.body.skipUpdate);else if(!t.body.ammo.isStaticObject()){const e=this.worldTransform.getOrigin(),n=this.worldTransform.getRotation(),i=t.body.offset;if(t.body.ignoreScale)this.tmpVector3a.set(t.scale.x,t.scale.y,t.scale.z);else{const e=t.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(e.x(),e.y(),e.z())}this.tmpVector3.set(e.x()+i.x,e.y()+i.y,e.z()+i.z),this.tmpQuaternion.set(n.x(),n.y(),n.z(),n.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),t.parent?parseInt(o)>=123?this.tmpMatrix4a.copy(t.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(t.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(t.position,t.quaternion,t.scale)}}}detectCollisions(){const t=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);const e=this.physicsWorld.getDispatcher(),n=e.getNumManifolds();for(let i=0;i<n;i++){const n=e.getManifoldByIndexInternal(i),r=n.getNumContacts(),s=Ammo.castObject(n.getBody0(),Ammo.btRigidBody),o=Ammo.castObject(n.getBody1(),Ammo.btRigidBody),a=s.threeObject,l=o.threeObject;if(!a||!l)continue;if(""===s.name&&""===o.name)continue;const c=a.body?.checkCollisions,h=l.body?.checkCollisions,u=a.body.breakable,d=l.body.breakable,p=a.body.fractureImpulse,m=l.body.fractureImpulse,f=c||h,g=u||d;if("undefined"===typeof a.fragmentDepth&&(a.fragmentDepth=0),"undefined"===typeof l.fragmentDepth&&(l.fragmentDepth=0),!f&&!g)continue;let v=!1,y=0,x="start";for(let e=0;e<r;e++){const i=n.getContactPoint(e),r=i.getDistance();if(r<=0){v=!0;const e=i.getAppliedImpulse(),n=i.get_m_positionWorldOnB(),r=i.get_m_normalWorldOnB();if(c||h){const i=[a.uuid,l.uuid].sort(),s=`${i[0]}__${i[1]}`;if(this.earlierDetectedCollisions.find((t=>t.combinedName===s))&&(x="collision"),!t.find((t=>t.combinedName===s))){t.push({combinedName:s,collision:!0});const i={x:n.x(),y:n.y(),z:n.z()},o={x:r.x(),y:r.y(),z:r.z()};a.body.impact.push({impulse:e,point:i,normal:o,name:l.name}),l.body.impact.push({impulse:e,point:i,normal:o,name:a.name}),this.collisionEvents.emit("collision",{bodies:[a,l],event:x})}}e>=y&&(y=e,(u||d)&&(this.impactPoint.set(n.x(),n.y(),n.z()),this.impactNormal.set(r.x(),r.y(),r.z())));break}}if(!v)continue;if(!g)continue;const b=2;if(this.emptyV3.set(0,0,0),a.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:u,physicsBody:s},l.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:d,physicsBody:o},u&&y>p&&a.fragmentDepth<b){const t=this.convexBreaker.subdivideByImpact(a,this.impactPoint,this.impactNormal,1,2),e=t.length;for(let n=0;n<e;n++){const e=s.getLinearVelocity(),i=s.getAngularVelocity(),r=t[n];r.userData.ammoPhysicsData.velocity.set(e.x(),e.y(),e.z()),r.userData.ammoPhysicsData.angularVelocity.set(i.x(),i.y(),i.z()),this.createDebrisFromBreakableObject(r,a)}this.objectsToRemove[this.numObjectsToRemove++]=a}if(d&&y>m&&l.fragmentDepth<b){const t=this.convexBreaker.subdivideByImpact(l,this.impactPoint,this.impactNormal,1,2),e=t.length;for(let n=0;n<e;n++){const e=o.getLinearVelocity(),i=o.getAngularVelocity(),r=t[n];r.userData.ammoPhysicsData.velocity.set(e.x(),e.y(),e.z()),r.userData.ammoPhysicsData.angularVelocity.set(i.x(),i.y(),i.z()),this.createDebrisFromBreakableObject(r,l)}this.objectsToRemove[this.numObjectsToRemove++]=l}}for(let i=0;i<this.numObjectsToRemove;i++)this.removeDebris(this.objectsToRemove[i]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach((e=>{const{combinedName:n}=e;if(!t.find((t=>t.combinedName===n))){const t=n.split("__"),e=this.rigidBodies.find((e=>e.uuid===t[0])),i=this.rigidBodies.find((e=>e.uuid===t[1])),r="end";e&&i&&this.collisionEvents.emit("collision",{bodies:[e,i],event:r})}})),this.earlierDetectedCollisions=[...t]}setGravity(t=0,e=-9.8,n=0){this.tmpBtVector3.setValue(t,e,n),this.physicsWorld.setGravity(this.tmpBtVector3)}get debug(){return this.isHeadless?null:{enable:()=>{this.debugDrawer.enable()},mode:(t=1)=>{this.debugDrawer.setDebugMode(t)},disable:()=>{this.debugDrawer.disable()}}}start(){"undefined"!==typeof Ammo?"function"===typeof Ammo?Ammo().then((()=>{this.setup()})):this.setup():Fx("Are you sure you included ammo.js?")}get add(){return{collider:(t,e,n)=>this.collisionEvents.addCollider(t,e,n),constraints:this.constraints.addConstraints,existing:(t,e)=>this.addExisting(t,e),plane:(t={},e={})=>this.shapes.addPlane(t,e),sphere:(t={},e={})=>this.shapes.addSphere(t,e),ground:(t={},e={})=>this.shapes.addGround(t,e),box:(t={},e={})=>this.shapes.addBox(t,e),cylinder:(t={},e={})=>this.shapes.addCylinder(t,e),cone:(t={},e={})=>this.shapes.addCone(t,e),torus:(t={},e={})=>this.shapes.addTorus(t,e),extrude:(t,e={})=>this.shapes.addExtrude(t,e),raycaster:(t="closest")=>"closest"===t?new Qb(this):new t_(this)}}prepareThreeObjectForCollisionShape(t,e={}){const{autoCenter:n=!1}=e,i={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6};let r="unknown";const s=t.geometry?.type||"unknown";/box/i.test(s)?r="box":/cone/i.test(s)?r="cone":/cylinder/i.test(s)?r="cylinder":/extrude/i.test(s)?r="extrude":/plane/i.test(s)?r="plane":/sphere/i.test(s)?r="sphere":/torus/i.test(s)&&(r="torus");let o={...i,...t?.geometry?.parameters};return e.shape?(o={...i,...e},r=e.shape):t.shape&&(r=t.shape),Object.keys(o).forEach((t=>{"undefined"===typeof o[t]&&i[t]&&(o[t]=i[t])})),n&&t.geometry.center(),"cylinder"===r&&(o.radius=e.radius||o.radiusTop),"extrude"===r&&(r="hacd"),"mesh"!==r&&"convex"!==r||(r="convexMesh"),"concave"===r&&(r="concaveMesh"),"unknown"===r&&(Fx(`Shape for ${t?.name} not recognized! Will fallback to box.`),r="box"),{shape:r,params:o,object:t}}createCollisionShape(t,e,n){const i=n?.quaternion?n?.quaternion:new Vn(0,0,0,1),{axis:r="y"}=e,s=new Ammo.btVector3,o=n?.geometry;n&&o?.isGeometry&&(n.geometry=(new yr).fromGeometry(o));const a=t=>{const e=(new xi).elements,n=[],i=[],r=[];return xb(t,{},((t,e,s)=>{n.push(t),i.push(e),r.push(s)})),{vertices:n,matrices:i,indexes:r,matrixWorld:e}};let l,c={};switch(-1!==this.complexShapes.indexOf(t)&&(c=a(n)),t){case"box":s.setValue(e.width/2,e.height/2,e.depth/2),l=new Ammo.btBoxShape(s);break;case"sphere":l=new Ammo.btSphereShape(e.radius);break;case"cylinder":switch(r){case"y":s.setValue(e.radius,e.height/2,e.radius),l=new Ammo.btCylinderShape(s);break;case"x":s.setValue(e.height/2,e.radius,e.radius),l=new Ammo.btCylinderShapeX(s);break;case"z":s.setValue(e.radius,e.radius,e.height/2),l=new Ammo.btCylinderShapeZ(s);break}break;case"cone":switch(r){case"y":l=new Ammo.btConeShape(e.radius,e.height);break;case"x":l=new Ammo.btConeShapeX(e.radius,e.height);break;case"z":l=new Ammo.btConeShapeZ(e.radius,e.height);break}break;case"capsule":switch(r){case"y":l=new Ammo.btCapsuleShape(e.radius,e.height);break;case"x":l=new Ammo.btCapsuleShapeX(e.radius,e.height);break;case"z":l=new Ammo.btCapsuleShapeZ(e.radius,e.height);break}break;case"torus":l=Mb(e,i);break;case"plane":l=gb(c.vertices,c.matrices,c.indexes,c.matrixWorld,{...e,concave:!1});break;case"hull":l=pb(c.vertices,c.matrices,c.matrixWorld,e);break;case"hacd":l=mb(c.vertices,c.matrices,c.indexes,c.matrixWorld,e);break;case"vhacd":l=fb(c.vertices,c.matrices,c.indexes,c.matrixWorld,e);break;case"convexMesh":l=gb(c.vertices,c.matrices,c.indexes,c.matrixWorld,{...e,concave:!1});break;case"concaveMesh":l=gb(c.vertices,c.matrices,c.indexes,c.matrixWorld,{...e,concave:!0});break}Ammo.destroy(s);const{x:h,y:u,z:d}=e;return(h||u||d)&&(l._compoundOffset={x:h||0,y:u||0,z:d||0}),Array.isArray(l)&&(l=this.mergeCollisionShapesToCompoundShape(l)),l}mergeCollisionShapesToCompoundShape(t){const e=new Ammo.btCompoundShape;return t.forEach((t=>{const{_childOffset:n,_compoundOffset:i}=t;if(n){const{pos:i,quat:r,scale:s,margin:o}=n,a=this.applyPosQuatScaleMargin(t,i,r,s,o);e.addChildShape(a,t)}else if(i){const n=new Ammo.btTransform;n.setIdentity(),n.setOrigin(new Ammo.btVector3(i.x,i.y,i.z)),e.addChildShape(n,t)}else{const n=new Ammo.btTransform;n.setIdentity(),e.addChildShape(n,t)}})),e}addExisting(t,e={}){const{hasBody:n}=t;if(n)return void Fx(`Object "${t.name}" already has a physical body!`);const i=new Hn,r=new Vn,s=new Hn;t.getWorldPosition(i),t.getWorldQuaternion(r),t.getWorldScale(s);const o="1"===(e.collisionFlags||0).toString(2).slice(-1),a="1"===(e.collisionFlags||0).toString(2).slice(-2,-1),{shape:l="unknown",compound:c=[],mass:h=(o||a?0:1),collisionFlags:u=0,collisionGroup:d=1,collisionMask:p=-1,offset:m,breakable:f=!1,addChildren:g=!0,margin:v=.01,ignoreScale:y=!1,fractureImpulse:x=1}=e;if(y&&s.set(1,1,1),c.length>=1){const e=c.map((t=>this.createCollisionShape(t.shape,t))),n=this.mergeCollisionShapesToCompoundShape(e),o=this.applyPosQuatScaleMargin(n,i,r,s,v),l=this.collisionShapeToRigidBody(n,o,h,a);return this.addRigidBodyToWorld(t,l,u,d,p,m),t.body.breakable=f,t.body.fractureImpulse=x,void(t.body.ignoreScale=y)}const b=[];if("unknown"!==l||t.isMesh){const n=this.prepareThreeObjectForCollisionShape(t,e),i=this.createCollisionShape(n.shape,n.params,n.object);b.push(i)}if("unknown"===l&&g&&t.children.length>=1&&t.children.forEach((t=>{if(t.isMesh){const e=this.prepareThreeObjectForCollisionShape(t),n=this.createCollisionShape(e.shape,e.params,e.object);n._childOffset={pos:t.position.clone(),quat:t.quaternion.clone(),scale:t.scale.clone(),margin:v},b.push(n)}})),0===b.length){const n=this.prepareThreeObjectForCollisionShape(t,e),i=this.createCollisionShape(n.shape,n.params,n.object);b.push(i)}const _=1===b.length?b[0]:this.mergeCollisionShapesToCompoundShape(b),w=this.applyPosQuatScaleMargin(_,i,r,s,v),M=this.collisionShapeToRigidBody(_,w,h,a);this.addRigidBodyToWorld(t,M,u,d,p,m),t.body.breakable=f,t.body.fractureImpulse=x,t.body.ignoreScale=y}addRigidBodyToWorld(t,e,n,i,r,s){this.rigidBodies.push(t),this.physicsWorld.addRigidBody(e,i,r);const o=Object.values(e)[0];t.name||(t.name=`object-${t.id}`),e.name=t.name,t.body=new ob(this,e),t.hasBody=!0,t.ptr=o,e.threeObject=t,s&&(t.body.offset={x:0,y:0,z:0,...s}),t.body.setCollisionFlags(n)}applyPosQuatScaleMargin(t,e=new Hn,n=new Vn,i=new Hn,r=.01){t.setMargin(r);const s=new Ammo.btQuaternion(0,0,0,1);s.setValue(n.x,n.y,n.z,n.w);const o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue(e.x,e.y,e.z),o.setRotation(s),Ammo.destroy(s);const a=new Ammo.btVector3(i.x,i.y,i.z);return t.setLocalScaling(a),Ammo.destroy(a),o}collisionShapeToRigidBody(t,e,n,i){const r=new Ammo.btDefaultMotionState(e),s=new Ammo.btVector3(0,0,0);n>0&&t.calculateLocalInertia(n,s);const o=new Ammo.btRigidBodyConstructionInfo(n,r,t,s),a=new Ammo.btRigidBody(o);return(n>0||i)&&a.setActivationState(4),a}}function n_(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class i_{static createButton(t){const e=document.createElement("button");function n(){let n=null;async function i(i){i.addEventListener("end",r),await t.xr.setSession(i),e.textContent="EXIT VR",n=i}function r(){n.removeEventListener("end",r),e.textContent="ENTER VR",n=null}e.style.display="",e.style.cursor="pointer",e.style.left="calc(50% - 50px)",e.style.width="100px",e.textContent="ENTER VR",e.onmouseenter=function(){e.style.opacity="1.0"},e.onmouseleave=function(){e.style.opacity="0.5"},e.onclick=function(){if(null===n){const t={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",t).then(i)}else n.end()}}function i(){e.style.display="",e.style.cursor="auto",e.style.left="calc(50% - 75px)",e.style.width="150px",e.onmouseenter=null,e.onmouseleave=null,e.onclick=null}function r(){i(),e.textContent="VR NOT SUPPORTED"}function s(t){i(),console.warn("Exception when trying to call xr.isSessionSupported",t),e.textContent="VR NOT ALLOWED"}function o(t){t.style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.background="rgba(0,0,0,0.1)",t.style.color="#fff",t.style.font="normal 13px sans-serif",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="999"}if("xr"in navigator)return e.id="VRButton",e.style.display="none",o(e),navigator.xr.isSessionSupported("immersive-vr").then((function(t){t?n():r(),t&&i_.xrSessionIsGranted&&e.click()})).catch(s),e;{const t=document.createElement("a");return!1===window.isSecureContext?(t.href=document.location.href.replace(/^http:/,"https:"),t.innerHTML="WEBXR NEEDS HTTPS"):(t.href="https://immersiveweb.dev/",t.innerHTML="WEBXR NOT AVAILABLE"),t.style.left="calc(50% - 90px)",t.style.width="180px",t.style.textDecoration="none",o(t),t}}static registerSessionGrantedListener(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(()=>{i_.xrSessionIsGranted=!0}))}}}n_(i_,"xrSessionIsGranted",!1),i_.registerSessionGrantedListener();const r_={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function s_(t){const e=await fetch(t);if(e.ok)return e.json();throw new Error(e.statusText)}async function o_(t){if(!t)throw new Error("No basePath supplied");const e="profilesList.json",n=await s_(`${t}/${e}`);return n}async function a_(t,e,n=null,i=!0){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await o_(e);let s;if(t.profiles.some((t=>{const n=r[t];return n&&(s={profileId:t,profilePath:`${e}/${n.path}`,deprecated:!!n.deprecated}),!!s})),!s){if(!n)throw new Error("No matching profile name found");const t=r[n];if(!t)throw new Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${e}/${t.path}`,deprecated:!!t.deprecated}}const o=await s_(s.profilePath);let a;if(i){let e;if(e="any"===t.handedness?o.layouts[Object.keys(o.layouts)[0]]:o.layouts[t.handedness],!e)throw new Error(`No matching handedness, ${t.handedness}, in profile ${s.profileId}`);e.assetPath&&(a=s.profilePath.replace("profile.json",e.assetPath))}return{profile:o,assetPath:a}}const l_={xAxis:0,yAxis:0,button:0,state:r_.ComponentState.DEFAULT};function c_(t=0,e=0){let n=t,i=e;const r=Math.sqrt(t*t+e*e);if(r>1){const r=Math.atan2(e,t);n=Math.cos(r),i=Math.sin(r)}const s={normalizedXAxis:.5*n+.5,normalizedYAxis:.5*i+.5};return s}class h_{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===r_.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(l_)}updateFromComponent({xAxis:t,yAxis:e,button:n,state:i}){const{normalizedXAxis:r,normalizedYAxis:s}=c_(t,e);switch(this.componentProperty){case r_.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?r:.5;break;case r_.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case r_.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case r_.ComponentProperty.STATE:this.valueNodeProperty===r_.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class u_{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||0===Object.keys(e.gamepadIndices).length)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach((t=>{const n=new h_(e.visualResponses[t]);this.visualResponses[t]=n})),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:r_.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){const t={id:this.id,...this.values};return t}updateFromGamepad(t){if(this.values.state=r_.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&t.buttons.length>this.gamepadIndices.button){const e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||1===this.values.button?this.values.state=r_.ComponentState.PRESSED:(e.touched||this.values.button>r_.ButtonTouchThreshold)&&(this.values.state=r_.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===r_.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>r_.AxisTouchThreshold&&(this.values.state=r_.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===r_.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>r_.AxisTouchThreshold&&(this.values.state=r_.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((t=>{t.updateFromComponent(this.values)}))}}class d_{constructor(t,e,n){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=n,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((t=>{const e=this.layoutDescription.components[t];this.components[t]=new u_(t,e)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const t=[];return Object.values(this.components).forEach((e=>{t.push(e.data)})),t}updateFromGamepad(){Object.values(this.components).forEach((t=>{t.updateFromGamepad(this.xrInputSource.gamepad)}))}}const p_="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",m_="generic-trigger";class f_ extends Gi{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t||(this.envMap=t,this.traverse((t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}))),this}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((t=>{Object.values(t.visualResponses).forEach((t=>{const{valueNode:e,minNode:n,maxNode:i,value:r,valueNodeProperty:s}=t;e&&(s===r_.VisualResponseProperty.VISIBILITY?e.visible=r:s===r_.VisualResponseProperty.TRANSFORM&&(e.quaternion.slerpQuaternions(n.quaternion,i.quaternion,r),e.position.lerpVectors(n.position,i.position,r)))}))})))}}function g_(t,e){Object.values(t.components).forEach((t=>{const{type:n,touchPointNodeName:i,visualResponses:r}=t;if(n===r_.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const e=new xp(.001),n=new rr({color:255}),i=new kr(e,n);t.touchPointNode.add(i)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach((t=>{const{valueNodeName:n,minNodeName:i,maxNodeName:r,valueNodeProperty:s}=t;if(s===r_.VisualResponseProperty.TRANSFORM){if(t.minNode=e.getObjectByName(i),t.maxNode=e.getObjectByName(r),!t.minNode)return void console.warn(`Could not find ${i} in the model`);if(!t.maxNode)return void console.warn(`Could not find ${r} in the model`)}t.valueNode=e.getObjectByName(n),t.valueNode||console.warn(`Could not find ${n} in the model`)}))}))}function v_(t,e){g_(t.motionController,e),t.envMap&&e.traverse((e=>{e.isMesh&&(e.material.envMap=t.envMap,e.material.needsUpdate=!0)})),t.add(e)}class y_{constructor(t=null){this.gltfLoader=t,this.path=p_,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Ny)}createControllerModel(t){const e=new f_;let n=null;return t.addEventListener("connected",(t=>{const i=t.data;"tracked-pointer"===i.targetRayMode&&i.gamepad&&a_(i,this.path,m_).then((({profile:t,assetPath:r})=>{e.motionController=new d_(i,t,r);const s=this._assetCache[e.motionController.assetUrl];if(s)n=s.scene.clone(),v_(e,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,(t=>{this._assetCache[e.motionController.assetUrl]=t,n=t.scene.clone(),v_(e,n)}),null,(()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)}))}})).catch((t=>{console.warn(t)}))})),t.addEventListener("disconnected",(()=>{e.motionController=null,e.remove(n),n=null})),e}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class x_{constructor(t,e){this._renderer=t,this._scene=e,this.controllerModelFactory=new y_;const n=new ab;n.name="dot",this.cameraGroup=new Ah,this.cameraGroup.add(n),e.add(this.cameraGroup),t.xr.enabled=!0;const i=i_.createButton(t);i.style.cssText+="background: rgba(0, 0, 0, 0.8); ",document.body.appendChild(i),this._renderer.xr.getCamera().add(this.cameraGroup)}get isPresenting(){return!!this._renderer?.xr?.isPresenting}getController(t){const e=this._renderer.xr.getController(t);return this.cameraGroup.add(e),e}getControllerGrip(t){const e=this._renderer.xr.getControllerGrip(t),n=this.controllerModelFactory.createControllerModel(e);return e.add(n),this.cameraGroup.add(e),e}getControllerRay(t){const{targetRayMode:e}=t;if("tracked-pointer"===e){const t=new yr;t.setAttribute("position",new hr([0,0,0,0,0,-1],3)),t.setAttribute("color",new hr([1,0,0,1,1,1],3));const e=new Su({vertexColors:!0});return new Lu(t,e)}if("gaze"===e){const t=new gp(.02,.04,32).translate(0,0,-1),e=new rr({color:"red",opacity:.5,transparent:!0});return new kr(t,e)}}get camera(){return this.WebXRCamera}get WebXRCamera(){return{group:this.cameraGroup,position:this._renderer.xr.getCamera()?.position,rotation:this.isPresenting?this._renderer.xr.getCamera().rotation:void 0,getWorldDirection:t=>this.isPresenting?this._renderer.xr.getCamera().getWorldDirection(t):void 0}}}const b_=(t=20,e)=>{if(window.__loadPhysics)for(let n=0;n<t;n++){const t=["standard","basic","normal","phong","line","points"],n=(t,e)=>Math.floor(Math.random()*(e-t+1)+t),i=t=>t[Math.floor(Math.random()*t.length)];Math.random()>.5?e.add.box({x:n(-10,10),y:n(10,20),z:n(-10,10),width:n(1,2)/10,height:n(1,2)/10,depth:n(1,2)/10,mass:1},{[i(t)]:{color:Math.floor(16777215*Math.random())}}).body.setRestitution(Math.floor(10*Math.random())/20):e.add.sphere({x:n(-10,10),y:n(10,20),z:n(-10,10),radius:n(1,2)/10,mass:1},{[i(t)]:{color:Math.floor(16777215*Math.random())}}).body.setRestitution(Math.floor(10*Math.random())/20)}else console.log("There is not much fun without physics enabled!")};var __=b_;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class w_{perspectiveCamera(t={}){return w_.Perspective(t)}orthographicCamera(t={}){return w_.Orthographic(t)}static Perspective(t={}){const{fov:e=50,aspect:n=window.innerWidth/window.innerHeight,near:i=.1,far:r=2e3,x:s=0,y:o=5,z:a=25}=t,l=new Yr(e,n,i,r);return l.position.set(s,o,a),l}static Orthographic(t={}){const e=window.innerWidth,n=window.innerHeight,{left:i=e/-2,right:r=e/2,top:s=n/2,bottom:o=n/-2,near:a=1,far:l=1e3,x:c=0,y:h=0,z:u=10}=t,d=new Ja(i,r,s,o,a,l);return d.position.set(c,h,u),d}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class M_{constructor(t={}){this.sceneConfig=t,this.scenes=new Map,this.__config={},this._isRunning=!1,this._deconstructor=[];const{key:e=Math.random().toString(),enableXR:n=!1}=t;this.__config.sceneKey=e,this.__config.enableXR=n}get deconstructor(){return{add:(...t)=>{t.forEach((t=>{this._deconstructor.push(t)}))}}}initializeScene(t){const{renderer:e,parent:n,canvas:i,scene:r,scenes:s,camera:o,cache:a,physics:l,sceneConfig:c}=t;this.scene=r,this.scenes=s,this.camera=o,this.cache=a,this.physics=l,this.renderer=e,this.parent=n,this.canvas=i;const{autoStart:h,textureAnisotropy:u}=c;this.load=new Dx(this.cache,u),this.lights=new Nx(this.scene),this.transform=new ib(this.camera,this.renderer),this.csg=Lf,this.heightMap=new Wx(this.scene),this.factories=new Hx(this.scene),this.misc=new eb(this.scene,this.renderer,this.factories),this.ws=new Yx(r,e,o,this.lights,this.physics,this.load,this.factories),this.mixers=new Jx,this.cameras=new w_,this.clock=new Vm,this.__config.enableXR&&(this.webXR=new x_(this.renderer,this.scene)),h&&this.start(this.__config.sceneKey)}get sceneKey(){return this.__config.sceneKey}destroy(t){this.physics?.destroy(t.body),this.scene.remove(t),t=null}async warpSpeed(...t){return await this.ws.warpSpeed(...t)}get animationMixers(){return this.mixers.mixers}get make(){return this.factories.make}get add(){return this.factories.add}haveSomeFun(t=20){__(t,this.physics)}isRunning(){return this._isRunning}async start(t,e){t&&t!==this.__config.sceneKey?(this.stop(),this.scenes.get(t)?._start(e)):this._start(e)}async _start(t){await(this.init?.(t)),await this._preload(),await this._create(),this.renderer.setAnimationLoop((()=>{this._update()})),this._isRunning=!0}async restart(t){await this.stop(),await this.start(this.__config.sceneKey,t)}async stop(){this._isRunning=!1,this.renderer.setAnimationLoop(null),this.clock.start();for(let t of this._deconstructor)await(t.dispose?.()),await(t.destroy?.()),"function"===typeof t&&await(t?.()),t=null;if(this._deconstructor=[],this.physics?.rigidBodies)for(let t=this.physics.rigidBodies.length-1;t>=0;t--)this.physics.destroy(this.physics.rigidBodies[t]);for(let t=this.scene.children.length-1;t>=0;t--)this.scene.remove(this.scene.children[t])}setSize(t,e){this.renderer.setSize(t,e),"undefined"!==typeof this.camera.aspect&&(this.camera.aspect=t/e),this.camera.updateProjectionMatrix()}setPixelRatio(t){this.renderer.setPixelRatio(t)}init(t={}){}preload(){}create(){}update(t,e){}preRender(){}postRender(){}async _preload(){await(this.preload?.())}async _create(){await(this.create?.())}_update(){const t=1e3*this.clock.getDelta(),e=this.clock.getElapsedTime();this.update?.(parseFloat(e.toFixed(3)),parseInt(t.toString())),this.physics?.update(t),this.physics?.updateDebugger(),this.animationMixers.update(t),this.preRender(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.postRender()}}
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class S_{constructor(t={}){this.threeGraphicsConfig=t;const{alpha:e=!1,anisotropy:n=1,camera:i=w_.Perspective({z:25,y:5}),antialias:r=!1,usePhysics:s=!0,renderer:o}=t;this.textureAnisotropy=n,this.camera=i,this.scene=new Bh,this.renderer=o||new Oh({antialias:r,alpha:e}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=p,this.cache=rm,this.cache.enabled=!0,s&&("undefined"!==typeof Ammo?this.physics=new e_(this.scene,t):Fx("Are you sure you included ammo.js?"))}}const T_="0.25.3",A_=`Powered by enable3d v${T_}`;console.log(`%c %c %c %c %c ${A_} %c https://enable3d.io/`,"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none");
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class E_ extends S_{constructor(t){super(t),this.projectConfig=t,this.scenes=new Map,this.renderer.setSize(window.innerWidth,window.innerHeight),this.projectConfig.parent?this.parent=document.getElementById(this.projectConfig.parent):this.parent=document.body,this.parent||(Fx(`Parent "${this.projectConfig.parent}" not found! Will add it to the body.`),this.parent=document.body),this.parent.appendChild(this.renderer.domElement),this.canvas=this.renderer.domElement;let e="";this.projectConfig.scenes.forEach(((t,n)=>{const i=new t;0===n&&(e=i.sceneKey);const r={sceneConfig:{textureAnisotropy:this.textureAnisotropy,autoStart:!1},renderer:this.renderer,parent:this.parent,canvas:this.canvas,scene:this.scene,scenes:this.scenes,camera:this.camera,cache:this.cache,physics:this.physics};i.initializeScene(r),0===n&&(i.setSize(this.parent.clientWidth,this.parent.clientHeight),i.setPixelRatio(Math.max(1,window.devicePixelRatio/2))),this.scenes.set(i.sceneKey,i)})),this.scenes.get(e)?.start(e)}}window,"ontouchstart"in window&&window.navigator.maxTouchPoints,window;
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
new Map,document.createElement("canvas");new of,new mn,new mn,new mn;n(5017);
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
class C_ extends rb.Events{constructor(){super(...arguments),this.id=-1}get add(){return{axis:(t={})=>this.addAxis(t),button:(t={})=>this.addButton(t)}}addAxis(t={}){this.id++;const{styles:e={left:35,bottom:35,size:100}}=t,n=this.circle({styles:e}),i=this.thumb({styles:e});n.appendChild(i),document.body.appendChild(n);const{maxRadius:r=40,rotationDamping:s=.06,moveDamping:o=.01}=t,a={id:this.id,domElement:i,maxRadius:r,maxRadiusSquared:r*r,origin:{left:i.offsetLeft,top:i.offsetTop},offset:{x:0,y:0},rotationDamping:s,moveDamping:o};if(a?.domElement){const{domElement:t}=a;"ontouchstart"in window?t.addEventListener("touchstart",(t=>{t.preventDefault(),this.tap(t,a),t.stopPropagation()})):t.addEventListener("mousedown",(t=>{t.preventDefault(),this.tap(t,a),t.stopPropagation()}))}return{onMove:t=>{this.on(`axis_onmove_${a.id}`,(e=>{t(e)}))}}}addButton(t={}){this.id++;const{styles:e={right:35,bottom:35,size:80},letter:n="A"}=t,i=this.circle({styles:e}),r=this.letter({letter:n});i.appendChild(r),document.body.appendChild(i);const s={id:this.id,domElement:i,offset:{x:0,y:0}};return s?.domElement&&this.click(s),{onClick:t=>{this.on(`button_onclick_${s.id}`,(e=>{t(e)}))},onRelease:t=>{this.on(`button_onrelease_${s.id}`,(e=>{t(e)}))}}}circle(t={}){const{styles:e}=t,{top:n,right:i,bottom:r,left:s,size:o}=e,a=document.createElement("div");let l=`position:absolute; width:${o}px; height:${o}px; background:rgba(126, 126, 126, 0.5); border:#444 solid medium; border-radius:50%; cursor: pointer; `;return n&&(l+=`top:${n}px; `),i&&(l+=`right:${i}px; `),r&&(l+=`bottom:${r}px; `),s&&(l+=`left:${s}px; `),a.style.cssText=l,a}thumb(t={}){const{styles:e}=t,{size:n}=e,i=document.createElement("div");return i.style.cssText=`position: absolute; left: ${n/4}px; top: ${n/4}px; width: ${n/2}px; height: ${n/2}px; border-radius: 50%; background: #fff; `,i}letter(t={}){const{letter:e}=t,n=document.createElement("span");return n.innerText=e,n.style.cssText="position: absolute; text-align: center; top: 4px; width: 80px; height: 80px; font-size: 64px; color: #fff; ",n}click(t){const{id:e,domElement:n}=t;"ontouchstart"in window?(n.addEventListener("touchstart",(t=>{t.preventDefault(),this.emit(`button_onclick_${e}`)})),n.addEventListener("touchend",(t=>{t.preventDefault(),this.emit(`button_onrelease_${e}`)}))):(n.addEventListener("mousedown",(t=>{t.preventDefault(),this.emit(`button_onclick_${e}`),t.stopPropagation()})),n.addEventListener("mouseup",(t=>{t.preventDefault(),this.emit(`button_onrelease_${e}`),t.stopPropagation()})))}tap(t,e){t=t||window.event,e.offset=this.getMousePosition(t),"ontouchstart"in window?(document.ontouchmove=t=>{t.target===e.domElement&&this.move(t,e)},document.ontouchend=t=>{t.target===e.domElement&&this.up(e)}):(document.onmousemove=t=>{t.target===e.domElement&&this.move(t,e)},document.onmouseup=t=>{this.up(e)})}move(t,e){const{domElement:n,maxRadius:i,maxRadiusSquared:r,origin:s,offset:o,id:a}=e;t=t||window.event;const l=this.getMousePosition(t);let c=l.x-o.x,h=l.y-o.y;const u=c*c+h*h;if(u>r){const t=Math.sqrt(u);c/=t,h/=t,c*=i,h*=i}n.style.top=`${h+n.clientHeight/2}px`,n.style.left=`${c+n.clientWidth/2}px`;const d=-(h-s.top+n.clientHeight/2)/i,p=(c-s.left+n.clientWidth/2)/i;this.emit(`axis_onmove_${a}`,{top:d,right:p})}up(t){const{domElement:e,origin:n,id:i}=t;"ontouchstart"in window?(document.ontouchmove=null,document.touchend=null):(document.onmousemove=null,document.onmouseup=null),e.style.top=`${n.top}px`,e.style.left=`${n.left}px`,this.emit(`axis_onmove_${i}`,{top:0,right:0})}getMousePosition(t){const e=t.targetTouches?t.targetTouches[0].pageX:t.clientX,n=t.targetTouches?t.targetTouches[0].pageY:t.clientY;return{x:e,y:n}}}
/**
 * @description  This code has originally been copied from Sketchbook
 *
 * @author       swift502 <blaha.j502@gmail.com> (http://jblaha.art/)
 * @copyright    Copyright (c) 2018 swift502; Project Url: https://github.com/swift502/Sketchbook
 * @license      {@link https://github.com/swift502/Sketchbook/blob/master/LICENSE GPL-3.0}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE GNU GPLv3}
 */
class P_{constructor(t,e,n){this.camera=t,this.target=e,this.config=n;const{offset:i=new Hn(0,0,0),sensitivity:r=new mn(.25,.25),radius:s=8,targetRadius:o=10,interpolationFactor:a=.05,pointerLock:l=!0,autoUpdate:c=!0,theta:h=0,phi:u=0,maxPhi:d=85,minPhi:p=-85}=n;this.offset=i,this.sensitivity=r,this.radius=s,this.targetRadius=o,this.interpolationFactor=a,this.theta=h,this.phi=u,this.maxPhi=d,this.minPhi=p}update(t,e){const n=this.target.position.clone().add(this.offset);this.theta-=t*(this.sensitivity.x/2),this.theta%=360,this.phi+=e*(this.sensitivity.y/2),this.phi=Math.min(this.maxPhi,Math.max(this.minPhi,this.phi)),this.radius=pn.lerp(this.radius,this.targetRadius,this.interpolationFactor),this.camera.position.x=n.x+this.radius*Math.sin(this.theta*Math.PI/180)*Math.cos(this.phi*Math.PI/180),this.camera.position.y=n.y+this.radius*Math.sin(this.phi*Math.PI/180),this.camera.position.z=n.z+this.radius*Math.cos(this.theta*Math.PI/180)*Math.cos(this.phi*Math.PI/180),this.camera.updateMatrix(),this.camera.lookAt(n)}}class L_{constructor(t,e=!0){this._element=t,this._isRunning=!1,e&&this.request()}isLocked(){return!!document.pointerLockElement}exit(){this._isRunning=!1,document.exitPointerLock(),this.removeListeners()}removeListeners(){document.removeEventListener("pointerlockchange",(()=>this.pointerLockChangeHandler())),this._element.removeEventListener("pointerdown",(()=>this.pointerDownHandlerHandler()))}pointerLockChangeHandler(){this._isRunning&&this._request()}pointerDownHandlerHandler(){this._isRunning&&this._element.requestPointerLock()}request(){this._isRunning=!0,this._request()}_request(){document.addEventListener("pointerlockchange",(()=>this.pointerLockChangeHandler()),{once:!0}),document.pointerLockElement||this._element.addEventListener("pointerdown",(()=>this.pointerDownHandlerHandler()),{once:!0})}}class R_{constructor(t,e=!0){this._element=t,this._isRunning=!1,this._position={x:0,y:0},this._delta={x:0,y:0},this._onMoveCallback=()=>{},this._isPointerDown=!1,e&&this.start()}get isTouchDevice(){return"ontouchstart"in window}get isPointerDown(){return this._isPointerDown}start(){this._isRunning||(this._isRunning=!0,this.isTouchDevice?(this._element.addEventListener("touchstart",(t=>this.onTouchStart(t))),this._element.addEventListener("touchend",(t=>this.onTouchEnd(t))),this._element.addEventListener("touchmove",(t=>this.onTouchMove(t)))):(this._element.addEventListener("mousedown",(t=>this.onPointerDown(t))),this._element.addEventListener("mouseup",(t=>this.onPointerUp(t))),this._element.addEventListener("mouseleave",(t=>this.onPointerLeave(t))),this._element.addEventListener("mouseover",(t=>this.onPointerOver(t))),this._element.addEventListener("mousemove",(t=>this.onPointerMove(t)))))}stop(){this.isTouchDevice?(this._element.removeEventListener("touchstart",(t=>this.onTouchStart(t))),this._element.removeEventListener("touchend",(t=>this.onTouchEnd(t))),this._element.removeEventListener("touchmove",(t=>this.onTouchMove(t)))):(this._element.removeEventListener("mousedown",(t=>this.onPointerDown(t))),this._element.removeEventListener("mouseleave",(t=>this.onPointerLeave(t))),this._element.removeEventListener("mouseup",(t=>this.onPointerUp(t))),this._element.removeEventListener("mouseover",(t=>this.onPointerOver(t))),this._element.removeEventListener("mousemove",(t=>this.onPointerMove(t)))),this._isRunning=!1}removeListeners(){this.stop()}onMove(t){this._onMoveCallback=t}onPointerDown(t){this._isPointerDown=!0}onPointerUp(t){this._isPointerDown=!1}onPointerLeave(t){this._isPointerDown=!1}onPointerMove(t){const e=t.movementX,n=t.movementY;this._delta={x:e,y:n},this._onMoveCallback(this._delta)}onPointerOver(t){}onTouchStart(t){const e=t.touches[0].clientX,n=t.touches[0].clientY;this._position={x:e,y:n}}onTouchEnd(t){this._position={x:0,y:0},this._delta={x:0,y:0},this._onMoveCallback(this._delta)}onTouchMove(t){const e=t.touches[0].clientX,n=t.touches[0].clientY;this._delta={x:e-this._position.x,y:n-this._position.y},this._onMoveCallback(this._delta),this._position={x:e,y:n}}}class I_ extends am{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new hm(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{e(r.parse(n))}catch(Y_){i?i(Y_):console.error(Y_),r.manager.itemError(t)}}),n,i)}parse(t){function e(t){const e=new DataView(t),i=50,r=e.getUint32(80,!0),s=84+r*i;if(s===e.byteLength)return!0;const o=[115,111,108,105,100];for(let a=0;a<5;a++)if(n(o,e,a))return!1;return!0}function n(t,e,n){for(let i=0,r=t.length;i<r;i++)if(t[i]!==e.getUint8(n+i))return!1;return!0}function i(t){const e=new DataView(t),n=e.getUint32(80,!0);let i,r,s,o,a,l,c,h,u=!1;for(let v=0;v<70;v++)1129270351==e.getUint32(v,!1)&&82==e.getUint8(v+4)&&61==e.getUint8(v+5)&&(u=!0,o=new Float32Array(3*n*3),a=e.getUint8(v+6)/255,l=e.getUint8(v+7)/255,c=e.getUint8(v+8)/255,h=e.getUint8(v+9)/255);const d=84,p=50,m=new yr,f=new Float32Array(3*n*3),g=new Float32Array(3*n*3);for(let v=0;v<n;v++){const t=d+v*p,n=e.getFloat32(t,!0),h=e.getFloat32(t+4,!0),m=e.getFloat32(t+8,!0);if(u){const n=e.getUint16(t+48,!0);0===(32768&n)?(i=(31&n)/31,r=(n>>5&31)/31,s=(n>>10&31)/31):(i=a,r=l,s=c)}for(let a=1;a<=3;a++){const l=t+12*a,c=3*v*3+3*(a-1);f[c]=e.getFloat32(l,!0),f[c+1]=e.getFloat32(l+4,!0),f[c+2]=e.getFloat32(l+8,!0),g[c]=n,g[c+1]=h,g[c+2]=m,u&&(o[c]=i,o[c+1]=r,o[c+2]=s)}}return m.setAttribute("position",new ar(f,3)),m.setAttribute("normal",new ar(g,3)),u&&(m.setAttribute("color",new ar(o,3)),m.hasColors=!0,m.alpha=h),m}function r(t){const e=new yr,n=/solid([\s\S]*?)endsolid/g,i=/facet([\s\S]*?)endfacet/g;let r=0;const s=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,o=new RegExp("vertex"+s+s+s,"g"),a=new RegExp("normal"+s+s+s,"g"),l=[],c=[],h=new Hn;let u,d=0,p=0,m=0;while(null!==(u=n.exec(t))){p=m;const t=u[0];while(null!==(u=i.exec(t))){let t=0,e=0;const n=u[0];while(null!==(u=a.exec(n)))h.x=parseFloat(u[1]),h.y=parseFloat(u[2]),h.z=parseFloat(u[3]),e++;while(null!==(u=o.exec(n)))l.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])),c.push(h.x,h.y,h.z),t++,m++;1!==e&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+r),3!==t&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+r),r++}const n=p,s=m-p;e.addGroup(n,s,d),d++}return e.setAttribute("position",new hr(l,3)),e.setAttribute("normal",new hr(c,3)),e}function s(t){return"string"!==typeof t?Dm.decodeText(new Uint8Array(t)):t}function o(t){if("string"===typeof t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=255&t.charCodeAt(n);return e.buffer||e}return t}const a=o(t);return e(a)?i(a):r(s(t))}}class D_{constructor(t){this.buildWalls(t)}buildWalls(t){t.config.walls.forEach((e=>{let n=t.physics.add.box({name:e.name,x:e.position.x,y:e.position.y,z:e.position.z,width:e.width,depth:e.depth,height:e.height,collisionFlags:e.collisionFlags},{lambert:{color:e.color,transparent:!0,opacity:.9}});n.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),n.body.needUpdate=!0,t.debug&&console.log(e,n)}))}}class O_{constructor(t){console.log("launcher"),this.buildLauncher(t),this.scene=t}buildLauncher(t){let e=t.config.launcher,n=e.position.x,i=e.position.y,r=e.position.z,s=t.physics.add.cylinder({height:3,y:i,x:n,z:r,radiusTop:.3,radiusBottom:.3,collisionFlags:2,mass:100},{custom:t.colors["mat1"]}),o=this.launcher_interior=t.physics.add.cylinder({height:2,y:i,x:n,z:r,radiusTop:.2,radiusBottom:.2,mass:1},{custom:t.colors["mat2"]});t.physics.add.constraints.slider(s.body,o.body,{frameA:{x:Math.PI/2,y:0,z:0},frameB:{x:Math.PI/2,y:0,z:0},linearLowerLimit:-2,linearUpperLimit:2}),s.rotation.x+=Math.PI/2,s.body.needUpdate=!0,t.physics.add.box({x:n,y:i-.3,z:r-5,width:.5,depth:7,height:.1,collisionFlags:2},{lambert:{color:"green",transparent:!0,opacity:.5}});const a=t.physics.add.box({x:n+.35,y:i,z:r-5,width:7,depth:.1,height:.5,collisionFlags:2},{lambert:{color:"green",transparent:!0,opacity:.5}}),l=t.physics.add.box({x:n-.35,y:i,z:r-5,width:7,depth:.1,height:.5,collisionFlags:2},{lambert:{color:"green",transparent:!0,opacity:.5}});a.rotation.y=Math.PI/2,a.body.needUpdate=!0,l.rotation.y=Math.PI/2,l.body.needUpdate=!0}launch(){let t=this.scene.config.launcher.force||5;t*=Math.random(),this.launcher_interior.body.applyForceZ(-t)}}class N_{constructor(t){console.log("obstacles"),this.buildObstacles(t),this.buildHinge(t)}buildObstacles(t){t.config.obstacles.forEach((e=>{if(console.log(e),1==e.actif)switch(e.type){case"box":this.buildBoxObstable(t,e);break;default:break}}))}buildHinge(t){const e=(e,n)=>{let i=t.physics.add.box({depth:.25,y:n,z:0,x:e,mass:0},{custom:t.colors.mat1}),r=t.physics.add.box({depth:.25},{custom:t.colors.mat2}),s=t.physics.add.box({depth:.25,width:3,mass:2,collisionFlags:0},{custom:t.colors.mat3});t.physics.add.constraints.hinge(i.body,r.body,{pivotA:{y:-1},pivotB:{y:.3},axisA:{x:1},axisB:{x:1}}),t.physics.add.constraints.hinge(r.body,s.body,{pivotA:{y:-1.3},pivotB:{y:0},axisA:{x:1},axisB:{x:1}}),s.body.on.collision(((t,e)=>{console.log(t,e)}))};e(-2,3.5)}buildBoxObstable(t,e){let n=t.physics.add.box({name:e.name,x:e.position.x,y:e.position.y,z:e.position.z,width:e.width,depth:e.depth,height:e.height,collisionFlags:e.collisionFlags},{lambert:{color:e.color,transparent:!0,opacity:e.opacity||.9}});n.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),n.body.needUpdate=!0,t.debug&&console.log(e,n),void 0!=e.onCollision&&n.body.on.collision(((n,i)=>{"ground"!==n.name&&"start"==i&&(console.log("collision",n.uuid),void 0!=e.onCollision&&(t.score+=e.onCollision.score,console.log(t.score)))}))}}class k_{constructor(t){console.log("tubes"),console.log(t.config.tubes),this.buildTubes(t)}buildTubes(t){t.config.tubes.forEach((e=>{console.log(e);var n=[];e.positions.forEach((t=>{console.log(t);const e=new Hn(Number(t.x),Number(t.y),Number(t.z));n.push(e)})),console.log(n);var i=new Ju(n),r=new Mp(i,e.segments,e.radius,e.radialSegments,!1),s=new Pp({emissive:10066329,roughness:.4,metalness:1}),o=new kx(r,s);let a=new ab;a.add(o),t.scene.add(a),t.physics.add.existing(a,{shape:"concave"}),a.body.setCollisionFlags(2)}))}}class z_{constructor(t){console.log("colors"),this.mat1=t.add.material({lambert:{color:"yellow",transparent:!0,opacity:.5}}),this.mat2=t.add.material({lambert:{color:"blue",transparent:!0,opacity:.5}}),this.mat3=t.add.material({lambert:{color:"green",transparent:!0,opacity:.5}}),this.mat4=new Op({color:"green",transparent:!0,opacity:.5}),this.mat5=t.add.material({lambert:{color:"red",transparent:!0,opacity:.5}})}}class B_{constructor(t){console.log("ball");let e=1,n=.2;null!=t.ball&&void 0==t.config.ball_number||(t.ball=t.physics.add.sphere({x:Number(t.config.launcher.position.x),y:Number(t.config.launcher.position.y)+.05,z:Number(t.config.launcher.position.z)-2,radius:.3,mass:.4,name:"ball"},{standard:{emissive:1162458,roughness:.4,metalness:1}}),t.ball.body.setCcdMotionThreshold(e),t.ball.body.setCcdSweptSphereRadius(n))}}const F_=new I_;let U_="/noos/";const V_="ontouchstart"in window;class H_ extends M_{constructor(){super("MainScene");let t=this;window.addEventListener("tableChanged",(async function(e){t.tablename=e.detail,t.restart({level:t.currentLevel+1,tablename:e.detail})}),!1)}async init(t={level:0,tablename:"book"}){this.renderer.setPixelRatio(Math.max(1,window.devicePixelRatio/2)),this.canJump=!0,this.move=!1,this.moveTop=0,this.moveRight=0,console.log("init",t);const{level:e,tablename:n}=t;this.currentLevel=e,this.tablename=n,console.log(`Playing level ${this.currentLevel}`),this.colors=new z_(this)}async preload(){console.log("preload",this.tablename),"book"==this.tablename?await this.load.preload("book",U_+"assets/glb/book.glb"):(this.config=await n(5913)("./"+this.tablename+"/config.json"),console.log(this,this.config),alert(this.config.type),await this.loadCustomConfig(this));const t=await this.load.preload("man",U_+"assets/glb/box_man.glb");console.log("man",t,V_)}async create(){let t;if(console.log("create"),"book"==this.tablename){t=await this.warpSpeed("-ground","-orbitControls");const{hemisphereLight:e,ambientLight:n,directionalLight:i}=t.lights,r=.65;e.intensity=r,n.intensity=r,i.intensity=r;const s=async()=>{const t=await this.load.gltf("book"),e=t.scenes[0],n=new ab;n.name="scene",n.add(e),this.add.existing(n),t.animations.forEach(((t,e)=>{n.mixer=this.animationMixers.create(n),n.action=[],n.action[e]=n.mixer.clipAction(t),n.action[e].play()})),n.traverse((t=>{t.isMesh&&(t.castShadow=t.receiveShadow=!1,t.material.metalness=0,t.material.roughness=1,/mesh/i.test(t.name)&&(this.physics.add.existing(t,{shape:"concave",mass:0,collisionFlags:1,autoCenter:!1}),t.body.setAngularFactor(0,0,0),t.body.setLinearFactor(0,0,0)))}))};s()}else t=await this.warpSpeed("-orbitControls"),console.log(t.ground),t.ground.material.color.g=255;const e=async()=>{const t=await this.load.gltf("man"),e=t.scene.children[0];if(this.man=new ab,this.man.name="man",this.man.rotateY(Math.PI+.1),this.man.add(e),this.man.rotation.set(0,1.5*Math.PI,0),"book"==this.tablename?this.man.position.set(35,0,0):this.man.position.set(0,1,0),this.man.traverse((t=>{t.isMesh&&(t.castShadow=t.receiveShadow=!1,t.material.roughness=1,t.material.metalness=0)})),this.animationMixers.add(this.man.animation.mixer),t.animations.forEach((t=>{t.name&&this.man.animation.add(t.name,t)})),this.man.animation.play("idle"),this.add.existing(this.man),this.physics.add.existing(this.man,{shape:"sphere",radius:.25,width:.5,offset:{y:-.25}}),this.man.body.setFriction(.8),this.man.body.setAngularFactor(0,0,0),this.man.body.setCcdMotionThreshold(1e-7),this.man.body.setCcdSweptSphereRadius(.25),this.controls=new P_(this.camera,this.man,{offset:new Hn(0,1,0),targetRadius:3}),this.controls.theta=90,!V_){let t=new L_(this.canvas),e=new R_(this.canvas);e.onMove((e=>{t.isLocked()&&this.controls.update(2*e.x,2*e.y)}))}};e(),this.keys={w:{isDown:!1},a:{isDown:!1},s:{isDown:!1},d:{isDown:!1},space:{isDown:!1}};const n=(t,e)=>{t.preventDefault();const{keyCode:n}=t;switch(n){case 87:this.keys.w.isDown=e;break;case 38:this.keys.w.isDown=e;break;case 32:this.keys.space.isDown=e;break}};if(document.addEventListener("keydown",(t=>n(t,!0))),document.addEventListener("keyup",(t=>n(t,!1))),V_){const t=new C_,e=t.add.axis({styles:{left:35,bottom:35,size:100}});e.onMove((t=>{const{top:e,right:n}=t;this.moveTop=3*e,this.moveRight=3*n}));const n=t.add.button({letter:"A",styles:{right:35,bottom:110,size:80,position:"absolute"}});n.onClick((()=>this.jump()));const i=t.add.button({letter:"B",styles:{right:110,bottom:35,size:80,position:"fixed"}});i.onClick((()=>this.move=!0)),i.onRelease((()=>this.move=!1))}setTimeout((()=>{const t=document.getElementById("welcome-game-placeholder");t&&t.remove()}),500)}jump(){this.man&&this.canJump&&(this.canJump=!1,this.man.animation.play("jump_running",500,!1),setTimeout((()=>{this.canJump=!0,this.man.animation.play("idle")}),650),this.man.body.applyForceY(6))}update(){if(this.man&&this.man.body){this.controls.update(2*this.moveRight,2*-this.moveTop);const t=4,e=new Hn,n=this.camera.getWorldDirection(e),i=Math.atan2(n.x,n.z),r=this.man.getWorldDirection(e),s=Math.atan2(r.x,r.z);this.man.body.setAngularVelocityY(0);const o=Math.abs(i-s);let a=V_?2:4,l=Math.PI/24;if(o>l&&(o>Math.PI-l&&(a*=-1),i<s&&(a*=-1),this.man.body.setAngularVelocityY(a)),this.keys.w.isDown||this.move){"idle"===this.man.animation.current&&this.canJump&&this.man.animation.play("run");const e=Math.sin(i)*t,n=this.man.body.velocity.y,r=Math.cos(i)*t;this.man.body.setVelocity(e,n,r)}else"run"===this.man.animation.current&&this.canJump&&this.man.animation.play("idle");this.keys.space.isDown&&this.canJump&&this.jump()}}async loadCustomConfig(t){if(void 0!=t.config.walls){let e=new D_(t);console.log(e)}if(void 0!=t.config.launcher&&(t.launcher=new O_(t)),void 0!=t.config.obstacles){let e=new N_(t);console.log(e)}if(void 0!=t.config.tubes){let e=new k_(t);console.log(e)}void 0!=t.config.flipper_parts&&t.loadParts(t,t.config.flipper_parts)}async loadParts(t,e){let n=e.length;for(let i of e){console.log("loading",i.name);let r=U_+"stl/"+i.file+".stl";F_.load(r,(function(e){const n=new kx(e,t.colors["mat1"]);let r=new ab;r.add(n),void 0!=i.scale&&r.scale.set(i.scale.x,i.scale.y,i.scale.z),void 0!=i.position&&r.position.set(i.position.x,i.position.y,i.position.z),void 0!=i.rotation&&r.rotation.set(i.rotation.x,i.rotation.y,i.rotation.z),t.scene.add(r),t.physics.add.existing(r,{shape:i.shape}),r.body.setCollisionFlags(2),r.name=i.name,r.mass=2}),(i=>{let r=i.loaded/i.total;console.log(100*r+"% loaded"),1==r&&(1==n?(console.log("Parts are loaded"),new B_(t)):console.log(n+"/"+e.length),n--)}),(t=>{console.log(t),alert("error loading"+i.name+" : "+t)}))}}}var W_={name:"MainContent",created(){console.log("/noos/"),this.load()},methods:{load(){Xb("lib/ammo",(()=>new E_({antialias:!1,maxSubSteps:10,fixedTimeStep:1/120,scenes:[H_]})))}}},G_=W_,j_=n(1001),q_=(0,j_.Z)(G_,r,s,!1,null,"7322efae",null),X_=q_.exports},6077:function(t,e,n){var i=n(614),r=String,s=TypeError;t.exports=function(t){if("object"==typeof t||i(t))return t;throw s("Can't set "+r(t)+" as a prototype")}},3013:function(t){t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:function(t,e,n){"use strict";var i,r,s,o=n(3013),a=n(9781),l=n(7854),c=n(614),h=n(111),u=n(2597),d=n(648),p=n(6330),m=n(8880),f=n(8052),g=n(3070).f,v=n(7976),y=n(9518),x=n(7674),b=n(5112),_=n(9711),w=n(9909),M=w.enforce,S=w.get,T=l.Int8Array,A=T&&T.prototype,E=l.Uint8ClampedArray,C=E&&E.prototype,P=T&&y(T),L=A&&y(A),R=Object.prototype,I=l.TypeError,D=b("toStringTag"),O=_("TYPED_ARRAY_TAG"),N="TypedArrayConstructor",k=o&&!!x&&"Opera"!==d(l.opera),z=!1,B={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},F={BigInt64Array:8,BigUint64Array:8},U=function(t){if(!h(t))return!1;var e=d(t);return"DataView"===e||u(B,e)||u(F,e)},V=function(t){var e=y(t);if(h(e)){var n=S(e);return n&&u(n,N)?n[N]:V(e)}},H=function(t){if(!h(t))return!1;var e=d(t);return u(B,e)||u(F,e)},W=function(t){if(H(t))return t;throw I("Target is not a typed array")},G=function(t){if(c(t)&&(!x||v(P,t)))return t;throw I(p(t)+" is not a typed array constructor")},j=function(t,e,n,i){if(a){if(n)for(var r in B){var s=l[r];if(s&&u(s.prototype,t))try{delete s.prototype[t]}catch(o){try{s.prototype[t]=e}catch(c){}}}L[t]&&!n||f(L,t,n?e:k&&A[t]||e,i)}},q=function(t,e,n){var i,r;if(a){if(x){if(n)for(i in B)if(r=l[i],r&&u(r,t))try{delete r[t]}catch(s){}if(P[t]&&!n)return;try{return f(P,t,n?e:k&&P[t]||e)}catch(s){}}for(i in B)r=l[i],!r||r[t]&&!n||f(r,t,e)}};for(i in B)r=l[i],s=r&&r.prototype,s?M(s)[N]=r:k=!1;for(i in F)r=l[i],s=r&&r.prototype,s&&(M(s)[N]=r);if((!k||!c(P)||P===Function.prototype)&&(P=function(){throw I("Incorrect invocation")},k))for(i in B)l[i]&&x(l[i],P);if((!k||!L||L===R)&&(L=P.prototype,k))for(i in B)l[i]&&x(l[i].prototype,L);if(k&&y(C)!==L&&x(C,L),a&&!u(L,D))for(i in z=!0,g(L,D,{get:function(){return h(this)?this[O]:void 0}}),B)l[i]&&m(l[i],O,i);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:k,TYPED_ARRAY_TAG:z&&O,aTypedArray:W,aTypedArrayConstructor:G,exportTypedArrayMethod:j,exportTypedArrayStaticMethod:q,getTypedArrayConstructor:V,isView:U,isTypedArray:H,TypedArray:P,TypedArrayPrototype:L}},9671:function(t,e,n){var i=n(9974),r=n(8361),s=n(7908),o=n(6244),a=function(t){var e=1==t;return function(n,a,l){var c,h,u=s(n),d=r(u),p=i(a,l),m=o(d);while(m-- >0)if(c=d[m],h=p(c,m,u),h)switch(t){case 0:return c;case 1:return m}return e?-1:void 0}};t.exports={findLast:a(0),findLastIndex:a(1)}},648:function(t,e,n){var i=n(1694),r=n(614),s=n(4326),o=n(5112),a=o("toStringTag"),l=Object,c="Arguments"==s(function(){return arguments}()),h=function(t,e){try{return t[e]}catch(n){}};t.exports=i?s:function(t){var e,n,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=h(e=l(t),a))?n:c?s(e):"Object"==(i=s(e))&&r(e.callee)?"Arguments":i}},8544:function(t,e,n){var i=n(7293);t.exports=!i((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},9518:function(t,e,n){var i=n(2597),r=n(614),s=n(7908),o=n(6200),a=n(8544),l=o("IE_PROTO"),c=Object,h=c.prototype;t.exports=a?c.getPrototypeOf:function(t){var e=s(t);if(i(e,l))return e[l];var n=e.constructor;return r(n)&&e instanceof n?n.prototype:e instanceof c?h:null}},7674:function(t,e,n){var i=n(1702),r=n(9670),s=n(6077);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{t=i(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),t(n,[]),e=n instanceof Array}catch(o){}return function(n,i){return r(n),s(i),e?t(n,i):n.__proto__=i,n}}():void 0)},1694:function(t,e,n){var i=n(5112),r=i("toStringTag"),s={};s[r]="z",t.exports="[object z]"===String(s)},4590:function(t,e,n){"use strict";var i=n(260),r=n(9671).findLastIndex,s=i.aTypedArray,o=i.exportTypedArrayMethod;o("findLastIndex",(function(t){return r(s(this),t,arguments.length>1?arguments[1]:void 0)}))},3408:function(t,e,n){"use strict";var i=n(260),r=n(9671).findLast,s=i.aTypedArray,o=i.exportTypedArrayMethod;o("findLast",(function(t){return r(s(this),t,arguments.length>1?arguments[1]:void 0)}))},5017:function(t,e,n){n(7658),n(541),
/*!
 * matter-js 0.17.1 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
function(e,n){t.exports=n()}(0,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=22)}([function(t,e){var i={};t.exports=i,function(){i._nextId=0,i._seed=0,i._nowStartTime=+new Date,i._warnedOnce={},i._decomp=null,i.extend=function(t,e){var n,r;"boolean"===typeof e?(n=2,r=e):(n=1,r=!0);for(var s=n;s<arguments.length;s++){var o=arguments[s];if(o)for(var a in o)r&&o[a]&&o[a].constructor===Object?t[a]&&t[a].constructor!==Object?t[a]=o[a]:(t[a]=t[a]||{},i.extend(t[a],r,o[a])):t[a]=o[a]}return t},i.clone=function(t,e){return i.extend({},e,t)},i.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)e.push(n);return e},i.values=function(t){var e=[];if(Object.keys){for(var n=Object.keys(t),i=0;i<n.length;i++)e.push(t[n[i]]);return e}for(var r in t)e.push(t[r]);return e},i.get=function(t,e,n,i){e=e.split(".").slice(n,i);for(var r=0;r<e.length;r+=1)t=t[e[r]];return t},i.set=function(t,e,n,r,s){var o=e.split(".").slice(r,s);return i.get(t,e,0,-1)[o[o.length-1]]=n,n},i.shuffle=function(t){for(var e=t.length-1;e>0;e--){var n=Math.floor(i.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}return t},i.choose=function(t){return t[Math.floor(i.random()*t.length)]},i.isElement=function(t){return"undefined"!==typeof HTMLElement?t instanceof HTMLElement:!!(t&&t.nodeType&&t.nodeName)},i.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i.isFunction=function(t){return"function"===typeof t},i.isPlainObject=function(t){return"object"===typeof t&&t.constructor===Object},i.isString=function(t){return"[object String]"===toString.call(t)},i.clamp=function(t,e,n){return t<e?e:t>n?n:t},i.sign=function(t){return t<0?-1:1},i.now=function(){if("undefined"!==typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-i._nowStartTime},i.random=function(e,n){return e="undefined"!==typeof e?e:0,n="undefined"!==typeof n?n:1,e+t()*(n-e)};var t=function(){return i._seed=(9301*i._seed+49297)%233280,i._seed/233280};i.colorToNumber=function(t){return t=t.replace("#",""),3==t.length&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),parseInt(t,16)},i.logLevel=1,i.log=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.info=function(){console&&i.logLevel>0&&i.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warn=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warnOnce=function(){var t=Array.prototype.slice.call(arguments).join(" ");i._warnedOnce[t]||(i.warn(t),i._warnedOnce[t]=!0)},i.deprecated=function(t,e,n){t[e]=i.chain((function(){i.warnOnce(" deprecated ",n)}),t[e])},i.nextId=function(){return i._nextId++},i.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},i.map=function(t,e){if(t.map)return t.map(e);for(var n=[],i=0;i<t.length;i+=1)n.push(e(t[i]));return n},i.topologicalSort=function(t){var e=[],n=[],r=[];for(var s in t)n[s]||r[s]||i._topologicalSort(s,n,r,t,e);return e},i._topologicalSort=function(t,e,n,r,s){var o=r[t]||[];n[t]=!0;for(var a=0;a<o.length;a+=1){var l=o[a];n[l]||(e[l]||i._topologicalSort(l,e,n,r,s))}n[t]=!1,e[t]=!0,s.push(t)},i.chain=function(){for(var t=[],e=0;e<arguments.length;e+=1){var n=arguments[e];n._chained?t.push.apply(t,n._chained):t.push(n)}var i=function(){for(var e,n=new Array(arguments.length),i=0,r=arguments.length;i<r;i++)n[i]=arguments[i];for(i=0;i<t.length;i+=1){var s=t[i].apply(e,n);"undefined"!==typeof s&&(e=s)}return e};return i._chained=t,i},i.chainPathBefore=function(t,e,n){return i.set(t,e,i.chain(n,i.get(t,e)))},i.chainPathAfter=function(t,e,n){return i.set(t,e,i.chain(i.get(t,e),n))},i.setDecomp=function(t){i._decomp=t},i.getDecomp=function(){var t=i._decomp;try{t||"undefined"===typeof window||(t=window.decomp),t||"undefined"===typeof n.g||(t=n.g.decomp)}catch(e){t=null}return t}}()},function(t,e){var n={};t.exports=n,function(){n.create=function(t){var e={min:{x:0,y:0},max:{x:0,y:0}};return t&&n.update(e,t),e},n.update=function(t,e,n){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var i=0;i<e.length;i++){var r=e[i];r.x>t.max.x&&(t.max.x=r.x),r.x<t.min.x&&(t.min.x=r.x),r.y>t.max.y&&(t.max.y=r.y),r.y<t.min.y&&(t.min.y=r.y)}n&&(n.x>0?t.max.x+=n.x:t.min.x+=n.x,n.y>0?t.max.y+=n.y:t.min.y+=n.y)},n.contains=function(t,e){return e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y},n.overlaps=function(t,e){return t.min.x<=e.max.x&&t.max.x>=e.min.x&&t.max.y>=e.min.y&&t.min.y<=e.max.y},n.translate=function(t,e){t.min.x+=e.x,t.max.x+=e.x,t.min.y+=e.y,t.max.y+=e.y},n.shift=function(t,e){var n=t.max.x-t.min.x,i=t.max.y-t.min.y;t.min.x=e.x,t.max.x=e.x+n,t.min.y=e.y,t.max.y=e.y+i}}()},function(t,e){var n={};t.exports=n,function(){n.create=function(t,e){return{x:t||0,y:e||0}},n.clone=function(t){return{x:t.x,y:t.y}},n.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},n.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},n.rotate=function(t,e,n){var i=Math.cos(e),r=Math.sin(e);n||(n={});var s=t.x*i-t.y*r;return n.y=t.x*r+t.y*i,n.x=s,n},n.rotateAbout=function(t,e,n,i){var r=Math.cos(e),s=Math.sin(e);i||(i={});var o=n.x+((t.x-n.x)*r-(t.y-n.y)*s);return i.y=n.y+((t.x-n.x)*s+(t.y-n.y)*r),i.x=o,i},n.normalise=function(t){var e=n.magnitude(t);return 0===e?{x:0,y:0}:{x:t.x/e,y:t.y/e}},n.dot=function(t,e){return t.x*e.x+t.y*e.y},n.cross=function(t,e){return t.x*e.y-t.y*e.x},n.cross3=function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)},n.add=function(t,e,n){return n||(n={}),n.x=t.x+e.x,n.y=t.y+e.y,n},n.sub=function(t,e,n){return n||(n={}),n.x=t.x-e.x,n.y=t.y-e.y,n},n.mult=function(t,e){return{x:t.x*e,y:t.y*e}},n.div=function(t,e){return{x:t.x/e,y:t.y/e}},n.perp=function(t,e){return e=!0===e?-1:1,{x:e*-t.y,y:e*t.x}},n.neg=function(t){return{x:-t.x,y:-t.y}},n.angle=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]}()},function(t,e,n){var i={};t.exports=i;var r=n(2),s=n(0);(function(){i.create=function(t,e){for(var n=[],i=0;i<t.length;i++){var r=t[i],s={x:r.x,y:r.y,index:i,body:e,isInternal:!1};n.push(s)}return n},i.fromPath=function(t,e){var n=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,r=[];return t.replace(n,(function(t,e,n){r.push({x:parseFloat(e),y:parseFloat(n)})})),i.create(r,e)},i.centre=function(t){for(var e,n,s,o=i.area(t,!0),a={x:0,y:0},l=0;l<t.length;l++)s=(l+1)%t.length,e=r.cross(t[l],t[s]),n=r.mult(r.add(t[l],t[s]),e),a=r.add(a,n);return r.div(a,6*o)},i.mean=function(t){for(var e={x:0,y:0},n=0;n<t.length;n++)e.x+=t[n].x,e.y+=t[n].y;return r.div(e,t.length)},i.area=function(t,e){for(var n=0,i=t.length-1,r=0;r<t.length;r++)n+=(t[i].x-t[r].x)*(t[i].y+t[r].y),i=r;return e?n/2:Math.abs(n)/2},i.inertia=function(t,e){for(var n,i,s=0,o=0,a=t,l=0;l<a.length;l++)i=(l+1)%a.length,n=Math.abs(r.cross(a[i],a[l])),s+=n*(r.dot(a[i],a[i])+r.dot(a[i],a[l])+r.dot(a[l],a[l])),o+=n;return e/6*(s/o)},i.translate=function(t,e,n){var i;if(n)for(i=0;i<t.length;i++)t[i].x+=e.x*n,t[i].y+=e.y*n;else for(i=0;i<t.length;i++)t[i].x+=e.x,t[i].y+=e.y;return t},i.rotate=function(t,e,n){if(0!==e){for(var i=Math.cos(e),r=Math.sin(e),s=0;s<t.length;s++){var o=t[s],a=o.x-n.x,l=o.y-n.y;o.x=n.x+(a*i-l*r),o.y=n.y+(a*r+l*i)}return t}},i.contains=function(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=t[(n+1)%t.length];if((e.x-i.x)*(r.y-i.y)+(e.y-i.y)*(i.x-r.x)>0)return!1}return!0},i.scale=function(t,e,n,s){if(1===e&&1===n)return t;var o,a;s=s||i.centre(t);for(var l=0;l<t.length;l++)o=t[l],a=r.sub(o,s),t[l].x=s.x+a.x*e,t[l].y=s.y+a.y*n;return t},i.chamfer=function(t,e,n,i,o){e="number"===typeof e?[e]:e||[8],n="undefined"!==typeof n?n:-1,i=i||2,o=o||14;for(var a=[],l=0;l<t.length;l++){var c=t[l-1>=0?l-1:t.length-1],h=t[l],u=t[(l+1)%t.length],d=e[l<e.length?l:e.length-1];if(0!==d){var p=r.normalise({x:h.y-c.y,y:c.x-h.x}),m=r.normalise({x:u.y-h.y,y:h.x-u.x}),f=Math.sqrt(2*Math.pow(d,2)),g=r.mult(s.clone(p),d),v=r.normalise(r.mult(r.add(p,m),.5)),y=r.sub(h,r.mult(v,f)),x=n;-1===n&&(x=1.75*Math.pow(d,.32)),x=s.clamp(x,i,o),x%2===1&&(x+=1);for(var b=Math.acos(r.dot(p,m)),_=b/x,w=0;w<x;w++)a.push(r.add(r.rotate(g,_*w),y))}else a.push(h)}return a},i.clockwiseSort=function(t){var e=i.mean(t);return t.sort((function(t,n){return r.angle(e,t)-r.angle(e,n)})),t},i.isConvex=function(t){var e,n,i,r,s=0,o=t.length;if(o<3)return null;for(e=0;e<o;e++)if(n=(e+1)%o,i=(e+2)%o,r=(t[n].x-t[e].x)*(t[i].y-t[n].y),r-=(t[n].y-t[e].y)*(t[i].x-t[n].x),r<0?s|=1:r>0&&(s|=2),3===s)return!1;return 0!==s||null},i.hull=function(t){var e,n,i=[],s=[];for(t=t.slice(0),t.sort((function(t,e){var n=t.x-e.x;return 0!==n?n:t.y-e.y})),n=0;n<t.length;n+=1){e=t[n];while(s.length>=2&&r.cross3(s[s.length-2],s[s.length-1],e)<=0)s.pop();s.push(e)}for(n=t.length-1;n>=0;n-=1){e=t[n];while(i.length>=2&&r.cross3(i[i.length-2],i[i.length-1],e)<=0)i.pop();i.push(e)}return i.pop(),s.pop(),i.concat(s)}})()},function(t,e,n){var i={};t.exports=i;var r=n(0);(function(){i.on=function(t,e,n){for(var i,r=e.split(" "),s=0;s<r.length;s++)i=r[s],t.events=t.events||{},t.events[i]=t.events[i]||[],t.events[i].push(n);return n},i.off=function(t,e,n){if(e){"function"===typeof e&&(n=e,e=r.keys(t.events).join(" "));for(var i=e.split(" "),s=0;s<i.length;s++){var o=t.events[i[s]],a=[];if(n&&o)for(var l=0;l<o.length;l++)o[l]!==n&&a.push(o[l]);t.events[i[s]]=a}}else t.events={}},i.trigger=function(t,e,n){var i,s,o,a,l=t.events;if(l&&r.keys(l).length>0){n||(n={}),i=e.split(" ");for(var c=0;c<i.length;c++)if(s=i[c],o=l[s],o){a=r.clone(n,!1),a.name=s,a.source=t;for(var h=0;h<o.length;h++)o[h].apply(t,[a])}}}})()},function(t,e,n){var i={};t.exports=i;var r=n(4),s=n(0),o=n(1),a=n(6);(function(){i.create=function(t){return s.extend({id:s.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},t)},i.setModified=function(t,e,n,r){if(t.isModified=e,n&&t.parent&&i.setModified(t.parent,e,n,r),r)for(var s=0;s<t.composites.length;s++){var o=t.composites[s];i.setModified(o,e,n,r)}},i.add=function(t,e){var n=[].concat(e);r.trigger(t,"beforeAdd",{object:e});for(var o=0;o<n.length;o++){var a=n[o];switch(a.type){case"body":if(a.parent!==a){s.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}i.addBody(t,a);break;case"constraint":i.addConstraint(t,a);break;case"composite":i.addComposite(t,a);break;case"mouseConstraint":i.addConstraint(t,a.constraint);break}}return r.trigger(t,"afterAdd",{object:e}),t},i.remove=function(t,e,n){var s=[].concat(e);r.trigger(t,"beforeRemove",{object:e});for(var o=0;o<s.length;o++){var a=s[o];switch(a.type){case"body":i.removeBody(t,a,n);break;case"constraint":i.removeConstraint(t,a,n);break;case"composite":i.removeComposite(t,a,n);break;case"mouseConstraint":i.removeConstraint(t,a.constraint);break}}return r.trigger(t,"afterRemove",{object:e}),t},i.addComposite=function(t,e){return t.composites.push(e),e.parent=t,i.setModified(t,!0,!0,!1),t},i.removeComposite=function(t,e,n){var r=s.indexOf(t.composites,e);if(-1!==r&&(i.removeCompositeAt(t,r),i.setModified(t,!0,!0,!1)),n)for(var o=0;o<t.composites.length;o++)i.removeComposite(t.composites[o],e,!0);return t},i.removeCompositeAt=function(t,e){return t.composites.splice(e,1),i.setModified(t,!0,!0,!1),t},i.addBody=function(t,e){return t.bodies.push(e),i.setModified(t,!0,!0,!1),t},i.removeBody=function(t,e,n){var r=s.indexOf(t.bodies,e);if(-1!==r&&(i.removeBodyAt(t,r),i.setModified(t,!0,!0,!1)),n)for(var o=0;o<t.composites.length;o++)i.removeBody(t.composites[o],e,!0);return t},i.removeBodyAt=function(t,e){return t.bodies.splice(e,1),i.setModified(t,!0,!0,!1),t},i.addConstraint=function(t,e){return t.constraints.push(e),i.setModified(t,!0,!0,!1),t},i.removeConstraint=function(t,e,n){var r=s.indexOf(t.constraints,e);if(-1!==r&&i.removeConstraintAt(t,r),n)for(var o=0;o<t.composites.length;o++)i.removeConstraint(t.composites[o],e,!0);return t},i.removeConstraintAt=function(t,e){return t.constraints.splice(e,1),i.setModified(t,!0,!0,!1),t},i.clear=function(t,e,n){if(n)for(var r=0;r<t.composites.length;r++)i.clear(t.composites[r],e,!0);return e?t.bodies=t.bodies.filter((function(t){return t.isStatic})):t.bodies.length=0,t.constraints.length=0,t.composites.length=0,i.setModified(t,!0,!0,!1),t},i.allBodies=function(t){for(var e=[].concat(t.bodies),n=0;n<t.composites.length;n++)e=e.concat(i.allBodies(t.composites[n]));return e},i.allConstraints=function(t){for(var e=[].concat(t.constraints),n=0;n<t.composites.length;n++)e=e.concat(i.allConstraints(t.composites[n]));return e},i.allComposites=function(t){for(var e=[].concat(t.composites),n=0;n<t.composites.length;n++)e=e.concat(i.allComposites(t.composites[n]));return e},i.get=function(t,e,n){var r,s;switch(n){case"body":r=i.allBodies(t);break;case"constraint":r=i.allConstraints(t);break;case"composite":r=i.allComposites(t).concat(t);break}return r?(s=r.filter((function(t){return t.id.toString()===e.toString()})),0===s.length?null:s[0]):null},i.move=function(t,e,n){return i.remove(t,e),i.add(n,e),t},i.rebase=function(t){for(var e=i.allBodies(t).concat(i.allConstraints(t)).concat(i.allComposites(t)),n=0;n<e.length;n++)e[n].id=s.nextId();return i.setModified(t,!0,!0,!1),t},i.translate=function(t,e,n){for(var r=n?i.allBodies(t):t.bodies,s=0;s<r.length;s++)a.translate(r[s],e);return i.setModified(t,!0,!0,!1),t},i.rotate=function(t,e,n,r){for(var s=Math.cos(e),o=Math.sin(e),l=r?i.allBodies(t):t.bodies,c=0;c<l.length;c++){var h=l[c],u=h.position.x-n.x,d=h.position.y-n.y;a.setPosition(h,{x:n.x+(u*s-d*o),y:n.y+(u*o+d*s)}),a.rotate(h,e)}return i.setModified(t,!0,!0,!1),t},i.scale=function(t,e,n,r,s){for(var o=s?i.allBodies(t):t.bodies,l=0;l<o.length;l++){var c=o[l],h=c.position.x-r.x,u=c.position.y-r.y;a.setPosition(c,{x:r.x+h*e,y:r.y+u*n}),a.scale(c,e,n)}return i.setModified(t,!0,!0,!1),t},i.bounds=function(t){for(var e=i.allBodies(t),n=[],r=0;r<e.length;r+=1){var s=e[r];n.push(s.bounds.min,s.bounds.max)}return o.create(n)}})()},function(t,e,n){var i={};t.exports=i;var r=n(3),s=n(2),o=n(7),a=(n(16),n(0)),l=n(1),c=n(10);(function(){i._inertiaScale=4,i._nextCollidingGroupId=1,i._nextNonCollidingGroupId=-1,i._nextCategory=1,i.create=function(e){var n={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},i=a.extend(n,e);return t(i,e),i},i.nextGroup=function(t){return t?i._nextNonCollidingGroupId--:i._nextCollidingGroupId++},i.nextCategory=function(){return i._nextCategory=i._nextCategory<<1,i._nextCategory};var t=function(t,e){e=e||{},i.set(t,{bounds:t.bounds||l.create(t.vertices),positionPrev:t.positionPrev||s.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),r.rotate(t.vertices,t.angle,t.position),c.rotate(t.axes,t.angle),l.update(t.bounds,t.vertices,t.velocity),i.set(t,{axes:e.axes||t.axes,area:e.area||t.area,mass:e.mass||t.mass,inertia:e.inertia||t.inertia});var n=t.isStatic?"#14151f":a.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),o=t.isStatic?"#555":"#ccc",h=t.isStatic&&null===t.render.fillStyle?1:0;t.render.fillStyle=t.render.fillStyle||n,t.render.strokeStyle=t.render.strokeStyle||o,t.render.lineWidth=t.render.lineWidth||h,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};i.set=function(t,e,n){var r;for(r in"string"===typeof e&&(r=e,e={},e[r]=n),e)if(Object.prototype.hasOwnProperty.call(e,r))switch(n=e[r],r){case"isStatic":i.setStatic(t,n);break;case"isSleeping":o.set(t,n);break;case"mass":i.setMass(t,n);break;case"density":i.setDensity(t,n);break;case"inertia":i.setInertia(t,n);break;case"vertices":i.setVertices(t,n);break;case"position":i.setPosition(t,n);break;case"angle":i.setAngle(t,n);break;case"velocity":i.setVelocity(t,n);break;case"angularVelocity":i.setAngularVelocity(t,n);break;case"parts":i.setParts(t,n);break;case"centre":i.setCentre(t,n);break;default:t[r]=n}},i.setStatic=function(t,e){for(var n=0;n<t.parts.length;n++){var i=t.parts[n];i.isStatic=e,e?(i._original={restitution:i.restitution,friction:i.friction,mass:i.mass,inertia:i.inertia,density:i.density,inverseMass:i.inverseMass,inverseInertia:i.inverseInertia},i.restitution=0,i.friction=1,i.mass=i.inertia=i.density=1/0,i.inverseMass=i.inverseInertia=0,i.positionPrev.x=i.position.x,i.positionPrev.y=i.position.y,i.anglePrev=i.angle,i.angularVelocity=0,i.speed=0,i.angularSpeed=0,i.motion=0):i._original&&(i.restitution=i._original.restitution,i.friction=i._original.friction,i.mass=i._original.mass,i.inertia=i._original.inertia,i.density=i._original.density,i.inverseMass=i._original.inverseMass,i.inverseInertia=i._original.inverseInertia,i._original=null)}},i.setMass=function(t,e){var n=t.inertia/(t.mass/6);t.inertia=n*(e/6),t.inverseInertia=1/t.inertia,t.mass=e,t.inverseMass=1/t.mass,t.density=t.mass/t.area},i.setDensity=function(t,e){i.setMass(t,e*t.area),t.density=e},i.setInertia=function(t,e){t.inertia=e,t.inverseInertia=1/t.inertia},i.setVertices=function(t,e){e[0].body===t?t.vertices=e:t.vertices=r.create(e,t),t.axes=c.fromVertices(t.vertices),t.area=r.area(t.vertices),i.setMass(t,t.density*t.area);var n=r.centre(t.vertices);r.translate(t.vertices,n,-1),i.setInertia(t,i._inertiaScale*r.inertia(t.vertices,t.mass)),r.translate(t.vertices,t.position),l.update(t.bounds,t.vertices,t.velocity)},i.setParts=function(t,e,n){var s;for(e=e.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,s=0;s<e.length;s++){var o=e[s];o!==t&&(o.parent=t,t.parts.push(o))}if(1!==t.parts.length){if(n="undefined"===typeof n||n,n){var a=[];for(s=0;s<e.length;s++)a=a.concat(e[s].vertices);r.clockwiseSort(a);var l=r.hull(a),c=r.centre(l);i.setVertices(t,l),r.translate(t.vertices,c)}var h=i._totalProperties(t);t.area=h.area,t.parent=t,t.position.x=h.centre.x,t.position.y=h.centre.y,t.positionPrev.x=h.centre.x,t.positionPrev.y=h.centre.y,i.setMass(t,h.mass),i.setInertia(t,h.inertia),i.setPosition(t,h.centre)}},i.setCentre=function(t,e,n){n?(t.positionPrev.x+=e.x,t.positionPrev.y+=e.y,t.position.x+=e.x,t.position.y+=e.y):(t.positionPrev.x=e.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=e.y-(t.position.y-t.positionPrev.y),t.position.x=e.x,t.position.y=e.y)},i.setPosition=function(t,e){var n=s.sub(e,t.position);t.positionPrev.x+=n.x,t.positionPrev.y+=n.y;for(var i=0;i<t.parts.length;i++){var o=t.parts[i];o.position.x+=n.x,o.position.y+=n.y,r.translate(o.vertices,n),l.update(o.bounds,o.vertices,t.velocity)}},i.setAngle=function(t,e){var n=e-t.angle;t.anglePrev+=n;for(var i=0;i<t.parts.length;i++){var o=t.parts[i];o.angle+=n,r.rotate(o.vertices,n,t.position),c.rotate(o.axes,n),l.update(o.bounds,o.vertices,t.velocity),i>0&&s.rotateAbout(o.position,n,t.position,o.position)}},i.setVelocity=function(t,e){t.positionPrev.x=t.position.x-e.x,t.positionPrev.y=t.position.y-e.y,t.velocity.x=e.x,t.velocity.y=e.y,t.speed=s.magnitude(t.velocity)},i.setAngularVelocity=function(t,e){t.anglePrev=t.angle-e,t.angularVelocity=e,t.angularSpeed=Math.abs(t.angularVelocity)},i.translate=function(t,e){i.setPosition(t,s.add(t.position,e))},i.rotate=function(t,e,n){if(n){var r=Math.cos(e),s=Math.sin(e),o=t.position.x-n.x,a=t.position.y-n.y;i.setPosition(t,{x:n.x+(o*r-a*s),y:n.y+(o*s+a*r)}),i.setAngle(t,t.angle+e)}else i.setAngle(t,t.angle+e)},i.scale=function(t,e,n,s){var o=0,a=0;s=s||t.position;for(var h=0;h<t.parts.length;h++){var u=t.parts[h];r.scale(u.vertices,e,n,s),u.axes=c.fromVertices(u.vertices),u.area=r.area(u.vertices),i.setMass(u,t.density*u.area),r.translate(u.vertices,{x:-u.position.x,y:-u.position.y}),i.setInertia(u,i._inertiaScale*r.inertia(u.vertices,u.mass)),r.translate(u.vertices,{x:u.position.x,y:u.position.y}),h>0&&(o+=u.area,a+=u.inertia),u.position.x=s.x+(u.position.x-s.x)*e,u.position.y=s.y+(u.position.y-s.y)*n,l.update(u.bounds,u.vertices,t.velocity)}t.parts.length>1&&(t.area=o,t.isStatic||(i.setMass(t,t.density*o),i.setInertia(t,a))),t.circleRadius&&(e===n?t.circleRadius*=e:t.circleRadius=null)},i.update=function(t,e,n,i){var o=Math.pow(e*n*t.timeScale,2),a=1-t.frictionAir*n*t.timeScale,h=t.position.x-t.positionPrev.x,u=t.position.y-t.positionPrev.y;t.velocity.x=h*a*i+t.force.x/t.mass*o,t.velocity.y=u*a*i+t.force.y/t.mass*o,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.angularVelocity=(t.angle-t.anglePrev)*a*i+t.torque/t.inertia*o,t.anglePrev=t.angle,t.angle+=t.angularVelocity,t.speed=s.magnitude(t.velocity),t.angularSpeed=Math.abs(t.angularVelocity);for(var d=0;d<t.parts.length;d++){var p=t.parts[d];r.translate(p.vertices,t.velocity),d>0&&(p.position.x+=t.velocity.x,p.position.y+=t.velocity.y),0!==t.angularVelocity&&(r.rotate(p.vertices,t.angularVelocity,t.position),c.rotate(p.axes,t.angularVelocity),d>0&&s.rotateAbout(p.position,t.angularVelocity,t.position,p.position)),l.update(p.bounds,p.vertices,t.velocity)}},i.applyForce=function(t,e,n){t.force.x+=n.x,t.force.y+=n.y;var i={x:e.x-t.position.x,y:e.y-t.position.y};t.torque+=i.x*n.y-i.y*n.x},i._totalProperties=function(t){for(var e={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===t.parts.length?0:1;n<t.parts.length;n++){var i=t.parts[n],r=i.mass!==1/0?i.mass:1;e.mass+=r,e.area+=i.area,e.inertia+=i.inertia,e.centre=s.add(e.centre,s.mult(i.position,r))}return e.centre=s.div(e.centre,e.mass),e}})()},function(t,e,n){var i={};t.exports=i;var r=n(4);(function(){i._motionWakeThreshold=.18,i._motionSleepThreshold=.08,i._minBias=.9,i.update=function(t,e){for(var n=e*e*e,r=0;r<t.length;r++){var s=t[r],o=s.speed*s.speed+s.angularSpeed*s.angularSpeed;if(0===s.force.x&&0===s.force.y){var a=Math.min(s.motion,o),l=Math.max(s.motion,o);s.motion=i._minBias*a+(1-i._minBias)*l,s.sleepThreshold>0&&s.motion<i._motionSleepThreshold*n?(s.sleepCounter+=1,s.sleepCounter>=s.sleepThreshold&&i.set(s,!0)):s.sleepCounter>0&&(s.sleepCounter-=1)}else i.set(s,!1)}},i.afterCollisions=function(t,e){for(var n=e*e*e,r=0;r<t.length;r++){var s=t[r];if(s.isActive){var o=s.collision,a=o.bodyA.parent,l=o.bodyB.parent;if(!(a.isSleeping&&l.isSleeping||a.isStatic||l.isStatic)&&(a.isSleeping||l.isSleeping)){var c=a.isSleeping&&!a.isStatic?a:l,h=c===a?l:a;!c.isStatic&&h.motion>i._motionWakeThreshold*n&&i.set(c,!1)}}}},i.set=function(t,e){var n=t.isSleeping;e?(t.isSleeping=!0,t.sleepCounter=t.sleepThreshold,t.positionImpulse.x=0,t.positionImpulse.y=0,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.anglePrev=t.angle,t.speed=0,t.angularSpeed=0,t.motion=0,n||r.trigger(t,"sleepStart")):(t.isSleeping=!1,t.sleepCounter=0,n&&r.trigger(t,"sleepEnd"))}})()},function(t,e,n){var i={};t.exports=i;var r=n(3),s=n(2),o=n(7),a=n(1),l=n(10),c=n(0);(function(){i._warming=.4,i._torqueDampen=1,i._minLength=1e-6,i.create=function(t){var e=t;e.bodyA&&!e.pointA&&(e.pointA={x:0,y:0}),e.bodyB&&!e.pointB&&(e.pointB={x:0,y:0});var n=e.bodyA?s.add(e.bodyA.position,e.pointA):e.pointA,i=e.bodyB?s.add(e.bodyB.position,e.pointB):e.pointB,r=s.magnitude(s.sub(n,i));e.length="undefined"!==typeof e.length?e.length:r,e.id=e.id||c.nextId(),e.label=e.label||"Constraint",e.type="constraint",e.stiffness=e.stiffness||(e.length>0?1:.7),e.damping=e.damping||0,e.angularStiffness=e.angularStiffness||0,e.angleA=e.bodyA?e.bodyA.angle:e.angleA,e.angleB=e.bodyB?e.bodyB.angle:e.angleB,e.plugin={};var o={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===e.length&&e.stiffness>.1?(o.type="pin",o.anchors=!1):e.stiffness<.9&&(o.type="spring"),e.render=c.extend(o,e.render),e},i.preSolveAll=function(t){for(var e=0;e<t.length;e+=1){var n=t[e],i=n.constraintImpulse;n.isStatic||0===i.x&&0===i.y&&0===i.angle||(n.position.x+=i.x,n.position.y+=i.y,n.angle+=i.angle)}},i.solveAll=function(t,e){for(var n=0;n<t.length;n+=1){var r=t[n],s=!r.bodyA||r.bodyA&&r.bodyA.isStatic,o=!r.bodyB||r.bodyB&&r.bodyB.isStatic;(s||o)&&i.solve(t[n],e)}for(n=0;n<t.length;n+=1)r=t[n],s=!r.bodyA||r.bodyA&&r.bodyA.isStatic,o=!r.bodyB||r.bodyB&&r.bodyB.isStatic,s||o||i.solve(t[n],e)},i.solve=function(t,e){var n=t.bodyA,r=t.bodyB,o=t.pointA,a=t.pointB;if(n||r){n&&!n.isStatic&&(s.rotate(o,n.angle-t.angleA,o),t.angleA=n.angle),r&&!r.isStatic&&(s.rotate(a,r.angle-t.angleB,a),t.angleB=r.angle);var l=o,c=a;if(n&&(l=s.add(n.position,o)),r&&(c=s.add(r.position,a)),l&&c){var h=s.sub(l,c),u=s.magnitude(h);u<i._minLength&&(u=i._minLength);var d,p,m,f,g,v=(u-t.length)/u,y=t.stiffness<1?t.stiffness*e:t.stiffness,x=s.mult(h,v*y),b=(n?n.inverseMass:0)+(r?r.inverseMass:0),_=(n?n.inverseInertia:0)+(r?r.inverseInertia:0),w=b+_;if(t.damping){var M=s.create();m=s.div(h,u),g=s.sub(r&&s.sub(r.position,r.positionPrev)||M,n&&s.sub(n.position,n.positionPrev)||M),f=s.dot(m,g)}n&&!n.isStatic&&(p=n.inverseMass/b,n.constraintImpulse.x-=x.x*p,n.constraintImpulse.y-=x.y*p,n.position.x-=x.x*p,n.position.y-=x.y*p,t.damping&&(n.positionPrev.x-=t.damping*m.x*f*p,n.positionPrev.y-=t.damping*m.y*f*p),d=s.cross(o,x)/w*i._torqueDampen*n.inverseInertia*(1-t.angularStiffness),n.constraintImpulse.angle-=d,n.angle-=d),r&&!r.isStatic&&(p=r.inverseMass/b,r.constraintImpulse.x+=x.x*p,r.constraintImpulse.y+=x.y*p,r.position.x+=x.x*p,r.position.y+=x.y*p,t.damping&&(r.positionPrev.x+=t.damping*m.x*f*p,r.positionPrev.y+=t.damping*m.y*f*p),d=s.cross(a,x)/w*i._torqueDampen*r.inverseInertia*(1-t.angularStiffness),r.constraintImpulse.angle+=d,r.angle+=d)}}},i.postSolveAll=function(t){for(var e=0;e<t.length;e++){var n=t[e],c=n.constraintImpulse;if(!(n.isStatic||0===c.x&&0===c.y&&0===c.angle)){o.set(n,!1);for(var h=0;h<n.parts.length;h++){var u=n.parts[h];r.translate(u.vertices,c),h>0&&(u.position.x+=c.x,u.position.y+=c.y),0!==c.angle&&(r.rotate(u.vertices,c.angle,n.position),l.rotate(u.axes,c.angle),h>0&&s.rotateAbout(u.position,c.angle,n.position,u.position)),a.update(u.bounds,u.vertices,n.velocity)}c.angle*=i._warming,c.x*=i._warming,c.y*=i._warming}}},i.pointAWorld=function(t){return{x:(t.bodyA?t.bodyA.position.x:0)+t.pointA.x,y:(t.bodyA?t.bodyA.position.y:0)+t.pointA.y}},i.pointBWorld=function(t){return{x:(t.bodyB?t.bodyB.position.x:0)+t.pointB.x,y:(t.bodyB?t.bodyB.position.y:0)+t.pointB.y}}})()},function(t,e,n){var i={};t.exports=i;var r=n(17);(function(){i.create=function(t,e){var n=t.bodyA,r=t.bodyB,s=t.parentA,o=t.parentB,a={id:i.id(n,r),bodyA:n,bodyB:r,contacts:{},activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:n.isSensor||r.isSensor,timeCreated:e,timeUpdated:e,inverseMass:s.inverseMass+o.inverseMass,friction:Math.min(s.friction,o.friction),frictionStatic:Math.max(s.frictionStatic,o.frictionStatic),restitution:Math.max(s.restitution,o.restitution),slop:Math.max(s.slop,o.slop)};return i.update(a,t,e),a},i.update=function(t,e,n){var s=t.contacts,o=e.supports,a=t.activeContacts,l=e.parentA,c=e.parentB;if(t.collision=e,t.inverseMass=l.inverseMass+c.inverseMass,t.friction=Math.min(l.friction,c.friction),t.frictionStatic=Math.max(l.frictionStatic,c.frictionStatic),t.restitution=Math.max(l.restitution,c.restitution),t.slop=Math.max(l.slop,c.slop),a.length=0,e.collided){for(var h=0;h<o.length;h++){var u=o[h],d=r.id(u),p=s[d];p?a.push(p):a.push(s[d]=r.create(u))}t.separation=e.depth,i.setActive(t,!0,n)}else!0===t.isActive&&i.setActive(t,!1,n)},i.setActive=function(t,e,n){e?(t.isActive=!0,t.timeUpdated=n):(t.isActive=!1,t.activeContacts.length=0)},i.id=function(t,e){return t.id<e.id?"A"+t.id+"B"+e.id:"A"+e.id+"B"+t.id}})()},function(t,e,n){var i={};t.exports=i;var r=n(2),s=n(0);(function(){i.fromVertices=function(t){for(var e={},n=0;n<t.length;n++){var i=(n+1)%t.length,o=r.normalise({x:t[i].y-t[n].y,y:t[n].x-t[i].x}),a=0===o.y?1/0:o.x/o.y;a=a.toFixed(3).toString(),e[a]=o}return s.values(e)},i.rotate=function(t,e){if(0!==e)for(var n=Math.cos(e),i=Math.sin(e),r=0;r<t.length;r++){var s,o=t[r];s=o.x*n-o.y*i,o.y=o.x*i+o.y*n,o.x=s}}})()},function(t,e,n){var i={};t.exports=i;var r=n(3),s=n(0),o=n(6),a=n(1),l=n(2);(function(){i.rectangle=function(t,e,n,i,a){a=a||{};var l={label:"Rectangle Body",position:{x:t,y:e},vertices:r.fromPath("L 0 0 L "+n+" 0 L "+n+" "+i+" L 0 "+i)};if(a.chamfer){var c=a.chamfer;l.vertices=r.chamfer(l.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete a.chamfer}return o.create(s.extend({},l,a))},i.trapezoid=function(t,e,n,i,a,l){l=l||{},a*=.5;var c,h=(1-2*a)*n,u=n*a,d=u+h,p=d+u;c=a<.5?"L 0 0 L "+u+" "+-i+" L "+d+" "+-i+" L "+p+" 0":"L 0 0 L "+d+" "+-i+" L "+p+" 0";var m={label:"Trapezoid Body",position:{x:t,y:e},vertices:r.fromPath(c)};if(l.chamfer){var f=l.chamfer;m.vertices=r.chamfer(m.vertices,f.radius,f.quality,f.qualityMin,f.qualityMax),delete l.chamfer}return o.create(s.extend({},m,l))},i.circle=function(t,e,n,r,o){r=r||{};var a={label:"Circle Body",circleRadius:n};o=o||25;var l=Math.ceil(Math.max(10,Math.min(o,n)));return l%2===1&&(l+=1),i.polygon(t,e,l,n,s.extend({},a,r))},i.polygon=function(t,e,n,a,l){if(l=l||{},n<3)return i.circle(t,e,a,l);for(var c=2*Math.PI/n,h="",u=.5*c,d=0;d<n;d+=1){var p=u+d*c,m=Math.cos(p)*a,f=Math.sin(p)*a;h+="L "+m.toFixed(3)+" "+f.toFixed(3)+" "}var g={label:"Polygon Body",position:{x:t,y:e},vertices:r.fromPath(h)};if(l.chamfer){var v=l.chamfer;g.vertices=r.chamfer(g.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete l.chamfer}return o.create(s.extend({},g,l))},i.fromVertices=function(t,e,n,i,c,h,u,d){var p,m,f,g,v,y,x,b,_,w,M,S=s.getDecomp();for(p=Boolean(S&&S.quickDecomp),i=i||{},f=[],c="undefined"!==typeof c&&c,h="undefined"!==typeof h?h:.01,u="undefined"!==typeof u?u:10,d="undefined"!==typeof d?d:.01,s.isArray(n[0])||(n=[n]),w=0;w<n.length;w+=1)if(y=n[w],g=r.isConvex(y),v=!g,v&&!p&&s.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),g||!p)y=g?r.clockwiseSort(y):r.hull(y),f.push({position:{x:t,y:e},vertices:y});else{var T=y.map((function(t){return[t.x,t.y]}));S.makeCCW(T),!1!==h&&S.removeCollinearPoints(T,h),!1!==d&&S.removeDuplicatePoints&&S.removeDuplicatePoints(T,d);var A=S.quickDecomp(T);for(x=0;x<A.length;x++){var E=A[x],C=E.map((function(t){return{x:t[0],y:t[1]}}));u>0&&r.area(C)<u||f.push({position:r.centre(C),vertices:C})}}for(x=0;x<f.length;x++)f[x]=o.create(s.extend(f[x],i));if(c){var P=5;for(x=0;x<f.length;x++){var L=f[x];for(b=x+1;b<f.length;b++){var R=f[b];if(a.overlaps(L.bounds,R.bounds)){var I=L.vertices,D=R.vertices;for(_=0;_<L.vertices.length;_++)for(M=0;M<R.vertices.length;M++){var O=l.magnitudeSquared(l.sub(I[(_+1)%I.length],D[M])),N=l.magnitudeSquared(l.sub(I[_],D[(M+1)%D.length]));O<P&&N<P&&(I[_].isInternal=!0,D[M].isInternal=!0)}}}}}return f.length>1?(m=o.create(s.extend({parts:f.slice(0)},i)),o.setPosition(m,{x:t,y:e}),m):f[0]}})()},function(t,e,n){var i={};t.exports=i;var r=n(0);(function(){i.create=function(t){var e={};return t||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),e.element=t||document.body,e.absolute={x:0,y:0},e.position={x:0,y:0},e.mousedownPosition={x:0,y:0},e.mouseupPosition={x:0,y:0},e.offset={x:0,y:0},e.scale={x:1,y:1},e.wheelDelta=0,e.button=-1,e.pixelRatio=parseInt(e.element.getAttribute("data-pixel-ratio"),10)||1,e.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},e.mousemove=function(t){var n=i._getRelativeMousePosition(t,e.element,e.pixelRatio),r=t.changedTouches;r&&(e.button=0,t.preventDefault()),e.absolute.x=n.x,e.absolute.y=n.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.sourceEvents.mousemove=t},e.mousedown=function(t){var n=i._getRelativeMousePosition(t,e.element,e.pixelRatio),r=t.changedTouches;r?(e.button=0,t.preventDefault()):e.button=t.button,e.absolute.x=n.x,e.absolute.y=n.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mousedownPosition.x=e.position.x,e.mousedownPosition.y=e.position.y,e.sourceEvents.mousedown=t},e.mouseup=function(t){var n=i._getRelativeMousePosition(t,e.element,e.pixelRatio),r=t.changedTouches;r&&t.preventDefault(),e.button=-1,e.absolute.x=n.x,e.absolute.y=n.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mouseupPosition.x=e.position.x,e.mouseupPosition.y=e.position.y,e.sourceEvents.mouseup=t},e.mousewheel=function(t){e.wheelDelta=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),t.preventDefault()},i.setElement(e,e.element),e},i.setElement=function(t,e){t.element=e,e.addEventListener("mousemove",t.mousemove),e.addEventListener("mousedown",t.mousedown),e.addEventListener("mouseup",t.mouseup),e.addEventListener("mousewheel",t.mousewheel),e.addEventListener("DOMMouseScroll",t.mousewheel),e.addEventListener("touchmove",t.mousemove),e.addEventListener("touchstart",t.mousedown),e.addEventListener("touchend",t.mouseup)},i.clearSourceEvents=function(t){t.sourceEvents.mousemove=null,t.sourceEvents.mousedown=null,t.sourceEvents.mouseup=null,t.sourceEvents.mousewheel=null,t.wheelDelta=0},i.setOffset=function(t,e){t.offset.x=e.x,t.offset.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},i.setScale=function(t,e){t.scale.x=e.x,t.scale.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},i._getRelativeMousePosition=function(t,e,n){var i,r,s=e.getBoundingClientRect(),o=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:o.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:o.scrollTop,c=t.changedTouches;return c?(i=c[0].pageX-s.left-a,r=c[0].pageY-s.top-l):(i=t.pageX-s.left-a,r=t.pageY-s.top-l),{x:i/(e.clientWidth/(e.width||e.clientWidth)*n),y:r/(e.clientHeight/(e.height||e.clientHeight)*n)}}})()},function(t,e,n){var i={};t.exports=i;var r=n(14),s=n(9),o=n(1);(function(){i.collisions=function(t,e){for(var n=[],a=e.pairs.table,l=0;l<t.length;l++){var c=t[l][0],h=t[l][1];if((!c.isStatic&&!c.isSleeping||!h.isStatic&&!h.isSleeping)&&(i.canCollide(c.collisionFilter,h.collisionFilter)&&o.overlaps(c.bounds,h.bounds)))for(var u=c.parts.length>1?1:0;u<c.parts.length;u++)for(var d=c.parts[u],p=h.parts.length>1?1:0;p<h.parts.length;p++){var m=h.parts[p];if(d===c&&m===h||o.overlaps(d.bounds,m.bounds)){var f,g=s.id(d,m),v=a[g];f=v&&v.isActive?v.collision:null;var y=r.collides(d,m,f);y.collided&&n.push(y)}}}return n},i.canCollide=function(t,e){return t.group===e.group&&0!==t.group?t.group>0:0!==(t.mask&e.category)&&0!==(e.mask&t.category)}})()},function(t,e,n){var i={};t.exports=i;var r=n(3),s=n(2);(function(){i.collides=function(t,e,n){var o,a,l,c,h=!1;if(n){var u=t.parent,d=e.parent,p=u.speed*u.speed+u.angularSpeed*u.angularSpeed+d.speed*d.speed+d.angularSpeed*d.angularSpeed;h=n&&n.collided&&p<.2,c=n}else c={collided:!1,bodyA:t,bodyB:e};if(n&&h){var m=c.axisBody,f=m===t?e:t,g=[m.axes[n.axisNumber]];if(l=i._overlapAxes(m.vertices,f.vertices,g),c.reused=!0,l.overlap<=0)return c.collided=!1,c}else{if(o=i._overlapAxes(t.vertices,e.vertices,t.axes),o.overlap<=0)return c.collided=!1,c;if(a=i._overlapAxes(e.vertices,t.vertices,e.axes),a.overlap<=0)return c.collided=!1,c;o.overlap<a.overlap?(l=o,c.axisBody=t):(l=a,c.axisBody=e),c.axisNumber=l.axisNumber}c.bodyA=t.id<e.id?t:e,c.bodyB=t.id<e.id?e:t,c.collided=!0,c.depth=l.overlap,c.parentA=c.bodyA.parent,c.parentB=c.bodyB.parent,t=c.bodyA,e=c.bodyB,s.dot(l.axis,s.sub(e.position,t.position))<0?c.normal={x:l.axis.x,y:l.axis.y}:c.normal={x:-l.axis.x,y:-l.axis.y},c.tangent=s.perp(c.normal),c.penetration=c.penetration||{},c.penetration.x=c.normal.x*c.depth,c.penetration.y=c.normal.y*c.depth;var v=i._findSupports(t,e,c.normal),y=[];if(r.contains(t.vertices,v[0])&&y.push(v[0]),r.contains(t.vertices,v[1])&&y.push(v[1]),y.length<2){var x=i._findSupports(e,t,s.neg(c.normal));r.contains(e.vertices,x[0])&&y.push(x[0]),y.length<2&&r.contains(e.vertices,x[1])&&y.push(x[1])}return y.length<1&&(y=[v[0]]),c.supports=y,c},i._overlapAxes=function(t,e,n){for(var r,o,a=s._temp[0],l=s._temp[1],c={overlap:Number.MAX_VALUE},h=0;h<n.length;h++){if(o=n[h],i._projectToAxis(a,t,o),i._projectToAxis(l,e,o),r=Math.min(a.max-l.min,l.max-a.min),r<=0)return c.overlap=r,c;r<c.overlap&&(c.overlap=r,c.axis=o,c.axisNumber=h)}return c},i._projectToAxis=function(t,e,n){for(var i=s.dot(e[0],n),r=i,o=1;o<e.length;o+=1){var a=s.dot(e[o],n);a>r?r=a:a<i&&(i=a)}t.min=i,t.max=r},i._findSupports=function(t,e,n){for(var i,r,o,a,l=Number.MAX_VALUE,c=s._temp[0],h=e.vertices,u=t.position,d=0;d<h.length;d++)r=h[d],c.x=r.x-u.x,c.y=r.y-u.y,i=-s.dot(n,c),i<l&&(l=i,o=r);var p=o.index-1>=0?o.index-1:h.length-1;r=h[p],c.x=r.x-u.x,c.y=r.y-u.y,l=-s.dot(n,c),a=r;var m=(o.index+1)%h.length;return r=h[m],c.x=r.x-u.x,c.y=r.y-u.y,i=-s.dot(n,c),i<l&&(a=r),[o,a]}})()},function(t,e,n){var i={};t.exports=i;var r=n(0);(function(){i._registry={},i.register=function(t){if(i.isPlugin(t)||r.warn("Plugin.register:",i.toString(t),"does not implement all required fields."),t.name in i._registry){var e=i._registry[t.name],n=i.versionParse(t.version).number,s=i.versionParse(e.version).number;n>s?(r.warn("Plugin.register:",i.toString(e),"was upgraded to",i.toString(t)),i._registry[t.name]=t):n<s?r.warn("Plugin.register:",i.toString(e),"can not be downgraded to",i.toString(t)):t!==e&&r.warn("Plugin.register:",i.toString(t),"is already registered to different plugin object")}else i._registry[t.name]=t;return t},i.resolve=function(t){return i._registry[i.dependencyParse(t).name]},i.toString=function(t){return"string"===typeof t?t:(t.name||"anonymous")+"@"+(t.version||t.range||"0.0.0")},i.isPlugin=function(t){return t&&t.name&&t.version&&t.install},i.isUsed=function(t,e){return t.used.indexOf(e)>-1},i.isFor=function(t,e){var n=t.for&&i.dependencyParse(t.for);return!t.for||e.name===n.name&&i.versionSatisfies(e.version,n.range)},i.use=function(t,e){if(t.uses=(t.uses||[]).concat(e||[]),0!==t.uses.length){for(var n=i.dependencies(t),s=r.topologicalSort(n),o=[],a=0;a<s.length;a+=1)if(s[a]!==t.name){var l=i.resolve(s[a]);l?i.isUsed(t,l.name)||(i.isFor(l,t)||(r.warn("Plugin.use:",i.toString(l),"is for",l.for,"but installed on",i.toString(t)+"."),l._warned=!0),l.install?l.install(t):(r.warn("Plugin.use:",i.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(o.push(" "+i.toString(l)),delete l._warned):o.push(" "+i.toString(l)),t.used.push(l.name)):o.push(" "+s[a])}o.length>0&&r.info(o.join("  "))}else r.warn("Plugin.use:",i.toString(t),"does not specify any dependencies to install.")},i.dependencies=function(t,e){var n=i.dependencyParse(t),s=n.name;if(e=e||{},!(s in e)){t=i.resolve(t)||t,e[s]=r.map(t.uses||[],(function(e){i.isPlugin(e)&&i.register(e);var s=i.dependencyParse(e),o=i.resolve(e);return o&&!i.versionSatisfies(o.version,s.range)?(r.warn("Plugin.dependencies:",i.toString(o),"does not satisfy",i.toString(s),"used by",i.toString(n)+"."),o._warned=!0,t._warned=!0):o||(r.warn("Plugin.dependencies:",i.toString(e),"used by",i.toString(n),"could not be resolved."),t._warned=!0),s.name}));for(var o=0;o<e[s].length;o+=1)i.dependencies(e[s][o],e);return e}},i.dependencyParse=function(t){if(r.isString(t)){var e=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/;return e.test(t)||r.warn("Plugin.dependencyParse:",t,"is not a valid dependency string."),{name:t.split("@")[0],range:t.split("@")[1]||"*"}}return{name:t.name,range:t.range||t.version}},i.versionParse=function(t){var e=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-]+)?$/;e.test(t)||r.warn("Plugin.versionParse:",t,"is not a valid version or range.");var n=e.exec(t),i=Number(n[4]),s=Number(n[5]),o=Number(n[6]);return{isRange:Boolean(n[1]||n[2]),version:n[3],range:t,operator:n[1]||n[2]||"",major:i,minor:s,patch:o,parts:[i,s,o],prerelease:n[7],number:1e8*i+1e4*s+o}},i.versionSatisfies=function(t,e){e=e||"*";var n=i.versionParse(e),r=i.versionParse(t);if(n.isRange){if("*"===n.operator||"*"===t)return!0;if(">"===n.operator)return r.number>n.number;if(">="===n.operator)return r.number>=n.number;if("~"===n.operator)return r.major===n.major&&r.minor===n.minor&&r.patch>=n.patch;if("^"===n.operator)return n.major>0?r.major===n.major&&r.number>=n.number:n.minor>0?r.minor===n.minor&&r.patch>=n.patch:r.patch===n.patch}return t===e||"*"===t}})()},function(t,e,n){var i={};t.exports=i;var r=n(0),s=n(5),o=n(1),a=n(4),l=n(2),c=n(12);(function(){var t,e;"undefined"!==typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout((function(){t(r.now())}),1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),i._goodFps=30,i._goodDelta=1e3/60,i.create=function(t){var e={controller:i,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},n=r.extend(e,t);return n.canvas&&(n.canvas.width=n.options.width||n.canvas.width,n.canvas.height=n.options.height||n.canvas.height),n.mouse=t.mouse,n.engine=t.engine,n.canvas=n.canvas||u(n.options.width,n.options.height),n.context=n.canvas.getContext("2d"),n.textures={},n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.canvas.width,y:n.canvas.height}},1!==n.options.pixelRatio&&i.setPixelRatio(n,n.options.pixelRatio),r.isElement(n.element)?n.element.appendChild(n.canvas):n.canvas.parentNode||r.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),n},i.run=function(e){(function r(s){e.frameRequestId=t(r),n(e,s),i.world(e,s),(e.options.showStats||e.options.showDebug)&&i.stats(e,e.context,s),(e.options.showPerformance||e.options.showDebug)&&i.performance(e,e.context,s)})()},i.stop=function(t){e(t.frameRequestId)},i.setPixelRatio=function(t,e){var n=t.options,i=t.canvas;"auto"===e&&(e=d(i)),n.pixelRatio=e,i.setAttribute("data-pixel-ratio",e),i.width=n.width*e,i.height=n.height*e,i.style.width=n.width+"px",i.style.height=n.height+"px"},i.lookAt=function(t,e,n,i){i="undefined"===typeof i||i,e=r.isArray(e)?e:[e],n=n||{x:0,y:0};for(var s={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},o=0;o<e.length;o+=1){var a=e[o],l=a.bounds?a.bounds.min:a.min||a.position||a,h=a.bounds?a.bounds.max:a.max||a.position||a;l&&h&&(l.x<s.min.x&&(s.min.x=l.x),h.x>s.max.x&&(s.max.x=h.x),l.y<s.min.y&&(s.min.y=l.y),h.y>s.max.y&&(s.max.y=h.y))}var u=s.max.x-s.min.x+2*n.x,d=s.max.y-s.min.y+2*n.y,p=t.canvas.height,m=t.canvas.width,f=m/p,g=u/d,v=1,y=1;g>f?y=g/f:v=f/g,t.options.hasBounds=!0,t.bounds.min.x=s.min.x,t.bounds.max.x=s.min.x+u*v,t.bounds.min.y=s.min.y,t.bounds.max.y=s.min.y+d*y,i&&(t.bounds.min.x+=.5*u-u*v*.5,t.bounds.max.x+=.5*u-u*v*.5,t.bounds.min.y+=.5*d-d*y*.5,t.bounds.max.y+=.5*d-d*y*.5),t.bounds.min.x-=n.x,t.bounds.max.x-=n.x,t.bounds.min.y-=n.y,t.bounds.max.y-=n.y,t.mouse&&(c.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.canvas.width,y:(t.bounds.max.y-t.bounds.min.y)/t.canvas.height}),c.setOffset(t.mouse,t.bounds.min))},i.startViewTransform=function(t){var e=t.bounds.max.x-t.bounds.min.x,n=t.bounds.max.y-t.bounds.min.y,i=e/t.options.width,r=n/t.options.height;t.context.setTransform(t.options.pixelRatio/i,0,0,t.options.pixelRatio/r,0,0),t.context.translate(-t.bounds.min.x,-t.bounds.min.y)},i.endViewTransform=function(t){t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0)},i.world=function(t,e){var n,h=r.now(),u=t.engine,d=u.world,p=t.canvas,f=t.context,g=t.options,v=t.timing,y=s.allBodies(d),x=s.allConstraints(d),b=g.wireframes?g.wireframeBackground:g.background,_=[],w=[],M={timestamp:u.timing.timestamp};if(a.trigger(t,"beforeRender",M),t.currentBackground!==b&&m(t,b),f.globalCompositeOperation="source-in",f.fillStyle="transparent",f.fillRect(0,0,p.width,p.height),f.globalCompositeOperation="source-over",g.hasBounds){for(n=0;n<y.length;n++){var S=y[n];o.overlaps(S.bounds,t.bounds)&&_.push(S)}for(n=0;n<x.length;n++){var T=x[n],A=T.bodyA,E=T.bodyB,C=T.pointA,P=T.pointB;A&&(C=l.add(A.position,T.pointA)),E&&(P=l.add(E.position,T.pointB)),C&&P&&((o.contains(t.bounds,C)||o.contains(t.bounds,P))&&w.push(T))}i.startViewTransform(t),t.mouse&&(c.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.options.width,y:(t.bounds.max.y-t.bounds.min.y)/t.options.height}),c.setOffset(t.mouse,t.bounds.min))}else w=x,_=y,1!==t.options.pixelRatio&&t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0);!g.wireframes||u.enableSleeping&&g.showSleeping?i.bodies(t,_,f):(g.showConvexHulls&&i.bodyConvexHulls(t,_,f),i.bodyWireframes(t,_,f)),g.showBounds&&i.bodyBounds(t,_,f),(g.showAxes||g.showAngleIndicator)&&i.bodyAxes(t,_,f),g.showPositions&&i.bodyPositions(t,_,f),g.showVelocity&&i.bodyVelocity(t,_,f),g.showIds&&i.bodyIds(t,_,f),g.showSeparations&&i.separations(t,u.pairs.list,f),g.showCollisions&&i.collisions(t,u.pairs.list,f),g.showVertexNumbers&&i.vertexNumbers(t,_,f),g.showMousePosition&&i.mousePosition(t,t.mouse,f),i.constraints(w,f),g.showBroadphase&&i.grid(t,u.grid,f),g.hasBounds&&i.endViewTransform(t),a.trigger(t,"afterRender",M),v.lastElapsed=r.now()-h},i.stats=function(t,e,n){for(var i=t.engine,r=i.world,o=s.allBodies(r),a=0,l=55,c=44,h=0,u=0,d=0;d<o.length;d+=1)a+=o[d].parts.length;var p={Part:a,Body:o.length,Cons:s.allConstraints(r).length,Comp:s.allComposites(r).length,Pair:i.pairs.list.length};for(var m in e.fillStyle="#0e0f19",e.fillRect(h,u,5.5*l,c),e.font="12px Arial",e.textBaseline="top",e.textAlign="right",p){var f=p[m];e.fillStyle="#aaa",e.fillText(m,h+l,u+8),e.fillStyle="#eee",e.fillText(f,h+l,u+26),h+=l}},i.performance=function(t,e){var n=t.engine,r=t.timing,s=r.deltaHistory,o=r.elapsedHistory,a=r.timestampElapsedHistory,l=r.engineDeltaHistory,c=r.engineElapsedHistory,u=n.timing.lastDelta,d=h(s),p=h(o),m=h(l),f=h(c),g=h(a),v=g/d||0,y=1e3/d||0,x=4,b=12,_=60,w=34,M=10,S=69;e.fillStyle="#0e0f19",e.fillRect(0,50,4*b+5*_+22,w),i.status(e,M,S,_,x,s.length,Math.round(y)+" fps",y/i._goodFps,(function(t){return s[t]/d-1})),i.status(e,M+b+_,S,_,x,l.length,u.toFixed(2)+" dt",i._goodDelta/u,(function(t){return l[t]/m-1})),i.status(e,M+2*(b+_),S,_,x,c.length,f.toFixed(2)+" ut",1-f/i._goodFps,(function(t){return c[t]/f-1})),i.status(e,M+3*(b+_),S,_,x,o.length,p.toFixed(2)+" rt",1-p/i._goodFps,(function(t){return o[t]/p-1})),i.status(e,M+4*(b+_),S,_,x,a.length,v.toFixed(2)+" x",v*v*v,(function(t){return(a[t]/s[t]/v||0)-1}))},i.status=function(t,e,n,i,s,o,a,l,c){t.strokeStyle="#888",t.fillStyle="#444",t.lineWidth=1,t.fillRect(e,n+7,i,1),t.beginPath(),t.moveTo(e,n+7-s*r.clamp(.4*c(0),-2,2));for(var h=0;h<i;h+=1)t.lineTo(e+h,n+7-(h<o?s*r.clamp(.4*c(h),-2,2):0));t.stroke(),t.fillStyle="hsl("+r.clamp(25+95*l,0,120)+",100%,60%)",t.fillRect(e,n-7,4,4),t.font="12px Arial",t.textBaseline="middle",t.textAlign="right",t.fillStyle="#eee",t.fillText(a,e+i,n-5)},i.constraints=function(t,e){for(var n=e,i=0;i<t.length;i++){var s=t[i];if(s.render.visible&&s.pointA&&s.pointB){var o,a,c=s.bodyA,h=s.bodyB;if(o=c?l.add(c.position,s.pointA):s.pointA,"pin"===s.render.type)n.beginPath(),n.arc(o.x,o.y,3,0,2*Math.PI),n.closePath();else{if(a=h?l.add(h.position,s.pointB):s.pointB,n.beginPath(),n.moveTo(o.x,o.y),"spring"===s.render.type)for(var u,d=l.sub(a,o),p=l.perp(l.normalise(d)),m=Math.ceil(r.clamp(s.length/5,12,20)),f=1;f<m;f+=1)u=f%2===0?1:-1,n.lineTo(o.x+d.x*(f/m)+p.x*u*4,o.y+d.y*(f/m)+p.y*u*4);n.lineTo(a.x,a.y)}s.render.lineWidth&&(n.lineWidth=s.render.lineWidth,n.strokeStyle=s.render.strokeStyle,n.stroke()),s.render.anchors&&(n.fillStyle=s.render.strokeStyle,n.beginPath(),n.arc(o.x,o.y,3,0,2*Math.PI),n.arc(a.x,a.y,3,0,2*Math.PI),n.closePath(),n.fill())}}},i.bodies=function(t,e,n){var i,r,s,o,a=n,l=(t.engine,t.options),c=l.showInternalEdges||!l.wireframes;for(s=0;s<e.length;s++)if(i=e[s],i.render.visible)for(o=i.parts.length>1?1:0;o<i.parts.length;o++)if(r=i.parts[o],r.render.visible){if(l.showSleeping&&i.isSleeping?a.globalAlpha=.5*r.render.opacity:1!==r.render.opacity&&(a.globalAlpha=r.render.opacity),r.render.sprite&&r.render.sprite.texture&&!l.wireframes){var h=r.render.sprite,u=p(t,h.texture);a.translate(r.position.x,r.position.y),a.rotate(r.angle),a.drawImage(u,u.width*-h.xOffset*h.xScale,u.height*-h.yOffset*h.yScale,u.width*h.xScale,u.height*h.yScale),a.rotate(-r.angle),a.translate(-r.position.x,-r.position.y)}else{if(r.circleRadius)a.beginPath(),a.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(r.vertices[0].x,r.vertices[0].y);for(var d=1;d<r.vertices.length;d++)!r.vertices[d-1].isInternal||c?a.lineTo(r.vertices[d].x,r.vertices[d].y):a.moveTo(r.vertices[d].x,r.vertices[d].y),r.vertices[d].isInternal&&!c&&a.moveTo(r.vertices[(d+1)%r.vertices.length].x,r.vertices[(d+1)%r.vertices.length].y);a.lineTo(r.vertices[0].x,r.vertices[0].y),a.closePath()}l.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb",a.stroke()):(a.fillStyle=r.render.fillStyle,r.render.lineWidth&&(a.lineWidth=r.render.lineWidth,a.strokeStyle=r.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},i.bodyWireframes=function(t,e,n){var i,r,s,o,a,l=n,c=t.options.showInternalEdges;for(l.beginPath(),s=0;s<e.length;s++)if(i=e[s],i.render.visible)for(a=i.parts.length>1?1:0;a<i.parts.length;a++){for(r=i.parts[a],l.moveTo(r.vertices[0].x,r.vertices[0].y),o=1;o<r.vertices.length;o++)!r.vertices[o-1].isInternal||c?l.lineTo(r.vertices[o].x,r.vertices[o].y):l.moveTo(r.vertices[o].x,r.vertices[o].y),r.vertices[o].isInternal&&!c&&l.moveTo(r.vertices[(o+1)%r.vertices.length].x,r.vertices[(o+1)%r.vertices.length].y);l.lineTo(r.vertices[0].x,r.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},i.bodyConvexHulls=function(t,e,n){var i,r,s,o=n;for(o.beginPath(),r=0;r<e.length;r++)if(i=e[r],i.render.visible&&1!==i.parts.length){for(o.moveTo(i.vertices[0].x,i.vertices[0].y),s=1;s<i.vertices.length;s++)o.lineTo(i.vertices[s].x,i.vertices[s].y);o.lineTo(i.vertices[0].x,i.vertices[0].y)}o.lineWidth=1,o.strokeStyle="rgba(255,255,255,0.2)",o.stroke()},i.vertexNumbers=function(t,e,n){var i,r,s,o=n;for(i=0;i<e.length;i++){var a=e[i].parts;for(s=a.length>1?1:0;s<a.length;s++){var l=a[s];for(r=0;r<l.vertices.length;r++)o.fillStyle="rgba(255,255,255,0.2)",o.fillText(i+"_"+r,l.position.x+.8*(l.vertices[r].x-l.position.x),l.position.y+.8*(l.vertices[r].y-l.position.y))}}},i.mousePosition=function(t,e,n){var i=n;i.fillStyle="rgba(255,255,255,0.8)",i.fillText(e.position.x+"  "+e.position.y,e.position.x+5,e.position.y-5)},i.bodyBounds=function(t,e,n){var i=n,r=(t.engine,t.options);i.beginPath();for(var s=0;s<e.length;s++){var o=e[s];if(o.render.visible)for(var a=e[s].parts,l=a.length>1?1:0;l<a.length;l++){var c=a[l];i.rect(c.bounds.min.x,c.bounds.min.y,c.bounds.max.x-c.bounds.min.x,c.bounds.max.y-c.bounds.min.y)}}r.wireframes?i.strokeStyle="rgba(255,255,255,0.08)":i.strokeStyle="rgba(0,0,0,0.1)",i.lineWidth=1,i.stroke()},i.bodyAxes=function(t,e,n){var i,r,s,o,a=n,l=(t.engine,t.options);for(a.beginPath(),r=0;r<e.length;r++){var c=e[r],h=c.parts;if(c.render.visible)if(l.showAxes)for(s=h.length>1?1:0;s<h.length;s++)for(i=h[s],o=0;o<i.axes.length;o++){var u=i.axes[o];a.moveTo(i.position.x,i.position.y),a.lineTo(i.position.x+20*u.x,i.position.y+20*u.y)}else for(s=h.length>1?1:0;s<h.length;s++)for(i=h[s],o=0;o<i.axes.length;o++)a.moveTo(i.position.x,i.position.y),a.lineTo((i.vertices[0].x+i.vertices[i.vertices.length-1].x)/2,(i.vertices[0].y+i.vertices[i.vertices.length-1].y)/2)}l.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},i.bodyPositions=function(t,e,n){var i,r,s,o,a=n,l=(t.engine,t.options);for(a.beginPath(),s=0;s<e.length;s++)if(i=e[s],i.render.visible)for(o=0;o<i.parts.length;o++)r=i.parts[o],a.arc(r.position.x,r.position.y,3,0,2*Math.PI,!1),a.closePath();for(l.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),s=0;s<e.length;s++)i=e[s],i.render.visible&&(a.arc(i.positionPrev.x,i.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},i.bodyVelocity=function(t,e,n){var i=n;i.beginPath();for(var r=0;r<e.length;r++){var s=e[r];s.render.visible&&(i.moveTo(s.position.x,s.position.y),i.lineTo(s.position.x+2*(s.position.x-s.positionPrev.x),s.position.y+2*(s.position.y-s.positionPrev.y)))}i.lineWidth=3,i.strokeStyle="cornflowerblue",i.stroke()},i.bodyIds=function(t,e,n){var i,r,s=n;for(i=0;i<e.length;i++)if(e[i].render.visible){var o=e[i].parts;for(r=o.length>1?1:0;r<o.length;r++){var a=o[r];s.font="12px Arial",s.fillStyle="rgba(255,255,255,0.5)",s.fillText(a.id,a.position.x+10,a.position.y-10)}}},i.collisions=function(t,e,n){var i,r,s,o,a=n,l=t.options;for(a.beginPath(),s=0;s<e.length;s++)if(i=e[s],i.isActive)for(r=i.collision,o=0;o<i.activeContacts.length;o++){var c=i.activeContacts[o],h=c.vertex;a.rect(h.x-1.5,h.y-1.5,3.5,3.5)}for(l.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),s=0;s<e.length;s++)if(i=e[s],i.isActive&&(r=i.collision,i.activeContacts.length>0)){var u=i.activeContacts[0].vertex.x,d=i.activeContacts[0].vertex.y;2===i.activeContacts.length&&(u=(i.activeContacts[0].vertex.x+i.activeContacts[1].vertex.x)/2,d=(i.activeContacts[0].vertex.y+i.activeContacts[1].vertex.y)/2),r.bodyB===r.supports[0].body||!0===r.bodyA.isStatic?a.moveTo(u-8*r.normal.x,d-8*r.normal.y):a.moveTo(u+8*r.normal.x,d+8*r.normal.y),a.lineTo(u,d)}l.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},i.separations=function(t,e,n){var i,r,s,o,a,l=n,c=t.options;for(l.beginPath(),a=0;a<e.length;a++)if(i=e[a],i.isActive){r=i.collision,s=r.bodyA,o=r.bodyB;var h=1;o.isStatic||s.isStatic||(h=.5),o.isStatic&&(h=0),l.moveTo(o.position.x,o.position.y),l.lineTo(o.position.x-r.penetration.x*h,o.position.y-r.penetration.y*h),h=1,o.isStatic||s.isStatic||(h=.5),s.isStatic&&(h=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x+r.penetration.x*h,s.position.y+r.penetration.y*h)}c.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},i.grid=function(t,e,n){var i=n,s=t.options;s.wireframes?i.strokeStyle="rgba(255,180,0,0.1)":i.strokeStyle="rgba(255,180,0,0.5)",i.beginPath();for(var o=r.keys(e.buckets),a=0;a<o.length;a++){var l=o[a];if(!(e.buckets[l].length<2)){var c=l.split(/C|R/);i.rect(.5+parseInt(c[1],10)*e.bucketWidth,.5+parseInt(c[2],10)*e.bucketHeight,e.bucketWidth,e.bucketHeight)}}i.lineWidth=1,i.stroke()},i.inspector=function(t,e){t.engine;var n,i=t.selected,r=t.render,s=r.options;if(s.hasBounds){var o=r.bounds.max.x-r.bounds.min.x,a=r.bounds.max.y-r.bounds.min.y,l=o/r.options.width,c=a/r.options.height;e.scale(1/l,1/c),e.translate(-r.bounds.min.x,-r.bounds.min.y)}for(var h=0;h<i.length;h++){var u=i[h].data;switch(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.9)",e.setLineDash([1,2]),u.type){case"body":n=u.bounds,e.beginPath(),e.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),e.closePath(),e.stroke();break;case"constraint":var d=u.pointA;u.bodyA&&(d=u.pointB),e.beginPath(),e.arc(d.x,d.y,10,0,2*Math.PI),e.closePath(),e.stroke();break}e.setLineDash([]),e.translate(-.5,-.5)}null!==t.selectStart&&(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.6)",e.fillStyle="rgba(255,165,0,0.1)",n=t.selectBounds,e.beginPath(),e.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),e.closePath(),e.stroke(),e.fill(),e.translate(-.5,-.5)),s.hasBounds&&e.setTransform(1,0,0,1,0,0)};var n=function(t,e){var n=t.engine,r=t.timing,s=r.historySize,o=n.timing.timestamp;r.delta=e-r.lastTime||i._goodDelta,r.lastTime=e,r.timestampElapsed=o-r.lastTimestamp||0,r.lastTimestamp=o,r.deltaHistory.unshift(r.delta),r.deltaHistory.length=Math.min(r.deltaHistory.length,s),r.engineDeltaHistory.unshift(n.timing.lastDelta),r.engineDeltaHistory.length=Math.min(r.engineDeltaHistory.length,s),r.timestampElapsedHistory.unshift(r.timestampElapsed),r.timestampElapsedHistory.length=Math.min(r.timestampElapsedHistory.length,s),r.engineElapsedHistory.unshift(n.timing.lastElapsed),r.engineElapsedHistory.length=Math.min(r.engineElapsedHistory.length,s),r.elapsedHistory.unshift(r.lastElapsed),r.elapsedHistory.length=Math.min(r.elapsedHistory.length,s)},h=function(t){for(var e=0,n=0;n<t.length;n+=1)e+=t[n];return e/t.length||0},u=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},d=function(t){var e=t.getContext("2d"),n=window.devicePixelRatio||1,i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return n/i},p=function(t,e){var n=t.textures[e];return n||(n=t.textures[e]=new Image,n.src=e,n)},m=function(t,e){var n=e;/(jpg|gif|png)$/.test(e)&&(n="url("+e+")"),t.canvas.style.background=n,t.canvas.style.backgroundSize="contain",t.currentBackground=e}})()},function(t,e){var n={};t.exports=n,function(){n.create=function(t){return{id:n.id(t),vertex:t,normalImpulse:0,tangentImpulse:0}},n.id=function(t){return t.body.id+"_"+t.index}}()},function(t,e,n){var i={};t.exports=i;var r=n(7),s=n(19),o=n(13),a=n(20),l=n(21),c=n(4),h=n(5),u=n(8),d=n(0),p=n(6);(function(){i.create=function(t){t=t||{};var e={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},grid:null,gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},n=d.extend(e,t);return n.world=t.world||h.create({label:"World"}),n.grid=l.create(t.grid||t.broadphase),n.pairs=a.create(),n.world.gravity=n.gravity,n.broadphase=n.grid,n.metrics={},n},i.update=function(t,e,n){var p=d.now();e=e||1e3/60,n=n||1;var m,f=t.world,g=t.timing,v=t.grid,y=[];g.timestamp+=e*g.timeScale,g.lastDelta=e*g.timeScale;var x={timestamp:g.timestamp};c.trigger(t,"beforeUpdate",x);var b=h.allBodies(f),_=h.allConstraints(f);for(t.enableSleeping&&r.update(b,g.timeScale),i._bodiesApplyGravity(b,t.gravity),i._bodiesUpdate(b,e,g.timeScale,n,f.bounds),u.preSolveAll(b),m=0;m<t.constraintIterations;m++)u.solveAll(_,g.timeScale);u.postSolveAll(b),f.isModified&&l.clear(v),l.update(v,b,t,f.isModified),y=v.pairsList,f.isModified&&h.setModified(f,!1,!1,!0);var w=o.collisions(y,t),M=t.pairs,S=g.timestamp;for(a.update(M,w,S),a.removeOld(M,S),t.enableSleeping&&r.afterCollisions(M.list,g.timeScale),M.collisionStart.length>0&&c.trigger(t,"collisionStart",{pairs:M.collisionStart}),s.preSolvePosition(M.list),m=0;m<t.positionIterations;m++)s.solvePosition(M.list,g.timeScale);for(s.postSolvePosition(b),u.preSolveAll(b),m=0;m<t.constraintIterations;m++)u.solveAll(_,g.timeScale);for(u.postSolveAll(b),s.preSolveVelocity(M.list),m=0;m<t.velocityIterations;m++)s.solveVelocity(M.list,g.timeScale);return M.collisionActive.length>0&&c.trigger(t,"collisionActive",{pairs:M.collisionActive}),M.collisionEnd.length>0&&c.trigger(t,"collisionEnd",{pairs:M.collisionEnd}),i._bodiesClearForces(b),c.trigger(t,"afterUpdate",x),t.timing.lastElapsed=d.now()-p,t},i.merge=function(t,e){if(d.extend(t,e),e.world){t.world=e.world,i.clear(t);for(var n=h.allBodies(t.world),s=0;s<n.length;s++){var o=n[s];r.set(o,!1),o.id=d.nextId()}}},i.clear=function(t){var e=t.world,n=h.allBodies(e);a.clear(t.pairs),l.clear(t.grid),l.update(t.grid,n,t,!0)},i._bodiesClearForces=function(t){for(var e=0;e<t.length;e++){var n=t[e];n.force.x=0,n.force.y=0,n.torque=0}},i._bodiesApplyGravity=function(t,e){var n="undefined"!==typeof e.scale?e.scale:.001;if((0!==e.x||0!==e.y)&&0!==n)for(var i=0;i<t.length;i++){var r=t[i];r.isStatic||r.isSleeping||(r.force.y+=r.mass*e.y*n,r.force.x+=r.mass*e.x*n)}},i._bodiesUpdate=function(t,e,n,i,r){for(var s=0;s<t.length;s++){var o=t[s];o.isStatic||o.isSleeping||p.update(o,e,n,i)}}})()},function(t,e,n){var i={};t.exports=i;var r=n(3),s=n(2),o=n(0),a=n(1);(function(){i._restingThresh=4,i._restingThreshTangent=6,i._positionDampen=.9,i._positionWarming=.8,i._frictionNormalMultiplier=5,i.preSolvePosition=function(t){var e,n,i;for(e=0;e<t.length;e++)n=t[e],n.isActive&&(i=n.activeContacts.length,n.collision.parentA.totalContacts+=i,n.collision.parentB.totalContacts+=i)},i.solvePosition=function(t,e){var n,r,o,a,l,c,h,u,d,p=s._temp[0],m=s._temp[1],f=s._temp[2],g=s._temp[3];for(n=0;n<t.length;n++)r=t[n],r.isActive&&!r.isSensor&&(o=r.collision,a=o.parentA,l=o.parentB,c=o.normal,h=s.sub(s.add(l.positionImpulse,l.position,p),s.add(a.positionImpulse,s.sub(l.position,o.penetration,m),f),g),r.separation=s.dot(c,h));for(n=0;n<t.length;n++)r=t[n],r.isActive&&!r.isSensor&&(o=r.collision,a=o.parentA,l=o.parentB,c=o.normal,d=(r.separation-r.slop)*e,(a.isStatic||l.isStatic)&&(d*=2),a.isStatic||a.isSleeping||(u=i._positionDampen/a.totalContacts,a.positionImpulse.x+=c.x*d*u,a.positionImpulse.y+=c.y*d*u),l.isStatic||l.isSleeping||(u=i._positionDampen/l.totalContacts,l.positionImpulse.x-=c.x*d*u,l.positionImpulse.y-=c.y*d*u))},i.postSolvePosition=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.totalContacts=0,0!==n.positionImpulse.x||0!==n.positionImpulse.y){for(var o=0;o<n.parts.length;o++){var l=n.parts[o];r.translate(l.vertices,n.positionImpulse),a.update(l.bounds,l.vertices,n.velocity),l.position.x+=n.positionImpulse.x,l.position.y+=n.positionImpulse.y}n.positionPrev.x+=n.positionImpulse.x,n.positionPrev.y+=n.positionImpulse.y,s.dot(n.positionImpulse,n.velocity)<0?(n.positionImpulse.x=0,n.positionImpulse.y=0):(n.positionImpulse.x*=i._positionWarming,n.positionImpulse.y*=i._positionWarming)}}},i.preSolveVelocity=function(t){var e,n,i,r,o,a,l,c,h,u,d,p,m,f,g=s._temp[0],v=s._temp[1];for(e=0;e<t.length;e++)if(i=t[e],i.isActive&&!i.isSensor)for(r=i.activeContacts,o=i.collision,a=o.parentA,l=o.parentB,c=o.normal,h=o.tangent,n=0;n<r.length;n++)u=r[n],d=u.vertex,p=u.normalImpulse,m=u.tangentImpulse,0===p&&0===m||(g.x=c.x*p+h.x*m,g.y=c.y*p+h.y*m,a.isStatic||a.isSleeping||(f=s.sub(d,a.position,v),a.positionPrev.x+=g.x*a.inverseMass,a.positionPrev.y+=g.y*a.inverseMass,a.anglePrev+=s.cross(f,g)*a.inverseInertia),l.isStatic||l.isSleeping||(f=s.sub(d,l.position,v),l.positionPrev.x-=g.x*l.inverseMass,l.positionPrev.y-=g.y*l.inverseMass,l.anglePrev-=s.cross(f,g)*l.inverseInertia))},i.solveVelocity=function(t,e){for(var n=e*e,r=s._temp[0],a=s._temp[1],l=s._temp[2],c=s._temp[3],h=s._temp[4],u=s._temp[5],d=0;d<t.length;d++){var p=t[d];if(p.isActive&&!p.isSensor){var m=p.collision,f=m.parentA,g=m.parentB,v=m.normal,y=m.tangent,x=p.activeContacts,b=1/x.length;f.velocity.x=f.position.x-f.positionPrev.x,f.velocity.y=f.position.y-f.positionPrev.y,g.velocity.x=g.position.x-g.positionPrev.x,g.velocity.y=g.position.y-g.positionPrev.y,f.angularVelocity=f.angle-f.anglePrev,g.angularVelocity=g.angle-g.anglePrev;for(var _=0;_<x.length;_++){var w=x[_],M=w.vertex,S=s.sub(M,f.position,a),T=s.sub(M,g.position,l),A=s.add(f.velocity,s.mult(s.perp(S),f.angularVelocity),c),E=s.add(g.velocity,s.mult(s.perp(T),g.angularVelocity),h),C=s.sub(A,E,u),P=s.dot(v,C),L=s.dot(y,C),R=Math.abs(L),I=o.sign(L),D=(1+p.restitution)*P,O=o.clamp(p.separation+P,0,1)*i._frictionNormalMultiplier,N=L,k=1/0;R>p.friction*p.frictionStatic*O*n&&(k=R,N=o.clamp(p.friction*I*n,-k,k));var z=s.cross(S,v),B=s.cross(T,v),F=b/(f.inverseMass+g.inverseMass+f.inverseInertia*z*z+g.inverseInertia*B*B);if(D*=F,N*=F,P<0&&P*P>i._restingThresh*n)w.normalImpulse=0;else{var U=w.normalImpulse;w.normalImpulse=Math.min(w.normalImpulse+D,0),D=w.normalImpulse-U}if(L*L>i._restingThreshTangent*n)w.tangentImpulse=0;else{var V=w.tangentImpulse;w.tangentImpulse=o.clamp(w.tangentImpulse+N,-k,k),N=w.tangentImpulse-V}r.x=v.x*D+y.x*N,r.y=v.y*D+y.y*N,f.isStatic||f.isSleeping||(f.positionPrev.x+=r.x*f.inverseMass,f.positionPrev.y+=r.y*f.inverseMass,f.anglePrev+=s.cross(S,r)*f.inverseInertia),g.isStatic||g.isSleeping||(g.positionPrev.x-=r.x*g.inverseMass,g.positionPrev.y-=r.y*g.inverseMass,g.anglePrev-=s.cross(T,r)*g.inverseInertia)}}}}})()},function(t,e,n){var i={};t.exports=i;var r=n(9),s=n(0);(function(){i._pairMaxIdleLife=1e3,i.create=function(t){return s.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},t)},i.update=function(t,e,n){var i,s,o,a,l=t.list,c=t.table,h=t.collisionStart,u=t.collisionEnd,d=t.collisionActive;for(h.length=0,u.length=0,d.length=0,a=0;a<l.length;a++)l[a].confirmedActive=!1;for(a=0;a<e.length;a++)i=e[a],i.collided&&(s=r.id(i.bodyA,i.bodyB),o=c[s],o?(o.isActive?d.push(o):h.push(o),r.update(o,i,n),o.confirmedActive=!0):(o=r.create(i,n),c[s]=o,h.push(o),l.push(o)));for(a=0;a<l.length;a++)o=l[a],o.isActive&&!o.confirmedActive&&(r.setActive(o,!1,n),u.push(o))},i.removeOld=function(t,e){var n,r,s,o,a=t.list,l=t.table,c=[];for(o=0;o<a.length;o++)n=a[o],r=n.collision,r.bodyA.isSleeping||r.bodyB.isSleeping?n.timeUpdated=e:e-n.timeUpdated>i._pairMaxIdleLife&&c.push(o);for(o=0;o<c.length;o++)s=c[o]-o,n=a[s],delete l[n.id],a.splice(s,1)},i.clear=function(t){return t.table={},t.list.length=0,t.collisionStart.length=0,t.collisionActive.length=0,t.collisionEnd.length=0,t}})()},function(t,e,n){var i={};t.exports=i;var r=n(9),s=n(0);(function(){i.create=function(t){var e={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return s.extend(e,t)},i.update=function(t,e,n,r){var s,o,a,l,c,h=n.world,u=t.buckets,d=!1;for(s=0;s<e.length;s++){var p=e[s];if((!p.isSleeping||r)&&(!h.bounds||!(p.bounds.max.x<h.bounds.min.x||p.bounds.min.x>h.bounds.max.x||p.bounds.max.y<h.bounds.min.y||p.bounds.min.y>h.bounds.max.y))){var m=i._getRegion(t,p);if(!p.region||m.id!==p.region.id||r){p.region&&!r||(p.region=m);var f=i._regionUnion(m,p.region);for(o=f.startCol;o<=f.endCol;o++)for(a=f.startRow;a<=f.endRow;a++){c=i._getBucketId(o,a),l=u[c];var g=o>=m.startCol&&o<=m.endCol&&a>=m.startRow&&a<=m.endRow,v=o>=p.region.startCol&&o<=p.region.endCol&&a>=p.region.startRow&&a<=p.region.endRow;!g&&v&&v&&l&&i._bucketRemoveBody(t,l,p),(p.region===m||g&&!v||r)&&(l||(l=i._createBucket(u,c)),i._bucketAddBody(t,l,p))}p.region=m,d=!0}}}d&&(t.pairsList=i._createActivePairsList(t))},i.clear=function(t){t.buckets={},t.pairs={},t.pairsList=[]},i._regionUnion=function(t,e){var n=Math.min(t.startCol,e.startCol),r=Math.max(t.endCol,e.endCol),s=Math.min(t.startRow,e.startRow),o=Math.max(t.endRow,e.endRow);return i._createRegion(n,r,s,o)},i._getRegion=function(t,e){var n=e.bounds,r=Math.floor(n.min.x/t.bucketWidth),s=Math.floor(n.max.x/t.bucketWidth),o=Math.floor(n.min.y/t.bucketHeight),a=Math.floor(n.max.y/t.bucketHeight);return i._createRegion(r,s,o,a)},i._createRegion=function(t,e,n,i){return{id:t+","+e+","+n+","+i,startCol:t,endCol:e,startRow:n,endRow:i}},i._getBucketId=function(t,e){return"C"+t+"R"+e},i._createBucket=function(t,e){var n=t[e]=[];return n},i._bucketAddBody=function(t,e,n){for(var i=0;i<e.length;i++){var s=e[i];if(!(n.id===s.id||n.isStatic&&s.isStatic)){var o=r.id(n,s),a=t.pairs[o];a?a[2]+=1:t.pairs[o]=[n,s,1]}}e.push(n)},i._bucketRemoveBody=function(t,e,n){e.splice(s.indexOf(e,n),1);for(var i=0;i<e.length;i++){var o=e[i],a=r.id(n,o),l=t.pairs[a];l&&(l[2]-=1)}},i._createActivePairsList=function(t){var e,n,i=[];e=s.keys(t.pairs);for(var r=0;r<e.length;r++)n=t.pairs[e[r]],n[2]>0?i.push(n):delete t.pairs[e[r]];return i}})()},function(t,e,n){var i=t.exports=n(23);i.Axes=n(10),i.Bodies=n(11),i.Body=n(6),i.Bounds=n(1),i.Common=n(0),i.Composite=n(5),i.Composites=n(24),i.Constraint=n(8),i.Contact=n(17),i.Detector=n(13),i.Engine=n(18),i.Events=n(4),i.Grid=n(21),i.Mouse=n(12),i.MouseConstraint=n(25),i.Pair=n(9),i.Pairs=n(20),i.Plugin=n(15),i.Query=n(26),i.Render=n(16),i.Resolver=n(19),i.Runner=n(27),i.SAT=n(14),i.Sleeping=n(7),i.Svg=n(28),i.Vector=n(2),i.Vertices=n(3),i.World=n(29),i.Engine.run=i.Runner.run,i.Common.deprecated(i.Engine,"run","Engine.run  use Matter.Runner.run(engine) instead")},function(t,e,n){var i={};t.exports=i;var r=n(15),s=n(0);(function(){i.name="matter-js",i.version="0.17.1",i.uses=[],i.used=[],i.use=function(){r.use(i,Array.prototype.slice.call(arguments))},i.before=function(t,e){return t=t.replace(/^Matter./,""),s.chainPathBefore(i,t,e)},i.after=function(t,e){return t=t.replace(/^Matter./,""),s.chainPathAfter(i,t,e)}})()},function(t,e,n){var i={};t.exports=i;var r=n(5),s=n(8),o=n(0),a=n(6),l=n(11),c=o.deprecated;(function(){i.stack=function(t,e,n,i,s,o,l){for(var c,h=r.create({label:"Stack"}),u=t,d=e,p=0,m=0;m<i;m++){for(var f=0,g=0;g<n;g++){var v=l(u,d,g,m,c,p);if(v){var y=v.bounds.max.y-v.bounds.min.y,x=v.bounds.max.x-v.bounds.min.x;y>f&&(f=y),a.translate(v,{x:.5*x,y:.5*y}),u=v.bounds.max.x+s,r.addBody(h,v),c=v,p+=1}else u+=s}d+=f+o,u=t}return h},i.chain=function(t,e,n,i,a,l){for(var c=t.bodies,h=1;h<c.length;h++){var u=c[h-1],d=c[h],p=u.bounds.max.y-u.bounds.min.y,m=u.bounds.max.x-u.bounds.min.x,f=d.bounds.max.y-d.bounds.min.y,g=d.bounds.max.x-d.bounds.min.x,v={bodyA:u,pointA:{x:m*e,y:p*n},bodyB:d,pointB:{x:g*i,y:f*a}},y=o.extend(v,l);r.addConstraint(t,s.create(y))}return t.label+=" Chain",t},i.mesh=function(t,e,n,i,a){var l,c,h,u,d,p=t.bodies;for(l=0;l<n;l++){for(c=1;c<e;c++)h=p[c-1+l*e],u=p[c+l*e],r.addConstraint(t,s.create(o.extend({bodyA:h,bodyB:u},a)));if(l>0)for(c=0;c<e;c++)h=p[c+(l-1)*e],u=p[c+l*e],r.addConstraint(t,s.create(o.extend({bodyA:h,bodyB:u},a))),i&&c>0&&(d=p[c-1+(l-1)*e],r.addConstraint(t,s.create(o.extend({bodyA:d,bodyB:u},a)))),i&&c<e-1&&(d=p[c+1+(l-1)*e],r.addConstraint(t,s.create(o.extend({bodyA:d,bodyB:u},a))))}return t.label+=" Mesh",t},i.pyramid=function(t,e,n,r,s,o,l){return i.stack(t,e,n,r,s,o,(function(e,i,o,c,h,u){var d=Math.min(r,Math.ceil(n/2)),p=h?h.bounds.max.x-h.bounds.min.x:0;if(!(c>d)){c=d-c;var m=c,f=n-1-c;if(!(o<m||o>f)){1===u&&a.translate(h,{x:(o+(n%2===1?1:-1))*p,y:0});var g=h?o*p:0;return l(t+g+o*s,i,o,c,h,u)}}}))},i.newtonsCradle=function(t,e,n,i,o){for(var a=r.create({label:"Newtons Cradle"}),c=0;c<n;c++){var h=1.9,u=l.circle(t+c*(i*h),e+o,i,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),d=s.create({pointA:{x:t+c*(i*h),y:e},bodyB:u});r.addBody(a,u),r.addConstraint(a,d)}return a},c(i,"newtonsCradle","Composites.newtonsCradle  moved to newtonsCradle example"),i.car=function(t,e,n,i,o){var c=a.nextGroup(!0),h=20,u=.5*-n+h,d=.5*n-h,p=0,m=r.create({label:"Car"}),f=l.rectangle(t,e,n,i,{collisionFilter:{group:c},chamfer:{radius:.5*i},density:2e-4}),g=l.circle(t+u,e+p,o,{collisionFilter:{group:c},friction:.8}),v=l.circle(t+d,e+p,o,{collisionFilter:{group:c},friction:.8}),y=s.create({bodyB:f,pointB:{x:u,y:p},bodyA:g,stiffness:1,length:0}),x=s.create({bodyB:f,pointB:{x:d,y:p},bodyA:v,stiffness:1,length:0});return r.addBody(m,f),r.addBody(m,g),r.addBody(m,v),r.addConstraint(m,y),r.addConstraint(m,x),m},c(i,"car","Composites.car  moved to car example"),i.softBody=function(t,e,n,r,s,a,c,h,u,d){u=o.extend({inertia:1/0},u),d=o.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var p=i.stack(t,e,n,r,s,a,(function(t,e){return l.circle(t,e,h,u)}));return i.mesh(p,n,r,c,d),p.label="Soft Body",p},c(i,"softBody","Composites.softBody  moved to softBody and cloth examples")})()},function(t,e,n){var i={};t.exports=i;var r=n(3),s=n(7),o=n(12),a=n(4),l=n(13),c=n(8),h=n(5),u=n(0),d=n(1);(function(){i.create=function(t,e){var n=(t?t.mouse:null)||(e?e.mouse:null);n||(t&&t.render&&t.render.canvas?n=o.create(t.render.canvas):e&&e.element?n=o.create(e.element):(n=o.create(),u.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var r=c.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),s={type:"mouseConstraint",mouse:n,element:null,body:null,constraint:r,collisionFilter:{category:1,mask:4294967295,group:0}},l=u.extend(s,e);return a.on(t,"beforeUpdate",(function(){var e=h.allBodies(t.world);i.update(l,e),i._triggerEvents(l)})),l},i.update=function(t,e){var n=t.mouse,i=t.constraint,o=t.body;if(0===n.button){if(i.bodyB)s.set(i.bodyB,!1),i.pointA=n.position;else for(var c=0;c<e.length;c++)if(o=e[c],d.contains(o.bounds,n.position)&&l.canCollide(o.collisionFilter,t.collisionFilter))for(var h=o.parts.length>1?1:0;h<o.parts.length;h++){var u=o.parts[h];if(r.contains(u.vertices,n.position)){i.pointA=n.position,i.bodyB=t.body=o,i.pointB={x:n.position.x-o.position.x,y:n.position.y-o.position.y},i.angleB=o.angle,s.set(o,!1),a.trigger(t,"startdrag",{mouse:n,body:o});break}}}else i.bodyB=t.body=null,i.pointB=null,o&&a.trigger(t,"enddrag",{mouse:n,body:o})},i._triggerEvents=function(t){var e=t.mouse,n=e.sourceEvents;n.mousemove&&a.trigger(t,"mousemove",{mouse:e}),n.mousedown&&a.trigger(t,"mousedown",{mouse:e}),n.mouseup&&a.trigger(t,"mouseup",{mouse:e}),o.clearSourceEvents(e)}})()},function(t,e,n){var i={};t.exports=i;var r=n(2),s=n(14),o=n(1),a=n(11),l=n(3);(function(){i.collides=function(t,e){for(var n=[],i=0;i<e.length;i++){var r=e[i];if(o.overlaps(r.bounds,t.bounds))for(var a=1===r.parts.length?0:1;a<r.parts.length;a++){var l=r.parts[a];if(o.overlaps(l.bounds,t.bounds)){var c=s.collides(l,t);if(c.collided){n.push(c);break}}}}return n},i.ray=function(t,e,n,s){s=s||1e-100;for(var o=r.angle(e,n),l=r.magnitude(r.sub(e,n)),c=.5*(n.x+e.x),h=.5*(n.y+e.y),u=a.rectangle(c,h,l,s,{angle:o}),d=i.collides(u,t),p=0;p<d.length;p+=1){var m=d[p];m.body=m.bodyB=m.bodyA}return d},i.region=function(t,e,n){for(var i=[],r=0;r<t.length;r++){var s=t[r],a=o.overlaps(s.bounds,e);(a&&!n||!a&&n)&&i.push(s)}return i},i.point=function(t,e){for(var n=[],i=0;i<t.length;i++){var r=t[i];if(o.contains(r.bounds,e))for(var s=1===r.parts.length?0:1;s<r.parts.length;s++){var a=r.parts[s];if(o.contains(a.bounds,e)&&l.contains(a.vertices,e)){n.push(r);break}}}return n}})()},function(t,e,n){var i={};t.exports=i;var r=n(4),s=n(18),o=n(0);(function(){var t,e,n;("undefined"!==typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),t)||(t=function(t){n=setTimeout((function(){t(o.now())}),1e3/60)},e=function(){clearTimeout(n)});i.create=function(t){var e={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},n=o.extend(e,t);return n.delta=n.delta||1e3/n.fps,n.deltaMin=n.deltaMin||1e3/n.fps,n.deltaMax=n.deltaMax||1e3/(.5*n.fps),n.fps=1e3/n.delta,n},i.run=function(e,n){return"undefined"!==typeof e.positionIterations&&(n=e,e=i.create()),function r(s){e.frameRequestId=t(r),s&&e.enabled&&i.tick(e,n,s)}(),e},i.tick=function(t,e,n){var i,o=e.timing,a=1,l={timestamp:o.timestamp};r.trigger(t,"beforeTick",l),t.isFixed?i=t.delta:(i=n-t.timePrev||t.delta,t.timePrev=n,t.deltaHistory.push(i),t.deltaHistory=t.deltaHistory.slice(-t.deltaSampleSize),i=Math.min.apply(null,t.deltaHistory),i=i<t.deltaMin?t.deltaMin:i,i=i>t.deltaMax?t.deltaMax:i,a=i/t.delta,t.delta=i),0!==t.timeScalePrev&&(a*=o.timeScale/t.timeScalePrev),0===o.timeScale&&(a=0),t.timeScalePrev=o.timeScale,t.correction=a,t.frameCounter+=1,n-t.counterTimestamp>=1e3&&(t.fps=t.frameCounter*((n-t.counterTimestamp)/1e3),t.counterTimestamp=n,t.frameCounter=0),r.trigger(t,"tick",l),r.trigger(t,"beforeUpdate",l),s.update(e,i,a),r.trigger(t,"afterUpdate",l),r.trigger(t,"afterTick",l)},i.stop=function(t){e(t.frameRequestId)},i.start=function(t,e){i.run(t,e)}})()},function(t,e,n){var i={};t.exports=i;n(1);var r=n(0);(function(){i.pathToVertices=function(t,e){"undefined"===typeof window||"SVGPathSeg"in window||r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var n,s,o,a,l,c,h,u,d,p,m,f,g=[],v=0,y=0,x=0;e=e||15;var b=function(t,e,n){var i=n%2===1&&n>1;if(!d||t!=d.x||e!=d.y){d&&i?(m=d.x,f=d.y):(m=0,f=0);var r={x:m+t,y:f+e};!i&&d||(d=r),g.push(r),y=m+t,x=f+e}},_=function(t){var e=t.pathSegTypeAsLetter.toUpperCase();if("Z"!==e){switch(e){case"M":case"L":case"T":case"C":case"S":case"Q":y=t.x,x=t.y;break;case"H":y=t.x;break;case"V":x=t.y;break}b(y,x,t.pathSegType)}};for(i._svgPathToAbsolute(t),o=t.getTotalLength(),c=[],n=0;n<t.pathSegList.numberOfItems;n+=1)c.push(t.pathSegList.getItem(n));h=c.concat();while(v<o){if(p=t.getPathSegAtLength(v),l=c[p],l!=u){while(h.length&&h[0]!=l)_(h.shift());u=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=t.getPointAtLength(v),b(a.x,a.y,0);break}v+=e}for(n=0,s=h.length;n<s;++n)_(h[n]);return g},i._svgPathToAbsolute=function(t){for(var e,n,i,r,s,o,a=t.pathSegList,l=0,c=0,h=a.numberOfItems,u=0;u<h;++u){var d=a.getItem(u),p=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(p))"x"in d&&(l=d.x),"y"in d&&(c=d.y);else switch("x1"in d&&(i=l+d.x1),"x2"in d&&(s=l+d.x2),"y1"in d&&(r=c+d.y1),"y2"in d&&(o=c+d.y2),"x"in d&&(l+=d.x),"y"in d&&(c+=d.y),p){case"m":a.replaceItem(t.createSVGPathSegMovetoAbs(l,c),u);break;case"l":a.replaceItem(t.createSVGPathSegLinetoAbs(l,c),u);break;case"h":a.replaceItem(t.createSVGPathSegLinetoHorizontalAbs(l),u);break;case"v":a.replaceItem(t.createSVGPathSegLinetoVerticalAbs(c),u);break;case"c":a.replaceItem(t.createSVGPathSegCurvetoCubicAbs(l,c,i,r,s,o),u);break;case"s":a.replaceItem(t.createSVGPathSegCurvetoCubicSmoothAbs(l,c,s,o),u);break;case"q":a.replaceItem(t.createSVGPathSegCurvetoQuadraticAbs(l,c,i,r),u);break;case"t":a.replaceItem(t.createSVGPathSegCurvetoQuadraticSmoothAbs(l,c),u);break;case"a":a.replaceItem(t.createSVGPathSegArcAbs(l,c,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),u);break;case"z":case"Z":l=e,c=n;break}"M"!=p&&"m"!=p||(e=l,n=c)}}})()},function(t,e,n){var i={};t.exports=i;var r=n(5);n(0);(function(){i.create=r.create,i.add=r.add,i.remove=r.remove,i.clear=r.clear,i.addComposite=r.addComposite,i.addBody=r.addBody,i.addConstraint=r.addConstraint})()}])}))},5913:function(t,e,n){var i={"./accueil/config.json":[2951,951],"./default/config.json":[2837,837],"./flipball/config.json":[4833,833],"./marble/config.json":[6291,291],"./modele/config.json":[1477,477],"./table1/config.json":[4095,95],"./table2/config.json":[3921,921]};function r(t){if(!n.o(i,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=i[t],r=e[0];return n.e(e[1]).then((function(){return n.t(r,19)}))}r.keys=function(){return Object.keys(i)},r.id=5913,t.exports=r},5795:function(t,e,n){"use strict";
/**
 * @package      npmjs.com/package/@yandeu/events (events.min.js)
 *
 * @author       Arnout Kazemier (https://github.com/3rd-Eden)
 * @copyright    Copyright (c) 2014 Arnout Kazemier
 * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events
 * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}
 */n(7658);var i=this&&this.__spreadArray||function(t,e){for(var n=0,i=e.length,r=t.length;n<i;n++,r++)t[r]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.Events=void 0;var r=n(5753),s=function(){function t(t,e,n){void 0===n&&(n=!1),this.fn=t,this.context=e,this.once=n}return t}(),o=function(t,e,n,i,r){if("function"!==typeof n)throw new TypeError("The listener must be a function");var o=new s(n,i||t,r);return t._events.has(e)?t._events.get(e).fn?t._events.set(e,[t._events.get(e),o]):t._events.get(e).push(o):(t._events.set(e,o),t._eventsCount++),t},a=function(t,e){0===--t._eventsCount?t._events=new Map:t._events.delete(e)},l=function(){function t(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(t,"VERSION",{get:function(){return r.VERSION},enumerable:!1,configurable:!0}),t.prototype.eventNames=function(){return Array.from(this._events.keys())},t.prototype.listeners=function(t){var e=this._events.get(t);if(!e)return[];if(e.fn)return[e.fn];for(var n=0,i=e.length,r=new Array(i);n<i;n++)r[n]=e[n].fn;return r},t.prototype.listenerCount=function(t){var e=this._events.get(t);return e?e.fn?1:e.length:0},t.prototype.emit=function(t){for(var e,n,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];if(!this._events.has(t))return!1;var o,a=this._events.get(t);if(a.fn)return a.once&&this.removeListener(t,a.fn,void 0,!0),(e=a.fn).call.apply(e,i([a.context],r)),!0;var l=a.length;for(o=0;o<l;o++)a[o].once&&this.removeListener(t,a[o].fn,void 0,!0),(n=a[o].fn).call.apply(n,i([a[o].context],r));return!0},t.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},t.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},t.prototype.removeListener=function(t,e,n,i){if(!this._events.has(t))return this;if(!e)return a(this,t),this;var r=this._events.get(t);if(r.fn)r.fn!==e||i&&!r.once||n&&r.context!==n||a(this,t);else{for(var s=0,o=[],l=r.length;s<l;s++)(r[s].fn!==e||i&&!r[s].once||n&&r[s].context!==n)&&o.push(r[s]);o.length?this._events.set(t,1===o.length?o[0]:o):a(this,t)}return this},t.prototype.removeAllListeners=function(t){return t?this._events.delete(t)&&a(this,t):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(t.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),t}();e.Events=l},5753:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VERSION=void 0,e.VERSION="0.0.5"}}]);
//# sourceMappingURL=450.1b345064.js.map